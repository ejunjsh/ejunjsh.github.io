<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[åˆ©ç”¨raspberry PI æ­å»ºä¸€ä¸ªç®€æ˜“çš„NAS]]></title>
      <url>/2017/07/20/raspberry-nas/</url>
      <content type="html"><![CDATA[<h1 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h1><ul>
<li>raspberry pi 3</li>
<li>ç¡¬ç›˜ï¼ˆæ ¼å¼åŒ–è¿‡ext4çš„ï¼‰</li>
<li>è¿æ¥raspberryç”¨çš„ç»ˆç«¯<a id="more"></a>
</li>
</ul>
<h1 id="å®‰è£…samba"><a href="#å®‰è£…samba" class="headerlink" title="å®‰è£…samba"></a>å®‰è£…samba</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo apt-get update</div><div class="line">sudo apt-get install samba samba-common-bin</div></pre></td></tr></table></figure>
<h1 id="é…ç½®samba"><a href="#é…ç½®samba" class="headerlink" title="é…ç½®samba"></a>é…ç½®samba</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.back</div><div class="line">sudo vim /etc/samba/smb.conf</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># åœ¨æœ«å°¾åŠ å…¥å¦‚ä¸‹å†…å®¹</span></div><div class="line"><span class="comment"># åˆ†äº«åç§°</span></div><div class="line">[MyNAS]</div><div class="line">    <span class="comment"># è¯´æ˜ä¿¡æ¯</span></div><div class="line">    comment = NAS Storage</div><div class="line">    <span class="comment"># å¯ä»¥è®¿é—®çš„ç”¨æˆ·</span></div><div class="line">    valid users = pi,root</div><div class="line">    <span class="comment"># å…±äº«æ–‡ä»¶çš„è·¯å¾„,raspberry pi ä¼šè‡ªåŠ¨å°†è¿æ¥åˆ°å…¶ä¸Šçš„å¤–æ¥å­˜å‚¨è®¾å¤‡æŒ‚è½½åˆ°/media/pi/ç›®å½•ä¸‹ã€‚</span></div><div class="line">    path = /media/pi/</div><div class="line">    <span class="comment"># å¯è¢«å…¶ä»–äººçœ‹åˆ°èµ„æºåç§°ï¼ˆéå†…å®¹ï¼‰</span></div><div class="line">    browseable = yes</div><div class="line">    <span class="comment"># å¯å†™</span></div><div class="line">    writable = yes</div><div class="line">    <span class="comment"># æ–°å»ºæ–‡ä»¶çš„æƒé™ä¸º 664</span></div><div class="line">    create mask = 0664</div><div class="line">    <span class="comment"># æ–°å»ºç›®å½•çš„æƒé™ä¸º 775</span></div><div class="line">    directory mask = 0775</div></pre></td></tr></table></figure>
<p>å¯ä»¥æŠŠé…ç½®æ–‡ä»¶ä¸­ä½ ä¸éœ€è¦çš„åˆ†äº«åç§°åˆ é™¤ï¼Œä¾‹å¦‚ [homes], [printers] ç­‰ã€‚<br>æµ‹è¯•é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰é”™è¯¯ï¼Œæ ¹æ®æç¤ºåšç›¸åº”ä¿®æ”¹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">testparm</div></pre></td></tr></table></figure></p>
<p>æ·»åŠ ç™»é™†è´¦æˆ·å¹¶åˆ›å»ºå¯†ç ï¼Œå¿…é¡»æ˜¯ linux å·²å­˜åœ¨çš„ç”¨æˆ·<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo smbpasswd -a pi</div></pre></td></tr></table></figure></p>
<p>é‡å¯ samba æœåŠ¡<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo /etc/init.d/samba restart</div></pre></td></tr></table></figure></p>
<h1 id="è¿æ¥"><a href="#è¿æ¥" class="headerlink" title="è¿æ¥"></a>è¿æ¥</h1><p>ä¸€èˆ¬æ ‘è“æ´¾è·Ÿä½ çš„WiFiç›¸è¿çš„è¯ï¼Œä½ çš„ç½‘ç»œå°±èƒ½çœ‹åˆ°è·Ÿä¸Šé¢é…ç½®ä¸€æ ·çš„åˆ†äº«åç§°ï¼Œå¦‚macä¸Šé¢è¿™æ ·çš„æ˜¾ç¤ºï¼š<br><a href="/images/nas-screenshot.png"><img src="/images/nas-screenshot.png" alt=""></a><br>å¦‚æœæ˜¾ç¤ºæ²¡æƒé™ï¼Œå¯ä»¥æ–­å¼€è¿æ¥ï¼Œç”¨ä½ ä¸Šé¢æ·»åŠ çš„è´¦å·ç™»å½•ã€‚</p>
]]></content>
      
        <categories>
            
            <category> raspberrypi </category>
            
        </categories>
        
        
        <tags>
            
            <tag> python </tag>
            
            <tag> raspberrypi </tag>
            
            <tag> NAS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ç”¨æ ‘è“æ´¾å®ç°ä¸€ä¸ªèƒ½æ’­æ”¾å¤©æ°”çš„é—¹é’Ÿ]]></title>
      <url>/2017/07/18/raspberry-weather-clock/</url>
      <content type="html"><![CDATA[<h1 id="å‰æ"><a href="#å‰æ" class="headerlink" title="å‰æ"></a>å‰æ</h1><p>ä½ è¦æœ‰ä¸ªpiğŸ˜„<br><a id="more"></a></p>
<h1 id="è·å–å¤©æ°”æ¥å£"><a href="#è·å–å¤©æ°”æ¥å£" class="headerlink" title="è·å–å¤©æ°”æ¥å£"></a>è·å–å¤©æ°”æ¥å£</h1><p>è¿™é‡Œæˆ‘æ˜¯ç”¨å›¾çµæœºå™¨äººæ¥è·å–å¤©æ°”çš„æ¥å£ï¼Œä½ å¯ä»¥è‡ªå·±ä¸Šå»æ³¨å†Œä¸€ä¸ªï¼Œä¸‹é¢ä»£ç URLçš„Keyæ˜¯æˆ‘æ³¨å†Œçš„æœºå™¨äººç»™çš„ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getWeatherText</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        response = requests.get(</div><div class="line">            <span class="string">"http://www.tuling123.com/openapi/api?key=652ae4a714794fe6b01faa990d7a981f&amp;info=%s"</span> % <span class="string">"å¹¿å·ä»Šæ—¥å¤©æ°”"</span>)</div><div class="line">        json = response.json()</div><div class="line">        <span class="keyword">if</span> json[<span class="string">"code"</span>] == <span class="number">100000</span>:</div><div class="line">            <span class="keyword">return</span> json[<span class="string">"text"</span>]</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">return</span> <span class="string">""</span></div><div class="line">    <span class="keyword">except</span>:</div><div class="line">        <span class="keyword">return</span> <span class="string">""</span></div></pre></td></tr></table></figure></p>
<h1 id="æ’­æ”¾æ–‡å­—"><a href="#æ’­æ”¾æ–‡å­—" class="headerlink" title="æ’­æ”¾æ–‡å­—"></a>æ’­æ”¾æ–‡å­—</h1><p>åˆ©ç”¨ç™¾åº¦çš„æ¥å£å¯ä»¥è½¬æ¢æ–‡æœ¬ä¸ºè¯­éŸ³ã€‚é»˜è®¤åªæœ‰å¥³å£°<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">text2voice</span><span class="params">(text)</span>:</span></div><div class="line">    url = <span class="string">'http://tts.baidu.com/text2audio?idx=1&amp;tex=&#123;0&#125;&amp;cuid=baidu_speech_'</span> \</div><div class="line">          <span class="string">'demo&amp;cod=2&amp;lan=zh&amp;ctp=1&amp;pdt=1&amp;spd=4&amp;per=4&amp;vol=5&amp;pit=5'</span>.format(text)</div><div class="line">    <span class="comment"># ç”¨mplayeræ’­æ”¾è¯­éŸ³</span></div><div class="line">    os.system(<span class="string">'mplayer "%s"'</span> % url)</div></pre></td></tr></table></figure></p>
<h1 id="å®‰è£…æ’­æ”¾åª’ä½“è½¯ä»¶"><a href="#å®‰è£…æ’­æ”¾åª’ä½“è½¯ä»¶" class="headerlink" title="å®‰è£…æ’­æ”¾åª’ä½“è½¯ä»¶"></a>å®‰è£…æ’­æ”¾åª’ä½“è½¯ä»¶</h1><p>ä¸Šé¢ä»£ç ä½ çœ‹åˆ°çš„<code>mplayer</code>,å°±æ˜¯ç”¨æ¥æ’­æ”¾è¯­éŸ³çš„ï¼Œä¼ ä¸ªurlä½œä¸ºå‚æ•°<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install mplayer</div><div class="line">usage: mplayer [url]</div></pre></td></tr></table></figure></p>
<h1 id="æ’­æ”¾éŸ³ä¹"><a href="#æ’­æ”¾éŸ³ä¹" class="headerlink" title="æ’­æ”¾éŸ³ä¹"></a>æ’­æ”¾éŸ³ä¹</h1><p>æœ‰äº†ä¸Šé¢è¿™ä¸ªç¥å™¨ï¼Œä½ å¯ä»¥ç»™æ’­æŠ¥è¯­éŸ³å‰ååŠ ä¸€é¦–éŸ³ä¹ğŸ˜„<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">playMusic</span><span class="params">(path)</span>:</span></div><div class="line">    os.system(<span class="string">'mplayer %s'</span> % path)</div></pre></td></tr></table></figure></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åˆ©ç”¨ä¸Šé¢çš„ä¸œä¸œï¼Œå¯ä»¥ç»„åˆäº›å¥½ç©çš„ä¸œè¥¿äº†ï¼Œè‡³äºé—¹é’Ÿçš„å”¤é†’ï¼Œå¯ä»¥crob job åšï¼Œä¹Ÿå¯ä»¥ä»£ç é‡Œé¢å®ç°ï¼Œenjoyâ€¦ğŸ˜„<br>å…¨éƒ¨ä»£ç åœ°å€ <a href="https://github.com/ejunjsh/raspberrypi-code/blob/master/clock/weather.py" target="_blank" rel="external">https://github.com/ejunjsh/raspberrypi-code/blob/master/clock/weather.py</a></p>
]]></content>
      
        <categories>
            
            <category> raspberrypi </category>
            
        </categories>
        
        
        <tags>
            
            <tag> python </tag>
            
            <tag> raspberrypi </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ç”¨goå®ç°ä¸€ä¸ªç®€å•çš„restfulæ¥å£]]></title>
      <url>/2017/07/18/go-first-rest/</url>
      <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>goçš„æ ‡å‡†åº“<code>http</code>å·²ç»å°è£…å¥½å¾ˆå¤šæ¥å£ï¼Œå¯ä»¥å¾ˆç®€å•å®ç°ä¸€ä¸ªwebæœåŠ¡å™¨ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// å®šä¹‰ handler</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">HelloServer</span><span class="params">(w http.ResponseWriter, req *http.Request)</span></span> &#123;</div><div class="line">    io.WriteString(w, <span class="string">"hello, world!\n"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="comment">//ç»‘å®špatternå’Œhandler</span></div><div class="line">    http.HandleFunc(<span class="string">"/hello"</span>, HelloServer)</div><div class="line">    err := http.ListenAndServe(<span class="string">":12345"</span>, <span class="literal">nil</span>)</div><div class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">        log.Fatal(<span class="string">"ListenAndServe: "</span>, err)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åŸºäºä¸Šé¢ä¾‹å­å¯ä»¥å°è£…ä¸€ä¸ªrestfulæ¥å£ï¼Œä¸æ˜¯éš¾äº‹ã€‚<br><a id="more"></a></p>
<h1 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h1><p>ä»ä¸Šé¢ä¾‹å­å¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªurl patternå¯¹åº”ä¸€ä¸ªhandlerï¼Œå³å¯¹åº”ä¸€ä¸ªå¤„ç†ï¼Œå°±å¯ä»¥å¤„ç†httpè¯·æ±‚äº†ï¼Œæ‰€ä»¥ä¸‹é¢çš„å®ç°æ˜¯åŸºäºå¯¹è¿™ä¸¤ä¸ªä¸œè¥¿çš„å°è£…å¼€å§‹</p>
<h2 id="å°è£…ä¸€ä¸ªrestful-app-ç»“æ„"><a href="#å°è£…ä¸€ä¸ªrestful-app-ç»“æ„" class="headerlink" title="å°è£…ä¸€ä¸ªrestful app ç»“æ„"></a>å°è£…ä¸€ä¸ªrestful app ç»“æ„</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> App <span class="keyword">struct</span> &#123;</div><div class="line">    <span class="comment">//ä¸€ä¸ªmapï¼Œkeyæ˜¯patternï¼Œvalueæ˜¯handler</span></div><div class="line">	handlers <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="function"><span class="keyword">func</span><span class="params">(r *HttpRequest,w HttpResponse)</span><span class="title">error</span></span></div><div class="line">    //<span class="title">pattern</span>æ•°ç»„ï¼Œç”¨æ¥ä¿è¯åŠ å…¥<span class="title">pattern</span>çš„é¡ºåºï¼Œå› ä¸ºä¸Šé¢çš„<span class="title">map</span>æ˜¯æ— é¡ºåºçš„</div><div class="line">	<span class="title">patterns</span> []<span class="title">string</span></div><div class="line">    //ä¸€ä¸ª<span class="title">map</span>ï¼Œ<span class="title">key</span>æ˜¯<span class="title">pattern</span>ï¼Œ<span class="title">value</span>æ˜¯<span class="title">http</span> <span class="title">method</span></div><div class="line">	<span class="title">methods</span> <span class="title">map</span>[<span class="title">string</span>]<span class="title">string</span></div><div class="line">    //ç”¨æ¥å®ç°åœ¨<span class="title">url</span> <span class="title">path</span>å–å‡ºå‚æ•°çš„ã€‚</div><div class="line">	<span class="title">regexps</span> <span class="title">map</span>[<span class="title">string</span>]*<span class="title">regexp</span>.<span class="title">Regexp</span></div><div class="line">	<span class="title">pathparamanmes</span> <span class="title">map</span>[<span class="title">string</span>][]<span class="title">string</span></div><div class="line">    //ç”¨æ¥å¤„ç†å¼‚å¸¸çš„<span class="title">handler</span></div><div class="line">	<span class="title">errHandler</span> <span class="title">func</span><span class="params">( err error, r *HttpRequest,w HttpResponse)</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åˆå§‹åŒ–å‡½æ•°<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewApp</span><span class="params">()</span> *<span class="title">App</span></span> &#123;</div><div class="line">	<span class="keyword">return</span> &amp;App&#123;</div><div class="line">		handlers: <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="function"><span class="keyword">func</span><span class="params">(r *HttpRequest,w HttpResponse)</span><span class="title">error</span>),</span></div><div class="line">		<span class="title">patterns</span>:<span class="title">make</span><span class="params">([]<span class="keyword">string</span>,0)</span>,</div><div class="line">		<span class="title">methods</span>:<span class="title">make</span><span class="params">(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span>,</div><div class="line">		<span class="title">regexps</span>:<span class="title">make</span><span class="params">(<span class="keyword">map</span>[<span class="keyword">string</span>]*regexp.Regexp)</span>,</div><div class="line">		<span class="title">pathparamanmes</span>:<span class="title">make</span><span class="params">(<span class="keyword">map</span>[<span class="keyword">string</span>][]<span class="keyword">string</span>)</span>,</div><div class="line">        //ä¸€ä¸ªé»˜è®¤çš„å¼‚å¸¸å¤„ç†ï¼Œç›´æ¥è¿”å›å¼‚å¸¸å†…å®¹</div><div class="line">		<span class="title">errHandler</span>: <span class="title">func</span><span class="params">(err error, r *HttpRequest, w HttpResponse)</span> &#123;</div><div class="line">			w.Write( []<span class="keyword">byte</span>(err.Error()))</div><div class="line">		&#125;,</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="æ˜ å°„ç»‘å®š"><a href="#æ˜ å°„ç»‘å®š" class="headerlink" title="æ˜ å°„ç»‘å®š"></a>æ˜ å°„ç»‘å®š</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span><span class="params">(a *App)</span> <span class="title">handle</span><span class="params">(method <span class="keyword">string</span>,pattern <span class="keyword">string</span>, handler <span class="keyword">func</span>(r *HttpRequest,w HttpResponse)</span> <span class="title">error</span>)</span>&#123;</div><div class="line">    <span class="comment">//ç»‘å®špatternå’Œhandler</span></div><div class="line">	a.handlers[pattern]=handler</div><div class="line">    <span class="comment">//ç»‘å®špatternå’Œmethod</span></div><div class="line">	a.methods[pattern]=method</div><div class="line">    <span class="comment">//ç»‘å®špattern æ­£åˆ™ï¼Œç”¨æ¥åŒ¹é…url pattern,å’Œè·å–url path å‚æ•°</span></div><div class="line">	a.regexps[pattern],a.pathparamanmes[pattern]=convertPatterntoRegex(pattern)</div><div class="line">	<span class="keyword">for</span> _,s:=<span class="keyword">range</span> a.patterns&#123;</div><div class="line">		<span class="keyword">if</span> s==pattern&#123;</div><div class="line">			<span class="keyword">return</span></div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">    <span class="comment">//åŠ å…¥æ•°ç»„ï¼Œæ–¹ä¾¿ç”¨æ­¤æ•°ç»„ç¡®å®šé¡ºåº</span></div><div class="line">	a.patterns=<span class="built_in">append</span>(a.patterns,pattern)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *App)</span> <span class="title">Get</span><span class="params">(pattern <span class="keyword">string</span>, handler <span class="keyword">func</span>(r *HttpRequest,w HttpResponse)</span><span class="title">error</span>)</span>  &#123;</div><div class="line">	a.handle(<span class="string">"GET"</span>,pattern,handler)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *App)</span> <span class="title">Post</span><span class="params">(pattern <span class="keyword">string</span>, handler <span class="keyword">func</span>(r *HttpRequest,w HttpResponse)</span><span class="title">error</span>)</span>  &#123;</div><div class="line">	a.handle(<span class="string">"POST"</span>,pattern,handler)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *App)</span> <span class="title">Delete</span><span class="params">(pattern <span class="keyword">string</span>, handler <span class="keyword">func</span>(r *HttpRequest,w HttpResponse)</span><span class="title">error</span>)</span>  &#123;</div><div class="line">	a.handle(<span class="string">"DELETE"</span>,pattern,handler)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *App)</span> <span class="title">Put</span><span class="params">(pattern <span class="keyword">string</span>, handler <span class="keyword">func</span>(r *HttpRequest,w HttpResponse)</span> <span class="title">error</span>)</span>  &#123;</div><div class="line">	a.handle(<span class="string">"PUT"</span>,pattern,handler)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *App)</span> <span class="title">Error</span><span class="params">(handler <span class="keyword">func</span>(err error,r *HttpRequest,w HttpResponse)</span>)</span>  &#123;</div><div class="line">	a.errHandler=handler</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æœ‰äº†æ˜ å°„ç»‘å®šäº†ï¼Œå°±è¦è¯·æ±‚èƒ½è¿›åˆ°æ¥ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥è¦å†™ä¸ªå…¥å£æ‰è¡Œã€‚</p>
<h2 id="ç¼–å†™httpå…¥å£"><a href="#ç¼–å†™httpå…¥å£" class="headerlink" title="ç¼–å†™httpå…¥å£"></a>ç¼–å†™httpå…¥å£</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//http å…¥å£</span></div><div class="line"><span class="function"><span class="keyword">func</span><span class="params">(a *App)</span> <span class="title">Run</span><span class="params">(address <span class="keyword">string</span>)</span> <span class="title">error</span></span>&#123;</div><div class="line">	fmt.Printf(<span class="string">"Server listens on %s"</span>,address)</div><div class="line">	err:=http.ListenAndServe(address,&amp;hodler&#123;app:a&#125;)</div><div class="line">	<span class="keyword">if</span> err!=<span class="literal">nil</span>&#123;</div><div class="line">		<span class="keyword">return</span> err</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//https å…¥å£</span></div><div class="line"><span class="function"><span class="keyword">func</span><span class="params">(a *App)</span> <span class="title">RunTls</span><span class="params">(address <span class="keyword">string</span>,cert <span class="keyword">string</span>,key <span class="keyword">string</span>)</span> <span class="title">error</span></span>&#123;</div><div class="line">	fmt.Printf(<span class="string">"Server listens on %s"</span>,address)</div><div class="line">	err:=http.ListenAndServeTLS(address,cert,key,&amp;hodler&#123;app:a&#125;)</div><div class="line">	<span class="keyword">if</span> err!=<span class="literal">nil</span>&#123;</div><div class="line">		<span class="keyword">return</span> err</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å…¥å£å‡½æ•°ä¸»è¦è°ƒç”¨<code>http</code>åº“æ¥å¯åŠ¨httpæœåŠ¡ï¼Œç„¶åæŠŠè¯·æ±‚å¤„ç†å‡½æ•°ä½œä¸º<code>ListenAndServe</code>ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ã€‚è¿™é‡Œç”±<code>holder</code>æ¥å®ç°è¿™ä¸ªå¤„ç†å‡½æ•°ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *hodler)</span> <span class="title">ServeHTTP</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span>&#123;</div><div class="line">	<span class="comment">//å°è£…ä¸€ä¸‹ï¼Œé™„åŠ æ›´å¤šåŠŸèƒ½</span></div><div class="line">    request:= newHttpRequest(r)</div><div class="line">	response:=newHttpResponse(w)</div><div class="line">	<span class="comment">//æ•è·panicï¼Œå¹¶è®©errhandlerå¤„ç†è¿”å›ã€‚</span></div><div class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</div><div class="line">		<span class="keyword">if</span> err:=<span class="built_in">recover</span>();err!=<span class="literal">nil</span>&#123;</div><div class="line">			<span class="keyword">if</span> e,ok:=err.(error);ok&#123;</div><div class="line">				h.app.errHandler(InternalError&#123;e,<span class="string">""</span>&#125;,request,response)</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span> e,ok:=err.(<span class="keyword">string</span>);ok&#123;</div><div class="line">				h.app.errHandler(InternalError&#123;<span class="literal">nil</span>,e&#125;,request,response)</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;()</div><div class="line">    <span class="comment">//æ ¹æ®patternçš„æ·»åŠ é¡ºåºï¼Œå¾ªç¯åˆ¤æ–­</span></div><div class="line">   <span class="keyword">for</span> _,p:=<span class="keyword">range</span> h.app.patterns&#123;</div><div class="line">       <span class="keyword">if</span> reg,ok:= h.app.regexps[p];ok&#123;</div><div class="line">           <span class="comment">//åŒ¹é…method</span></div><div class="line">		   <span class="keyword">if</span> method,ok:=h.app.methods[p];ok&amp;&amp;r.Method==method&#123;</div><div class="line">              <span class="comment">//åŒ¹é…pattern</span></div><div class="line">			   <span class="keyword">if</span> reg.Match([]<span class="keyword">byte</span>(r.URL.Path)) &#123;</div><div class="line">                   <span class="comment">//æŠ½å–url path parameters</span></div><div class="line">				   matchers:=reg.FindSubmatch([]<span class="keyword">byte</span>(r.URL.Path))</div><div class="line">				   pathParamMap:=<span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</div><div class="line">				   <span class="keyword">if</span> <span class="built_in">len</span>(matchers)&gt;<span class="number">1</span>&#123;</div><div class="line">                       <span class="keyword">if</span> pathParamNames,ok:=h.app.pathparamanmes[p];ok&#123;</div><div class="line">						   <span class="keyword">for</span> i:=<span class="number">1</span>;i&lt;<span class="built_in">len</span>(matchers);i++&#123;</div><div class="line">							   pathParamMap[pathParamNames[i]]=<span class="keyword">string</span>(matchers[i])</div><div class="line">						   &#125;</div><div class="line">					   &#125;</div><div class="line">				   &#125;</div><div class="line">                   <span class="comment">//PathParamsæ˜¯å°è£…åçš„requestç‹¬æœ‰çš„å±æ€§</span></div><div class="line">				   request.PathParams=pathParamMap</div><div class="line">				   <span class="keyword">if</span> handler,ok:=h.app.handlers[p];ok&#123;</div><div class="line">                       <span class="comment">//æ‰§è¡Œhandler</span></div><div class="line">					   err:=handler(request,response)</div><div class="line">					   <span class="keyword">if</span> err!=<span class="literal">nil</span>&#123;</div><div class="line">                           <span class="comment">//æ‰§è¡Œerrhandler</span></div><div class="line">						   h.app.errHandler(err,request,response)</div><div class="line">					   &#125;</div><div class="line">					   <span class="keyword">return</span></div><div class="line">				   &#125;</div><div class="line">			   &#125;</div><div class="line">		   &#125;</div><div class="line">	   &#125;</div><div class="line">   &#125;</div><div class="line">   <span class="comment">//æ‰§è¡Œno found errhandler</span></div><div class="line">	h.app.errHandler(NoFoundError&#123;&#125;,request,response)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åŸºæœ¬ä¸€ä¸ªè¯·æ±‚çš„æµç¨‹å¦‚ä¸‹ï¼š<br>requset-&gt;ServeHTTP()-&gt;åŒ¹é…url pattern-&gt;åŒ¹é…method-&gt;åŒ¹é…åˆ°ä½ çš„handler-&gt;æ‰§è¡Œä½ çš„handler-&gt;è¿”å›ç»“æœ</p>
<h2 id="è¿”å›ç»“æœ"><a href="#è¿”å›ç»“æœ" class="headerlink" title="è¿”å›ç»“æœ"></a>è¿”å›ç»“æœ</h2><p>ç”±äºè¿”å›ç»“æœå¯ä»¥æœ‰å¾ˆå¤šï¼Œæ‰€ä»¥å°è£…äº†<code>http</code>åº“çš„<code>http.ResponseWriter</code>æ¥å®ç°<code>WriteString,WriteJson,WriteXml,WriteFile</code>ç­‰æ–¹æ³•ã€‚</p>
<pre><code class="go"><span class="comment">//å°è£…requestï¼Œé™„ä»¶ä¸€ä¸ªPathParamsæ¥ä¿å­˜url path parameters.</span>
<span class="keyword">type</span> HttpRequest <span class="keyword">struct</span> {
    *http.Request
    PathParams <span class="keyword">map</span>[<span class="keyword">string</span>] <span class="keyword">string</span>
}

<span class="keyword">type</span> HttpResponse <span class="keyword">struct</span> {
    http.ResponseWriter
}
<span class="function"><span class="keyword">func</span> <span class="params">(response *HttpResponse)</span> <span class="title">WriteString</span><span class="params">(str <span class="keyword">string</span>)</span> <span class="title">error</span></span> {
    ...
}

<span class="function"><span class="keyword">func</span> <span class="params">(response *HttpResponse)</span> <span class="title">WriteJson</span><span class="params">(jsonObj <span class="keyword">interface</span>{})</span> <span class="title">error</span></span> {
    ...
}

<span class="function"><span class="keyword">func</span> <span class="params">(response *HttpResponse)</span> <span class="title">WriteXml</span><span class="params">(xmlObj <span class="keyword">interface</span>{})</span> <span class="title">error</span></span> {
    ...
}

<span class="function"><span class="keyword">func</span> <span class="params">(response *HttpResponse)</span> <span class="title">WriteFile</span><span class="params">(filepath <span class="keyword">string</span>)</span> <span class="title">error</span></span> {
    ...
}

<span class="function"><span class="keyword">func</span> <span class="params">(response *HttpResponse)</span> <span class="title">WriteTemplates</span><span class="params">(data <span class="keyword">interface</span>{},tplPath ...<span class="keyword">string</span>)</span> <span class="title">error</span></span>  {
    ...
}
</code></pre>
<h1 id="github-åœ°å€"><a href="#github-åœ°å€" class="headerlink" title="github åœ°å€"></a>github åœ°å€</h1><p>æ‰€æœ‰ä»£ç è§<a href="https://github.com/ejunjsh/gorest" target="_blank" rel="external">https://github.com/ejunjsh/gorest</a></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>goçš„æ ‡å‡†åº“å°è£…äº†å¾ˆå¤šäº†ï¼Œæ‰€ä»¥å®ç°è¿™ä¸ªå…¶å®è¿˜æ˜¯æ¯”è¾ƒè½»æ¾çš„ğŸ˜„</p>
]]></content>
      
        <categories>
            
            <category> go </category>
            
        </categories>
        
        
        <tags>
            
            <tag> go </tag>
            
            <tag> restful </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ä¸€å¼ å›¾äº†è§£ä¸€è‡´æ€§hash]]></title>
      <url>/2017/07/16/consistent-hash/</url>
      <content type="html"><![CDATA[<p><a href="/images/consistent-hash.png"><img src="/images/consistent-hash.png" alt="one image describes how consistent-hash works"></a><br><a id="more"></a></p>
]]></content>
      
        <categories>
            
            <category> java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> java </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ä¸€å¼ å›¾äº†è§£hashmap]]></title>
      <url>/2017/07/15/hashmap/</url>
      <content type="html"><![CDATA[<p><a href="/images/hashmap.png"><img src="/images/hashmap.png" alt="one image describes how hashmap works"></a><br><a id="more"></a></p>
]]></content>
      
        <categories>
            
            <category> java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> java </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[pythonåœ¨ä¸åŒå±‚çº§ç›®å½•importæ¨¡å—çš„æ–¹æ³•]]></title>
      <url>/2015/02/18/python-import-module/</url>
      <content type="html"><![CDATA[<blockquote>
<p>ä½¿ç”¨pythonè¿›è¡Œç¨‹åºç¼–å†™æ—¶ï¼Œç»å¸¸ä¼šä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—åŒ…ã€‚è¿™ç§åŒ…æˆ‘ä»¬å¯ä»¥é€šè¿‡python setup install è¿›è¡Œå®‰è£…åï¼Œé€šè¿‡import XXXæˆ–from XXX import yyy è¿›è¡Œå¯¼å…¥ã€‚ä¸è¿‡å¦‚æœæ˜¯è‡ªå·±éå†™çš„ä¾èµ–åŒ…ï¼Œåˆä¸æƒ³å®‰è£…åˆ°pythonçš„ç›¸åº”ç›®å½•ï¼Œå¯ä»¥æ”¾åˆ°æœ¬ç›®å½•é‡Œè¿›è¡Œimportè¿›è¡Œè°ƒç”¨ï¼›ä¸ºäº†æ›´æ¸…æ™°çš„ç†æ¸…ç¨‹åºä¹‹é—´çš„å…³ç³»ï¼Œä¾‹å¦‚æˆ‘ä»¬ä¼šæŠŠè¿™ç§åŒ…æ”¾åˆ°libç›®å½•å†è°ƒç”¨ã€‚æœ¬ç¯‡å°±é’ˆå¯¹å¸¸è§çš„æ¨¡å—è°ƒç”¨æ–¹æ³•æ±‡æ€»ä¸‹ã€‚</p>
</blockquote>
<a id="more"></a>
<h1 id="åŒçº§ç›®å½•ä¸‹çš„è°ƒæœ‰"><a href="#åŒçº§ç›®å½•ä¸‹çš„è°ƒæœ‰" class="headerlink" title="åŒçº§ç›®å½•ä¸‹çš„è°ƒæœ‰"></a>åŒçº§ç›®å½•ä¸‹çš„è°ƒæœ‰</h1><p>ç¨‹åºç»“æ„å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">-- src</div><div class="line">    |-- mod1.py</div><div class="line">    |-- test1.py</div></pre></td></tr></table></figure></p>
<p>è‹¥åœ¨ç¨‹åºtest1.pyä¸­å¯¼å…¥æ¨¡å—mod1, åˆ™ç›´æ¥ä½¿ç”¨<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> mod1</div><div class="line">æˆ–</div><div class="line"><span class="keyword">from</span> mod1 <span class="keyword">import</span> *;</div></pre></td></tr></table></figure></p>
<h1 id="è°ƒç”¨å­ç›®å½•ä¸‹çš„æ¨¡å—"><a href="#è°ƒç”¨å­ç›®å½•ä¸‹çš„æ¨¡å—" class="headerlink" title="è°ƒç”¨å­ç›®å½•ä¸‹çš„æ¨¡å—"></a>è°ƒç”¨å­ç›®å½•ä¸‹çš„æ¨¡å—</h1><p>ç¨‹åºç»“æ„å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">-- src</div><div class="line">    |-- mod1.py</div><div class="line">    |-- lib</div><div class="line">    |    |-- mod2.py</div><div class="line">    |-- test1.py</div></pre></td></tr></table></figure></p>
<p>è¿™æ—¶çœ‹åˆ°test1.pyå’Œlibç›®å½•ï¼ˆå³mod2.pyçš„çˆ¶çº§ç›®å½•ï¼‰ï¼Œå¦‚æœæƒ³åœ¨ç¨‹åºtest1.pyä¸­å¯¼å…¥æ¨¡å—mod2.py ï¼Œå¯ä»¥åœ¨libä»¶å¤¹ä¸­å»ºç«‹ç©ºæ–‡ä»¶<strong>init</strong>.pyæ–‡ä»¶(ä¹Ÿå¯ä»¥åœ¨è¯¥æ–‡ä»¶ä¸­è‡ªå®šä¹‰è¾“å‡ºæ¨¡å—æ¥å£)ï¼Œç„¶åä½¿ç”¨ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> lib.mod2 <span class="keyword">import</span> *</div><div class="line">æˆ–</div><div class="line"><span class="keyword">import</span> lib.mod2</div></pre></td></tr></table></figure></p>
<h1 id="è°ƒç”¨ä¸Šçº§ç›®å½•ä¸‹çš„æ–‡ä»¶"><a href="#è°ƒç”¨ä¸Šçº§ç›®å½•ä¸‹çš„æ–‡ä»¶" class="headerlink" title="è°ƒç”¨ä¸Šçº§ç›®å½•ä¸‹çš„æ–‡ä»¶"></a>è°ƒç”¨ä¸Šçº§ç›®å½•ä¸‹çš„æ–‡ä»¶</h1><p>ç¨‹åºç»“æ„å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">-- src</div><div class="line">    |-- mod1.py</div><div class="line">    |-- lib</div><div class="line">    |    |-- mod2.py</div><div class="line">    |-- sub</div><div class="line">    |    |-- test2.py</div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæƒ³è¦å®ç°test2.pyè°ƒç”¨mod1.pyå’Œmod2.py ï¼Œåšæ³•æ˜¯æˆ‘ä»¬å…ˆè·³åˆ°srcç›®å½•ä¸‹é¢ï¼Œç›´æ¥å¯ä»¥è°ƒç”¨mod1ï¼Œç„¶ååœ¨libä¸Šå½“ä¸‹å»ºä¸€ä¸ªç©ºæ–‡ä»¶<strong>init</strong>.py ï¼Œå°±å¯ä»¥åƒç¬¬äºŒæ­¥è°ƒç”¨å­ç›®å½•ä¸‹çš„æ¨¡å—ä¸€æ ·ï¼Œé€šè¿‡import  lib.mod2è¿›è¡Œè°ƒç”¨äº†ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> sys</div><div class="line">sys.path.append(<span class="string">".."</span>)</div><div class="line"><span class="keyword">import</span> mod1</div><div class="line"><span class="keyword">import</span> lib.mod2</div></pre></td></tr></table></figure></p>
]]></content>
      
        <categories>
            
            <category> pythonåŸºç¡€ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> python </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[centos å¯ç”¨ftpåŠŸèƒ½]]></title>
      <url>/2014/08/17/centos-ftp/</url>
      <content type="html"><![CDATA[<p>1.å®‰è£…vsftpdç»„ä»¶ï¼Œå®‰è£…å®Œåï¼Œæœ‰/etc/vsftpd/vsftpd.conf æ–‡ä»¶ï¼Œç”¨æ¥é…ç½®ï¼Œè¿˜æœ‰æ–°å»ºäº†ä¸€ä¸ªftpç”¨æˆ·å’Œftpçš„ç»„ï¼ŒæŒ‡å‘homeç›®å½•ä¸º/var/ftp,é»˜è®¤æ˜¯nologinï¼ˆä¸èƒ½ç™»å½•ç³»ç»Ÿï¼‰<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install vsftpd</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>å¯ä»¥ç”¨ä¸‹é¢å‘½ä»¤æŸ¥çœ‹ç”¨æˆ·<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat /etc/passwd</div></pre></td></tr></table></figure></p>
<p>é»˜è®¤ftpæœåŠ¡æ˜¯æ²¡æœ‰å¯åŠ¨çš„ï¼Œç”¨ä¸‹é¢å‘½ä»¤å¯åŠ¨<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service vsftpd start</div></pre></td></tr></table></figure></p>
<p>2.å®‰è£…ftpå®¢æˆ·ç«¯ç»„ä»¶ï¼ˆç”¨æ¥éªŒè¯æ˜¯å¦vsftpdï¼‰<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install ftp</div></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œå‘½ä»¤å°è¯•ç™»å½•<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ftp localhost</div></pre></td></tr></table></figure></p>
<p>è¾“å…¥ç”¨æˆ·åftpï¼Œå¯†ç éšä¾¿ï¼ˆå› ä¸ºé»˜è®¤æ˜¯å…è®¸åŒ¿åçš„ï¼‰</p>
<p>ç™»å½•æˆåŠŸï¼Œå°±ä»£è¡¨ftpæœåŠ¡å¯ç”¨äº†ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¤–ç½‘æ˜¯è®¿é—®ä¸äº†çš„ï¼Œæ‰€ä»¥è¿˜è¦ç»§ç»­é…ç½®ã€‚</p>
<p>3.å–æ¶ˆåŒ¿åç™»é™†<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /etc/vsftpd/vsftpd.conf</div></pre></td></tr></table></figure></p>
<p>æŠŠç¬¬ä¸€è¡Œçš„ anonymous_enable=YES ï¼Œæ”¹ä¸ºNO<br>é‡å¯<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service vsftpd restart</div></pre></td></tr></table></figure></p>
<p>4.æ–°å»ºä¸€ä¸ªç”¨æˆ·(ftpuserä¸ºç”¨æˆ·åï¼Œéšä¾¿å°±å¯ä»¥)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">useradd ftpuser</div></pre></td></tr></table></figure></p>
<p>ä¿®æ”¹å¯†ç ï¼ˆè¾“å…¥ä¸¤æ¬¡ï¼‰<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">passwd ftpuser</div></pre></td></tr></table></figure></p>
<p>è¿™æ ·ä¸€ä¸ªç”¨æˆ·å»ºå®Œï¼Œå¯ä»¥ç”¨è¿™ä¸ªç™»å½•ï¼Œè®°å¾—ç”¨æ™®é€šç™»å½•ä¸è¦ç”¨åŒ¿åäº†ã€‚ç™»å½•åé»˜è®¤çš„è·¯å¾„ä¸º /home/ftpuser.</p>
<p>5.å¼€æ”¾21ç«¯å£</p>
<p>å› ä¸ºftpé»˜è®¤çš„ç«¯å£ä¸º21ï¼Œè€Œcentosé»˜è®¤æ˜¯æ²¡æœ‰å¼€å¯çš„ï¼Œæ‰€ä»¥è¦ä¿®æ”¹iptablesæ–‡ä»¶<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vi /etc/sysconfig/iptables</div></pre></td></tr></table></figure></p>
<p>åœ¨è¡Œä¸Šé¢æœ‰22 -j ACCEPT ä¸‹é¢å¦èµ·ä¸€è¡Œè¾“å…¥è·Ÿé‚£è¡Œå·®ä¸å¤šçš„ï¼Œåªæ˜¯æŠŠ22æ¢æˆ21ï¼Œç„¶åï¼šwqä¿å­˜ã€‚<br>è¿˜è¦è¿è¡Œä¸‹,é‡å¯iptables<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service iptables restart</div></pre></td></tr></table></figure></p>
<p>å¤–ç½‘æ˜¯å¯ä»¥è®¿é—®ä¸Šå»äº†ï¼Œå¯æ˜¯å‘ç°æ²¡æ³•è¿”å›ç›®å½•ï¼Œä¹Ÿä¸Šä¼ ä¸äº†ï¼Œå› ä¸ºselinuxä½œæ€ªäº†ã€‚<br>6.ä¿®æ”¹selinux<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">getsebool -a | grep ftp</div></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œä¸Šé¢å‘½ä»¤ï¼Œå†è¿”å›çš„ç»“æœçœ‹åˆ°ä¸¤è¡Œéƒ½æ˜¯offï¼Œä»£è¡¨ï¼Œæ²¡æœ‰å¼€å¯å¤–ç½‘çš„è®¿é—®<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">.... </div><div class="line">allow_ftpd_full_access off </div><div class="line">....</div><div class="line">....</div><div class="line">ftp_home_dir off</div></pre></td></tr></table></figure></p>
<p>åªè¦æŠŠä¸Šé¢éƒ½å˜æˆonå°±è¡Œ<br>æ‰§è¡Œ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">setsebool -P allow_ftpd_full_access 1 </div><div class="line">setsebool -P ftp_home_dir off 1</div></pre></td></tr></table></figure></p>
<p>å†é‡å¯ä¸€ä¸‹vsftpd<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service vsftpd restart</div></pre></td></tr></table></figure></p>
<p>è¿™æ ·åº”è¯¥æ²¡é—®é¢˜äº†ï¼ˆå¦‚æœï¼Œè¿˜æ˜¯ä¸è¡Œï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯ç”¨äº†ftpå®¢æˆ·ç«¯å·¥å…·ç”¨äº†passiveæ¨¡å¼è®¿é—®äº†ï¼Œå¦‚æç¤ºEntering Passive modeï¼Œå°±ä»£è¡¨æ˜¯passiveæ¨¡å¼ï¼Œé»˜è®¤æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºftp passiveæ¨¡å¼è¢«iptablesæŒ¡ä½äº†ï¼Œä¸‹é¢ä¼šè®²æ€ä¹ˆå¼€å¯ï¼Œå¦‚æœæ‡’å¾—å¼€çš„è¯ï¼Œå°±çœ‹çœ‹ä½ å®¢æˆ·ç«¯ftpæ˜¯å¦æœ‰portæ¨¡å¼çš„é€‰é¡¹ï¼Œæˆ–è€…æŠŠpassiveæ¨¡å¼çš„é€‰é¡¹å»æ‰ã€‚å¦‚æœå®¢æˆ·ç«¯è¿˜æ˜¯ä¸è¡Œï¼Œçœ‹çœ‹å®¢æˆ·ç«¯ä¸Šçš„ä¸»æœºçš„ç”µè„‘æ˜¯å¦å¼€äº†é˜²ç«å¢™ï¼Œå…³å§ï¼‰</p>
<p>7.å¼€å¯passiveæ¨¡å¼</p>
<p>é»˜è®¤æ˜¯å¼€å¯çš„ï¼Œä½†æ˜¯è¦æŒ‡å®šä¸€ä¸ªç«¯å£èŒƒå›´ï¼Œæ‰“å¼€vsftpd.confæ–‡ä»¶ï¼Œåœ¨åé¢åŠ ä¸Š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">pasv_min_port=30000</div><div class="line"></div><div class="line">pasv_max_port=30999</div></pre></td></tr></table></figure></p>
<p>è¡¨ç¤ºç«¯å£èŒƒå›´ä¸º30000~30999ï¼Œè¿™ä¸ªå¯ä»¥éšæ„æ”¹ã€‚<br>æ”¹å®Œé‡å¯ä¸€ä¸‹vsftpd</p>
<p>ç”±äºæŒ‡å®šè¿™æ®µç«¯å£èŒƒå›´ï¼Œiptablesä¹Ÿè¦ç›¸åº”çš„å¼€å¯è¿™ä¸ªèŒƒå›´ï¼Œæ‰€ä»¥åƒä¸Šé¢é‚£æ ·æ‰“å¼€iptablesæ–‡ä»¶</p>
<p>ä¹Ÿæ˜¯åœ¨21ä¸Šä¸‹é¢å¦èµ·ä¸€è¡Œï¼Œæ›´é‚£è¡Œå·®ä¸å¤šï¼Œåªæ˜¯æŠŠ21 æ”¹ä¸º30000:30999,ç„¶å:wqä¿å­˜ï¼Œé‡å¯ä¸‹iptablesã€‚è¿™æ ·å°±æå®šäº†ã€‚</p>
]]></content>
      
        <categories>
            
            <category> linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> linux </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ç”¨cglibç”Ÿæˆçš„ä»£ç†ç±»å–ä¸åˆ°æ³¨è§£çš„é—®é¢˜]]></title>
      <url>/2014/07/19/cglib-annonation/</url>
      <content type="html"><![CDATA[<p>ç™¾åº¦æ‰¾äº†ä¸€ä¸‹æ²¡æ‰¾åˆ°ï¼Œè°·æ­Œæœä¸€ä¸‹å°±å‡ºæ¥äº†ï¼ˆä¼šç‚¹è‹±è¯­å°±æ˜¯å¥½ï¼‰</p>
<p>ç›´æ¥åœ¨æ³¨è§£ä¸Šé¢åŠ @Inherited<br><a id="more"></a><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Inherited</span></div><div class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</div><div class="line"><span class="meta">@Target</span>(ElementType.TYPE)</div><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyAnnotation &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åŸæ¥CGLIB è¿”å›çš„ä»£ç†ç±»æ˜¯åŸºäºåŸæ¥ç±»çš„å­ç±»çš„ï¼ŒåŠ ä¸Šè¿™ä¸ªæ ‡å¿—å°±å¯ä»¥ä»¤å­ç±»ç»§æ‰¿è¿™ä¸ªæ³¨è§£ï¼ˆå”‰ï¼ŒåŸºç¡€å•Šï¼‰<br>é“¾æ¥<a href="http://stackoverflow.com/questions/1706751/retain-annotations-on-cglib-proxies" target="_blank" rel="external">http://stackoverflow.com/questions/1706751/retain-annotations-on-cglib-proxies</a></p>
]]></content>
      
        <categories>
            
            <category> java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> java </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[maven resource è®°å½•]]></title>
      <url>/2014/02/20/maven-resouce/</url>
      <content type="html"><![CDATA[<p>ä»Šå¤©é‡åˆ°mavenæ‰“åŒ…çš„æ—¶å€™å‘ç°åœ¨main/javaé‡Œé¢çš„xmlæ²¡æœ‰æ‰“åŒ…è¿›jarä¸Šã€‚</p>
<p>ä¸Šç½‘æœäº†ä¸‹ï¼Œmavené»˜è®¤æ‰“åŒ…main/resourceçš„èµ„æºï¼Œè¦æƒ³æ‰“åŒ…main/javaçš„è¦åƒä¸‹é¢è¿™æ ·é…ã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">resources</span>&gt;</span> </div><div class="line">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span> </div><div class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span> </div><div class="line">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span> </div><div class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span> </div><div class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span> </div><div class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.tld<span class="tag">&lt;/<span class="name">include</span>&gt;</span> </div><div class="line">                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span> </div><div class="line">                <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span> </div><div class="line">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span> </div><div class="line">  <span class="tag">&lt;/<span class="name">resources</span>&gt;</span> </div><div class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>æå®šæ”¶å·¥ã€‚ã€‚ã€‚ä¸çŸ¥é“æœ‰æ²¡æœ‰æ›´å¥½åˆ°æ–¹æ³•å‘¢ï¼Ÿ</p>
]]></content>
      
        <categories>
            
            <category> java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> java </tag>
            
            <tag> maven </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[linux awkå‘½ä»¤è¯¦è§£]]></title>
      <url>/2014/01/06/linux-awk/</url>
      <content type="html"><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>awkæ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ–‡æœ¬åˆ†æå·¥å…·ï¼Œç›¸å¯¹äºgrepçš„æŸ¥æ‰¾ï¼Œsedçš„ç¼–è¾‘ï¼Œawkåœ¨å…¶å¯¹æ•°æ®åˆ†æå¹¶ç”ŸæˆæŠ¥å‘Šæ—¶ï¼Œæ˜¾å¾—å°¤ä¸ºå¼ºå¤§ã€‚ç®€å•æ¥è¯´awkå°±æ˜¯æŠŠæ–‡ä»¶é€è¡Œçš„è¯»å…¥ï¼Œä»¥ç©ºæ ¼ä¸ºé»˜è®¤åˆ†éš”ç¬¦å°†æ¯è¡Œåˆ‡ç‰‡ï¼Œåˆ‡å¼€çš„éƒ¨åˆ†å†è¿›è¡Œå„ç§åˆ†æå¤„ç†ã€‚</p>
<p>awkæœ‰3ä¸ªä¸åŒç‰ˆæœ¬: awkã€nawkå’Œgawkï¼Œæœªä½œç‰¹åˆ«è¯´æ˜ï¼Œä¸€èˆ¬æŒ‡gawkï¼Œgawk æ˜¯ AWK çš„ GNU ç‰ˆæœ¬ã€‚</p>
<p>awkå…¶åç§°å¾—è‡ªäºå®ƒçš„åˆ›å§‹äºº Alfred Aho ã€Peter Weinberger å’Œ Brian Kernighan å§“æ°çš„é¦–ä¸ªå­—æ¯ã€‚å®é™…ä¸Š AWK çš„ç¡®æ‹¥æœ‰è‡ªå·±çš„è¯­è¨€ï¼š AWK ç¨‹åºè®¾è®¡è¯­è¨€ ï¼Œ ä¸‰ä½åˆ›å»ºè€…å·²å°†å®ƒæ­£å¼å®šä¹‰ä¸ºâ€œæ ·å¼æ‰«æå’Œå¤„ç†è¯­è¨€â€ã€‚å®ƒå…è®¸æ‚¨åˆ›å»ºç®€çŸ­çš„ç¨‹åºï¼Œè¿™äº›ç¨‹åºè¯»å–è¾“å…¥æ–‡ä»¶ã€ä¸ºæ•°æ®æ’åºã€å¤„ç†æ•°æ®ã€å¯¹è¾“å…¥æ‰§è¡Œè®¡ç®—ä»¥åŠç”ŸæˆæŠ¥è¡¨ï¼Œè¿˜æœ‰æ— æ•°å…¶ä»–çš„åŠŸèƒ½ã€‚<br><a id="more"></a></p>
<h1 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;&#123;pattern + action&#125;&apos; &#123;filenames&#125;</div></pre></td></tr></table></figure>
<p>å°½ç®¡æ“ä½œå¯èƒ½ä¼šå¾ˆå¤æ‚ï¼Œä½†è¯­æ³•æ€»æ˜¯è¿™æ ·ï¼Œå…¶ä¸­ pattern è¡¨ç¤º AWK åœ¨æ•°æ®ä¸­æŸ¥æ‰¾çš„å†…å®¹ï¼Œè€Œ action æ˜¯åœ¨æ‰¾åˆ°åŒ¹é…å†…å®¹æ—¶æ‰€æ‰§è¡Œçš„ä¸€ç³»åˆ—å‘½ä»¤ã€‚èŠ±æ‹¬å·ï¼ˆ{}ï¼‰ä¸éœ€è¦åœ¨ç¨‹åºä¸­å§‹ç»ˆå‡ºç°ï¼Œä½†å®ƒä»¬ç”¨äºæ ¹æ®ç‰¹å®šçš„æ¨¡å¼å¯¹ä¸€ç³»åˆ—æŒ‡ä»¤è¿›è¡Œåˆ†ç»„ã€‚ patternå°±æ˜¯è¦è¡¨ç¤ºçš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨æ–œæ æ‹¬èµ·æ¥ã€‚</p>
<p>awkè¯­è¨€çš„æœ€åŸºæœ¬åŠŸèƒ½æ˜¯åœ¨æ–‡ä»¶æˆ–è€…å­—ç¬¦ä¸²ä¸­åŸºäºæŒ‡å®šè§„åˆ™æµè§ˆå’ŒæŠ½å–ä¿¡æ¯ï¼ŒawkæŠ½å–ä¿¡æ¯åï¼Œæ‰èƒ½è¿›è¡Œå…¶ä»–æ–‡æœ¬æ“ä½œã€‚å®Œæ•´çš„awkè„šæœ¬é€šå¸¸ç”¨æ¥æ ¼å¼åŒ–æ–‡æœ¬æ–‡ä»¶ä¸­çš„ä¿¡æ¯ã€‚</p>
<p>é€šå¸¸ï¼Œawkæ˜¯ä»¥æ–‡ä»¶çš„ä¸€è¡Œä¸ºå¤„ç†å•ä½çš„ã€‚awkæ¯æ¥æ”¶æ–‡ä»¶çš„ä¸€è¡Œï¼Œç„¶åæ‰§è¡Œç›¸åº”çš„å‘½ä»¤ï¼Œæ¥å¤„ç†æ–‡æœ¬ã€‚</p>
<h1 id="è°ƒç”¨awk"><a href="#è°ƒç”¨awk" class="headerlink" title="è°ƒç”¨awk"></a>è°ƒç”¨awk</h1><p>æœ‰ä¸‰ç§æ–¹å¼è°ƒç”¨awk</p>
<p>1.å‘½ä»¤è¡Œæ–¹å¼<br>awk [-F  field-separator]  â€˜commandsâ€™  input-file(s)<br>å…¶ä¸­ï¼Œcommands æ˜¯çœŸæ­£awkå‘½ä»¤ï¼Œ[-FåŸŸåˆ†éš”ç¬¦]æ˜¯å¯é€‰çš„ã€‚ input-file(s) æ˜¯å¾…å¤„ç†çš„æ–‡ä»¶ã€‚<br>åœ¨awkä¸­ï¼Œæ–‡ä»¶çš„æ¯ä¸€è¡Œä¸­ï¼Œç”±åŸŸåˆ†éš”ç¬¦åˆ†å¼€çš„æ¯ä¸€é¡¹ç§°ä¸ºä¸€ä¸ªåŸŸã€‚é€šå¸¸ï¼Œåœ¨ä¸æŒ‡å-FåŸŸåˆ†éš”ç¬¦çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„åŸŸåˆ†éš”ç¬¦æ˜¯ç©ºæ ¼ã€‚</p>
<p>2.shellè„šæœ¬æ–¹å¼<br>å°†æ‰€æœ‰çš„awkå‘½ä»¤æ’å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä½¿awkç¨‹åºå¯æ‰§è¡Œï¼Œç„¶åawkå‘½ä»¤è§£é‡Šå™¨ä½œä¸ºè„šæœ¬çš„é¦–è¡Œï¼Œä¸€éé€šè¿‡é”®å…¥è„šæœ¬åç§°æ¥è°ƒç”¨ã€‚<br>ç›¸å½“äºshellè„šæœ¬é¦–è¡Œçš„ï¼š#!/bin/sh<br>å¯ä»¥æ¢æˆï¼š#!/bin/awk</p>
<p>3.å°†æ‰€æœ‰çš„awkå‘½ä»¤æ’å…¥ä¸€ä¸ªå•ç‹¬æ–‡ä»¶ï¼Œç„¶åè°ƒç”¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk -f awk-script-file input-file(s)</div></pre></td></tr></table></figure></p>
<p>å…¶ä¸­ï¼Œ-fé€‰é¡¹åŠ è½½awk-script-fileä¸­çš„awkè„šæœ¬ï¼Œinput-file(s)è·Ÿä¸Šé¢çš„æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>æœ¬ç« é‡ç‚¹ä»‹ç»å‘½ä»¤è¡Œæ–¹å¼ã€‚</p>
<h1 id="å…¥é—¨å®ä¾‹"><a href="#å…¥é—¨å®ä¾‹" class="headerlink" title="å…¥é—¨å®ä¾‹"></a>å…¥é—¨å®ä¾‹</h1><p>å‡è®¾last -n 5çš„è¾“å‡ºå¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@www ~]# last -n 5 &lt;==ä»…å–å‡ºå‰äº”è¡Œ</div><div class="line">root     pts/1   192.168.1.100  Tue Feb 10 11:21   still logged in</div><div class="line">root     pts/1   192.168.1.100  Tue Feb 10 00:46 - 02:28  (01:41)</div><div class="line">root     pts/1   192.168.1.100  Mon Feb  9 11:41 - 18:30  (06:48)</div><div class="line">dmtsai   pts/1   192.168.1.100  Mon Feb  9 11:41 - 11:41  (00:00)</div><div class="line">root     tty1                   Fri Sep  5 14:09 - 14:10  (00:01)</div></pre></td></tr></table></figure>
<p>å¦‚æœåªæ˜¯æ˜¾ç¤ºæœ€è¿‘ç™»å½•çš„5ä¸ªå¸å·</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#last -n 5 | awk  &apos;&#123;print $1&#125;&apos;</div><div class="line">root</div><div class="line">root</div><div class="line">root</div><div class="line">dmtsai</div><div class="line">root</div></pre></td></tr></table></figure>
<p>awkå·¥ä½œæµç¨‹æ˜¯è¿™æ ·çš„ï¼šè¯»å…¥æœ‰â€™\nâ€™æ¢è¡Œç¬¦åˆ†å‰²çš„ä¸€æ¡è®°å½•ï¼Œç„¶åå°†è®°å½•æŒ‰æŒ‡å®šçš„åŸŸåˆ†éš”ç¬¦åˆ’åˆ†åŸŸï¼Œå¡«å……åŸŸï¼Œ$0åˆ™è¡¨ç¤ºæ‰€æœ‰åŸŸ,$1è¡¨ç¤ºç¬¬ä¸€ä¸ªåŸŸ,$nè¡¨ç¤ºç¬¬nä¸ªåŸŸã€‚é»˜è®¤åŸŸåˆ†éš”ç¬¦æ˜¯â€ç©ºç™½é”®â€ æˆ– â€œ[tab]é”®â€,æ‰€ä»¥$1è¡¨ç¤ºç™»å½•ç”¨æˆ·ï¼Œ$3è¡¨ç¤ºç™»å½•ç”¨æˆ·ip,ä»¥æ­¤ç±»æ¨ã€‚</p>
<p>å¦‚æœåªæ˜¯æ˜¾ç¤º/etc/passwdçš„è´¦æˆ·</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#cat /etc/passwd |awk  -F &apos;:&apos;  &apos;&#123;print $1&#125;&apos;  </div><div class="line">root</div><div class="line">daemon</div><div class="line">bin</div><div class="line">sys</div></pre></td></tr></table></figure>
<p>è¿™ç§æ˜¯awk+actionçš„ç¤ºä¾‹ï¼Œæ¯è¡Œéƒ½ä¼šæ‰§è¡Œaction{print $1}ã€‚</p>
<p>-FæŒ‡å®šåŸŸåˆ†éš”ç¬¦ä¸ºâ€™:â€™ã€‚</p>
<p>å¦‚æœåªæ˜¯æ˜¾ç¤º/etc/passwdçš„è´¦æˆ·å’Œè´¦æˆ·å¯¹åº”çš„shell,è€Œè´¦æˆ·ä¸shellä¹‹é—´ä»¥tabé”®åˆ†å‰²</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#cat /etc/passwd |awk  -F &apos;:&apos;  &apos;&#123;print $1&quot;\t&quot;$7&#125;&apos;</div><div class="line">root    /bin/bash</div><div class="line">daemon  /bin/sh</div><div class="line">bin     /bin/sh</div><div class="line">sys     /bin/sh</div></pre></td></tr></table></figure>
<p>å¦‚æœåªæ˜¯æ˜¾ç¤º/etc/passwdçš„è´¦æˆ·å’Œè´¦æˆ·å¯¹åº”çš„shell,è€Œè´¦æˆ·ä¸shellä¹‹é—´ä»¥é€—å·åˆ†å‰²,è€Œä¸”åœ¨æ‰€æœ‰è¡Œæ·»åŠ åˆ—åname,shell,åœ¨æœ€åä¸€è¡Œæ·»åŠ â€blue,/bin/noshâ€ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">cat /etc/passwd |awk  -F &apos;:&apos;  &apos;BEGIN &#123;print &quot;name,shell&quot;&#125;  &#123;print $1&quot;,&quot;$7&#125; END &#123;print &quot;blue,/bin/nosh&quot;&#125;&apos;</div><div class="line">name,shell</div><div class="line">root,/bin/bash</div><div class="line">daemon,/bin/sh</div><div class="line">bin,/bin/sh</div><div class="line">sys,/bin/sh</div><div class="line">....</div><div class="line">blue,/bin/nosh</div></pre></td></tr></table></figure>
<p>awkå·¥ä½œæµç¨‹æ˜¯è¿™æ ·çš„ï¼šå…ˆæ‰§è¡ŒBEGINGï¼Œç„¶åè¯»å–æ–‡ä»¶ï¼Œè¯»å…¥æœ‰/næ¢è¡Œç¬¦åˆ†å‰²çš„ä¸€æ¡è®°å½•ï¼Œç„¶åå°†è®°å½•æŒ‰æŒ‡å®šçš„åŸŸåˆ†éš”ç¬¦åˆ’åˆ†åŸŸï¼Œå¡«å……åŸŸï¼Œ $0åˆ™è¡¨ç¤ºæ‰€æœ‰åŸŸ,$1è¡¨ç¤ºç¬¬ä¸€ä¸ªåŸŸ,$nè¡¨ç¤ºç¬¬nä¸ªåŸŸ ,éšåå¼€å§‹æ‰§è¡Œæ¨¡å¼æ‰€å¯¹åº”çš„åŠ¨ä½œactionã€‚æ¥ç€å¼€å§‹è¯»å…¥ç¬¬äºŒæ¡è®°å½•Â·Â·Â·Â·Â·Â·ç›´åˆ°æ‰€æœ‰çš„è®°å½•éƒ½è¯»å®Œï¼Œæœ€åæ‰§è¡ŒENDæ“ä½œã€‚ </p>
<p>æœç´¢/etc/passwdæœ‰rootå…³é”®å­—çš„æ‰€æœ‰è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#awk -F: &apos;/root/&apos; /etc/passwd</div><div class="line">root:x:0:0:root:/root:/bin/bash</div></pre></td></tr></table></figure>
<p>è¿™ç§æ˜¯patternçš„ä½¿ç”¨ç¤ºä¾‹ï¼ŒåŒ¹é…äº†pattern(è¿™é‡Œæ˜¯root)çš„è¡Œæ‰ä¼šæ‰§è¡Œaction(æ²¡æœ‰æŒ‡å®šactionï¼Œé»˜è®¤è¾“å‡ºæ¯è¡Œçš„å†…å®¹)ã€‚</p>
<p>æœç´¢æ”¯æŒæ­£åˆ™ï¼Œä¾‹å¦‚æ‰¾rootå¼€å¤´çš„: awk -F: â€˜/^root/â€˜ /etc/passwd</p>
<p>æœç´¢/etc/passwdæœ‰rootå…³é”®å­—çš„æ‰€æœ‰è¡Œï¼Œå¹¶æ˜¾ç¤ºå¯¹åº”çš„shell </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># awk -F: &apos;/root/&#123;print $7&#125;&apos; /etc/passwd             </div><div class="line">/bin/bash</div></pre></td></tr></table></figure>
<p>è¿™é‡ŒæŒ‡å®šäº†action{print $7}</p>
<h1 id="awkå†…ç½®å˜é‡"><a href="#awkå†…ç½®å˜é‡" class="headerlink" title="awkå†…ç½®å˜é‡"></a>awkå†…ç½®å˜é‡</h1><p>awkæœ‰è®¸å¤šå†…ç½®å˜é‡ç”¨æ¥è®¾ç½®ç¯å¢ƒä¿¡æ¯ï¼Œè¿™äº›å˜é‡å¯ä»¥è¢«æ”¹å˜ï¼Œä¸‹é¢ç»™å‡ºäº†æœ€å¸¸ç”¨çš„ä¸€äº›å˜é‡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">ARGC               å‘½ä»¤è¡Œå‚æ•°ä¸ªæ•°</div><div class="line">ARGV               å‘½ä»¤è¡Œå‚æ•°æ’åˆ—</div><div class="line">ENVIRON            æ”¯æŒé˜Ÿåˆ—ä¸­ç³»ç»Ÿç¯å¢ƒå˜é‡çš„ä½¿ç”¨</div><div class="line">FILENAME           awkæµè§ˆçš„æ–‡ä»¶å</div><div class="line">FNR                æµè§ˆæ–‡ä»¶çš„è®°å½•æ•°</div><div class="line">FS                 è®¾ç½®è¾“å…¥åŸŸåˆ†éš”ç¬¦ï¼Œç­‰ä»·äºå‘½ä»¤è¡Œ -Fé€‰é¡¹</div><div class="line">NF                 æµè§ˆè®°å½•çš„åŸŸçš„ä¸ªæ•°</div><div class="line">NR                 å·²è¯»çš„è®°å½•æ•°</div><div class="line">OFS                è¾“å‡ºåŸŸåˆ†éš”ç¬¦</div><div class="line">ORS                è¾“å‡ºè®°å½•åˆ†éš”ç¬¦</div><div class="line">RS                 æ§åˆ¶è®°å½•åˆ†éš”ç¬¦</div></pre></td></tr></table></figure>
<p>æ­¤å¤–, $0å˜é‡æ˜¯æŒ‡æ•´æ¡è®°å½•ã€‚$1è¡¨ç¤ºå½“å‰è¡Œçš„ç¬¬ä¸€ä¸ªåŸŸ,$2è¡¨ç¤ºå½“å‰è¡Œçš„ç¬¬äºŒä¸ªåŸŸ,â€¦â€¦ä»¥æ­¤ç±»æ¨ã€‚</p>
<p>ç»Ÿè®¡/etc/passwd:æ–‡ä»¶åï¼Œæ¯è¡Œçš„è¡Œå·ï¼Œæ¯è¡Œçš„åˆ—æ•°ï¼Œå¯¹åº”çš„å®Œæ•´è¡Œå†…å®¹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#awk  -F &apos;:&apos;  &apos;&#123;print &quot;filename:&quot; FILENAME &quot;,linenumber:&quot; NR &quot;,columns:&quot; NF &quot;,linecontent:&quot;$0&#125;&apos; /etc/passwd</div><div class="line">filename:/etc/passwd,linenumber:1,columns:7,linecontent:root:x:0:0:root:/root:/bin/bash</div><div class="line">filename:/etc/passwd,linenumber:2,columns:7,linecontent:daemon:x:1:1:daemon:/usr/sbin:/bin/sh</div><div class="line">filename:/etc/passwd,linenumber:3,columns:7,linecontent:bin:x:2:2:bin:/bin:/bin/sh</div><div class="line">filename:/etc/passwd,linenumber:4,columns:7,linecontent:sys:x:3:3:sys:/dev:/bin/sh</div></pre></td></tr></table></figure>
<p>ä½¿ç”¨printfæ›¿ä»£print,å¯ä»¥è®©ä»£ç æ›´åŠ ç®€æ´ï¼Œæ˜“è¯»</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk  -F &apos;:&apos;  &apos;&#123;printf(&quot;filename:%10s,linenumber:%s,columns:%s,linecontent:%s\n&quot;,FILENAME,NR,NF,$0)&#125;&apos; /etc/passwd</div></pre></td></tr></table></figure>
<h1 id="printå’Œprintf"><a href="#printå’Œprintf" class="headerlink" title="printå’Œprintf"></a>printå’Œprintf</h1><p>awkä¸­åŒæ—¶æä¾›äº†printå’Œprintfä¸¤ç§æ‰“å°è¾“å‡ºçš„å‡½æ•°ã€‚</p>
<p>å…¶ä¸­printå‡½æ•°çš„å‚æ•°å¯ä»¥æ˜¯å˜é‡ã€æ•°å€¼æˆ–è€…å­—ç¬¦ä¸²ã€‚å­—ç¬¦ä¸²å¿…é¡»ç”¨åŒå¼•å·å¼•ç”¨ï¼Œå‚æ•°ç”¨é€—å·åˆ†éš”ã€‚å¦‚æœæ²¡æœ‰é€—å·ï¼Œå‚æ•°å°±ä¸²è”åœ¨ä¸€èµ·è€Œæ— æ³•åŒºåˆ†ã€‚è¿™é‡Œï¼Œé€—å·çš„ä½œç”¨ä¸è¾“å‡ºæ–‡ä»¶çš„åˆ†éš”ç¬¦çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯åè€…æ˜¯ç©ºæ ¼è€Œå·²ã€‚</p>
<p>printfå‡½æ•°ï¼Œå…¶ç”¨æ³•å’Œcè¯­è¨€ä¸­printfåŸºæœ¬ç›¸ä¼¼,å¯ä»¥æ ¼å¼åŒ–å­—ç¬¦ä¸²,è¾“å‡ºå¤æ‚æ—¶ï¼Œprintfæ›´åŠ å¥½ç”¨ï¼Œä»£ç æ›´æ˜“æ‡‚ã€‚</p>
<h1 id="awkç¼–ç¨‹"><a href="#awkç¼–ç¨‹" class="headerlink" title="awkç¼–ç¨‹"></a>awkç¼–ç¨‹</h1><p> å˜é‡å’Œèµ‹å€¼</p>
<p>é™¤äº†awkçš„å†…ç½®å˜é‡ï¼Œawkè¿˜å¯ä»¥è‡ªå®šä¹‰å˜é‡ã€‚</p>
<p>ä¸‹é¢ç»Ÿè®¡/etc/passwdçš„è´¦æˆ·äººæ•°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">awk &apos;&#123;count++;print $0;&#125; END&#123;print &quot;user count is &quot;, count&#125;&apos; /etc/passwd</div><div class="line">root:x:0:0:root:/root:/bin/bash</div><div class="line">......</div><div class="line">user count is  40</div></pre></td></tr></table></figure></p>
<p>countæ˜¯è‡ªå®šä¹‰å˜é‡ã€‚ä¹‹å‰çš„action{}é‡Œéƒ½æ˜¯åªæœ‰ä¸€ä¸ªprint,å…¶å®printåªæ˜¯ä¸€ä¸ªè¯­å¥ï¼Œè€Œaction{}å¯ä»¥æœ‰å¤šä¸ªè¯­å¥ï¼Œä»¥;å·éš”å¼€ã€‚</p>
<p>è¿™é‡Œæ²¡æœ‰åˆå§‹åŒ–countï¼Œè™½ç„¶é»˜è®¤æ˜¯0ï¼Œä½†æ˜¯å¦¥å½“çš„åšæ³•è¿˜æ˜¯åˆå§‹åŒ–ä¸º0:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">awk &apos;BEGIN &#123;count=0;print &quot;[start]user count is &quot;, count&#125; &#123;count=count+1;print $0;&#125; END&#123;print &quot;[end]user count is &quot;, count&#125;&apos; /etc/passwd</div><div class="line">[start]user count is  0</div><div class="line">root:x:0:0:root:/root:/bin/bash</div><div class="line">...</div><div class="line">[end]user count is  40</div></pre></td></tr></table></figure>
<p>ç»Ÿè®¡æŸä¸ªæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶å ç”¨çš„å­—èŠ‚æ•°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ls -l |awk &apos;BEGIN &#123;size=0;&#125; &#123;size=size+$5;&#125; END&#123;print &quot;[end]size is &quot;, size&#125;&apos;</div><div class="line">[end]size is  8657198</div></pre></td></tr></table></figure></p>
<p>å¦‚æœä»¥Mä¸ºå•ä½æ˜¾ç¤º:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ls -l |awk &apos;BEGIN &#123;size=0;&#125; &#123;size=size+$5;&#125; END&#123;print &quot;[end]size is &quot;, size/1024/1024,&quot;M&quot;&#125;&apos; </div><div class="line">[end]size is  8.25889 M</div></pre></td></tr></table></figure></p>
<p>æ³¨æ„ï¼Œç»Ÿè®¡ä¸åŒ…æ‹¬æ–‡ä»¶å¤¹çš„å­ç›®å½•ã€‚</p>
<p>æ¡ä»¶è¯­å¥<br>awkä¸­çš„æ¡ä»¶è¯­å¥æ˜¯ä»Cè¯­è¨€ä¸­å€Ÿé‰´æ¥çš„ï¼Œè§å¦‚ä¸‹å£°æ˜æ–¹å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">if (expression) &#123;</div><div class="line">    statement;</div><div class="line">    statement;</div><div class="line">    ... ...</div><div class="line">&#125;</div><div class="line"></div><div class="line">if (expression) &#123;</div><div class="line">    statement;</div><div class="line">&#125; else &#123;</div><div class="line">    statement2;</div><div class="line">&#125;</div><div class="line"></div><div class="line">if (expression) &#123;</div><div class="line">    statement1;</div><div class="line">&#125; else if (expression1) &#123;</div><div class="line">    statement2;</div><div class="line">&#125; else &#123;</div><div class="line">    statement3;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç»Ÿè®¡æŸä¸ªæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶å ç”¨çš„å­—èŠ‚æ•°,è¿‡æ»¤4096å¤§å°çš„æ–‡ä»¶(ä¸€èˆ¬éƒ½æ˜¯æ–‡ä»¶å¤¹):<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ls -l |awk &apos;BEGIN &#123;size=0;print &quot;[start]size is &quot;, size&#125; &#123;if($5!=4096)&#123;size=size+$5;&#125;&#125; END&#123;print &quot;[end]size is &quot;, size/1024/1024,&quot;M&quot;&#125;&apos; </div><div class="line">[end]size is  8.22339 M</div></pre></td></tr></table></figure></p>
<p>å¾ªç¯è¯­å¥</p>
<p>awkä¸­çš„å¾ªç¯è¯­å¥åŒæ ·å€Ÿé‰´äºCè¯­è¨€ï¼Œæ”¯æŒwhileã€do/whileã€forã€breakã€continueï¼Œè¿™äº›å…³é”®å­—çš„è¯­ä¹‰å’ŒCè¯­è¨€ä¸­çš„è¯­ä¹‰å®Œå…¨ç›¸åŒã€‚</p>
<p>æ•°ç»„</p>
<p>  å› ä¸ºawkä¸­æ•°ç»„çš„ä¸‹æ ‡å¯ä»¥æ˜¯æ•°å­—å’Œå­—æ¯ï¼Œæ•°ç»„çš„ä¸‹æ ‡é€šå¸¸è¢«ç§°ä¸ºå…³é”®å­—(key)ã€‚å€¼å’Œå…³é”®å­—éƒ½å­˜å‚¨åœ¨å†…éƒ¨çš„ä¸€å¼ é’ˆå¯¹key/valueåº”ç”¨hashçš„è¡¨æ ¼é‡Œã€‚ç”±äºhashä¸æ˜¯é¡ºåºå­˜å‚¨ï¼Œå› æ­¤åœ¨æ˜¾ç¤ºæ•°ç»„å†…å®¹æ—¶ä¼šå‘ç°ï¼Œå®ƒä»¬å¹¶ä¸æ˜¯æŒ‰ç…§ä½ é¢„æ–™çš„é¡ºåºæ˜¾ç¤ºå‡ºæ¥çš„ã€‚æ•°ç»„å’Œå˜é‡ä¸€æ ·ï¼Œéƒ½æ˜¯åœ¨ä½¿ç”¨æ—¶è‡ªåŠ¨åˆ›å»ºçš„ï¼Œawkä¹ŸåŒæ ·ä¼šè‡ªåŠ¨åˆ¤æ–­å…¶å­˜å‚¨çš„æ˜¯æ•°å­—è¿˜æ˜¯å­—ç¬¦ä¸²ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œawkä¸­çš„æ•°ç»„ç”¨æ¥ä»è®°å½•ä¸­æ”¶é›†ä¿¡æ¯ï¼Œå¯ä»¥ç”¨äºè®¡ç®—æ€»å’Œã€ç»Ÿè®¡å•è¯ä»¥åŠè·Ÿè¸ªæ¨¡æ¿è¢«åŒ¹é…çš„æ¬¡æ•°ç­‰ç­‰ã€‚</p>
<p>æ˜¾ç¤º/etc/passwdçš„è´¦æˆ·</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">awk -F &apos;:&apos; &apos;BEGIN &#123;count=0;&#125; &#123;name[count] = $1;count++;&#125;; END&#123;for (i = 0; i &lt; NR; i++) print i, name[i]&#125;&apos; /etc/passwd</div><div class="line">root</div><div class="line">daemon</div><div class="line">bin</div><div class="line">sys</div><div class="line">sync</div><div class="line">games</div><div class="line">......</div></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> linuxå‘½ä»¤ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> linux </tag>
            
            <tag> awk </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[linux sedå‘½ä»¤è¯¦è§£]]></title>
      <url>/2014/01/05/linux-sed/</url>
      <content type="html"><![CDATA[<p>åŠŸèƒ½è¯´æ˜ï¼š</p>
<p>åˆ©ç”¨scriptæ¥å¤„ç†æ–‡æœ¬æ–‡ä»¶ã€‚ </p>
<p>è¯­ã€€ã€€æ³•ï¼š</p>
<p>sed [-hnV][-e script][-f scriptæ–‡ä»¶][æ–‡æœ¬æ–‡ä»¶]<br><a id="more"></a></p>
<p>è¡¥å……è¯´æ˜ï¼š</p>
<p>sedå¯ä¾ç…§scriptçš„æŒ‡ä»¤ï¼Œæ¥å¤„ç†ã€ç¼–è¾‘æ–‡æœ¬æ–‡ä»¶ã€‚ </p>
<p>å‚ã€€ã€€æ•°ï¼š<br>-e scriptæˆ–â€”expression=script   ä»¥é€‰é¡¹ä¸­æŒ‡å®šçš„scriptæ¥å¤„ç†è¾“å…¥çš„æ–‡æœ¬æ–‡ä»¶ã€‚<br>-f scriptæ–‡ä»¶æˆ–â€”file=scriptæ–‡ä»¶   ä»¥é€‰é¡¹ä¸­æŒ‡å®šçš„scriptæ–‡ä»¶æ¥å¤„ç†è¾“å…¥çš„æ–‡æœ¬æ–‡ä»¶ã€‚<br>-hæˆ–â€”help æ˜¾ç¤ºå¸®åŠ©ã€‚<br>-næˆ–â€”quietæˆ–â€“silent ä»…æ˜¾ç¤ºscriptå¤„ç†åçš„ç»“æœã€‚<br>-Væˆ–â€”version æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚  </p>
<p>ä¾‹      å­ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed -e <span class="string">'s/123/1234/'</span> a.txt</div></pre></td></tr></table></figure></p>
<p>å°†a.txtæ–‡ä»¶ä¸­æ‰€æœ‰è¡Œä¸­çš„123ç”¨1234æ›¿æ¢ï¼ˆ-eè¡¨ç¤ºå‘½ä»¤ä»¥å‘½ä»¤è¡Œçš„æ–¹å¼æ‰§è¡Œï¼›å‚æ•°sï¼Œè¡¨ç¤ºæ‰§è¡Œæ›¿æ¢æ“ä½œï¼‰ </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed -e <span class="string">'3,5 a4'</span> a.txt</div></pre></td></tr></table></figure>
<p>å°†a.txtæ–‡ä»¶ä¸­çš„3è¡Œåˆ°5è¡Œä¹‹é—´æ‰€æœ‰è¡Œçš„åé¢æ·»åŠ ä¸€è¡Œå†…å®¹ä¸º4çš„è¡Œï¼ˆå‚æ•°aï¼Œè¡¨ç¤ºæ·»åŠ è¡Œï¼Œå‚æ•°aåé¢æŒ‡å®šæ·»åŠ çš„å†…å®¹ï¼‰ </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed -e <span class="string">'1 s/12/45/'</span> a.txt</div></pre></td></tr></table></figure>
<p>æŠŠç¬¬ä¸€è¡Œçš„12æ›¿æ¢æˆ45 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed -i <span class="string">"s/oldstring/newstring/g"</span> `grep oldstring -rl yourdir`</div></pre></td></tr></table></figure>
<p>æ‰¹é‡å¤„ç†é€šè¿‡grepæœç´¢å‡ºæ¥çš„æ‰€æœ‰æ–‡æ¡£ï¼Œå°†è¿™äº›æ–‡æ¡£ä¸­æ‰€æœ‰çš„oldstringç”¨newstringæ›¿æ¢ï¼ˆ-iå‚æ•°è¡¨ç¤ºç›´æ¥å¯¹ç›®æ ‡æ–‡ä»¶æ“ä½œï¼‰ </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed -n <span class="string">'s/^test/mytest/p'</span> example.file</div></pre></td></tr></table></figure>
<p>(-n)é€‰é¡¹å’Œpæ ‡å¿—ä¸€èµ·ä½¿ç”¨è¡¨ç¤ºåªæ‰“å°é‚£äº›å‘ç”Ÿæ›¿æ¢çš„è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæŸä¸€è¡Œå¼€å¤´çš„testè¢«æ›¿æ¢æˆmytestï¼Œå°±æ‰“å°å®ƒã€‚(^è¿™æ˜¯æ­£åˆ™è¡¨è¾¾å¼ä¸­è¡¨ç¤ºå¼€å¤´ï¼Œè¯¥ç¬¦å·åé¢è·Ÿçš„å°±æ˜¯å¼€å¤´çš„å­—ç¬¦ä¸²)ï¼ˆå‚æ•°pè¡¨ç¤ºæ‰“å°è¡Œï¼‰ </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed <span class="string">'s/^wangpan/&amp;19850715/'</span> example.file</div></pre></td></tr></table></figure>
<p>è¡¨ç¤ºè¢«æ›¿æ¢æ¢å­—ç¬¦ä¸²è¢«æ‰¾åˆ°åï¼Œè¢«æ›¿æ¢çš„å­—ç¬¦ä¸²é€šè¿‡ï¼†ç¬¦å·è¿æ¥ç»™å‡ºçš„å­—ç¬¦ä¸²ç»„æˆæ–°å­—ç¬¦ä¼ æ›¿æ¢è¢«æ›¿æ¢çš„å­—ç¬¦ä¸²,æ‰€æœ‰ä»¥wangpanå¼€å¤´çš„è¡Œéƒ½ä¼šè¢«æ›¿æ¢æˆå®ƒè‡ªå·²åŠ 19850715ï¼Œå˜æˆwangpan19850715 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed -n <span class="string">'s/\(love\)able/\1rs/p'</span> example.file</div></pre></td></tr></table></figure>
<p>loveè¢«æ ‡è®°ä¸º1ï¼Œæ‰€æœ‰loveableä¼šè¢«æ›¿æ¢æˆloversï¼Œè€Œä¸”æ›¿æ¢çš„è¡Œä¼šè¢«æ‰“å°å‡ºæ¥ã€‚éœ€è¦å°†è¿™æ¡å‘½ä»¤åˆ†è§£ï¼Œs/æ˜¯è¡¨ç¤ºæ›¿æ¢æ“ä½œï¼Œ(love)è¡¨ç¤ºé€‰ä¸­loveå­—ç¬¦ä¸²ï¼Œ(love)able/è¡¨ç¤ºåŒ…å«loveableçš„è¡Œï¼Œ(love)able/\lè¡¨ç¤ºloveå­—ç¬¦ä¸²æ ‡è®°ä¸º1ï¼Œè¡¨ç¤ºåœ¨æ›¿æ¢è¿‡ç¨‹ä¸­ä¸å˜ã€‚rs/è¡¨ç¤ºæ›¿æ¢çš„ç›®æ ‡å­—ç¬¦ä¸²ã€‚è¿™æ¡å‘½ä»¤çš„æ“ä½œå«ä¹‰ï¼šåªæ‰“å°æ›¿æ¢äº†çš„è¡Œ </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed <span class="string">'s#10#100#g'</span> example.file</div></pre></td></tr></table></figure>
<p>ä¸è®ºä»€ä¹ˆå­—ç¬¦ï¼Œç´§è·Ÿç€så‘½ä»¤çš„éƒ½è¢«è®¤ä¸ºæ˜¯æ–°çš„åˆ†éš”ç¬¦ï¼Œæ‰€ä»¥ï¼Œâ€œ#â€åœ¨è¿™é‡Œæ˜¯åˆ†éš”ç¬¦ï¼Œä»£æ›¿äº†é»˜è®¤çš„â€œ/â€åˆ†éš”ç¬¦ã€‚è¡¨ç¤ºæŠŠæ‰€æœ‰10æ›¿æ¢æˆ100ã€‚ </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed -n <span class="string">'/love/,/unlove/p'</span> example.file</div></pre></td></tr></table></figure>
<p>åªæ‰“å°åŒ…å«loveå­—ç¬¦ä¸²è¡Œåˆ°åŒ…å«unloveå­—ç¬¦ä¸²è¡Œä¹‹é—´çš„æ‰€æœ‰è¡Œï¼ˆç¡®å®šè¡Œçš„èŒƒå›´å°±æ˜¯é€šè¿‡é€—å·å®ç°çš„ï¼‰ </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed -n <span class="string">'5,/^wang/p'</span> example</div></pre></td></tr></table></figure>
<p>åªæ‰“å°ä»ç¬¬äº”è¡Œå¼€å§‹åˆ°ç¬¬ä¸€ä¸ªåŒ…å«ä»¥wangå¼€å§‹çš„è¡Œä¹‹é—´çš„æ‰€æœ‰è¡Œ </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed <span class="string">'/love/,/unlove/s/$/wangpan/'</span> example.file</div></pre></td></tr></table></figure>
<p>å¯¹äºåŒ…å«loveå­—ç¬¦ä¸²çš„è¡Œåˆ°åŒ…å«unloveå­—ç¬¦ä¸²ä¹‹é—´çš„è¡Œï¼Œæ¯è¡Œçš„æœ«å°¾ç”¨å­—ç¬¦ä¸²wangpanæ›¿æ¢ã€‚<br>å­—ç¬¦ä¸²$/è¡¨ç¤ºä»¥å­—ç¬¦ä¸²ç»“å°¾çš„è¡Œï¼Œ$/è¡¨ç¤ºæ¯ä¸€è¡Œçš„ç»“å°¾ï¼Œs/$/wangpan/è¡¨ç¤ºæ¯ä¸€è¡Œçš„ç»“å°¾æ·»åŠ wangpanå­—ç¬¦ä¸² </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed -e <span class="string">'11,53d'</span> -e <span class="string">'s/wang/pan/'</span> example.file</div></pre></td></tr></table></figure>
<p>(-e)é€‰é¡¹å…è®¸åœ¨åŒä¸€è¡Œé‡Œæ‰§è¡Œå¤šæ¡å‘½ä»¤ã€‚å¦‚ä¾‹å­æ‰€ç¤ºï¼Œç¬¬ä¸€æ¡å‘½ä»¤åˆ é™¤11è‡³53è¡Œï¼Œç¬¬äºŒæ¡å‘½ä»¤ç”¨panæ›¿æ¢wangã€‚å‘½ä»¤çš„æ‰§è¡Œé¡ºåºå¯¹ç»“æœæœ‰å½±å“ã€‚å¦‚æœä¸¤ä¸ªå‘½ä»¤éƒ½æ˜¯æ›¿æ¢å‘½ä»¤ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªæ›¿æ¢å‘½ä»¤å°†å½±å“ç¬¬äºŒä¸ªæ›¿æ¢å‘½ä»¤çš„ç»“æœã€‚(å‚æ•°dï¼Œè¡¨ç¤ºåˆ é™¤æŒ‡å®šçš„è¡Œ) </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed --expression=<span class="string">'s/wang/pan/'</span> --expression=<span class="string">'/love/d'</span> example.file</div></pre></td></tr></table></figure>
<p>ä¸€ä¸ªæ¯”-eæ›´å¥½çš„å‘½ä»¤æ˜¯â€“expressionã€‚å®ƒèƒ½ç»™sedè¡¨è¾¾å¼èµ‹å€¼ã€‚ </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed <span class="string">'/wangpan/r file'</span> example.file</div></pre></td></tr></table></figure>
<p>fileé‡Œçš„å†…å®¹è¢«è¯»è¿›æ¥ï¼Œæ˜¾ç¤ºåœ¨ä¸wangpanåŒ¹é…çš„è¡Œåé¢ï¼Œå¦‚æœåŒ¹é…å¤šè¡Œï¼Œåˆ™fileçš„å†…å®¹å°†æ˜¾ç¤ºåœ¨æ‰€æœ‰åŒ¹é…è¡Œçš„ä¸‹é¢ã€‚å‚æ•°rï¼Œè¡¨ç¤ºè¯»å‡ºæ–‡ä»¶ï¼Œåé¢ç©ºæ ¼ç´§è·Ÿæ–‡ä»¶åç§° </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed -n <span class="string">'/test/w file'</span> example.file</div></pre></td></tr></table></figure>
<p>åœ¨example.fileä¸­æ‰€æœ‰åŒ…å«testçš„è¡Œéƒ½è¢«å†™å…¥fileé‡Œã€‚å‚æ•°wï¼Œè¡¨ç¤ºå°†åŒ¹é…çš„è¡Œå†™å…¥åˆ°æŒ‡å®šçš„æ–‡ä»¶fileä¸­ </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed <span class="string">'/^test/a\oh! My god!'</span> example.file</div></pre></td></tr></table></figure>
<p>â€˜oh! My god!â€™è¢«è¿½åŠ åˆ°ä»¥testå¼€å¤´çš„è¡Œçš„åé¢ï¼Œsedè¦æ±‚å‚æ•°aåé¢æœ‰ä¸€ä¸ªåæ–œæ ã€‚ </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed <span class="string">'/test/i\oh! My god!'</span> example.file</div></pre></td></tr></table></figure>
<p>â€˜oh! My god!â€™è¢«è¿½åŠ åˆ°åŒ…å«testå­—ç¬¦ä¸²è¡Œçš„å‰é¢ï¼Œå‚æ•°iè¡¨ç¤ºæ·»åŠ æŒ‡å®šå†…å®¹åˆ°åŒ¹é…è¡Œçš„å‰é¢ï¼Œsedè¦æ±‚å‚æ•°iåé¢æœ‰ä¸€ä¸ªåæ–œæ  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed <span class="string">'/test/&#123; n; s/aa/bb/; &#125;'</span> example.file</div></pre></td></tr></table></figure>
<p>å¦‚æœtestè¢«åŒ¹é…ï¼Œåˆ™ç§»åŠ¨åˆ°åŒ¹é…è¡Œçš„ä¸‹ä¸€è¡Œï¼Œæ›¿æ¢è¿™ä¸€è¡Œçš„aaï¼Œå˜ä¸ºbbã€‚å‚æ•°nï¼Œè¡¨ç¤ºè¯»å–åŒ¹é…è¡Œçš„ä¸‹ä¸€ä¸ªè¾“å…¥è¡Œï¼Œç”¨ä¸‹ä¸€ä¸ªå‘½ä»¤å¤„ç†æ–°çš„è¡Œè€Œä¸æ˜¯åŒ¹é…è¡Œã€‚Sedè¦æ±‚å‚æ•°nåè·Ÿåˆ†å· </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed <span class="string">'1,10y/abcde/ABCDE/'</span> example.file</div></pre></td></tr></table></figure>
<p>æŠŠ1â€”10è¡Œå†…æ‰€æœ‰abcdeè½¬å˜ä¸ºå¤§å†™ï¼Œæ³¨æ„ï¼Œæ­£åˆ™è¡¨è¾¾å¼å…ƒå­—ç¬¦ä¸èƒ½ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ã€‚å‚æ•°yï¼Œè¡¨ç¤ºæŠŠä¸€ä¸ªå­—ç¬¦ç¿»è¯‘ä¸ºå¦å¤–çš„å­—ç¬¦ï¼ˆä½†æ˜¯ä¸ç”¨äºæ­£åˆ™è¡¨è¾¾å¼ï¼‰ </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed -i <span class="string">'s/now/right now/g'</span> test_sed_command.txt</div></pre></td></tr></table></figure>
<p>è¡¨ç¤ºç›´æ¥æ“ä½œæ–‡ä»¶test_sed_command.txtï¼Œå°†æ–‡ä»¶test_sed_command.txtä¸­æ‰€æœ‰çš„nowç”¨right nowæ›¿æ¢ã€‚å‚æ•°-iï¼Œè¡¨ç¤ºç›´æ¥æ“ä½œä¿®æ”¹æ–‡ä»¶ï¼Œä¸è¾“å‡ºã€‚ </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed <span class="string">'2q'</span> test_sed_command.txt</div></pre></td></tr></table></figure>
<p>åœ¨æ‰“å°å®Œç¬¬2è¡Œåï¼Œå°±ç›´æ¥é€€å‡ºsedã€‚å‚æ•°qï¼Œè¡¨ç¤ºé€€å‡º </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed -e <span class="string">'/old/h'</span> -e <span class="string">'/girl-friend/G'</span> test_sed_command.txt</div></pre></td></tr></table></figure>
<p>é¦–å…ˆäº†è§£å‚æ•°hï¼Œæ‹·è´åŒ¹é…æˆåŠŸè¡Œçš„å†…å®¹åˆ°å†…å­˜ä¸­çš„ç¼“å†²åŒºã€‚åœ¨äº†è§£å‚æ•°Gï¼Œè·å¾—å†…å­˜ç¼“å†²åŒºçš„å†…å®¹ï¼Œå¹¶è¿½åŠ åˆ°å½“å‰æ¨¡æ¿å—æ–‡æœ¬çš„åé¢ã€‚ä¸Šé¢å‘½ä»¤è¡Œçš„å«ä¹‰ï¼šå°†åŒ…å«oldå­—ç¬¦ä¸²çš„è¡Œçš„å†…å®¹ä¿å­˜åœ¨ç¼“å†²åŒºä¸­ï¼Œç„¶åå°†ç¼“å†²åŒºçš„å†…å®¹æ‹¿å‡ºæ¥æ·»åŠ åˆ°åŒ…å«girl-friendå­—ç¬¦ä¸²è¡Œçš„åé¢ã€‚éšå«è¦æ±‚æœé›†åˆ°ç¼“å†²åŒºçš„åŒ¹é…è¡Œåœ¨éœ€è¦æ·»åŠ è¡Œçš„å‰é¢ã€‚ </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sed -e <span class="string">'/test/h'</span> -e <span class="string">'/wangpan/x'</span> example.file</div></pre></td></tr></table></figure>
<p>å°†åŒ…å«testå­—ç¬¦ä¸²çš„è¡Œçš„å†…å®¹ä¿å­˜åœ¨ç¼“å†²åŒºä¸­ï¼Œç„¶åå†å°†ç¼“å†²åŒºçš„å†…å®¹æ›¿æ¢åŒ…å«wangpanå­—ç¬¦ä¸²çš„è¡Œã€‚å‚æ•°xï¼Œè¡¨ç¤ºè¡Œæ›¿æ¢æ“ä½œã€‚éšå«è¦æ±‚æœé›†åˆ°ç¼“å†²åŒºçš„åŒ¹é…è¡Œåœ¨éœ€è¦è¢«æ›¿æ¢è¡Œçš„å‰é¢ã€‚ </p>
]]></content>
      
        <categories>
            
            <category> linuxå‘½ä»¤ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> linux </tag>
            
            <tag> sed </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[linux grepå‘½ä»¤è¯¦è§£]]></title>
      <url>/2014/01/04/linux-grep/</url>
      <content type="html"><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>grep (global search regular expression(RE) and print out the line,å…¨é¢æœç´¢æ­£åˆ™è¡¨è¾¾å¼å¹¶æŠŠè¡Œæ‰“å°å‡ºæ¥)æ˜¯ä¸€ç§å¼ºå¤§çš„æ–‡æœ¬æœç´¢å·¥å…·ï¼Œå®ƒèƒ½ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœç´¢æ–‡æœ¬ï¼Œå¹¶æŠŠåŒ¹é…çš„è¡Œæ‰“å°å‡ºæ¥ã€‚</p>
<p>Unixçš„grepå®¶æ—åŒ…æ‹¬grepã€egrepå’Œfgrepã€‚egrepå’Œfgrepçš„å‘½ä»¤åªè·Ÿgrepæœ‰å¾ˆå°ä¸åŒã€‚egrepæ˜¯grepçš„æ‰©å±•ï¼Œæ”¯æŒæ›´å¤šçš„reå…ƒå­—ç¬¦ï¼Œ fgrepå°±æ˜¯fixed grepæˆ–fast grepï¼Œå®ƒä»¬æŠŠæ‰€æœ‰çš„å­—æ¯éƒ½çœ‹ä½œå•è¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä¸­çš„å…ƒå­—ç¬¦è¡¨ç¤ºå›å…¶è‡ªèº«çš„å­—é¢æ„ä¹‰ï¼Œä¸å†ç‰¹æ®Šã€‚linuxä½¿ç”¨GNUç‰ˆæœ¬çš„grepã€‚å®ƒåŠŸèƒ½æ›´å¼ºï¼Œå¯ä»¥é€šè¿‡-Gã€-Eã€-Få‘½ä»¤è¡Œé€‰é¡¹æ¥ä½¿ç”¨egrepå’Œfgrepçš„åŠŸèƒ½ã€‚<br><a id="more"></a></p>
<h1 id="grepå¸¸ç”¨ç”¨æ³•"><a href="#grepå¸¸ç”¨ç”¨æ³•" class="headerlink" title="grepå¸¸ç”¨ç”¨æ³•"></a>grepå¸¸ç”¨ç”¨æ³•</h1><p>grep [-acinv] [â€“color=auto] â€˜æœå¯»å­—ç¬¦ä¸²â€™ filename<br>é€‰é¡¹ä¸å‚æ•°ï¼š<br>-a ï¼šå°† binary æ–‡ä»¶ä»¥ text æ–‡ä»¶çš„æ–¹å¼æœå¯»æ•°æ®<br>-c ï¼šè®¡ç®—æ‰¾åˆ° â€˜æœå¯»å­—ç¬¦ä¸²â€™ çš„æ¬¡æ•°<br>-i ï¼šå¿½ç•¥å¤§å°å†™çš„ä¸åŒï¼Œæ‰€ä»¥å¤§å°å†™è§†ä¸ºç›¸åŒ<br>-n ï¼šé¡ºä¾¿è¾“å‡ºè¡Œå·<br>-v ï¼šåå‘é€‰æ‹©ï¼Œäº¦å³æ˜¾ç¤ºå‡ºæ²¡æœ‰ â€˜æœå¯»å­—ç¬¦ä¸²â€™ å†…å®¹çš„é‚£ä¸€è¡Œï¼<br>â€“color=auto ï¼šå¯ä»¥å°†æ‰¾åˆ°çš„å…³é”®è¯éƒ¨åˆ†åŠ ä¸Šé¢œè‰²çš„æ˜¾ç¤ºå–”ï¼</p>
<p>å°†/etc/passwdï¼Œæœ‰å‡ºç° root çš„è¡Œå–å‡ºæ¥<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">grep root /etc/passwd</div><div class="line">root:x:0:0:root:/root:/bin/bash</div><div class="line">operator:x:11:0:operator:/root:/sbin/nologin</div><div class="line">æˆ–</div><div class="line">cat /etc/passwd | grep root </div><div class="line">root:x:0:0:root:/root:/bin/bash</div><div class="line">operator:x:11:0:operator:/root:/sbin/nologin</div></pre></td></tr></table></figure></p>
<p>å°†/etc/passwdï¼Œæœ‰å‡ºç° root çš„è¡Œå–å‡ºæ¥,åŒæ—¶æ˜¾ç¤ºè¿™äº›è¡Œåœ¨/etc/passwdçš„è¡Œå·<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">grep -n root /etc/passwd</div><div class="line">1:root:x:0:0:root:/root:/bin/bash</div><div class="line">30:operator:x:11:0:operator:/root:/sbin/nologin</div></pre></td></tr></table></figure></p>
<p>åœ¨å…³é”®å­—çš„æ˜¾ç¤ºæ–¹é¢ï¼Œgrep å¯ä»¥ä½¿ç”¨ â€“color=auto æ¥å°†å…³é”®å­—éƒ¨åˆ†ä½¿ç”¨é¢œè‰²æ˜¾ç¤ºã€‚ è¿™å¯æ˜¯ä¸ªå¾ˆä¸é”™çš„åŠŸèƒ½å•Šï¼ä½†æ˜¯å¦‚æœæ¯æ¬¡ä½¿ç”¨ grep éƒ½å¾—è¦è‡ªè¡ŒåŠ ä¸Š â€“color=auto åˆæ˜¾çš„å¾ˆéº»çƒ¦ï½ æ­¤æ—¶é‚£ä¸ªå¥½ç”¨çš„ alias å°±å¾—æ¥å¤„ç†ä¸€ä¸‹å•¦ï¼ä½ å¯ä»¥åœ¨ ~/.bashrc å†…åŠ ä¸Šè¿™è¡Œï¼š<code>alias grep=&#39;grep --color=auto&#39;</code>å†ä»¥<code>source ~/.bashrc</code>æ¥ç«‹å³ç”Ÿæ•ˆå³å¯å–”ï¼ è¿™æ ·æ¯æ¬¡è¿è¡Œ grep ä»–éƒ½ä¼šè‡ªåŠ¨å¸®ä½ åŠ ä¸Šé¢œè‰²æ˜¾ç¤ºå•¦</p>
<p>å°†/etc/passwdï¼Œå°†æ²¡æœ‰å‡ºç° root çš„è¡Œå–å‡ºæ¥<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">grep -v root /etc/passwd</div><div class="line">root:x:0:0:root:/root:/bin/bash</div><div class="line">operator:x:11:0:operator:/root:/sbin/nologin</div></pre></td></tr></table></figure></p>
<p>å°†/etc/passwdï¼Œå°†æ²¡æœ‰å‡ºç° root å’Œnologinçš„è¡Œå–å‡ºæ¥<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">grep -v root /etc/passwd | grep -v nologin</div><div class="line">root:x:0:0:root:/root:/bin/bash</div><div class="line">operator:x:11:0:operator:/root:/sbin/nologin</div></pre></td></tr></table></figure></p>
<p>ç”¨ dmesg åˆ—å‡ºæ ¸å¿ƒä¿¡æ¯ï¼Œå†ä»¥ grep æ‰¾å‡ºå†…å« eth é‚£è¡Œ,è¦å°†æ‰åˆ°çš„å…³é”®å­—æ˜¾è‰²ï¼Œä¸”åŠ ä¸Šè¡Œå·æ¥è¡¨ç¤ºï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@www ~]<span class="comment"># dmesg | grep -n --color=auto 'eth'</span></div><div class="line">247:eth0: RealTek RTL8139 at 0xee846000, 00:90:cc:a6:34:84, IRQ 10</div><div class="line">248:eth0: Identified 8139 chip <span class="built_in">type</span> <span class="string">'RTL-8139C'</span></div><div class="line">294:eth0: link up, 100Mbps, full-duplex, lpa 0xC5E1</div><div class="line">305:eth0: no IPv6 routers present</div></pre></td></tr></table></figure></p>
<p>ä½ ä¼šå‘ç°é™¤äº† eth ä¼šæœ‰ç‰¹æ®Šé¢œè‰²æ¥è¡¨ç¤ºä¹‹å¤–ï¼Œæœ€å‰é¢è¿˜æœ‰è¡Œå·å–”ï¼<br>åœ¨å…³é”®å­—çš„æ˜¾ç¤ºæ–¹é¢ï¼Œgrep å¯ä»¥ä½¿ç”¨ â€“color=auto æ¥å°†å…³é”®å­—éƒ¨åˆ†ä½¿ç”¨é¢œè‰²æ˜¾ç¤ºã€‚ è¿™å¯æ˜¯ä¸ªå¾ˆä¸é”™çš„åŠŸèƒ½å•Šï¼ä½†æ˜¯å¦‚æœæ¯æ¬¡ä½¿ç”¨ grep éƒ½å¾—è¦è‡ªè¡ŒåŠ ä¸Š â€“color=auto åˆæ˜¾çš„å¾ˆéº»çƒ¦ï½ æ­¤æ—¶é‚£ä¸ªå¥½ç”¨çš„ alias å°±å¾—æ¥å¤„ç†ä¸€ä¸‹å•¦ï¼ä½ å¯ä»¥åœ¨ ~/.bashrc å†…åŠ ä¸Šè¿™è¡Œï¼š<code>alias grep=&#39;grep --color=auto&#39;</code>å†ä»¥<code>source ~/.bashrc</code>æ¥ç«‹å³ç”Ÿæ•ˆå³å¯å–”ï¼ è¿™æ ·æ¯æ¬¡è¿è¡Œ grep ä»–éƒ½ä¼šè‡ªåŠ¨å¸®ä½ åŠ ä¸Šé¢œè‰²æ˜¾ç¤ºå•¦</p>
<p>ç”¨ dmesg åˆ—å‡ºæ ¸å¿ƒä¿¡æ¯ï¼Œå†ä»¥ grep æ‰¾å‡ºå†…å« eth é‚£è¡Œ,åœ¨å…³é”®å­—æ‰€åœ¨è¡Œçš„å‰ä¸¤è¡Œä¸åä¸‰è¡Œä¹Ÿä¸€èµ·æ‰å‡ºæ¥æ˜¾ç¤º<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@www ~]<span class="comment"># dmesg | grep -n -A3 -B2 --color=auto 'eth'</span></div><div class="line">245-PCI: setting IRQ 10 as level-triggered</div><div class="line">246-ACPI: PCI Interrupt 0000:00:0e.0[A] -&gt; Link [LNKB] ...</div><div class="line">247:eth0: RealTek RTL8139 at 0xee846000, 00:90:cc:a6:34:84, IRQ 10</div><div class="line">248:eth0: Identified 8139 chip <span class="built_in">type</span> <span class="string">'RTL-8139C'</span></div><div class="line">249-input: PC Speaker as /class/input/input2</div><div class="line">250-ACPI: PCI Interrupt 0000:00:01.4[B] -&gt; Link [LNKB] ...</div><div class="line">251-hdb: ATAPI 48X DVD-ROM DVD-R-RAM CD-R/RW drive, 2048kB Cache, UDMA(66)</div></pre></td></tr></table></figure></p>
<p>å¦‚ä¸Šæ‰€ç¤ºï¼Œä½ ä¼šå‘ç°å…³é”®å­— 247 æ‰€åœ¨çš„å‰ä¸¤è¡ŒåŠ 248 åä¸‰è¡Œä¹Ÿéƒ½è¢«æ˜¾ç¤ºå‡ºæ¥ï¼<br>è¿™æ ·å¯ä»¥è®©ä½ å°†å…³é”®å­—å‰åæ•°æ®æ‰å‡ºæ¥è¿›è¡Œåˆ†æå•¦ï¼</p>
<p>æ ¹æ®æ–‡ä»¶å†…å®¹é€’å½’æŸ¥æ‰¾ç›®å½•<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">grep â€˜energywiseâ€™ *           <span class="comment">#åœ¨å½“å‰ç›®å½•æœç´¢å¸¦'energywise'è¡Œçš„æ–‡ä»¶</span></div><div class="line">grep -r â€˜energywiseâ€™ *        <span class="comment">#åœ¨å½“å‰ç›®å½•åŠå…¶å­ç›®å½•ä¸‹æœç´¢'energywise'è¡Œçš„æ–‡ä»¶</span></div><div class="line">grep -l -r â€˜energywiseâ€™ *     <span class="comment">#åœ¨å½“å‰ç›®å½•åŠå…¶å­ç›®å½•ä¸‹æœç´¢'energywise'è¡Œçš„æ–‡ä»¶ï¼Œä½†æ˜¯ä¸æ˜¾ç¤ºåŒ¹é…çš„è¡Œï¼Œåªæ˜¾ç¤ºåŒ¹é…çš„æ–‡ä»¶</span></div></pre></td></tr></table></figure></p>
<h1 id="grepä¸æ­£è§„è¡¨è¾¾å¼"><a href="#grepä¸æ­£è§„è¡¨è¾¾å¼" class="headerlink" title="grepä¸æ­£è§„è¡¨è¾¾å¼"></a>grepä¸æ­£è§„è¡¨è¾¾å¼</h1><p>å­—ç¬¦ç±»</p>
<p>å­—ç¬¦ç±»çš„æœç´¢ï¼šå¦‚æœæˆ‘æƒ³è¦æœå¯» test æˆ– taste è¿™ä¸¤ä¸ªå•å­—æ—¶ï¼Œå¯ä»¥å‘ç°åˆ°ï¼Œå…¶å®å¥¹ä»¬æœ‰å…±é€šçš„ â€˜t?stâ€™ å­˜åœ¨ï½è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘å¯ä»¥è¿™æ ·æ¥æœå¯»ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@www ~]<span class="comment"># grep -n 't[ae]st' regular_express.txt</span></div><div class="line">8:I can<span class="string">'t finish the test.</span></div><div class="line">9:Oh! The soup taste good.</div></pre></td></tr></table></figure></p>
<p>å…¶å® [] é‡Œé¢ä¸è®ºæœ‰å‡ ä¸ªå­—èŠ‚ï¼Œä»–éƒ½è°¨ä»£è¡¨æŸ<code>ä¸€ä¸ª</code>å­—èŠ‚ï¼Œ æ‰€ä»¥ï¼Œä¸Šé¢çš„ä¾‹å­è¯´æ˜äº†ï¼Œæˆ‘éœ€è¦çš„å­—ä¸²æ˜¯<code>tast</code>æˆ–<code>test</code>ä¸¤ä¸ªå­—ä¸²è€Œå·²ï¼</p>
<p>å­—ç¬¦ç±»çš„åå‘é€‰æ‹© [^] ï¼šå¦‚æœæƒ³è¦æœç´¢åˆ°æœ‰ oo çš„è¡Œï¼Œä½†ä¸æƒ³è¦ oo å‰é¢æœ‰ gï¼Œå¦‚ä¸‹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@www ~]<span class="comment"># grep -n '[^g]oo' regular_express.txt</span></div><div class="line">2:apple is my favorite food.</div><div class="line">3:Football game is not use feet only.</div><div class="line">18:google is the best tools <span class="keyword">for</span> search keyword.</div><div class="line">19:goooooogle yes!</div></pre></td></tr></table></figure></p>
<p>ç¬¬ 2,3 è¡Œæ²¡æœ‰ç–‘é—®ï¼Œå› ä¸º foo ä¸ Foo å‡å¯è¢«æ¥å—ï¼</p>
<p>ä½†æ˜¯ç¬¬ 18 è¡Œæ˜æ˜æœ‰ google çš„ goo å•Šï½åˆ«å¿˜è®°äº†ï¼Œå› ä¸ºè¯¥è¡Œåé¢å‡ºç°äº† tool çš„ too å•Šï¼æ‰€ä»¥è¯¥è¡Œä¹Ÿè¢«åˆ—å‡ºæ¥ï½ ä¹Ÿå°±æ˜¯è¯´ï¼Œ 18 è¡Œé‡Œé¢è™½ç„¶å‡ºç°äº†æˆ‘ä»¬æ‰€ä¸è¦çš„é¡¹ç›® (goo) ä½†æ˜¯ç”±æ–¼æœ‰éœ€è¦çš„é¡¹ç›® (too) ï¼Œ å› æ­¤ï¼Œæ˜¯ç¬¦åˆå­—ä¸²æœå¯»çš„å–”ï¼</p>
<p>è‡³æ–¼ç¬¬ 19 è¡Œï¼ŒåŒæ ·çš„ï¼Œå› ä¸º goooooogle é‡Œé¢çš„ oo å‰é¢å¯èƒ½æ˜¯ o ï¼Œä¾‹å¦‚ï¼š go(ooo)oogle ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸€è¡Œä¹Ÿæ˜¯ç¬¦åˆéœ€æ±‚çš„ï¼</p>
<p>å­—ç¬¦ç±»çš„è¿ç»­ï¼šå†æ¥ï¼Œå‡è®¾æˆ‘ oo å‰é¢ä¸æƒ³è¦æœ‰å°å†™å­—èŠ‚ï¼Œæ‰€ä»¥ï¼Œæˆ‘å¯ä»¥è¿™æ ·å†™ [^abcdâ€¦.z]oo ï¼Œ ä½†æ˜¯è¿™æ ·ä¼¼ä¹ä¸æ€ä¹ˆæ–¹ä¾¿ï¼Œç”±æ–¼å°å†™å­—èŠ‚çš„ ASCII ä¸Šç¼–ç çš„é¡ºåºæ˜¯è¿ç»­çš„ï¼Œ å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¹‹ç®€åŒ–ä¸ºåº•ä¸‹è¿™æ ·ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@www ~]<span class="comment"># grep -n '[^a-z]oo' regular_express.txt</span></div><div class="line">3:Football game is not use feet only.</div></pre></td></tr></table></figure></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬åœ¨ä¸€ç»„é›†åˆå­—èŠ‚ä¸­ï¼Œå¦‚æœè¯¥å­—èŠ‚ç»„æ˜¯è¿ç»­çš„ï¼Œä¾‹å¦‚å¤§å†™è‹±æ–‡/å°å†™è‹±æ–‡/æ•°å­—ç­‰ç­‰ï¼Œ å°±å¯ä»¥ä½¿ç”¨[a-z],[A-Z],[0-9]ç­‰æ–¹å¼æ¥ä¹¦å†™ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬çš„è¦æ±‚å­—ä¸²æ˜¯æ•°å­—ä¸è‹±æ–‡å‘¢ï¼Ÿ å‘µå‘µï¼å°±å°†ä»–å…¨éƒ¨å†™åœ¨ä¸€èµ·ï¼Œå˜æˆï¼š[a-zA-Z0-9]ã€‚</p>
<p>æˆ‘ä»¬è¦å–å¾—æœ‰æ•°å­—çš„é‚£ä¸€è¡Œï¼Œå°±è¿™æ ·ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@www ~]<span class="comment"># grep -n '[0-9]' regular_express.txt</span></div><div class="line">5:However, this dress is about $ 3183 dollars.</div><div class="line">15:You are the best is mean you are the no. 1.</div></pre></td></tr></table></figure></p>
<p>è¡Œé¦–ä¸è¡Œå°¾å­—èŠ‚ ^ $<br>è¡Œé¦–å­—ç¬¦ï¼šå¦‚æœæˆ‘æƒ³è¦è®© the åªåœ¨è¡Œé¦–åˆ—å‡ºå‘¢ï¼Ÿ è¿™ä¸ªæ—¶å€™å°±å¾—è¦ä½¿ç”¨å®šä½å­—èŠ‚äº†ï¼æˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@www ~]<span class="comment"># grep -n '^the' regular_express.txt</span></div><div class="line">12:the symbol <span class="string">'*'</span> is represented as start.</div></pre></td></tr></table></figure></p>
<p>æ­¤æ—¶ï¼Œå°±åªå‰©ä¸‹ç¬¬ 12 è¡Œï¼Œå› ä¸ºåªæœ‰ç¬¬ 12 è¡Œçš„è¡Œé¦–æ˜¯ the å¼€å¤´å•Šï½æ­¤å¤–ï¼Œ å¦‚æœæˆ‘æƒ³è¦å¼€å¤´æ˜¯å°å†™å­—èŠ‚çš„é‚£ä¸€è¡Œå°±åˆ—å‡ºå‘¢ï¼Ÿå¯ä»¥è¿™æ ·ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@www ~]<span class="comment"># grep -n '^[a-z]' regular_express.txt</span></div><div class="line">2:apple is my favorite food.</div><div class="line">4:this dress doesn<span class="string">'t fit me.</span></div><div class="line">10:motorcycle is cheap than car.</div><div class="line">12:the symbol '*<span class="string">' is represented as start.</span></div><div class="line">18:google is the best tools for search keyword.</div><div class="line">19:goooooogle yes!</div><div class="line">20:go! go! Let's go.</div></pre></td></tr></table></figure></p>
<p>å¦‚æœæˆ‘ä¸æƒ³è¦å¼€å¤´æ˜¯è‹±æ–‡å­—æ¯ï¼Œåˆ™å¯ä»¥æ˜¯è¿™æ ·ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@www ~]<span class="comment"># grep -n '^[^a-zA-Z]' regular_express.txt</span></div><div class="line">1:<span class="string">"Open Source"</span> is a good mechanism to develop programs.</div><div class="line">21:<span class="comment"># I am VBird</span></div></pre></td></tr></table></figure></p>
<p>^ ç¬¦å·ï¼Œåœ¨å­—ç¬¦ç±»ç¬¦å·(æ‹¬å·[])ä¹‹å†…ä¸ä¹‹å¤–æ˜¯ä¸åŒçš„ï¼ åœ¨ [] å†…ä»£è¡¨<code>åå‘é€‰æ‹©</code>ï¼Œåœ¨ [] ä¹‹å¤–åˆ™ä»£è¡¨å®šä½åœ¨è¡Œé¦–çš„æ„ä¹‰ï¼</p>
<p>é‚£å¦‚æœæˆ‘æƒ³è¦æ‰¾å‡ºæ¥ï¼Œè¡Œå°¾ç»“æŸä¸ºå°æ•°ç‚¹ (.) çš„é‚£ä¸€è¡Œï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@www ~]<span class="comment"># grep -n '\.$' regular_express.txt</span></div><div class="line">1:<span class="string">"Open Source"</span> is a good mechanism to develop programs.</div><div class="line">2:apple is my favorite food.</div><div class="line">3:Football game is not use feet only.</div><div class="line">4:this dress doesn<span class="string">'t fit me.</span></div><div class="line">10:motorcycle is cheap than car.</div><div class="line">11:This window is clear.</div><div class="line">12:the symbol '*<span class="string">' is represented as start.</span></div><div class="line">15:You are the best is mean you are the no. 1.</div><div class="line">16:The world &lt;Happy&gt; is the same with "glad".</div><div class="line">17:I like dog.</div><div class="line">18:google is the best tools for search keyword.</div><div class="line">20:go! go! Let's go.</div></pre></td></tr></table></figure></p>
<p>ç‰¹åˆ«æ³¨æ„åˆ°ï¼Œå› ä¸ºå°æ•°ç‚¹å…·æœ‰å…¶ä»–æ„ä¹‰(åº•ä¸‹ä¼šä»‹ç»)ï¼Œæ‰€ä»¥å¿…é¡»è¦ä½¿ç”¨è½¬ä¹‰å­—ç¬¦(\)æ¥åŠ ä»¥è§£é™¤å…¶ç‰¹æ®Šæ„ä¹‰ï¼</p>
<p>æ‰¾å‡ºç©ºç™½è¡Œï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@www ~]<span class="comment"># grep -n '^$' regular_express.txt</span></div><div class="line">22:</div></pre></td></tr></table></figure></p>
<p>å› ä¸ºåªæœ‰è¡Œé¦–è·Ÿè¡Œå°¾ (^$)ï¼Œæ‰€ä»¥ï¼Œè¿™æ ·å°±å¯ä»¥æ‰¾å‡ºç©ºç™½è¡Œå•¦ï¼</p>
<p>ä»»æ„ä¸€ä¸ªå­—èŠ‚ . ä¸é‡å¤å­—èŠ‚ *<br>è¿™ä¸¤ä¸ªç¬¦å·åœ¨æ­£åˆ™è¡¨è¾¾å¼çš„æ„ä¹‰å¦‚ä¸‹ï¼š</p>
<p>. (å°æ•°ç‚¹)ï¼šä»£è¡¨<code>ä¸€å®šæœ‰ä¸€ä¸ªä»»æ„å­—èŠ‚</code>çš„æ„æ€ï¼›<br>* (æ˜Ÿå·)ï¼šä»£è¡¨<code>é‡å¤å‰ä¸€ä¸ªå­—ç¬¦ï¼Œ 0 åˆ°æ— ç©·å¤šæ¬¡</code>çš„æ„æ€ï¼Œä¸ºç»„åˆå½¢æ€</p>
<p>å‡è®¾æˆ‘éœ€è¦æ‰¾å‡º g??d çš„å­—ä¸²ï¼Œäº¦å³å…±æœ‰å››ä¸ªå­—èŠ‚ï¼Œ èµ·å¤´æ˜¯ g è€Œç»“æŸæ˜¯ d ï¼Œæˆ‘å¯ä»¥è¿™æ ·åšï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@www ~]<span class="comment"># grep -n 'g..d' regular_express.txt</span></div><div class="line">1:<span class="string">"Open Source"</span> is a good mechanism to develop programs.</div><div class="line">9:Oh! The soup taste good.</div><div class="line">16:The world &lt;Happy&gt; is the same with <span class="string">"glad"</span>.</div></pre></td></tr></table></figure></p>
<p>å› ä¸ºå¼ºè°ƒ g ä¸ d ä¹‹é—´ä¸€å®šè¦å­˜åœ¨ä¸¤ä¸ªå­—èŠ‚ï¼Œå› æ­¤ï¼Œç¬¬ 13 è¡Œçš„ god ä¸ç¬¬ 14 è¡Œçš„ gd å°±ä¸ä¼šè¢«åˆ—å‡ºæ¥å•¦ï¼</p>
<p>å¦‚æœæˆ‘æƒ³è¦åˆ—å‡ºæœ‰ oo, ooo, oooo ç­‰ç­‰çš„æ•°æ®ï¼Œ ä¹Ÿå°±æ˜¯è¯´ï¼Œè‡³å°‘è¦æœ‰ä¸¤ä¸ª(å«) o ä»¥ä¸Šï¼Œè¯¥å¦‚ä½•æ˜¯å¥½ï¼Ÿ</p>
<p>å› ä¸º * ä»£è¡¨çš„æ˜¯<code>é‡å¤ 0 ä¸ªæˆ–å¤šä¸ªå‰é¢çš„ RE å­—ç¬¦</code>çš„æ„ä¹‰ï¼Œ å› æ­¤ <code>o*</code> ä»£è¡¨çš„æ˜¯ï¼š<code>æ‹¥æœ‰ç©ºå­—èŠ‚æˆ–ä¸€ä¸ª o ä»¥ä¸Šçš„å­—èŠ‚</code>ï¼Œå› æ­¤ï¼Œ<code>grep -n &#39;o*&#39; regular_express.txt</code>å°†ä¼šæŠŠæ‰€æœ‰çš„æ•°æ®éƒ½åˆ—å°å‡ºæ¥ç»ˆç«¯ä¸Šï¼</p>
<p>å½“æˆ‘ä»¬éœ€è¦<code>è‡³å°‘ä¸¤ä¸ª o ä»¥ä¸Šçš„å­—ä¸²</code>æ—¶ï¼Œå°±éœ€è¦ <code>ooo*</code> ï¼Œäº¦å³æ˜¯ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@www ~]<span class="comment"># grep -n 'ooo*' regular_express.txt</span></div><div class="line">1:<span class="string">"Open Source"</span> is a good mechanism to develop programs.</div><div class="line">2:apple is my favorite food.</div><div class="line">3:Football game is not use feet only.</div><div class="line">9:Oh! The soup taste good.</div><div class="line">18:google is the best tools <span class="keyword">for</span> search keyword.</div><div class="line">19:goooooogle yes!</div></pre></td></tr></table></figure></p>
<p>å¦‚æœæˆ‘æƒ³è¦å­—ä¸²å¼€å¤´ä¸ç»“å°¾éƒ½æ˜¯ gï¼Œä½†æ˜¯ä¸¤ä¸ª g ä¹‹é—´ä»…èƒ½å­˜åœ¨è‡³å°‘ä¸€ä¸ª o ï¼Œäº¦å³æ˜¯ gog, goog, gooogâ€¦. ç­‰ç­‰ï¼Œé‚£è¯¥å¦‚ä½•ï¼Ÿ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@www ~]<span class="comment"># grep -n 'goo*g' regular_express.txt</span></div><div class="line">18:google is the best tools <span class="keyword">for</span> search keyword.</div><div class="line">19:goooooogle yes!</div></pre></td></tr></table></figure></p>
<p>å¦‚æœæˆ‘æƒ³è¦æ‰¾å‡º g å¼€å¤´ä¸ g ç»“å°¾çš„è¡Œï¼Œå½“ä¸­çš„å­—ç¬¦å¯æœ‰å¯æ— <br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@www ~]<span class="comment"># grep -n 'g.*g' regular_express.txt</span></div><div class="line">1:<span class="string">"Open Source"</span> is a good mechanism to develop programs.</div><div class="line">14:The gd software is a library <span class="keyword">for</span> drafting programs.</div><div class="line">18:google is the best tools <span class="keyword">for</span> search keyword.</div><div class="line">19:goooooogle yes!</div><div class="line">20:go! go! Let<span class="string">'s go.</span></div></pre></td></tr></table></figure></p>
<p>å› ä¸ºæ˜¯ä»£è¡¨ g å¼€å¤´ä¸ g ç»“å°¾ï¼Œä¸­é—´ä»»æ„å­—èŠ‚å‡å¯æ¥å—ï¼Œæ‰€ä»¥ï¼Œç¬¬ 1, 14, 20 è¡Œæ˜¯å¯æ¥å—çš„å–”ï¼ è¿™ä¸ª .* çš„ RE è¡¨ç¤ºä»»æ„å­—ç¬¦æ˜¯å¾ˆå¸¸è§çš„.</p>
<p>å¦‚æœæˆ‘æƒ³è¦æ‰¾å‡º<code>ä»»æ„æ•°å­—</code>çš„è¡Œï¼Ÿå› ä¸ºä»…æœ‰æ•°å­—ï¼Œæ‰€ä»¥å°±æˆä¸ºï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@www ~]<span class="comment"># grep -n '[0-9][0-9]*' regular_express.txt</span></div><div class="line">5:However, this dress is about $ 3183 dollars.</div><div class="line">15:You are the best is mean you are the no. 1.</div></pre></td></tr></table></figure></p>
<p>é™å®šè¿ç»­ RE å­—ç¬¦èŒƒå›´ {}<br>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ . ä¸ RE å­—ç¬¦åŠ <code>*</code> æ¥é…ç½® 0 ä¸ªåˆ°æ— é™å¤šä¸ªé‡å¤å­—èŠ‚ï¼Œ é‚£å¦‚æœæˆ‘æƒ³è¦é™åˆ¶ä¸€ä¸ªèŒƒå›´åŒºé—´å†…çš„é‡å¤å­—èŠ‚æ•°å‘¢ï¼Ÿ</p>
<p>ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘æƒ³è¦æ‰¾å‡ºä¸¤ä¸ªåˆ°äº”ä¸ª o çš„è¿ç»­å­—ä¸²ï¼Œè¯¥å¦‚ä½•ä½œï¼Ÿè¿™æ—¶å€™å°±å¾—è¦ä½¿ç”¨åˆ°é™å®šèŒƒå›´çš„å­—ç¬¦ {} äº†ã€‚ ä½†å› ä¸º { ä¸ } çš„ç¬¦å·åœ¨ shell æ˜¯æœ‰ç‰¹æ®Šæ„ä¹‰çš„ï¼Œå› æ­¤ï¼Œ æˆ‘ä»¬å¿…é¡»è¦ä½¿ç”¨å­—ç¬¦ <code>\</code> æ¥è®©ä»–å¤±å»ç‰¹æ®Šæ„ä¹‰æ‰è¡Œã€‚ è‡³æ–¼ {} çš„è¯­æ³•æ˜¯è¿™æ ·çš„ï¼Œå‡è®¾æˆ‘è¦æ‰¾åˆ°ä¸¤ä¸ª o çš„å­—ä¸²ï¼Œå¯ä»¥æ˜¯ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@www ~]<span class="comment"># grep -n 'o\&#123;2\&#125;' regular_express.txt</span></div><div class="line">1:<span class="string">"Open Source"</span> is a good mechanism to develop programs.</div><div class="line">2:apple is my favorite food.</div><div class="line">3:Football game is not use feet only.</div><div class="line">9:Oh! The soup taste good.</div><div class="line">18:google is the best tools <span class="keyword">for</span> search ke</div><div class="line">19:goooooogle yes!</div></pre></td></tr></table></figure></p>
<p>å‡è®¾æˆ‘ä»¬è¦æ‰¾å‡º g åé¢æ¥ 2 åˆ° 5 ä¸ª o ï¼Œç„¶åå†æ¥ä¸€ä¸ª g çš„å­—ä¸²ï¼Œä»–ä¼šæ˜¯è¿™æ ·ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@www ~]<span class="comment"># grep -n 'go\&#123;2,5\&#125;g' regular_express.txt</span></div><div class="line">18:google is the best tools <span class="keyword">for</span> search keyword.</div></pre></td></tr></table></figure></p>
<p>å¦‚æœæˆ‘æƒ³è¦çš„æ˜¯ 2 ä¸ª o ä»¥ä¸Šçš„ gooooâ€¦.g å‘¢ï¼Ÿé™¤äº†å¯ä»¥æ˜¯ gooo*g ï¼Œä¹Ÿå¯ä»¥æ˜¯ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@www ~]<span class="comment"># grep -n 'go\&#123;2,\&#125;g' regular_express.txt</span></div><div class="line">18:google is the best tools <span class="keyword">for</span> search keyword.</div><div class="line">19:goooooogle yes!</div></pre></td></tr></table></figure></p>
<p>æ‰©å±•grep(grep -E æˆ–è€… egrep)ï¼š<br>ä½¿ç”¨æ‰©å±•grepçš„ä¸»è¦å¥½å¤„æ˜¯å¢åŠ äº†é¢å¤–çš„æ­£åˆ™è¡¨è¾¾å¼å…ƒå­—ç¬¦é›†ã€‚</p>
<p>æ‰“å°æ‰€æœ‰åŒ…å«NWæˆ–EAçš„è¡Œã€‚å¦‚æœä¸æ˜¯ä½¿ç”¨egrepï¼Œè€Œæ˜¯grepï¼Œå°†ä¸ä¼šæœ‰ç»“æœæŸ¥å‡ºã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">egrep <span class="string">'NW|EA'</span> testfile     </div><div class="line">    northwest       NW      Charles Main        3.0     .98     3       34</div><div class="line">    eastern         EA      TB Savage           4.4     .84     5       20</div></pre></td></tr></table></figure></p>
<p>å¯¹äºæ ‡å‡†grepï¼Œå¦‚æœåœ¨æ‰©å±•å…ƒå­—ç¬¦å‰é¢åŠ \ï¼Œgrepä¼šè‡ªåŠ¨å¯ç”¨æ‰©å±•é€‰é¡¹-Eã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">grep <span class="string">'NW\|EA'</span> testfile</div><div class="line">northwest       NW      Charles Main        3.0     .98     3       34</div><div class="line">eastern         EA      TB Savage           4.4     .84     5       20</div></pre></td></tr></table></figure></p>
<p>æœç´¢æ‰€æœ‰åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª3çš„è¡Œã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">egrep <span class="string">'3+'</span> testfile</div><div class="line">grep -E <span class="string">'3+'</span> testfile</div><div class="line">grep <span class="string">'3\+'</span> testfile        </div><div class="line"><span class="comment">#è¿™3æ¡å‘½ä»¤å°†ä¼š</span></div><div class="line">northwest       NW      Charles Main          3.0     .98     3       34</div><div class="line">western         WE      Sharon Gray           5.3     .97     5       23</div><div class="line">northeast       NE      AM Main Jr.           5.1     .94     3       13</div><div class="line">central         CT      Ann Stephens          5.7     .94     5       13</div></pre></td></tr></table></figure></p>
<p>æœç´¢æ‰€æœ‰åŒ…å«0ä¸ªæˆ–1ä¸ªå°æ•°ç‚¹å­—ç¬¦çš„è¡Œã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">egrep <span class="string">'2\.?[0-9]'</span> testfile </div><div class="line">grep -E <span class="string">'2\.?[0-9]'</span> testfile</div><div class="line">grep <span class="string">'2\.\?[0-9]'</span> testfile </div><div class="line"><span class="comment">#é¦–å…ˆå«æœ‰2å­—ç¬¦ï¼Œå…¶åç´§è·Ÿç€0ä¸ªæˆ–1ä¸ªç‚¹ï¼Œåé¢å†æ˜¯0å’Œ9ä¹‹é—´çš„æ•°å­—ã€‚</span></div><div class="line">western         WE       Sharon Gray          5.3     .97     5       23</div><div class="line">southwest       SW      Lewis Dalsass         2.7     .8      2       18</div><div class="line">eastern         EA       TB Savage             4.4     .84     5       20</div></pre></td></tr></table></figure></p>
<p>æœç´¢ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¿ç»­çš„noçš„è¡Œã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">egrep <span class="string">'(no)+'</span> testfile</div><div class="line">grep -E <span class="string">'(no)+'</span> testfile</div><div class="line">grep <span class="string">'\(no\)\+'</span> testfile   <span class="comment">#3ä¸ªå‘½ä»¤è¿”å›ç›¸åŒç»“æœï¼Œ</span></div><div class="line">northwest       NW      Charles Main        3.0     .98     3       34</div><div class="line">northeast       NE       AM Main Jr.        5.1     .94     3       13</div><div class="line">north           NO      Margot Weber        4.5     .89     5       9</div></pre></td></tr></table></figure></p>
<p>ä¸ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼</p>
<p>fgrep æŸ¥è¯¢é€Ÿåº¦æ¯”grepå‘½ä»¤å¿«ï¼Œä½†æ˜¯ä¸å¤Ÿçµæ´»ï¼šå®ƒåªèƒ½æ‰¾å›ºå®šçš„æ–‡æœ¬ï¼Œè€Œä¸æ˜¯è§„åˆ™è¡¨è¾¾å¼ã€‚</p>
<p>å¦‚æœä½ æƒ³åœ¨ä¸€ä¸ªæ–‡ä»¶æˆ–è€…è¾“å‡ºä¸­æ‰¾åˆ°åŒ…å«æ˜Ÿå·å­—ç¬¦çš„è¡Œ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">fgrep  <span class="string">'*'</span> /etc/profile</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> /etc/profile.d/*.sh ; <span class="keyword">do</span></div><div class="line">æˆ–</div><div class="line">grep -F <span class="string">'*'</span> /etc/profile</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> /etc/profile.d/*.sh ; <span class="keyword">do</span></div></pre></td></tr></table></figure></p>
]]></content>
      
        <categories>
            
            <category> linuxå‘½ä»¤ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> linux </tag>
            
            <tag> grep </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[jQueryçš„.bind()ã€.live()å’Œ.delegate()ä¹‹é—´åŒºåˆ«]]></title>
      <url>/2014/01/04/jquery-bind-delegate/</url>
      <content type="html"><![CDATA[<p><code>æ‘˜è¦: jQueryçš„.bind()ã€.live()å’Œ.delegate()ä¹‹é—´çš„åŒºåˆ«å¹¶éæ€»æ˜¯é‚£ä¹ˆæ˜æ˜¾çš„ï¼Œç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬å¯¹æ‰€æœ‰çš„ä¸åŒä¹‹å¤„éƒ½æœ‰æ¸…æ™°çš„ç†è§£çš„è¯ï¼Œé‚£ä¹ˆè¿™å°†ä¼šæœ‰åŠ©äºæˆ‘ä»¬ç¼–å†™å‡ºæ›´åŠ ç®€æ´çš„ä»£ç ï¼Œä»¥åŠé˜²æ­¢åœ¨äº¤äº’åº”ç”¨ä¸­å¼¹å‡ºé”™è¯¯ã€‚</code></p>
<p><a href="/images/jquery-1.jpg"><img src="/images/jquery-1.jpg" alt=""></a><br><a id="more"></a></p>
<p>DOMæ ‘</p>
<p>é¦–å…ˆï¼Œå¯è§†åŒ–ä¸€ä¸ªHMTLæ–‡æ¡£çš„DOMæ ‘æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚ä¸€ä¸ªç®€å•çš„HTMLé¡µé¢çœ‹èµ·æ¥å°±åƒæ˜¯è¿™ä¸ªæ ·å­ï¼š<br><a href="/images/jquery-2.png"><img src="/images/jquery-2.png" alt=""></a> </p>
<p>äº‹ä»¶å†’æ³¡(åˆç§°äº‹ä»¶ä¼ æ’­)</p>
<p>å½“æˆ‘ä»¬ç‚¹å‡»ä¸€ä¸ªé“¾æ¥æ—¶ï¼Œå…¶è§¦å‘äº†é“¾æ¥å…ƒç´ çš„å•å‡»äº‹ä»¶ï¼Œè¯¥äº‹ä»¶åˆ™å¼•å‘ä»»ä½•æˆ‘ä»¬å·²ç»‘å®šåˆ°è¯¥å…ƒç´ çš„å•å‡»äº‹ä»¶ä¸Šçš„å‡½æ•°çš„æ‰§è¡Œã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'a'</span>).bind(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; alert(<span class="string">"That tickles!"</span>) &#125;);</div></pre></td></tr></table></figure>
<p>å› æ­¤ä¸€ä¸ªå•å‡»æ“ä½œä¼šè§¦å‘alertå‡½æ•°çš„æ‰§è¡Œã€‚<br><a href="/images/jquery-3.png"><img src="/images/jquery-3.png" alt=""></a> </p>
<p>clickäº‹ä»¶æ¥ç€ä¼šå‘æ ‘çš„æ ¹æ–¹å‘ä¼ æ’­ï¼Œå¹¿æ’­åˆ°çˆ¶å…ƒç´ ï¼Œç„¶åæ¥ç€æ˜¯æ¯ä¸ªç¥–å…ˆå…ƒç´ ï¼Œåªè¦æ˜¯å®ƒçš„æŸä¸ªåä»£å…ƒç´ ä¸Šçš„å•å‡»äº‹ä»¶è¢«è§¦å‘ï¼Œäº‹ä»¶å°±ä¼šä¼ ç»™å®ƒã€‚</p>
<p><a href="/images/jquery-4.png"><img src="/images/jquery-4.png" alt=""></a> </p>
<p>åœ¨æ“çºµDOMçš„è¯­å¢ƒä¸­ï¼Œdocumentæ˜¯æ ¹èŠ‚ç‚¹ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥è¾ƒå®¹æ˜“åœ°è¯´æ˜.bind()ã€.live()å’Œ.delegate()çš„ä¸åŒä¹‹å¤„äº†ã€‚</p>
<p>.bind()</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'a'</span>).bind(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; alert(<span class="string">"That tickles!"</span>) &#125;);</div></pre></td></tr></table></figure>
<p>è¿™æ˜¯æœ€ç®€å•çš„ç»‘å®šæ–¹æ³•äº†ã€‚JQueryæ‰«ææ–‡æ¡£æ‰¾å‡ºæ‰€æœ‰çš„$(â€˜aâ€™)å…ƒç´ ï¼Œå¹¶æŠŠalertå‡½æ•°ç»‘å®šåˆ°æ¯ä¸ªå…ƒç´ çš„clickäº‹ä»¶ä¸Šã€‚</p>
<p>.live()</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'a'</span>).live(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; alert(<span class="string">"That tickles!"</span>) &#125;);</div></pre></td></tr></table></figure>
<p>JQueryæŠŠalertå‡½æ•°ç»‘å®šåˆ°$(document)å…ƒç´ ä¸Šï¼Œå¹¶ä½¿ç”¨â€™clickâ€™å’Œâ€™aâ€™ä½œä¸ºå‚æ•°ã€‚ä»»ä½•æ—¶å€™åªè¦æœ‰äº‹ä»¶å†’æ³¡åˆ°documentèŠ‚ç‚¹ä¸Šï¼Œå®ƒå°±æŸ¥çœ‹è¯¥äº‹ä»¶æ˜¯å¦æ˜¯ä¸€ä¸ªclickäº‹ä»¶ï¼Œä»¥åŠè¯¥äº‹ä»¶çš„ç›®æ ‡å…ƒç´ ä¸â€™aâ€™è¿™ä¸€CSSé€‰æ‹©å™¨æ˜¯å¦åŒ¹é…ï¼Œå¦‚æœéƒ½æ˜¯çš„è¯ï¼Œåˆ™æ‰§è¡Œå‡½æ•°ã€‚</p>
<p>liveæ–¹æ³•è¿˜å¯ä»¥è¢«ç»‘å®šåˆ°å…·ä½“çš„å…ƒç´ (æˆ–â€œcontextâ€)è€Œä¸æ˜¯documentä¸Šï¼Œåƒè¿™æ ·ï¼š</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'a'</span>, $(<span class="string">'#container'</span>)[<span class="number">0</span>]).live(...);</div></pre></td></tr></table></figure>
<p>.delegate()</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'#container'</span>).delegate(<span class="string">'a'</span>, <span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; alert(<span class="string">"That tickles!"</span>) &#125;);</div></pre></td></tr></table></figure>
<p>JQueryæ‰«ææ–‡æ¡£æŸ¥æ‰¾$(â€˜#containerâ€™)ï¼Œå¹¶ä½¿ç”¨clickäº‹ä»¶å’Œâ€™aâ€™è¿™ä¸€CSSé€‰æ‹©å™¨ä½œä¸ºå‚æ•°æŠŠalertå‡½æ•°ç»‘å®šåˆ°$(â€˜#containerâ€™)ä¸Šã€‚ä»»ä½•æ—¶å€™åªè¦æœ‰äº‹ä»¶å†’æ³¡åˆ°$(â€˜#containerâ€™)ä¸Šï¼Œå®ƒå°±æŸ¥çœ‹è¯¥äº‹ä»¶æ˜¯å¦æ˜¯clickäº‹ä»¶ï¼Œä»¥åŠè¯¥äº‹ä»¶çš„ç›®æ ‡å…ƒç´ æ˜¯å¦ä¸CCSé€‰æ‹©å™¨ç›¸åŒ¹é…ã€‚å¦‚æœä¸¤ç§æ£€æŸ¥çš„ç»“æœéƒ½ä¸ºçœŸçš„è¯ï¼Œå®ƒå°±æ‰§è¡Œå‡½æ•°ã€‚</p>
<p>å¯ä»¥æ³¨æ„åˆ°ï¼Œè¿™ä¸€è¿‡ç¨‹ä¸.live()ç±»ä¼¼ï¼Œä½†æ˜¯å…¶æŠŠå¤„ç†ç¨‹åºç»‘å®šåˆ°å…·ä½“çš„å…ƒç´ è€Œédocumentè¿™ä¸€æ ¹ä¸Šã€‚ç²¾æ˜çš„JSâ€™erä»¬å¯èƒ½ä¼šåšå‡ºè¿™æ ·çš„ç»“è®ºï¼Œå³$(â€˜aâ€™).live() == $(document).delegate(â€˜aâ€™)ï¼Œæ˜¯è¿™æ ·å—?å—¯ï¼Œä¸ï¼Œä¸å®Œå…¨æ˜¯ã€‚</p>
<p>ä¸ºä»€ä¹ˆ.delegate()è¦æ¯”.live()å¥½ç”¨</p>
<p>åŸºäºå‡ ä¸ªåŸå› ï¼Œäººä»¬é€šå¸¸æ›´æ„¿æ„é€‰ç”¨jQueryçš„delegateæ–¹æ³•è€Œä¸æ˜¯liveæ–¹æ³•ã€‚è€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'a'</span>).live(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; blah() &#125;);     </div><div class="line"><span class="comment">// æˆ–è€…   </span></div><div class="line">$(<span class="built_in">document</span>).delegate(<span class="string">'a'</span>, <span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; blah() &#125;);</div></pre></td></tr></table></figure>
<p>é€Ÿåº¦</p>
<p>åè€…å®é™…ä¸Šè¦å¿«è¿‡å‰è€…ï¼Œå› ä¸ºå‰è€…é¦–å…ˆè¦æ‰«ææ•´ä¸ªçš„æ–‡æ¡£æŸ¥æ‰¾æ‰€æœ‰çš„$(â€˜aâ€™)å…ƒç´ ï¼ŒæŠŠå®ƒä»¬å­˜æˆjQueryå¯¹è±¡ã€‚å°½ç®¡liveå‡½æ•°ä»…éœ€è¦æŠŠâ€™aâ€™ä½œä¸ºä¸²å‚æ•°ä¼ é€’ä»¥ç”¨åšä¹‹åçš„åˆ¤æ–­ï¼Œä½†æ˜¯$()å‡½æ•°å¹¶æœªâ€œçŸ¥é“â€è¢«é“¾æ¥çš„æ–¹æ³•å°†ä¼šæ˜¯.live()ã€‚</p>
<p>è€Œå¦ä¸€æ–¹é¢ï¼Œdelegateæ–¹æ³•ä»…éœ€è¦æŸ¥æ‰¾å¹¶å­˜å‚¨$(document)å…ƒç´ ã€‚</p>
<p>ä¸€ç§å¯»æ±‚é¿å¼€è¿™ä¸€é—®é¢˜çš„æ–¹æ³•æ˜¯è°ƒç”¨åœ¨$(document).ready()ä¹‹å¤–ç»‘å®šçš„liveï¼Œè¿™æ ·å®ƒå°±ä¼šç«‹å³æ‰§è¡Œã€‚åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œå…¶ä¼šåœ¨DOMè·å¾—å¡«å……ä¹‹å‰è¿è¡Œï¼Œå› æ­¤å°±ä¸ä¼šæŸ¥æ‰¾å…ƒç´ æˆ–æ˜¯åˆ›å»ºjQueryå¯¹è±¡äº†ã€‚</p>
<p>çµæ´»æ€§å’Œé“¾èƒ½åŠ›</p>
<p>liveå‡½æ•°ä¹ŸæŒºä»¤äººè´¹è§£çš„ã€‚æƒ³æƒ³çœ‹ï¼Œå®ƒè¢«é“¾åˆ°$(â€˜aâ€™)å¯¹è±¡é›†ä¸Šï¼Œä½†å…¶å®é™…ä¸Šæ˜¯åœ¨$(document)å¯¹è±¡ä¸Šå‘ç”Ÿä½œç”¨ã€‚ç”±äºè¿™ä¸ªåŸå› ï¼Œå®ƒèƒ½å¤Ÿè¯•å›¾ä»¥ä¸€ç§å“æ­»äººçš„æ–¹å¼æ¥æŠŠæ–¹æ³•é“¾åˆ°è‡ªèº«ä¸Šã€‚å®é™…ä¸Šï¼Œæˆ‘æƒ³è¯´çš„æ˜¯ï¼Œä»¥$.live(â€˜aâ€™,â€¦)è¿™ä¸€å½¢å¼ä½œä¸ºä¸€ç§å…¨å±€æ€§çš„jQueryæ–¹æ³•ï¼Œliveæ–¹æ³•ä¼šæ›´å…·æ„ä¹‰ä¸€äº›ã€‚</p>
<p>ä»…æ”¯æŒCSSé€‰æ‹©å™¨</p>
<p>æœ€åä¸€ç‚¹ï¼Œliveæ–¹æ³•æœ‰ä¸€ä¸ªéå¸¸å¤§çš„ç¼ºç‚¹ï¼Œé‚£å°±æ˜¯å®ƒä»…èƒ½é’ˆå¯¹ç›´æ¥çš„CSSé€‰æ‹©å™¨åšæ“ä½œï¼Œè¿™ä½¿å¾—å®ƒå˜å¾—éå¸¸çš„ä¸çµæ´»ã€‚</p>
<p>æ¬²äº†è§£æ›´å¤šå…³äºCSSé€‰æ‹©å™¨çš„ç¼ºç‚¹ï¼Œè¯·å‚é˜…Exploring jQuery .live() and .die()ä¸€æ–‡ã€‚</p>
<p>æ›´æ–°ï¼šæ„Ÿè°¢Hacker Newsä¸Šçš„pedalpeteå’Œåé¢è¯„è®ºä¸­çš„Ellsassæé†’æˆ‘åŠ å…¥æ¥ä¸‹æ¥çš„è¿™ä¸€èŠ‚å†…å®¹ã€‚</p>
<p>ä¸ºä»€ä¹ˆé€‰æ‹©.live()æˆ–.delegate()è€Œä¸æ˜¯.bind()</p>
<p>æ¯•ç«Ÿï¼Œbindçœ‹èµ·æ¥ä¼¼ä¹æ›´åŠ çš„æ˜ç¡®å’Œç›´æ¥ï¼Œéš¾é“ä¸æ˜¯å—?å—¯ï¼Œæœ‰ä¸¤ä¸ªåŸå› è®©æˆ‘ä»¬æ›´æ„¿æ„é€‰æ‹©delegateæˆ–liveè€Œä¸æ˜¯bindï¼š</p>
<p>ä¸ºäº†æŠŠå¤„ç†ç¨‹åºé™„åŠ åˆ°å¯èƒ½è¿˜æœªå­˜åœ¨äºDOMä¸­çš„DOMå…ƒç´ ä¹‹ä¸Šã€‚å› ä¸ºbindæ˜¯ç›´æ¥æŠŠå¤„ç†ç¨‹åºç»‘å®šåˆ°å„ä¸ªå…ƒç´ ä¸Šï¼Œå®ƒä¸èƒ½æŠŠå¤„ç†ç¨‹åºç»‘å®šåˆ°è¿˜æœªå­˜åœ¨äºé¡µé¢ä¸­çš„å…ƒç´ ä¹‹ä¸Šã€‚</p>
<p>å¦‚æœä½ è¿è¡Œäº†$(â€˜aâ€™).bind(â€¦)ï¼Œè€Œåæ–°çš„é“¾æ¥ç»ç”±AJAXåŠ å…¥åˆ°äº†é¡µé¢ä¸­ï¼Œåˆ™ä½ çš„bindå¤„ç†ç¨‹åºå¯¹äºè¿™äº›æ–°åŠ å…¥çš„é“¾æ¥æ¥è¯´æ˜¯æ— æ•ˆçš„ã€‚è€Œå¦ä¸€æ–¹é¢liveå’Œdelegateåˆ™æ˜¯è¢«ç»‘å®šåˆ°å¦ä¸€ä¸ªç¥–å…ˆèŠ‚ç‚¹ä¸Šï¼Œå› æ­¤å…¶å¯¹äºä»»ä½•ç›®å‰æˆ–æ˜¯å°†æ¥å­˜åœ¨äºè¯¥ç¥–å…ˆå…ƒç´ ä¹‹å†…çš„å…ƒç´ éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<p>æˆ–è€…ä¸ºäº†æŠŠå¤„ç†ç¨‹åºé™„åŠ åˆ°å•ä¸ªå…ƒç´ ä¸Šæˆ–æ˜¯ä¸€å°ç»„å…ƒç´ ä¹‹ä¸Šï¼Œç›‘å¬åä»£å…ƒç´ ä¸Šçš„äº‹ä»¶è€Œä¸æ˜¯å¾ªç¯éå†å¹¶æŠŠåŒä¸€ä¸ªå‡½æ•°é€ä¸ªé™„åŠ åˆ°DOMä¸­çš„100ä¸ªå…ƒç´ ä¸Šã€‚æŠŠå¤„ç†ç¨‹åºé™„åŠ åˆ°ä¸€ä¸ª(æˆ–æ˜¯ä¸€å°ç»„)ç¥–å…ˆå…ƒç´ ä¸Šè€Œä¸æ˜¯ç›´æ¥æŠŠå¤„ç†ç¨‹åºé™„åŠ åˆ°é¡µé¢ä¸­çš„æ‰€æœ‰å…ƒç´ ä¸Šï¼Œè¿™ç§åšæ³•å¸¦æ¥äº†æ€§èƒ½ä¸Šçš„å¥½å¤„ã€‚</p>
<p>åœæ­¢ä¼ æ’­</p>
<p>æœ€åä¸€ä¸ªæˆ‘æƒ³åšçš„æé†’ä¸äº‹ä»¶ä¼ æ’­æœ‰å…³ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨è¿™æ ·çš„äº‹ä»¶æ–¹æ³•æ¥ç»ˆæ­¢å¤„ç†å‡½æ•°çš„æ‰§è¡Œï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'a'</span>).bind(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;      </div><div class="line">e.preventDefault();   </div><div class="line"><span class="comment">// æˆ–è€…   </span></div><div class="line">e.stopPropagation();   </div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>ä¸è¿‡ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨liveæˆ–æ˜¯delegateæ–¹æ³•çš„æ—¶å€™ï¼Œå¤„ç†å‡½æ•°å®é™…ä¸Šå¹¶æ²¡æœ‰åœ¨è¿è¡Œï¼Œéœ€è¦ç­‰åˆ°äº‹ä»¶å†’æ³¡åˆ°å¤„ç†ç¨‹åºå®é™…ç»‘å®šçš„å…ƒç´ ä¸Šæ—¶å‡½æ•°æ‰ä¼šè¿è¡Œã€‚è€Œåˆ°æ­¤æ—¶ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„å…¶ä»–çš„æ¥è‡ª.bind()çš„å¤„ç†å‡½æ•°æ—©å·²è¿è¡Œäº†ã€‚</p>
<p>åŸæ–‡åœ°å€ï¼š<a href="http://developer.51cto.com/art/201103/249694.htm" target="_blank" rel="external">http://developer.51cto.com/art/201103/249694.htm</a></p>
]]></content>
      
        <categories>
            
            <category> jQuery </category>
            
        </categories>
        
        
        <tags>
            
            <tag> jQuery </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ­£ç¡®ç†è§£ThreadLocal]]></title>
      <url>/2014/01/04/threadlocal-understanding/</url>
      <content type="html"><![CDATA[<p>é¦–å…ˆï¼ŒThreadLocal ä¸æ˜¯ç”¨æ¥è§£å†³å…±äº«å¯¹è±¡çš„å¤šçº¿ç¨‹è®¿é—®é—®é¢˜çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé€šè¿‡ThreadLocal.set() åˆ°çº¿ç¨‹ä¸­çš„å¯¹è±¡æ˜¯è¯¥çº¿ç¨‹è‡ªå·±ä½¿ç”¨çš„å¯¹è±¡ï¼Œå…¶ä»–çº¿ç¨‹æ˜¯ä¸éœ€è¦è®¿é—®çš„ï¼Œä¹Ÿè®¿é—®ä¸åˆ°çš„ã€‚ å„ä¸ªçº¿ç¨‹ä¸­è®¿é—®çš„æ˜¯ä¸åŒçš„å¯¹è±¡ã€‚  </p>
<p>å¦å¤–ï¼Œè¯´ThreadLocalä½¿å¾—å„çº¿ç¨‹èƒ½å¤Ÿä¿æŒå„è‡ªç‹¬ç«‹çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸æ˜¯é€šè¿‡ThreadLocal.set()æ¥å®ç°çš„ï¼Œè€Œæ˜¯é€šè¿‡æ¯ä¸ªçº¿ç¨‹ä¸­çš„new å¯¹è±¡ çš„æ“ä½œæ¥åˆ›å»ºçš„å¯¹è±¡ï¼Œæ¯ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ªï¼Œä¸æ˜¯ä»€ä¹ˆå¯¹è±¡çš„æ‹·è´æˆ–å‰¯æœ¬ã€‚ é€šè¿‡ThreadLocal.set()å°†è¿™ä¸ªæ–°åˆ›å»ºçš„å¯¹è±¡çš„å¼•ç”¨ä¿å­˜åˆ°å„çº¿ç¨‹çš„è‡ªå·±çš„ä¸€ä¸ªmapä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è¿™æ ·ä¸€ä¸ªmapï¼Œæ‰§è¡ŒThreadLocal.get()æ—¶ï¼Œå„çº¿ç¨‹ä»è‡ªå·±çš„mapä¸­å–å‡ºæ”¾è¿›å»çš„å¯¹è±¡ï¼Œå› æ­¤å–å‡ºæ¥çš„æ˜¯å„è‡ªè‡ªå·±çº¿ç¨‹ä¸­çš„å¯¹è±¡ï¼ŒThreadLocalå®ä¾‹æ˜¯ä½œä¸ºmapçš„keyæ¥ä½¿ç”¨çš„ã€‚<br><a id="more"></a><br>å¦‚æœThreadLocal.set()è¿›å»çš„ä¸œè¥¿æœ¬æ¥å°±æ˜¯å¤šä¸ªçº¿ç¨‹å…±äº«çš„åŒä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå¤šä¸ªçº¿ç¨‹çš„ThreadLocal.get()å–å¾—çš„è¿˜æ˜¯è¿™ä¸ªå…±äº«å¯¹è±¡æœ¬èº«ï¼Œè¿˜æ˜¯æœ‰å¹¶å‘è®¿é—®é—®é¢˜ã€‚  </p>
<p>ä¸‹é¢æ¥çœ‹ä¸€ä¸ªhibernateä¸­å…¸å‹çš„ThreadLocalçš„åº”ç”¨ï¼š </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal threadSession = <span class="keyword">new</span> ThreadLocal();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title">getSession</span><span class="params">()</span> <span class="keyword">throws</span> InfrastructureException </span>&#123;</div><div class="line">        Session s = (Session) threadSession.get();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">if</span> (s == <span class="keyword">null</span>) &#123;</div><div class="line">                s = getSessionFactory().openSession();</div><div class="line">                threadSession.set(s);</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">catch</span> (HibernateException ex) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> InfrastructureException(ex);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> s;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°åœ¨getSession()æ–¹æ³•ä¸­ï¼Œé¦–å…ˆåˆ¤æ–­å½“å‰çº¿ç¨‹ä¸­æœ‰æ²¡æœ‰æ”¾è¿›å»sessionï¼Œå¦‚æœè¿˜æ²¡æœ‰ï¼Œé‚£ä¹ˆé€šè¿‡sessionFactory().openSession()æ¥åˆ›å»ºä¸€ä¸ªsessionï¼Œå†å°†session setåˆ°çº¿ç¨‹ä¸­ï¼Œå®é™…æ˜¯æ”¾åˆ°å½“å‰çº¿ç¨‹çš„ThreadLocalMapè¿™ä¸ªmapä¸­ï¼Œè¿™æ—¶ï¼Œå¯¹äºè¿™ä¸ªsessionçš„å”¯ä¸€å¼•ç”¨å°±æ˜¯å½“å‰çº¿ç¨‹ä¸­çš„é‚£ä¸ªThreadLocalMapï¼ˆä¸‹é¢ä¼šè®²åˆ°ï¼‰ï¼Œè€ŒthreadSessionä½œä¸ºè¿™ä¸ªå€¼çš„keyï¼Œè¦å–å¾—è¿™ä¸ªsessionå¯ä»¥é€šè¿‡threadSession.get()æ¥å¾—åˆ°ï¼Œé‡Œé¢æ‰§è¡Œçš„æ“ä½œå®é™…æ˜¯å…ˆå–å¾—å½“å‰çº¿ç¨‹ä¸­çš„ThreadLocalMapï¼Œç„¶åå°†threadSessionä½œä¸ºkeyå°†å¯¹åº”çš„å€¼å–å‡ºã€‚è¿™ä¸ªsessionç›¸å½“äºçº¿ç¨‹çš„ç§æœ‰å˜é‡ï¼Œè€Œä¸æ˜¯publicçš„ã€‚<br>æ˜¾ç„¶ï¼Œå…¶ä»–çº¿ç¨‹ä¸­æ˜¯å–ä¸åˆ°è¿™ä¸ªsessionçš„ï¼Œä»–ä»¬ä¹Ÿåªèƒ½å–åˆ°è‡ªå·±çš„ThreadLocalMapä¸­çš„ä¸œè¥¿ã€‚è¦æ˜¯sessionæ˜¯å¤šä¸ªçº¿ç¨‹å…±äº«ä½¿ç”¨çš„ï¼Œé‚£è¿˜ä¸ä¹±å¥—äº†ã€‚<br>è¯•æƒ³å¦‚æœä¸ç”¨ThreadLocalæ€ä¹ˆæ¥å®ç°å‘¢ï¼Ÿå¯èƒ½å°±è¦åœ¨actionä¸­åˆ›å»ºsessionï¼Œç„¶åæŠŠsessionä¸€ä¸ªä¸ªä¼ åˆ°serviceå’Œdaoä¸­ï¼Œè¿™å¯å¤Ÿéº»çƒ¦çš„ã€‚æˆ–è€…å¯ä»¥è‡ªå·±å®šä¹‰ä¸€ä¸ªé™æ€çš„mapï¼Œå°†å½“å‰threadä½œä¸ºkeyï¼Œåˆ›å»ºçš„sessionä½œä¸ºå€¼ï¼Œputåˆ°mapä¸­ï¼Œåº”è¯¥ä¹Ÿè¡Œï¼Œè¿™ä¹Ÿæ˜¯ä¸€èˆ¬äººçš„æƒ³æ³•ï¼Œä½†äº‹å®ä¸Šï¼ŒThreadLocalçš„å®ç°åˆšå¥½ç›¸åï¼Œå®ƒæ˜¯åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­æœ‰ä¸€ä¸ªmapï¼Œè€Œå°†ThreadLocalå®ä¾‹ä½œä¸ºkeyï¼Œè¿™æ ·æ¯ä¸ªmapä¸­çš„é¡¹æ•°å¾ˆå°‘ï¼Œè€Œä¸”å½“çº¿ç¨‹é”€æ¯æ—¶ç›¸åº”çš„ä¸œè¥¿ä¹Ÿä¸€èµ·é”€æ¯äº†ï¼Œä¸çŸ¥é“é™¤äº†è¿™äº›è¿˜æœ‰ä»€ä¹ˆå…¶ä»–çš„å¥½å¤„ã€‚  </p>
<p>æ€»ä¹‹ï¼ŒThreadLocalä¸æ˜¯ç”¨æ¥è§£å†³å¯¹è±¡å…±äº«è®¿é—®é—®é¢˜çš„ï¼Œè€Œä¸»è¦æ˜¯æä¾›äº†ä¿æŒå¯¹è±¡çš„æ–¹æ³•å’Œé¿å…å‚æ•°ä¼ é€’çš„æ–¹ä¾¿çš„å¯¹è±¡è®¿é—®æ–¹å¼ã€‚å½’çº³äº†ä¸¤ç‚¹ï¼š<br>1ã€‚æ¯ä¸ªçº¿ç¨‹ä¸­éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„ThreadLocalMapç±»å¯¹è±¡ï¼Œå¯ä»¥å°†çº¿ç¨‹è‡ªå·±çš„å¯¹è±¡ä¿æŒåˆ°å…¶ä¸­ï¼Œå„ç®¡å„çš„ï¼Œçº¿ç¨‹å¯ä»¥æ­£ç¡®çš„è®¿é—®åˆ°è‡ªå·±çš„å¯¹è±¡ã€‚<br>2ã€‚å°†ä¸€ä¸ªå…±ç”¨çš„ThreadLocalé™æ€å®ä¾‹ä½œä¸ºkeyï¼Œå°†ä¸åŒå¯¹è±¡çš„å¼•ç”¨ä¿å­˜åˆ°ä¸åŒçº¿ç¨‹çš„ThreadLocalMapä¸­ï¼Œç„¶ååœ¨çº¿ç¨‹æ‰§è¡Œçš„å„å¤„é€šè¿‡è¿™ä¸ªé™æ€ThreadLocalå®ä¾‹çš„get()æ–¹æ³•å–å¾—è‡ªå·±çº¿ç¨‹ä¿å­˜çš„é‚£ä¸ªå¯¹è±¡ï¼Œé¿å…äº†å°†è¿™ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’çš„éº»çƒ¦ã€‚   </p>
<p>å½“ç„¶å¦‚æœè¦æŠŠæœ¬æ¥çº¿ç¨‹å…±äº«çš„å¯¹è±¡é€šè¿‡ThreadLocal.set()æ”¾åˆ°çº¿ç¨‹ä¸­ä¹Ÿå¯ä»¥ï¼Œå¯ä»¥å®ç°é¿å…å‚æ•°ä¼ é€’çš„è®¿é—®æ–¹å¼ï¼Œä½†æ˜¯è¦æ³¨æ„get()åˆ°çš„æ˜¯é‚£åŒä¸€ä¸ªå…±äº«å¯¹è±¡ï¼Œå¹¶å‘è®¿é—®é—®é¢˜è¦é å…¶ä»–æ‰‹æ®µæ¥è§£å†³ã€‚ä½†ä¸€èˆ¬æ¥è¯´çº¿ç¨‹å…±äº«çš„å¯¹è±¡é€šè¿‡è®¾ç½®ä¸ºæŸç±»çš„é™æ€å˜é‡å°±å¯ä»¥å®ç°æ–¹ä¾¿çš„è®¿é—®äº†ï¼Œä¼¼ä¹æ²¡å¿…è¦æ”¾åˆ°çº¿ç¨‹ä¸­ã€‚  </p>
<p>ThreadLocalçš„åº”ç”¨åœºåˆï¼Œæˆ‘è§‰å¾—æœ€é€‚åˆçš„æ˜¯æŒ‰çº¿ç¨‹å¤šå®ä¾‹ï¼ˆæ¯ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªå®ä¾‹ï¼‰çš„å¯¹è±¡çš„è®¿é—®ï¼Œå¹¶ä¸”è¿™ä¸ªå¯¹è±¡å¾ˆå¤šåœ°æ–¹éƒ½è¦ç”¨åˆ°ã€‚   </p>
<p>ä¸‹é¢æ¥çœ‹çœ‹ThreadLocalçš„å®ç°åŸç†ï¼ˆjdk1.5æºç ï¼‰<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadLocal</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * ThreadLocals rely on per-thread hash maps attached to each thread</div><div class="line">     * (Thread.threadLocals and inheritableThreadLocals).  The ThreadLocal</div><div class="line">     * objects act as keys, searched via threadLocalHashCode.  This is a</div><div class="line">     * custom hash code (useful only within ThreadLocalMaps) that eliminates</div><div class="line">     * collisions in the common case where consecutively constructed</div><div class="line">     * ThreadLocals are used by the same threads, while remaining well-behaved</div><div class="line">     * in less common cases.</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> threadLocalHashCode = nextHashCode();</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * The next hash code to be given out. Accessed only by like-named method.</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> nextHashCode = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * The difference between successively generated hash codes - turns</div><div class="line">     * implicit sequential thread-local IDs into near-optimally spread</div><div class="line">     * multiplicative hash values for power-of-two-sized tables.</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> HASH_INCREMENT = <span class="number">0x61c88647</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Compute the next hash code. The static synchronization used here</div><div class="line">     * should not be a performance bottleneck. When ThreadLocals are</div><div class="line">     * generated in different threads at a fast enough rate to regularly</div><div class="line">     * contend on this lock, memory contention is by far a more serious</div><div class="line">     * problem than lock contention.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">nextHashCode</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> h = nextHashCode;</div><div class="line">        nextHashCode = h + HASH_INCREMENT;</div><div class="line">        <span class="keyword">return</span> h;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Creates a thread local variable.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadLocal</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the value in the current thread's copy of this thread-local</div><div class="line">     * variable.  Creates and initializes the copy if this is the first time</div><div class="line">     * the thread has called this method.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span> the current thread's value of this thread-local</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</div><div class="line">        Thread t = Thread.currentThread();</div><div class="line">        ThreadLocalMap map = getMap(t);</div><div class="line">        <span class="keyword">if</span> (map != <span class="keyword">null</span>)</div><div class="line">            <span class="keyword">return</span> (T)map.get(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">        <span class="comment">// Maps are constructed lazily.  if the map for this thread</span></div><div class="line">        <span class="comment">// doesn't exist, create it, with this ThreadLocal and its</span></div><div class="line">        <span class="comment">// initial value as its only entry.</span></div><div class="line">        T value = initialValue();</div><div class="line">        createMap(t, value);</div><div class="line">        <span class="keyword">return</span> value;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Sets the current thread's copy of this thread-local variable</div><div class="line">     * to the specified value.  Many applications will have no need for</div><div class="line">     * this functionality, relying solely on the &#123;<span class="doctag">@link</span> #initialValue&#125;</div><div class="line">     * method to set the values of thread-locals.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> value the value to be stored in the current threads' copy of</div><div class="line">     *        this thread-local.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T value)</span> </span>&#123;</div><div class="line">        Thread t = Thread.currentThread();</div><div class="line">        ThreadLocalMap map = getMap(t);</div><div class="line">        <span class="keyword">if</span> (map != <span class="keyword">null</span>)</div><div class="line">            map.set(<span class="keyword">this</span>, value);</div><div class="line">        <span class="keyword">else</span></div><div class="line">            createMap(t, value);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Get the map associated with a ThreadLocal. Overridden in</div><div class="line">     * InheritableThreadLocal.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span>  t the current thread</div><div class="line">     * <span class="doctag">@return</span> the map</div><div class="line">     */</div><div class="line">    <span class="function">ThreadLocalMap <span class="title">getMap</span><span class="params">(Thread t)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> t.threadLocals;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Create the map associated with a ThreadLocal. Overridden in</div><div class="line">     * InheritableThreadLocal.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> t the current thread</div><div class="line">     * <span class="doctag">@param</span> firstValue value for the initial entry of the map</div><div class="line">     * <span class="doctag">@param</span> map the map to store.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">createMap</span><span class="params">(Thread t, T firstValue)</span> </span>&#123;</div><div class="line">        t.threadLocals = <span class="keyword">new</span> ThreadLocalMap(<span class="keyword">this</span>, firstValue);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    .......</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * ThreadLocalMap is a customized hash map suitable only for</div><div class="line">     * maintaining thread local values. No operations are exported</div><div class="line">     * outside of the ThreadLocal class. The class is package private to</div><div class="line">     * allow declaration of fields in class Thread.  To help deal with</div><div class="line">     * very large and long-lived usages, the hash table entries use</div><div class="line">     * WeakReferences for keys. However, since reference queues are not</div><div class="line">     * used, stale entries are guaranteed to be removed only when</div><div class="line">     * the table starts running out of space.</div><div class="line">     */</div><div class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadLocalMap</span> </span>&#123;</div><div class="line"></div><div class="line">    ........</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°ThreadLocalç±»ä¸­çš„å˜é‡åªæœ‰è¿™3ä¸ªintå‹ï¼š </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> threadLocalHashCode = nextHashCode();</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> nextHashCode = <span class="number">0</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> HASH_INCREMENT = <span class="number">0x61c88647</span>;</div></pre></td></tr></table></figure>
<p>è€Œä½œä¸ºThreadLocalå®ä¾‹çš„å˜é‡åªæœ‰ threadLocalHashCode è¿™ä¸€ä¸ªï¼ŒnextHashCode å’ŒHASH_INCREMENT æ˜¯ThreadLocalç±»çš„é™æ€å˜é‡ï¼Œå®é™…ä¸ŠHASH_INCREMENTæ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œè¡¨ç¤ºäº†è¿ç»­åˆ†é…çš„ä¸¤ä¸ªThreadLocalå®ä¾‹çš„threadLocalHashCodeå€¼çš„å¢é‡ï¼Œè€ŒnextHashCode çš„è¡¨ç¤ºäº†å³å°†åˆ†é…çš„ä¸‹ä¸€ä¸ªThreadLocalå®ä¾‹çš„threadLocalHashCode çš„å€¼ã€‚  </p>
<p>å¯ä»¥æ¥çœ‹ä¸€ä¸‹åˆ›å»ºä¸€ä¸ªThreadLocalå®ä¾‹å³new ThreadLocal()æ—¶åšäº†å“ªäº›æ“ä½œï¼Œä»ä¸Šé¢çœ‹åˆ°æ„é€ å‡½æ•°ThreadLocal()é‡Œä»€ä¹ˆæ“ä½œéƒ½æ²¡æœ‰ï¼Œå”¯ä¸€çš„æ“ä½œæ˜¯è¿™å¥ï¼š </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> threadLocalHashCode = nextHashCode();</div></pre></td></tr></table></figure>
<p>é‚£ä¹ˆnextHashCode()åšäº†ä»€ä¹ˆå‘¢ï¼š </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">nextHashCode</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> h = nextHashCode;</div><div class="line">        nextHashCode = h + HASH_INCREMENT;</div><div class="line">        <span class="keyword">return</span> h;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>å°±æ˜¯å°†ThreadLocalç±»çš„ä¸‹ä¸€ä¸ªhashCodeå€¼å³nextHashCodeçš„å€¼èµ‹ç»™å®ä¾‹çš„threadLocalHashCodeï¼Œç„¶ånextHashCodeçš„å€¼å¢åŠ HASH_INCREMENTè¿™ä¸ªå€¼ã€‚  </p>
<p>å› æ­¤ThreadLocalå®ä¾‹çš„å˜é‡åªæœ‰è¿™ä¸ªthreadLocalHashCodeï¼Œè€Œä¸”æ˜¯finalçš„ï¼Œç”¨æ¥åŒºåˆ†ä¸åŒçš„ThreadLocalå®ä¾‹ï¼ŒThreadLocalç±»ä¸»è¦æ˜¯ä½œä¸ºå·¥å…·ç±»æ¥ä½¿ç”¨ï¼Œé‚£ä¹ˆThreadLocal.set()è¿›å»çš„å¯¹è±¡æ˜¯æ”¾åœ¨å“ªå„¿çš„å‘¢ï¼Ÿ  </p>
<p>çœ‹ä¸€ä¸‹ä¸Šé¢çš„set()æ–¹æ³•ï¼Œä¸¤å¥åˆå¹¶ä¸€ä¸‹æˆä¸º </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ThreadLocalMap map = Thread.currentThread().threadLocals;</div></pre></td></tr></table></figure>
<p>è¿™ä¸ªThreadLocalMap ç±»æ˜¯ThreadLocalä¸­å®šä¹‰çš„å†…éƒ¨ç±»ï¼Œä½†æ˜¯å®ƒçš„å®ä¾‹å´ç”¨åœ¨Threadç±»ä¸­ï¼š </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">    ......</div><div class="line"></div><div class="line">    <span class="comment">/* ThreadLocal values pertaining to this thread. This map is maintained</span></div><div class="line">     * by the ThreadLocal class. */</div><div class="line">    ThreadLocal.ThreadLocalMap threadLocals = <span class="keyword">null</span>;  </div><div class="line">    ......</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å†çœ‹è¿™å¥ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (map != <span class="keyword">null</span>)</div><div class="line">            map.set(<span class="keyword">this</span>, value);</div></pre></td></tr></table></figure></p>
<p>ä¹Ÿå°±æ˜¯å°†è¯¥ThreadLocalå®ä¾‹ä½œä¸ºkeyï¼Œè¦ä¿æŒçš„å¯¹è±¡ä½œä¸ºå€¼ï¼Œè®¾ç½®åˆ°å½“å‰çº¿ç¨‹çš„ThreadLocalMap ä¸­ï¼Œget()æ–¹æ³•åŒæ ·å¤§å®¶çœ‹äº†ä»£ç ä¹Ÿå°±æ˜ç™½äº†ï¼ŒThreadLocalMap ç±»çš„ä»£ç å¤ªå¤šäº†ï¼Œæˆ‘å°±ä¸å¸–äº†ï¼Œè‡ªå·±å»çœ‹æºç å§ã€‚ </p>
<p>è´´ä¸ªä¾‹å­å§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age = <span class="number">0</span>;   <span class="comment">//å¹´é¾„</span></div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.age;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.age = age;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadLocalDemo</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">    <span class="comment">//åˆ›å»ºçº¿ç¨‹å±€éƒ¨å˜é‡studentLocalï¼Œåœ¨åé¢ä½ ä¼šå‘ç°ç”¨æ¥ä¿å­˜Studentå¯¹è±¡</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> ThreadLocal studentLocal = <span class="keyword">new</span> ThreadLocal();</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] agrs)</span> </span>&#123;</div><div class="line">        ThreadLocalDemo td = <span class="keyword">new</span> ThreadLocalDemo();</div><div class="line">        Thread t1 = <span class="keyword">new</span> Thread(td, <span class="string">"a"</span>);</div><div class="line">        Thread t2 = <span class="keyword">new</span> Thread(td, <span class="string">"b"</span>);</div><div class="line">        t1.start();</div><div class="line">        t2.start();</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        accessStudent();</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * ç¤ºä¾‹ä¸šåŠ¡æ–¹æ³•ï¼Œç”¨æ¥æµ‹è¯•</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accessStudent</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">//è·å–å½“å‰çº¿ç¨‹çš„åå­—</span></div><div class="line">        String currentThreadName = Thread.currentThread().getName();</div><div class="line">        System.out.println(currentThreadName + <span class="string">" is running!"</span>);</div><div class="line">        <span class="comment">//äº§ç”Ÿä¸€ä¸ªéšæœºæ•°å¹¶æ‰“å°</span></div><div class="line">        Random random = <span class="keyword">new</span> Random();</div><div class="line">        <span class="keyword">int</span> age = random.nextInt(<span class="number">100</span>);</div><div class="line">        System.out.println(<span class="string">"thread "</span> + currentThreadName + <span class="string">" set age to:"</span> + age);</div><div class="line">        <span class="comment">//è·å–ä¸€ä¸ªStudentå¯¹è±¡ï¼Œå¹¶å°†éšæœºæ•°å¹´é¾„æ’å…¥åˆ°å¯¹è±¡å±æ€§ä¸­</span></div><div class="line">        Student student = getStudent();</div><div class="line">        student.setAge(age);</div><div class="line">        System.out.println(<span class="string">"thread "</span> + currentThreadName + <span class="string">" first read age is:"</span> + student.getAge());</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Thread.sleep(<span class="number">500</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">catch</span> (InterruptedException ex) &#123;</div><div class="line">            ex.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        System.out.println(<span class="string">"thread "</span> + currentThreadName + <span class="string">" second read age is:"</span> + student.getAge());</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">protected</span> Student <span class="title">getStudent</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">//è·å–æœ¬åœ°çº¿ç¨‹å˜é‡å¹¶å¼ºåˆ¶è½¬æ¢ä¸ºStudentç±»å‹</span></div><div class="line">        Student student = (Student) studentLocal.get();</div><div class="line">        <span class="comment">//çº¿ç¨‹é¦–æ¬¡æ‰§è¡Œæ­¤æ–¹æ³•çš„æ—¶å€™ï¼ŒstudentLocal.get()è‚¯å®šä¸ºnull</span></div><div class="line">        <span class="keyword">if</span> (student == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="comment">//åˆ›å»ºä¸€ä¸ªStudentå¯¹è±¡ï¼Œå¹¶ä¿å­˜åˆ°æœ¬åœ°çº¿ç¨‹å˜é‡studentLocalä¸­</span></div><div class="line">            student = <span class="keyword">new</span> Student();</div><div class="line">            studentLocal.set(student);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> student;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç»“æœï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">a is running! </div><div class="line">thread a <span class="built_in">set</span> age to:76 </div><div class="line">b is running! </div><div class="line">thread b <span class="built_in">set</span> age to:27 </div><div class="line">thread a first <span class="built_in">read</span> age is:76 </div><div class="line">thread b first <span class="built_in">read</span> age is:27 </div><div class="line">thread a second <span class="built_in">read</span> age is:76 </div><div class="line">thread b second <span class="built_in">read</span> age is:27</div></pre></td></tr></table></figure></p>
<p>åŸæ–‡åœ°å€ï¼š<a href="http://www.iteye.com/topic/103804" target="_blank" rel="external">http://www.iteye.com/topic/103804</a></p>
]]></content>
      
        <categories>
            
            <category> java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> java </tag>
            
            <tag> threadlocal </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Hello World]]></title>
      <url>/2014/01/01/hello-world/</url>
      <content type="html"><![CDATA[<p>Welcome to my blog, This is my first post.so hello world<br><a id="more"></a></p>
]]></content>
      
        <categories>
            
            <category> life </category>
            
        </categories>
        
        
        <tags>
            
            <tag> hello </tag>
            
            <tag> world </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
