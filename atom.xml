<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>IdiotSky</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://idiotsky.top/"/>
  <updated>2018-07-24T13:46:18.579Z</updated>
  <id>http://idiotsky.top/</id>
  
  <author>
    <name>ejunjsh</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ä¸€ä¸ªå¾ˆå¥½ç†è§£raftçš„åŠ¨ç”»æ¼”ç¤º</title>
    <link href="http://idiotsky.top/2018/07/24/understanding-raft/"/>
    <id>http://idiotsky.top/2018/07/24/understanding-raft/</id>
    <published>2018-07-24T13:23:16.000Z</published>
    <updated>2018-07-24T13:46:18.579Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>å¾ˆå¥½ç†è§£çš„åŠ¨ç”»ï¼Œä¸€çœ‹å°±æ‡‚äº†ğŸ‘¿</p>
</blockquote>
<iframe src="http://idiotsky.top/raft/raft/index.html" style="width:100%;height:700px;border-width: 0px;"><br></iframe>

<a id="more"></a>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;å¾ˆå¥½ç†è§£çš„åŠ¨ç”»ï¼Œä¸€çœ‹å°±æ‡‚äº†ğŸ‘¿&lt;/p&gt;
&lt;/blockquote&gt;
&lt;iframe src=&quot;http://idiotsky.top/raft/raft/index.html&quot; style=&quot;width:100%;height:700px;border-width: 0px;&quot;&gt;&lt;br&gt;&lt;/iframe&gt;
    
    </summary>
    
      <category term="åˆ†å¸ƒå¼" scheme="http://idiotsky.top/categories/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
      <category term="raft" scheme="http://idiotsky.top/tags/raft/"/>
    
  </entry>
  
  <entry>
    <title>Paxosç¤ºä¾‹</title>
    <link href="http://idiotsky.top/2018/07/24/paxos-example/"/>
    <id>http://idiotsky.top/2018/07/24/paxos-example/</id>
    <published>2018-07-24T12:11:55.000Z</published>
    <updated>2018-07-24T13:19:10.365Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™ç¯‡æ–‡ç« é€šè¿‡ä¸€ä¸ªæœ‰æ•ˆçš„ä¾‹å­æè¿°äº†ä¸€ä¸ªåä¸ºPaxos çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ã€‚</p>
<p>åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ç”¨äºä½¿ä¸€ç»„è®¡ç®—æœºèƒ½å¤Ÿå°±å•ä¸ªå€¼è¾¾æˆä¸€è‡´ï¼Œä¾‹å¦‚é€šå¸¸ä½¿ç”¨ä¸¤é˜¶æ®µæˆ–ä¸‰é˜¶æ®µæäº¤åšå‡ºçš„æäº¤æˆ–å›æ»šå†³ç­–ã€‚åªè¦é€‰æ‹©ä¸€ä¸ªå€¼ï¼Œç®—æ³•çš„å…¶ä»–å€¼å°±æ²¡æœ‰å…³ç³»äº†ã€‚</p>
<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè¿™å¾ˆéš¾ï¼Œå› ä¸ºæœºå™¨ä¹‹é—´çš„æ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±æˆ–æ— é™æœŸå»¶è¿Ÿï¼Œæˆ–è€…æœºå™¨æœ¬èº«å¯èƒ½ä¼šå‘ç”Ÿæ•…éšœã€‚</p>
<p>Paxosä¿è¯èŠ‚ç‚¹åªä¼šé€‰æ‹©å•ä¸ªå€¼ï¼ˆæ„å‘³ç€å®ƒä¿è¯å®‰å…¨ï¼‰ï¼Œä½†ä¸ä¿è¯åœ¨å¤§å¤šæ•°èŠ‚ç‚¹ä¸å¯ç”¨æ—¶èƒ½ä¸èƒ½å»åˆ°å€¼</p>
<a id="more"></a>
<h1 id="ä¸€èˆ¬çš„åšæ³•"><a href="#ä¸€èˆ¬çš„åšæ³•" class="headerlink" title="ä¸€èˆ¬çš„åšæ³•"></a>ä¸€èˆ¬çš„åšæ³•</h1><p>ä¸€ä¸ªPaxosçš„èŠ‚ç‚¹å¯ä»¥é‡‡å–ä»»ä½•æˆ–æ‰€æœ‰ä¸‰ä¸ªè§’è‰²ï¼š<code>proposer</code>ï¼Œ<code>acceptor</code>å’Œ<code>learner</code>ã€‚</p>
<p>ä¸€ä¸ª<code>proposer</code>æè®®ä¸€ä¸ªå€¼æ˜¯éœ€è¦åŒæ„æ‰è¡Œçš„ï¼Œå®ƒå‘ä¸€ä¸ªåŒ…å«å€¼çš„æè®®ç»™æ‰€æœ‰çš„<code>acceptor</code>ï¼Œ<code>acceptor</code>å†³å®šæ˜¯å¦åŒæ„è¿™ä¸ªå€¼ã€‚</p>
<p>æ¯ä¸ª<code>acceptor</code>ç‹¬ç«‹é€‰æ‹©ä¸€ä¸ªå€¼â€“å®ƒå¯èƒ½æ”¶åˆ°å¤šä¸ªæ¥è‡ªä¸åŒ<code>proposer</code>çš„æè®®â€“å¹¶å°†å…¶å†³å®šå‘é€ç»™<code>learner</code>ï¼Œä»¥ç¡®å®šæ˜¯å¦å·²æ¥å—ä»»ä½•å€¼ã€‚</p>
<p>å¯¹äºPaxosæ¥å—çš„å€¼ï¼Œå¤§å¤šæ•°<code>acceptor</code>å¿…é¡»é€‰æ‹©ç›¸åŒçš„å€¼ã€‚å®é™…ä¸Šï¼Œå•ä¸ªèŠ‚ç‚¹å¯ä»¥æ‰¿æ‹…è®¸å¤šæˆ–æ‰€æœ‰è¿™äº›è§’è‰²ï¼Œä½†åœ¨æœ¬èŠ‚çš„ç¤ºä¾‹ä¸­ï¼Œæ¯ä¸ªè§’è‰²éƒ½åœ¨ä¸€ä¸ªå•ç‹¬çš„èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><a href="https://angus.nyc/wp-content/uploads/2012/06/0.png" target="_blank" rel="noopener"><img src="https://angus.nyc/wp-content/uploads/2012/06/0.png" alt=""></a></p>
<center>å›¾1ï¼šåŸºæœ¬Paxosæ¶æ„ã€‚ä¸€äº›<code>proposer</code>å‘<code>acceptor</code>æå‡ºå»ºè®®ã€‚å½“<code>acceptor</code>æ¥å—ä¸€ä¸ªå€¼æ—¶ï¼Œå®ƒä¼šå°†ç»“æœå‘é€ç»™<code>learner</code>èŠ‚ç‚¹ã€‚<br></center>

<h1 id="Paxosç¤ºä¾‹"><a href="#Paxosç¤ºä¾‹" class="headerlink" title="Paxosç¤ºä¾‹"></a>Paxosç¤ºä¾‹</h1><p>åœ¨æ ‡å‡†çš„Paxosç®—æ³•ä¸­ï¼Œ<code>proposer</code>å‘<code>acceptor</code>å‘é€ä¸¤ç§ç±»å‹çš„æ¶ˆæ¯ï¼š<strong>å‡†å¤‡</strong>å’Œ<strong>æ¥å—</strong>è¯·æ±‚ã€‚</p>
<p>åœ¨è¯¥ç®—æ³•çš„ç¬¬ä¸€é˜¶æ®µï¼Œ<code>proposer</code>å‘æ¯ä¸ª<code>acceptor</code>å‘é€åŒ…å«å»ºè®®å€¼vå’Œæè®®å·nçš„å‡†å¤‡è¯·æ±‚ã€‚</p>
<p>å¯¹äºå…¶ä»–<code>proposer</code>çš„ææ¡ˆå·ï¼Œæ¯ä¸ª<code>proposer</code>çš„æè®®å·å¿…é¡»æ˜¯æ­£æ•°çš„ï¼Œå•è°ƒé€’å¢çš„ï¼Œå”¯ä¸€çš„ï¼Œè‡ªç„¶çš„æ•°å­—ã€‚</p>
<p>åœ¨ä¸‹é¢è¯´æ˜çš„ç¤ºä¾‹ä¸­ï¼Œæœ‰ä¸¤ä¸ª<code>proposer</code>ï¼Œä¸¤ä¸ªéƒ½æå‡ºå‡†å¤‡è¯·æ±‚ã€‚æ¥è‡ª<code>proposer A</code>çš„è¯·æ±‚å’Œæ¥è‡ª<code>proposer B</code>çš„è¯·æ±‚é¦–å…ˆåˆ°è¾¾<code>acceptor X</code>å’Œ<code>acceptor Y</code>ï¼Œè€Œæ¥è‡ª<code>proposer B</code>çš„è¯·æ±‚é¦–å…ˆåˆ°è¾¾<code>acceptor Z</code>ã€‚</p>
<p><a href="https://angus.nyc/wp-content/uploads/2012/06/2.png" target="_blank" rel="noopener"><img src="https://angus.nyc/wp-content/uploads/2012/06/2.png" alt=""></a></p>
<center>å›¾2ï¼šproposer Aå’ŒBå„è‡ªå‘æ¯ä¸ªæ¥å—è€…å‘é€å‡†å¤‡è¯·æ±‚ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œproposer Açš„è¯·æ±‚é¦–å…ˆåˆ°è¾¾æ¥acceptor Xå’ŒYï¼Œè€Œproposer Bçš„è¯·æ±‚é¦–å…ˆåˆ°è¾¾acceptor Z.</center>

<p>å¦‚æœæ¥æ”¶å‡†å¤‡è¯·æ±‚çš„<code>acceptor</code>æ²¡æœ‰çœ‹åˆ°å¦ä¸€ä¸ªæè®®ï¼Œåˆ™<code>acceptor</code>ä»¥å‡†å¤‡å“åº”ä½œå‡ºå“åº”ï¼Œè¯¥å‡†å¤‡å“åº”æ‰¿è¯ºæ°¸è¿œä¸æ¥å—å…·æœ‰è¾ƒä½æè®®ç¼–å·çš„å¦ä¸€æè®®ã€‚</p>
<p>è¿™åœ¨ä¸‹é¢çš„å›¾3ä¸­è¯´æ˜ï¼Œå…¶æ˜¾ç¤ºäº†æ¯ä¸ªæ¥å—è€…å¯¹ä»–ä»¬æ”¶åˆ°çš„ç¬¬ä¸€ä¸ªå‡†å¤‡è¯·æ±‚çš„å“åº”ã€‚</p>
<p><a href="https://angus.nyc/wp-content/uploads/2012/06/3.png" target="_blank" rel="noopener"><img src="https://angus.nyc/wp-content/uploads/2012/06/3.png" alt=""></a></p>
<center>å›¾3ï¼šæ¯ä¸ª<code>acceptor</code>å“åº”å®ƒæ”¶åˆ°çš„ç¬¬ä¸€ä¸ªå‡†å¤‡è¯·æ±‚æ¶ˆæ¯ã€‚</center>

<p>æœ€ç»ˆï¼Œ<code>acceptor Z</code>æ¥æ”¶<code>proposer A</code>çš„è¯·æ±‚ï¼Œ<code>acceptor X</code>å’Œ<code>acceptor Y</code>æ¥æ”¶<code>proposer B</code>çš„è¯·æ±‚ã€‚</p>
<p>å¦‚æœ<code>acceptor</code>å·²ç»çœ‹åˆ°å…·æœ‰æ›´é«˜æè®®å·çš„è¯·æ±‚ï¼Œåˆ™å¿½ç•¥å‡†å¤‡è¯·æ±‚ï¼Œ<code>proposer A</code>å¯¹<code>acceptor Z</code>çš„è¯·æ±‚å°±æ˜¯è¿™ç§æƒ…å†µã€‚</p>
<p>å¦‚æœ<code>acceptor</code>æ²¡æœ‰çœ‹åˆ°æ›´é«˜ç¼–å·çš„è¯·æ±‚ï¼Œå®ƒå†æ¬¡æ‰¿è¯ºå¿½ç•¥å…·æœ‰è¾ƒä½æè®®ç¼–å·çš„ä»»ä½•è¯·æ±‚ï¼Œå¹¶å‘å›å…¶å·²æ¥å—çš„ç¼–å·æœ€é«˜çš„æè®®ä»¥åŠè¯¥æè®®çš„å€¼ã€‚</p>
<p><code>proposer B</code>å¯¹<code>acceptor X</code>å’Œ<code>acceptor Y</code>çš„è¯·æ±‚å°±æ˜¯è¿™ç§æƒ…å†µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><a href="https://angus.nyc/wp-content/uploads/2012/06/4.png" target="_blank" rel="noopener"><img src="https://angus.nyc/wp-content/uploads/2012/06/4.png" alt=""></a></p>
<center>å›¾4ï¼šacceptor Zå¿½ç•¥äº†proposer Açš„è¯·æ±‚ï¼Œå› ä¸ºå®ƒå·²ç»çœ‹åˆ°äº†æ›´é«˜ç¼–å·çš„æè®®ï¼ˆ4&gt; 2ï¼‰ã€‚acceptor Xå’ŒYç”¨ä»–ä»¬å…ˆå‰ç¡®è®¤çš„æœ€é«˜è¯·æ±‚æ¥å“åº”proposer Bçš„è¯·æ±‚ï¼Œå¹¶æ‰¿è¯ºå¿½ç•¥ä»»ä½•ç¼–å·è¾ƒä½çš„æè®®ã€‚</center>

<p>ä¸€æ—¦<code>proposer</code>æ”¶åˆ°å¤§å¤šæ•°<code>acceptor</code>çš„å‡†å¤‡å“åº”ï¼Œå®ƒå°±å¯ä»¥å‘å‡ºæ¥å—è¯·æ±‚ã€‚</p>
<p>ç”±äº<code>proposer A</code>ä»…æ”¶åˆ°è¡¨æ˜æ²¡æœ‰å…ˆå‰ææ¡ˆ<code>[no previous]</code>çš„å“åº”ï¼Œå› æ­¤å®ƒå‘<code>acceptor</code>å‘é€ä¸åˆå§‹ææ¡ˆç›¸åŒçš„æè®®ç¼–å·å’Œå€¼çš„æ¥å—è¯·æ±‚ï¼ˆn = 2ï¼Œv = 8ï¼‰ã€‚</p>
<p>ç„¶è€Œï¼Œè¿™äº›è¯·æ±‚è¢«æ¯ä¸€ä¸ª<code>acceptor</code>å¿½ç•¥ï¼Œå› ä¸º<code>acceptor</code>éƒ½æ‰¿è¯ºä¸æ¥å—çš„æè®®å·ä½äºè¯·æ±‚4ï¼ˆå“åº”å‡†å¤‡è¯·æ±‚ç»™<code>proposer B</code>ï¼‰ã€‚</p>
<p><code>proposer B</code>å‘æ¯ä¸ª<code>acceptor</code>å‘é€åŒ…å«å…¶å…ˆå‰ä½¿ç”¨çš„æè®®å·ï¼ˆn = 4ï¼‰çš„æ¥å—è¯·æ±‚ï¼Œå¹¶ä¸”è¿™ä¸ªæ¥å—è¯·æ±‚è¿˜åŒ…å«äº†åœ¨å…¶æ”¶åˆ°çš„å‡†å¤‡å“åº”æ¶ˆæ¯ä¸­ä¸æœ€é«˜æè®®å·ç›¸å…³è”çš„å€¼ï¼ˆv = 8ï¼‰ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œè¿™ä¸æ˜¯<code>proposer B</code>æœ€åˆæå‡ºçš„å€¼ï¼Œè€Œæ˜¯å®ƒçœ‹åˆ°çš„å‡†å¤‡å“åº”æ¶ˆæ¯ä¸­çš„æœ€é«˜å€¼ã€‚</p>
<p><a href="https://angus.nyc/wp-content/uploads/2012/06/5.png" target="_blank" rel="noopener"><img src="https://angus.nyc/wp-content/uploads/2012/06/5.png" alt=""></a></p>
<center>å›¾5ï¼Œ<code>proposer B</code>å‘é€ä¸€ä¸ªæ¥å—è¯·æ±‚ç»™æ¯ä¸ª<code>acceptor</code>,è¿™ä¸ªè¯·æ±‚åŒ…å«äº†å®ƒä¹‹å‰çš„æè®®å·(4)å’Œå®ƒä»[n=2,v=8]ä¸­çœ‹åˆ°çš„å€¼ï¼ˆ8ï¼‰</center>

<p>å¦‚æœ<code>acceptor</code>æ”¶åˆ°çš„æ¥å—è¯·æ±‚çš„æè®®å·å¤§äºæˆ–ç­‰äºä¹‹å‰å®ƒä¿è¯çš„ï¼Œé‚£ä¹ˆå®ƒæ¥å—å¹¶å‘æ¯ä¸ª<code>learner</code>èŠ‚ç‚¹å‘é€é€šçŸ¥ã€‚</p>
<p>å½“<code>learner</code>å‘ç°å¤§å¤šæ•°`acceptorå·²æ¥å—æŸä¸ªå€¼æ—¶ï¼ŒPaxosç®—æ³•ä¼šé€‰æ‹©è¿™ä¸ªå€¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><a href="https://angus.nyc/wp-content/uploads/2012/06/6.png" target="_blank" rel="noopener"><img src="https://angus.nyc/wp-content/uploads/2012/06/6.png" alt=""></a></p>
<p>ä¸€æ—¦Paxosé€‰æ‹©äº†ä¸€ä¸ªå€¼ï¼Œä¸å…¶ä»–<code>proposer</code>çš„è¿›ä¸€æ­¥æ²Ÿé€šå°±æ— æ³•æ”¹å˜è¿™ä¸ªå€¼ã€‚</p>
<p>å¦‚æœå¦ä¸€ä¸ª<code>proposer</code>ï¼ˆ<code>proposer C</code>ï¼‰å‘é€çš„æè®®å·æ¯”ä¹‹å‰çœ‹åˆ°çš„æè®®å·æ›´é«˜ï¼Œå¹¶ä¸”å…·æœ‰ä¸åŒçš„å€¼ï¼ˆä¾‹å¦‚ï¼Œn = 6ï¼Œv = 7ï¼‰ï¼Œåˆ™æ¯ä¸ª<code>acceptor</code>éƒ½ä¼šä½¿ç”¨ä¹‹å‰çš„æœ€é«˜æè®®å·è¿›è¡Œå“åº”ï¼ˆn = 4ï¼Œv = 8ï¼‰ã€‚</p>
<p>è¿™è¦æ±‚<code>proposer C</code>å‘é€åŒ…å«[n = 6ï¼Œv = 8] çš„æ¥å—è¯·æ±‚ï¼Œè¯¥è¯·æ±‚ä»…ç¡®è®¤å·²ç»é€‰æ‹©çš„å€¼ã€‚æ­¤å¤–ï¼Œå¦‚æœä¸€äº›å°‘<code>acceptor</code>è¿˜æ²¡æœ‰é€‰æ‹©ä¸€ä¸ªä»·å€¼ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç¡®ä¿ä»–ä»¬æœ€ç»ˆå°±åŒä¸€ä»·å€¼è¾¾æˆå…±è¯†ã€‚</p>
<p>Lamportå’ŒBakerç­‰äººåœ¨è®ºæ–‡ä¸­è®¨è®ºäº†å¯¹æ ‡å‡†Paxosç®—æ³•çš„å„ç§æ•ˆç‡æ”¹è¿›ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ<code>proposer</code>çŸ¥é“å®ƒæ˜¯ç¬¬ä¸€ä¸ªå»ºè®®å€¼çš„è¯ï¼Œåˆ™å‡†å¤‡è¯·æ±‚ä¸å†æ˜¯å¿…é¡»çš„äº†ã€‚</p>
<p>å› ä¸ºè¿™ç§è¯·æ±‚çš„æè®®ç¼–å·ä¸º0ï¼Œå¦‚æœæ”¶åˆ°ä»»ä½•æ›´é«˜ç¼–å·çš„è¯·æ±‚çš„è¯ï¼Œè¿™ç§è¯·æ±‚å°±ä¼šè¢«å¿½ç•¥çš„ã€‚</p>
<p>ç¿»è¯‘ <a href="https://angus.nyc/2012/paxos-by-example/" target="_blank" rel="noopener">https://angus.nyc/2012/paxos-by-example/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™ç¯‡æ–‡ç« é€šè¿‡ä¸€ä¸ªæœ‰æ•ˆçš„ä¾‹å­æè¿°äº†ä¸€ä¸ªåä¸ºPaxos çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ã€‚&lt;/p&gt;
&lt;p&gt;åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ç”¨äºä½¿ä¸€ç»„è®¡ç®—æœºèƒ½å¤Ÿå°±å•ä¸ªå€¼è¾¾æˆä¸€è‡´ï¼Œä¾‹å¦‚é€šå¸¸ä½¿ç”¨ä¸¤é˜¶æ®µæˆ–ä¸‰é˜¶æ®µæäº¤åšå‡ºçš„æäº¤æˆ–å›æ»šå†³ç­–ã€‚åªè¦é€‰æ‹©ä¸€ä¸ªå€¼ï¼Œç®—æ³•çš„å…¶ä»–å€¼å°±æ²¡æœ‰å…³ç³»äº†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè¿™å¾ˆéš¾ï¼Œå› ä¸ºæœºå™¨ä¹‹é—´çš„æ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±æˆ–æ— é™æœŸå»¶è¿Ÿï¼Œæˆ–è€…æœºå™¨æœ¬èº«å¯èƒ½ä¼šå‘ç”Ÿæ•…éšœã€‚&lt;/p&gt;
&lt;p&gt;Paxosä¿è¯èŠ‚ç‚¹åªä¼šé€‰æ‹©å•ä¸ªå€¼ï¼ˆæ„å‘³ç€å®ƒä¿è¯å®‰å…¨ï¼‰ï¼Œä½†ä¸ä¿è¯åœ¨å¤§å¤šæ•°èŠ‚ç‚¹ä¸å¯ç”¨æ—¶èƒ½ä¸èƒ½å»åˆ°å€¼&lt;/p&gt;
    
    </summary>
    
      <category term="åˆ†å¸ƒå¼" scheme="http://idiotsky.top/categories/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
      <category term="Paxos" scheme="http://idiotsky.top/tags/Paxos/"/>
    
  </entry>
  
  <entry>
    <title>kafkaæ€»ç»“</title>
    <link href="http://idiotsky.top/2018/07/22/kafka-summary/"/>
    <id>http://idiotsky.top/2018/07/22/kafka-summary/</id>
    <published>2018-07-22T13:38:51.000Z</published>
    <updated>2018-07-22T07:50:29.168Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>ç©äº†å¾ˆä¹…çš„kafkaï¼Œç°åœ¨æ€»ç»“ä¸‹å§ï¼Œå½“ç„¶é€šè¿‡åˆ«äººçš„æ–‡ç« æ¥æ€»ç»“è¿˜æ˜¯äº‹åŠåŠŸå€çš„ğŸ‘¿</p>
</blockquote>
<h1 id="æ¶æ„å›¾"><a href="#æ¶æ„å›¾" class="headerlink" title="æ¶æ„å›¾"></a>æ¶æ„å›¾</h1><p><a href="http://idiotsky.top/images3/kafka-1.jpg"><img src="http://idiotsky.top/images3/kafka-1.jpg" alt=""></a></p>
<p>å¦‚ä¸Šå›¾ï¼Œä¸€ä¸ªkafkaæ¶æ„åŒ…æ‹¬è‹¥å¹²ä¸ªProducerï¼ˆæœåŠ¡å™¨æ—¥å¿—ã€ä¸šåŠ¡æ•°æ®ã€webå‰ç«¯äº§ç”Ÿçš„page viewç­‰ï¼‰ï¼Œè‹¥å¹²ä¸ªBrokerï¼ˆkafkaæ”¯æŒæ°´å¹³æ‰©å±•ï¼Œä¸€èˆ¬brokeræ•°é‡è¶Šå¤šé›†ç¾¤çš„ååé‡è¶Šå¤§ï¼‰ï¼Œè‹¥å¹²ä¸ªconsumer groupï¼Œä¸€ä¸ªZookeeperé›†ç¾¤ï¼ˆkafkaé€šè¿‡Zookeeperç®¡ç†é›†ç¾¤é…ç½®ã€é€‰ä¸¾leaderã€consumer groupå‘ç”Ÿå˜åŒ–æ—¶è¿›è¡Œrebalanceï¼‰ã€‚</p>
<a id="more"></a>
<h1 id="åç§°è§£é‡Š"><a href="#åç§°è§£é‡Š" class="headerlink" title="åç§°è§£é‡Š"></a>åç§°è§£é‡Š</h1><ul>
<li>Broker: æ¶ˆæ¯ä¸­é—´ä»¶å¤„ç†èŠ‚ç‚¹ï¼ˆæœåŠ¡å™¨ï¼‰ï¼Œä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªbrokerï¼Œä¸€ä¸ªKafkaé›†ç¾¤ç”±ä¸€ä¸ªæˆ–å¤šä¸ªbrokerç»„æˆ</li>
<li>Topic: Kafkaå¯¹æ¶ˆæ¯è¿›è¡Œå½’ç±»ï¼Œå‘é€åˆ°é›†ç¾¤çš„æ¯ä¸€æ¡æ¶ˆæ¯éƒ½è¦æŒ‡å®šä¸€ä¸ªtopic</li>
<li>Partition: ç‰©ç†ä¸Šçš„æ¦‚å¿µï¼Œæ¯ä¸ªtopicåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªpartitionï¼Œä¸€ä¸ªpartitionå¯¹åº”ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹å­˜å‚¨partitionçš„æ•°æ®å’Œç´¢å¼•æ–‡ä»¶ï¼Œæ¯ä¸ªpartitionå†…éƒ¨æ˜¯æœ‰åºçš„</li>
<li>Producer: ç”Ÿäº§è€…ï¼Œè´Ÿè´£å‘å¸ƒæ¶ˆæ¯åˆ°broker</li>
<li>Consumer: æ¶ˆè´¹è€…ï¼Œä»brokerè¯»å–æ¶ˆæ¯</li>
<li>ConsumerGroup: æ¯ä¸ªconsumerå±äºä¸€ä¸ªç‰¹å®šçš„consumer groupï¼Œå¯ä¸ºæ¯ä¸ªconsumeræŒ‡å®šgroup nameï¼Œè‹¥ä¸æŒ‡å®šï¼Œåˆ™å±äºé»˜è®¤çš„groupï¼Œä¸€æ¡æ¶ˆæ¯å¯ä»¥å‘é€åˆ°ä¸åŒçš„consumer groupï¼Œä½†ä¸€ä¸ªconsumer groupä¸­åªèƒ½æœ‰ä¸€ä¸ªconsumerèƒ½æ¶ˆè´¹è¿™æ¡æ¶ˆæ¯</li>
</ul>
<h1 id="å…³ç³»è§£é‡Š"><a href="#å…³ç³»è§£é‡Š" class="headerlink" title="å…³ç³»è§£é‡Š"></a>å…³ç³»è§£é‡Š</h1><h2 id="Topic-amp-Partition"><a href="#Topic-amp-Partition" class="headerlink" title="Topic &amp; Partition"></a>Topic &amp; Partition</h2><p>ä¸€ä¸ªtopicä¸ºä¸€ç±»æ¶ˆæ¯ï¼Œæ¯æ¡æ¶ˆæ¯å¿…é¡»æŒ‡å®šä¸€ä¸ªtopicã€‚ç‰©ç†ä¸Šï¼Œä¸€ä¸ªtopicåˆ†æˆä¸€ä¸ªæˆ–å¤šä¸ªpartitionï¼Œæ¯ä¸ªpartitionæœ‰å¤šä¸ªå‰¯æœ¬åˆ†å¸ƒåœ¨ä¸åŒçš„brokerä¸­ï¼Œå¦‚ä¸‹å›¾ã€‚</p>
<p><a href="http://idiotsky.top/images3/kafka-2.jpg"><img src="http://idiotsky.top/images3/kafka-2.jpg" alt=""></a></p>
<p>æ¯ä¸ªpartitionåœ¨å­˜å‚¨å±‚é¢æ˜¯ä¸€ä¸ªappend logæ–‡ä»¶ï¼Œå‘å¸ƒåˆ°æ­¤partitionçš„æ¶ˆæ¯ä¼šè¿½åŠ åˆ°logæ–‡ä»¶çš„å°¾éƒ¨ï¼Œä¸ºé¡ºåºå†™äººç£ç›˜ï¼ˆé¡ºåºå†™ç£ç›˜æ¯”éšæœºå†™å†…å­˜çš„æ•ˆç‡è¿˜è¦é«˜ï¼‰ã€‚æ¯æ¡æ¶ˆæ¯åœ¨logæ–‡ä»¶ä¸­çš„ä½ç½®æˆä¸ºoffsetï¼ˆåç§»é‡ï¼‰ï¼Œoffsetä¸ºä¸€ä¸ªlongå‹æ•°å­—ï¼Œå”¯ä¸€æ ‡è®°ä¸€æ¡æ¶ˆæ¯ã€‚å¦‚ä¸‹å›¾</p>
<p><a href="http://idiotsky.top/images3/kafka-3.png"><img src="http://idiotsky.top/images3/kafka-3.png" alt=""></a></p>
<p>æ¯ä¸ªæ¶ˆè´¹è€…å”¯ä¸€ä¿å­˜çš„å…ƒæ•°æ®æ˜¯offsetå€¼ï¼Œè¿™ä¸ªä½ç½®å®Œå…¨ä¸ºæ¶ˆè´¹è€…æ§åˆ¶ï¼Œå› æ­¤æ¶ˆè´¹è€…å¯ä»¥é‡‡ç”¨ä»»ä½•é¡ºåºæ¥æ¶ˆè´¹è®°å½•ï¼Œå¦‚ä¸‹å›¾</p>
<p><a href="http://idiotsky.top/images3/kafka-4.png"><img src="http://idiotsky.top/images3/kafka-4.png" alt=""></a></p>
<p>kafkaä¸­åªèƒ½ä¿è¯partitionä¸­è®°å½•æ˜¯æœ‰åºçš„ï¼Œè€Œä¸ä¿è¯topicä¸­ä¸åŒpartitionçš„é¡ºåº</p>
<h2 id="Consumer-group-amp-consumer"><a href="#Consumer-group-amp-consumer" class="headerlink" title="Consumer group &amp; consumer"></a>Consumer group &amp; consumer</h2><p>ä¸€ä¸ªæ¶ˆè´¹ç»„ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆè´¹è€…å®ä¾‹ç»„æˆï¼Œä¾¿äºæ‰©å®¹ä¸å®¹é”™ã€‚</p>
<p>kafkaæ˜¯å‘å¸ƒä¸è®¢é˜…æ¨¡å¼ï¼Œè¿™ä¸ªè®¢é˜…è€…æ˜¯æ¶ˆè´¹ç»„ï¼Œè€Œä¸æ˜¯æ¶ˆè´¹è€…å®ä¾‹ã€‚æ¯ä¸€æ¡æ¶ˆæ¯åªä¼šè¢«åŒä¸€ä¸ªæ¶ˆè´¹ç»„é‡Œçš„ä¸€ä¸ªæ¶ˆè´¹è€…å®ä¾‹æ¶ˆè´¹ï¼Œä¸åŒçš„æ¶ˆè´¹ç»„å¯ä»¥åŒæ—¶æ¶ˆè´¹åŒä¸€æ¡æ¶ˆæ¯ï¼Œå¦‚ä¸‹å›¾</p>
<p><a href="http://idiotsky.top/images3/kafka-5.png"><img src="http://idiotsky.top/images3/kafka-5.png" alt=""></a></p>
<p>ä¸ºäº†å®ç°ä¼ ç»Ÿçš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¶ˆæ¯åªè¢«æ¶ˆè´¹ä¸€æ¬¡çš„è¯­ä¹‰ï¼Œkafkaä¿è¯åŒä¸€ä¸ªæ¶ˆè´¹ç»„é‡Œåªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ä¼šæ¶ˆè´¹ä¸€æ¡æ¶ˆæ¯ï¼Œkafkaè¿˜å…è®¸ä¸åŒçš„æ¶ˆè´¹ç»„åŒæ—¶æ¶ˆè´¹ä¸€æ¡æ¶ˆæ¯ï¼Œè¿™ä¸€ç‰¹æ€§å¯ä»¥ä¸ºæ¶ˆæ¯çš„å¤šå…ƒåŒ–å¤„ç†æä¾›äº†æ”¯æŒï¼Œkafkaçš„è®¾è®¡ç†å¿µä¹‹ä¸€å°±æ˜¯åŒæ—¶æä¾›ç¦»çº¿å¤„ç†å’Œå®æ—¶å¤„ç†ï¼Œå› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨Stormè¿™ç§å®æ—¶æµå¤„ç†ç³»ç»Ÿå¯¹æ¶ˆæ¯è¿›è¡Œå®æ—¶åœ¨çº¿å¤„ç†ï¼ŒåŒæ—¶ä½¿ç”¨Hadoopè¿™ç§æ‰¹å¤„ç†ç³»ç»Ÿè¿›è¡Œç¦»çº¿å¤„ç†ï¼Œè¿˜å¯ä»¥åŒæ—¶å°†æ•°æ®å®æ—¶å¤‡ä»½åˆ°å¦ä¸€ä¸ªæ•°æ®ä¸­å¿ƒï¼Œåªéœ€è¦ä¿è¯è¿™ä¸‰ä¸ªæ“ä½œçš„æ¶ˆè´¹è€…å®ä¾‹åœ¨ä¸åŒconsumer group å³å¯</p>
<h2 id="Consumer-Rebalance"><a href="#Consumer-Rebalance" class="headerlink" title="Consumer Rebalance"></a>Consumer Rebalance</h2><p>kafkaä¿è¯äº†åŒä¸€ä¸ªæ¶ˆè´¹ç»„ä¸­åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…å®ä¾‹ä¼šæ¶ˆè´¹æŸæ¡æ¶ˆæ¯ï¼Œå®é™…ä¸Šï¼Œkafkaä¿è¯çš„æ˜¯ç¨³å®šçŠ¶æ€ä¸‹æ¯ä¸€ä¸ªæ¶ˆè´¹è€…å®ä¾‹åªä¼šæ¶ˆè´¹ä¸€ä¸ªæˆ–å¤šä¸ªç‰¹å®špartitionæ•°æ®ï¼Œè€ŒæŸä¸ªpartitionçš„æ•°æ®åªä¼šè¢«æŸä¸€ç‰¹å®šçš„consumerå®ä¾‹æ¶ˆè´¹ï¼Œè¿™æ ·è®¾è®¡çš„åŠ£åŠ¿æ˜¯æ— æ³•è®©åŒä¸€ä¸ªæ¶ˆè´¹ç»„é‡Œçš„consumerå‡åŒ€æ¶ˆè´¹ï¼Œä¼˜åŠ¿æ˜¯æ¯ä¸ªconsumerä¸ç”¨è·Ÿå¤§é‡çš„brokeré€šä¿¡ï¼Œå‡å°‘é€šä¿¡å¼€é”€ï¼Œä¹Ÿé™ä½äº†åˆ†é…éš¾åº¦ã€‚è€Œä¸”ï¼ŒåŒä¸€ä¸ªpartitionæ•°æ®æ˜¯æœ‰åºçš„ï¼Œä¿è¯äº†æœ‰åºè¢«æ¶ˆè´¹ã€‚æ ¹æ®consumer groupä¸­çš„consumeræ•°é‡å’Œpartitionæ•°é‡ï¼Œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹3ç§æƒ…å†µï¼š</p>
<ul>
<li>è‹¥consumer groupä¸­çš„consumeræ•°é‡å°‘äºpartitionæ•°é‡ï¼Œåˆ™è‡³å°‘æœ‰1ä¸ªconsumerä¼šæ¶ˆè´¹å¤šä¸ªpartitionæ•°æ®</li>
<li>è‹¥consumer groupä¸­çš„consumeræ•°é‡å¤šäºpartitionæ•°é‡ï¼Œåˆ™ä¼šæœ‰éƒ¨åˆ†consumeræ— æ³•æ¶ˆè´¹è¯¥topicä¸­ä»»ä½•ä¸€æ¡æ¶ˆæ¯</li>
<li>è‹¥consumer groupä¸­çš„consumeræ•°é‡ç­‰äºpartitionæ•°é‡ï¼Œåˆ™æ­£å¥½ä¸€ä¸ªconsumeræ¶ˆè´¹ä¸€ä¸ªpartitionæ•°æ®</li>
</ul>
<h1 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h1><p>ä»¥ä¸€ä¸ªå®ä¾‹ç»“æŸè¿™ç¯‡æ–‡ç« </p>
<p>åˆ›å»ºä¸€ä¸ª<code>kafka-topic</code>,å®ƒæœ‰4ä¸ªåˆ†ç‰‡ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics.sh --create --zookeeper zk:2181 --replication-factor 1 --partitions 4 --topic kafka-topic</span><br></pre></td></tr></table></figure>
<p>ç¼–å†™ä¸€ä¸ª<a href="https://github.com/ejunjsh/java-code/blob/master/src/main/java/com/sky/code/kafka/CustomPartitionProducer.java" target="_blank" rel="noopener">ç”Ÿäº§è€…</a></p>
<p>è¾“å‡º<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Sun Jul 22 07:17:11 UTC 2018,kafka.apache.org,192.168.14.203</span><br><span class="line">publish to partition 2</span><br><span class="line">offset  0</span><br><span class="line">Sun Jul 22 07:17:14 UTC 2018,kafka.apache.org,192.168.14.134</span><br><span class="line">publish to partition 0</span><br><span class="line">offset  0</span><br><span class="line">Sun Jul 22 07:17:16 UTC 2018,kafka.apache.org,192.168.14.150</span><br><span class="line">publish to partition 0</span><br><span class="line">offset  1</span><br><span class="line">Sun Jul 22 07:17:18 UTC 2018,kafka.apache.org,192.168.14.49</span><br><span class="line">publish to partition 2</span><br><span class="line">offset  1</span><br><span class="line">Sun Jul 22 07:17:20 UTC 2018,kafka.apache.org,192.168.14.55</span><br><span class="line">publish to partition 2</span><br><span class="line">offset  2</span><br><span class="line">Sun Jul 22 07:17:22 UTC 2018,kafka.apache.org,192.168.14.172</span><br><span class="line">publish to partition 2</span><br><span class="line">offset  3</span><br><span class="line">Sun Jul 22 07:17:24 UTC 2018,kafka.apache.org,192.168.14.122</span><br><span class="line">publish to partition 1</span><br><span class="line">offset  0</span><br><span class="line">Sun Jul 22 07:17:26 UTC 2018,kafka.apache.org,192.168.14.237</span><br><span class="line">publish to partition 3</span><br><span class="line">offset  0</span><br><span class="line">Sun Jul 22 07:17:28 UTC 2018,kafka.apache.org,192.168.14.95</span><br><span class="line">publish to partition 2</span><br><span class="line">offset  4</span><br></pre></td></tr></table></figure></p>
<p>åŸºæœ¬éƒ½å‡åŒ€å†™åˆ°ä¸åŒçš„åˆ†ç‰‡ä¸Š</p>
<p>æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ª<a href="https://github.com/ejunjsh/java-code/blob/master/src/main/java/com/sky/code/kafka/CustomPartitionConsumer.java" target="_blank" rel="noopener">æ¶ˆè´¹è€…</a>ï¼Œå®ƒå¯åŠ¨ä¸‰ä¸ªçº¿ç¨‹ä»£è¡¨ä¸‰ä¸ªæ¶ˆè´¹è€…å»æ¶ˆè´¹</p>
<p>è¾“å‡º</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">0: &#123;partition=1, offset=20, value=Sun Jul 22 07:20:12 UTC 2018,kafka.apache.org,192.168.14.141&#125;</span><br><span class="line">0: &#123;partition=0, offset=20, value=Sun Jul 22 07:20:14 UTC 2018,kafka.apache.org,192.168.14.113&#125;</span><br><span class="line">2: &#123;partition=3, offset=24, value=Sun Jul 22 07:20:16 UTC 2018,kafka.apache.org,192.168.14.173&#125;</span><br><span class="line">0: &#123;partition=0, offset=21, value=Sun Jul 22 07:20:18 UTC 2018,kafka.apache.org,192.168.14.38&#125;</span><br><span class="line">2: &#123;partition=3, offset=25, value=Sun Jul 22 07:20:20 UTC 2018,kafka.apache.org,192.168.14.222&#125;</span><br><span class="line">1: &#123;partition=2, offset=26, value=Sun Jul 22 07:20:22 UTC 2018,kafka.apache.org,192.168.14.19&#125;</span><br><span class="line">2: &#123;partition=3, offset=26, value=Sun Jul 22 07:20:24 UTC 2018,kafka.apache.org,192.168.14.227&#125;</span><br><span class="line">0: &#123;partition=1, offset=21, value=Sun Jul 22 07:20:26 UTC 2018,kafka.apache.org,192.168.14.72&#125;</span><br><span class="line">0: &#123;partition=1, offset=22, value=Sun Jul 22 07:20:28 UTC 2018,kafka.apache.org,192.168.14.68&#125;</span><br><span class="line">1: &#123;partition=2, offset=27, value=Sun Jul 22 07:20:31 UTC 2018,kafka.apache.org,192.168.14.172&#125;</span><br><span class="line">2: &#123;partition=3, offset=27, value=Sun Jul 22 07:20:33 UTC 2018,kafka.apache.org,192.168.14.45&#125;</span><br><span class="line">0: &#123;partition=1, offset=23, value=Sun Jul 22 07:20:35 UTC 2018,kafka.apache.org,192.168.14.87&#125;</span><br><span class="line">2: &#123;partition=3, offset=28, value=Sun Jul 22 07:20:37 UTC 2018,kafka.apache.org,192.168.14.160&#125;</span><br><span class="line">2: &#123;partition=3, offset=29, value=Sun Jul 22 07:20:39 UTC 2018,kafka.apache.org,192.168.14.54&#125;</span><br></pre></td></tr></table></figure>
<p>æ¯ä¸€è¡Œå¼€å¤´çš„åºå·ä»£è¡¨çš„æ˜¯æ¶ˆè´¹è€…çš„åºå·ï¼Œå¾ˆæ˜æ˜¾0å·æ¶ˆè´¹è€…æ¶ˆè´¹äº†0å’Œ1åˆ†ç‰‡ï¼Œ1å·æ¶ˆè´¹è€…æ¶ˆè´¹2å·åˆ†ç‰‡ï¼Œ2å·æ¶ˆè´¹è€…æ¶ˆè´¹3å·åˆ†ç‰‡</p>
<p>æ¥ä¸‹æ¥è¯•ä¸‹åŠ å¤§æ¶ˆè´¹è€…ç­‰äºåˆ†ç‰‡æ•°å³4ä¸ªæ¶ˆè´¹è€…çœ‹çœ‹</p>
<p>è¾“å‡º<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0: &#123;partition=0, offset=66, value=Sun Jul 22 07:27:06 UTC 2018,kafka.apache.org,192.168.14.99&#125;</span><br><span class="line">3: &#123;partition=3, offset=90, value=Sun Jul 22 07:27:08 UTC 2018,kafka.apache.org,192.168.14.222&#125;</span><br><span class="line">0: &#123;partition=0, offset=67, value=Sun Jul 22 07:27:10 UTC 2018,kafka.apache.org,192.168.14.106&#125;</span><br><span class="line">2: &#123;partition=2, offset=70, value=Sun Jul 22 07:27:12 UTC 2018,kafka.apache.org,192.168.14.175&#125;</span><br><span class="line">0: &#123;partition=0, offset=68, value=Sun Jul 22 07:27:14 UTC 2018,kafka.apache.org,192.168.14.163&#125;</span><br><span class="line">1: &#123;partition=1, offset=70, value=Sun Jul 22 07:27:16 UTC 2018,kafka.apache.org,192.168.14.176&#125;</span><br><span class="line">3: &#123;partition=3, offset=91, value=Sun Jul 22 07:27:18 UTC 2018,kafka.apache.org,192.168.14.228&#125;</span><br><span class="line">2: &#123;partition=2, offset=71, value=Sun Jul 22 07:27:20 UTC 2018,kafka.apache.org,192.168.14.55&#125;</span><br><span class="line">1: &#123;partition=1, offset=71, value=Sun Jul 22 07:27:22 UTC 2018,kafka.apache.org,192.168.14.40&#125;</span><br><span class="line">1: &#123;partition=1, offset=72, value=Sun Jul 22 07:27:24 UTC 2018,kafka.apache.org,192.168.14.135&#125;</span><br><span class="line">0: &#123;partition=0, offset=69, value=Sun Jul 22 07:27:26 UTC 2018,kafka.apache.org,192.168.14.249&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¾ˆæ˜æ˜¾ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…è·Ÿæ¯ä¸ªåˆ†ç‰‡æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚</p>
<p>å†çœ‹çœ‹æ¶ˆè´¹è€…å¤šä½™åˆ†ç‰‡çš„æƒ…å†µ,è¿™æ¬¡æŠŠæ¶ˆè´¹è€…åŠ å¤§åˆ°6ä¸ª</p>
<p>è¾“å‡º</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">2: &#123;partition=2, offset=90, value=Sun Jul 22 07:29:44 UTC 2018,kafka.apache.org,192.168.14.148&#125;</span><br><span class="line">0: &#123;partition=0, offset=87, value=Sun Jul 22 07:29:46 UTC 2018,kafka.apache.org,192.168.14.18&#125;</span><br><span class="line">1: &#123;partition=1, offset=86, value=Sun Jul 22 07:29:48 UTC 2018,kafka.apache.org,192.168.14.77&#125;</span><br><span class="line">0: &#123;partition=0, offset=88, value=Sun Jul 22 07:29:50 UTC 2018,kafka.apache.org,192.168.14.21&#125;</span><br><span class="line">2: &#123;partition=2, offset=91, value=Sun Jul 22 07:29:52 UTC 2018,kafka.apache.org,192.168.14.116&#125;</span><br><span class="line">2: &#123;partition=2, offset=92, value=Sun Jul 22 07:29:54 UTC 2018,kafka.apache.org,192.168.14.92&#125;</span><br><span class="line">0: &#123;partition=0, offset=89, value=Sun Jul 22 07:29:56 UTC 2018,kafka.apache.org,192.168.14.241&#125;</span><br><span class="line">1: &#123;partition=1, offset=87, value=Sun Jul 22 07:29:58 UTC 2018,kafka.apache.org,192.168.14.207&#125;</span><br><span class="line">3: &#123;partition=3, offset=112, value=Sun Jul 22 07:30:00 UTC 2018,kafka.apache.org,192.168.14.100&#125;</span><br><span class="line">1: &#123;partition=1, offset=88, value=Sun Jul 22 07:30:02 UTC 2018,kafka.apache.org,192.168.14.77&#125;</span><br><span class="line">1: &#123;partition=1, offset=89, value=Sun Jul 22 07:30:04 UTC 2018,kafka.apache.org,192.168.14.141&#125;</span><br><span class="line">3: &#123;partition=3, offset=113, value=Sun Jul 22 07:30:06 UTC 2018,kafka.apache.org,192.168.14.36&#125;</span><br><span class="line">2: &#123;partition=2, offset=93, value=Sun Jul 22 07:30:08 UTC 2018,kafka.apache.org,192.168.14.216&#125;</span><br><span class="line">3: &#123;partition=3, offset=114, value=Sun Jul 22 07:30:10 UTC 2018,kafka.apache.org,192.168.14.205&#125;</span><br><span class="line">2: &#123;partition=2, offset=94, value=Sun Jul 22 07:30:12 UTC 2018,kafka.apache.org,192.168.14.238&#125;</span><br><span class="line">3: &#123;partition=3, offset=115, value=Sun Jul 22 07:30:14 UTC 2018,kafka.apache.org,192.168.14.118&#125;</span><br><span class="line">2: &#123;partition=2, offset=95, value=Sun Jul 22 07:30:16 UTC 2018,kafka.apache.org,192.168.14.97&#125;</span><br><span class="line">0: &#123;partition=0, offset=90, value=Sun Jul 22 07:30:18 UTC 2018,kafka.apache.org,192.168.14.169&#125;</span><br><span class="line">2: &#123;partition=2, offset=96, value=Sun Jul 22 07:30:20 UTC 2018,kafka.apache.org,192.168.14.226&#125;</span><br><span class="line">3: &#123;partition=3, offset=116, value=Sun Jul 22 07:30:22 UTC 2018,kafka.apache.org,192.168.14.34&#125;</span><br><span class="line">3: &#123;partition=3, offset=117, value=Sun Jul 22 07:30:24 UTC 2018,kafka.apache.org,192.168.14.184&#125;</span><br><span class="line">1: &#123;partition=1, offset=90, value=Sun Jul 22 07:30:26 UTC 2018,kafka.apache.org,192.168.14.207&#125;</span><br><span class="line">2: &#123;partition=2, offset=97, value=Sun Jul 22 07:30:28 UTC 2018,kafka.apache.org,192.168.14.121&#125;</span><br></pre></td></tr></table></figure>
<p>æ˜¾ç„¶ï¼Œåªæ˜¯çœ‹åˆ°å››ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹å››ä¸ªåˆ†ç‰‡ï¼Œå…¶ä½™æ¶ˆè´¹è€…æ²¡æœ‰å‚ä¸åˆ°æ¶ˆè´¹ä¸­å»ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>kafkaæ˜¯ä¸€ä¸ªé«˜å¯ç”¨é«˜ååçš„åˆ†å¸ƒå¼æ¶ˆæ¯ç»„ä»¶ï¼Œå¤šåˆ†ç‰‡å¯ä»¥æä¾›å¤šæ¶ˆè´¹è€…å¤šäº§ç”Ÿè€…çš„ååï¼Œå¤šä¸ªåˆ†ç»„å¯ä»¥æ»¡è¶³å¤šä¸ªåº”ç”¨å¯¹åŒä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—çš„ä½¿ç”¨è¦æ±‚è€Œäº’ä¸å¹²æ‰°ï¼ŒåŒä¸€åˆ†ç»„æ¶ˆè´¹è€…è¿˜èƒ½åŸºæœ¬ä¿è¯æ¶ˆæ¯åªæ¶ˆè´¹ä¸€æ¬¡ã€‚</p>
<p>å‚è€ƒ <a href="https://zhuanlan.zhihu.com/p/38269875" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/38269875</a></p>
<p>ä½¿ç”¨çš„å®ä¾‹å¯åˆ°è¿™ä¸ª<a href="https://github.com/ejunjsh/java-code" target="_blank" rel="noopener">é“¾æ¥</a>è·å–ï¼Œè¿˜æä¾›<code>docker</code>è¿è¡Œç¯å¢ƒå“¦ </p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ç©äº†å¾ˆä¹…çš„kafkaï¼Œç°åœ¨æ€»ç»“ä¸‹å§ï¼Œå½“ç„¶é€šè¿‡åˆ«äººçš„æ–‡ç« æ¥æ€»ç»“è¿˜æ˜¯äº‹åŠåŠŸå€çš„ğŸ‘¿&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;æ¶æ„å›¾&quot;&gt;&lt;a href=&quot;#æ¶æ„å›¾&quot; class=&quot;headerlink&quot; title=&quot;æ¶æ„å›¾&quot;&gt;&lt;/a&gt;æ¶æ„å›¾&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;http://idiotsky.top/images3/kafka-1.jpg&quot;&gt;&lt;img src=&quot;http://idiotsky.top/images3/kafka-1.jpg&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¦‚ä¸Šå›¾ï¼Œä¸€ä¸ªkafkaæ¶æ„åŒ…æ‹¬è‹¥å¹²ä¸ªProducerï¼ˆæœåŠ¡å™¨æ—¥å¿—ã€ä¸šåŠ¡æ•°æ®ã€webå‰ç«¯äº§ç”Ÿçš„page viewç­‰ï¼‰ï¼Œè‹¥å¹²ä¸ªBrokerï¼ˆkafkaæ”¯æŒæ°´å¹³æ‰©å±•ï¼Œä¸€èˆ¬brokeræ•°é‡è¶Šå¤šé›†ç¾¤çš„ååé‡è¶Šå¤§ï¼‰ï¼Œè‹¥å¹²ä¸ªconsumer groupï¼Œä¸€ä¸ªZookeeperé›†ç¾¤ï¼ˆkafkaé€šè¿‡Zookeeperç®¡ç†é›†ç¾¤é…ç½®ã€é€‰ä¸¾leaderã€consumer groupå‘ç”Ÿå˜åŒ–æ—¶è¿›è¡Œrebalanceï¼‰ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="java" scheme="http://idiotsky.top/categories/java/"/>
    
    
      <category term="java" scheme="http://idiotsky.top/tags/java/"/>
    
      <category term="kafka" scheme="http://idiotsky.top/tags/kafka/"/>
    
  </entry>
  
  <entry>
    <title>ç”¨javapçœ‹ä¸€ä¸‹finalæ˜¯ä»€ä¹ˆ</title>
    <link href="http://idiotsky.top/2018/07/17/java-javap-final/"/>
    <id>http://idiotsky.top/2018/07/17/java-javap-final/</id>
    <published>2018-07-17T14:23:29.000Z</published>
    <updated>2018-07-22T05:12:32.952Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>ä¸€ç›´å¾ˆå¥½å¥‡<code>final</code>çš„ç±»å­—æ®µåœ¨classæ–‡ä»¶æ˜¯æ€ä¹ˆè¡¨ç¤ºçš„ï¼Œæ‰€ä»¥ç”¨javapçœ‹çœ‹æ€ä¹ˆå›äº‹,ä¹Ÿé¡ºä¾¿å¤ä¹ ä¸‹å­—èŠ‚ç æŒ‡ä»¤ğŸ‘¿</p>
</blockquote>
<h1 id="æ²¡æœ‰finalä¿®é¥°çš„ç±»çš„é™æ€å­—æ®µ"><a href="#æ²¡æœ‰finalä¿®é¥°çš„ç±»çš„é™æ€å­—æ®µ" class="headerlink" title="æ²¡æœ‰finalä¿®é¥°çš„ç±»çš„é™æ€å­—æ®µ"></a>æ²¡æœ‰<code>final</code>ä¿®é¥°çš„ç±»çš„é™æ€å­—æ®µ</h1><p>å®šä¹‰ä¸€ä¸ªç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> String str=<span class="string">"ä¸¥"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        System.out.println(str);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>ç¼–è¯‘æŸ¥çœ‹classæ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">javac test.java</span><br><span class="line">javap -verbose test.class</span><br><span class="line"></span><br><span class="line">//çœç•¥å¸¸é‡æ± </span><br><span class="line">&#123;</span><br><span class="line">  public static java.lang.String str;</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line"></span><br><span class="line">  public test();</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=1, locals=1, args_size=1</span><br><span class="line">         0: aload_0</span><br><span class="line">         1: invokespecial #1                  // Method java/lang/Object."&lt;init&gt;":()V</span><br><span class="line">         4: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 1: 0</span><br><span class="line"></span><br><span class="line">  public static void main(java.lang.String[]);</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=1, args_size=1</span><br><span class="line">         0: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">         3: getstatic     #3                  // Field str:Ljava/lang/String;</span><br><span class="line">         6: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">         9: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 5: 0</span><br><span class="line">        line 6: 9</span><br><span class="line"></span><br><span class="line">  static &#123;&#125;;</span><br><span class="line">    flags: ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=1, locals=0, args_size=0</span><br><span class="line">         0: ldc           #5                  // String ä¸¥</span><br><span class="line">         2: putstatic     #3                  // Field str:Ljava/lang/String;</span><br><span class="line">         5: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 2: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ ä¼šå‘ç°<code>public static String str=&quot;ä¸¥&quot;;</code>ç›´æ¥ç¿»è¯‘æˆä¸€ä¸ªé™æ€å—</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">static &#123;&#125;;</span><br><span class="line">  flags: ACC_STATIC</span><br><span class="line">  Code:</span><br><span class="line">    stack=1, locals=0, args_size=0</span><br><span class="line">       0: ldc           #5                  // String ä¸¥</span><br><span class="line">       2: putstatic     #3                  // Field str:Ljava/lang/String;</span><br><span class="line">       5: return</span><br><span class="line">    LineNumberTable:</span><br><span class="line">      line 2: 0</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢<code>ldc</code>çš„æŒ‡ä»¤å°±æ˜¯æŠŠå¸¸é‡ä»å¸¸é‡æ± è¯»åˆ°æ“ä½œæ•°æ ˆï¼Œ<code>putstatic</code>æŒ‡ä»¤ä»æ ˆé¡¶èµ‹å€¼ç»™ç±»çš„é™æ€å­—æ®µ<code>str</code>,è¿™ä¸ªå­—æ®µä¹‹ååœ¨<code>main</code>å‡½æ•°ä¼šè¯»å‡ºæ¥ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public static void main(java.lang.String[]);</span><br><span class="line">  flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">  Code:</span><br><span class="line">    stack=2, locals=1, args_size=1</span><br><span class="line">       0: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">       3: getstatic     #3                  // Field str:Ljava/lang/String;</span><br><span class="line">       6: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">       9: return</span><br><span class="line">    LineNumberTable:</span><br><span class="line">      line 5: 0</span><br><span class="line">      line 6: 9</span><br></pre></td></tr></table></figure>
<p><code>getstatic</code>æ˜¯ç”¨æ¥è¯»å–ç±»çš„é™æ€å­—æ®µçš„ï¼Œè¿™é‡Œè¯»å‡ºæ¥æ”¾å…¥æ“ä½œæ•°æ ˆã€‚</p>
<h1 id="æœ‰finalä¿®é¥°çš„ç±»é™æ€å­—æ®µ"><a href="#æœ‰finalä¿®é¥°çš„ç±»é™æ€å­—æ®µ" class="headerlink" title="æœ‰finalä¿®é¥°çš„ç±»é™æ€å­—æ®µ"></a>æœ‰<code>final</code>ä¿®é¥°çš„ç±»é™æ€å­—æ®µ</h1><p>æ”¹ä¸€ä¸‹è¿™ä¸ªç±»ï¼ŒåŠ <code>final</code>ä¿®é¥°ä¸‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String str=<span class="string">"ä¸¥"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        System.out.println(str);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘æŸ¥çœ‹classæ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">javac test.java</span><br><span class="line">javap -verbose test.class</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> çœç•¥å¸¸é‡æ± </span></span><br><span class="line">&#123;</span><br><span class="line">  public static final java.lang.String str;</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC, ACC_FINAL</span><br><span class="line">    ConstantValue: String ä¸¥</span><br><span class="line"></span><br><span class="line">  public test();</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=1, locals=1, args_size=1</span><br><span class="line">         0: aload_0</span><br><span class="line">         1: invokespecial #1                  // Method java/lang/Object."&lt;init&gt;":()V</span><br><span class="line">         4: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 1: 0</span><br><span class="line"></span><br><span class="line">  public static void main(java.lang.String[]);</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=1, args_size=1</span><br><span class="line">         0: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">         3: ldc           #3                  // String ä¸¥</span><br><span class="line">         5: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">         8: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 5: 0</span><br><span class="line">        line 6: 8</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ ä¼šå‘ç°classæ–‡ä»¶æ²¡æœ‰ä¹‹å‰çš„é™æ€å—äº†ï¼Œè€Œä¸”ä¹Ÿä¸å†ç”¨<code>getstatic</code>æŒ‡ä»¤è·å–å­—æ®µçš„å€¼ï¼Œè€Œæ˜¯ç›´æ¥<code>ldc</code>æŒ‡ä»¤å–å¸¸é‡æ± çš„å€¼ã€‚</p>
<p>æ¥ä¸‹æ¥çœ‹çœ‹å®ä¾‹å­—æ®µåœ¨åŠ <code>final</code>æˆ–ä¸åŠ ä¼šä¸ä¼šæœ‰ä»€ä¹ˆä¸åŒå‘¢</p>
<h1 id="ä¸åŠ finalçš„å®ä¾‹å­—æ®µ"><a href="#ä¸åŠ finalçš„å®ä¾‹å­—æ®µ" class="headerlink" title="ä¸åŠ finalçš„å®ä¾‹å­—æ®µ"></a>ä¸åŠ finalçš„å®ä¾‹å­—æ®µ</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span>  String str=<span class="string">"ä¸¥"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        test t=<span class="keyword">new</span> test();</span><br><span class="line">        System.out.println(t.str);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç±»æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">//çœç•¥æ²¡ç”¨çš„äº†ã€‚ã€‚ã€‚</span><br><span class="line">&#123;</span><br><span class="line">  public java.lang.String str;</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line"></span><br><span class="line">  public test();</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=1, args_size=1</span><br><span class="line">         0: aload_0</span><br><span class="line">         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">         4: aload_0</span><br><span class="line">         5: ldc           #2                  // String ä¸¥</span><br><span class="line">         7: putfield      #3                  // Field str:Ljava/lang/String;</span><br><span class="line">        10: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 1: 0</span><br><span class="line">        line 2: 4</span><br><span class="line"></span><br><span class="line">  public static void main(java.lang.String[]);</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=2, args_size=1</span><br><span class="line">         0: new           #4                  // class test</span><br><span class="line">         3: dup</span><br><span class="line">         4: invokespecial #5                  // Method &quot;&lt;init&gt;&quot;:()V</span><br><span class="line">         7: astore_1</span><br><span class="line">         8: getstatic     #6                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">        11: aload_1</span><br><span class="line">        12: getfield      #3                  // Field str:Ljava/lang/String;</span><br><span class="line">        15: invokevirtual #7                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">        18: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 5: 0</span><br><span class="line">        line 6: 8</span><br><span class="line">        line 7: 18</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ„é€ å‡½æ•°é‡Œé¢ç”¨<code>ldc</code>åˆå§‹åŒ–äº†å®ä¾‹å­—æ®µ<code>str</code>çš„å€¼,ç„¶ååœ¨mainå‡½æ•°é‡Œé¢ç”¨<code>getfield</code>æŒ‡ä»¤ï¼Œè·å–<code>t</code>å®ä¾‹çš„<code>str</code>çš„å€¼ã€‚</p>
<h1 id="åŠ finalçš„å®ä¾‹å­—æ®µ"><a href="#åŠ finalçš„å®ä¾‹å­—æ®µ" class="headerlink" title="åŠ finalçš„å®ä¾‹å­—æ®µ"></a>åŠ <code>final</code>çš„å®ä¾‹å­—æ®µ</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">final</span> String str=<span class="string">"ä¸¥"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        test t=<span class="keyword">new</span> test();</span><br><span class="line">        System.out.println(t.str);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç±»æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">//çœç•¥æ²¡ç”¨çš„äº†ã€‚ã€‚ã€‚</span><br><span class="line">&#123;</span><br><span class="line">  public final java.lang.String str;</span><br><span class="line">    flags: ACC_PUBLIC, ACC_FINAL</span><br><span class="line">    ConstantValue: String ä¸¥</span><br><span class="line"></span><br><span class="line">  public test();</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=1, args_size=1</span><br><span class="line">         0: aload_0</span><br><span class="line">         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">         4: aload_0</span><br><span class="line">         5: ldc           #2                  // String ä¸¥</span><br><span class="line">         7: putfield      #3                  // Field str:Ljava/lang/String;</span><br><span class="line">        10: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 1: 0</span><br><span class="line">        line 2: 4</span><br><span class="line"></span><br><span class="line">  public static void main(java.lang.String[]);</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=2, args_size=1</span><br><span class="line">         0: new           #4                  // class test</span><br><span class="line">         3: dup</span><br><span class="line">         4: invokespecial #5                  // Method &quot;&lt;init&gt;&quot;:()V</span><br><span class="line">         7: astore_1</span><br><span class="line">         8: getstatic     #6                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">        11: aload_1</span><br><span class="line">        12: invokevirtual #7                  // Method java/lang/Object.getClass:()Ljava/lang/Class;</span><br><span class="line">        15: pop</span><br><span class="line">        16: ldc           #2                  // String ä¸¥</span><br><span class="line">        18: invokevirtual #8                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">        21: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 5: 0</span><br><span class="line">        line 6: 8</span><br><span class="line">        line 7: 21</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>getfield</code>æŒ‡ä»¤å˜æˆäº†ç†Ÿæ‚‰çš„<code>ldc</code>,å¾ˆæ˜æ˜¾äº†ï¼ŒåŠ äº†<code>final</code>ä¹‹åå°±å»å¸¸é‡æ± å»æ‰¾ï¼Œå°±ä¸éœ€è¦ç”¨<code>getfield</code>æŒ‡ä»¤ã€‚</p>
<p>ä¸Šé¢çš„å­—æ®µæ˜¯å­—ç¬¦ä¸²ï¼Œé‚£æ¥ä¸‹æ¥çœ‹çœ‹æ•°å­—çš„å­—æ®µä¼šæ€ä¹ˆæ ·å‘¢</p>
<h1 id="æ•°å­—çš„éfinalé™æ€å­—æ®µ"><a href="#æ•°å­—çš„éfinalé™æ€å­—æ®µ" class="headerlink" title="æ•°å­—çš„éfinalé™æ€å­—æ®µ"></a>æ•°å­—çš„é<code>final</code>é™æ€å­—æ®µ</h1><p>ä¸Šä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> i=<span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        System.out.println(i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>javapç»“æœ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">//çœç•¥å¸¸é‡æ± </span><br><span class="line">&#123;</span><br><span class="line">  public static int i;</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line"></span><br><span class="line">  public test();</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=1, locals=1, args_size=1</span><br><span class="line">         0: aload_0</span><br><span class="line">         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">         4: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 1: 0</span><br><span class="line"></span><br><span class="line">  public static void main(java.lang.String[]);</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=1, args_size=1</span><br><span class="line">         0: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">         3: getstatic     #3                  // Field i:I</span><br><span class="line">         6: invokevirtual #4                  // Method java/io/PrintStream.println:(I)V</span><br><span class="line">         9: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 6: 0</span><br><span class="line">        line 7: 9</span><br><span class="line"></span><br><span class="line">  static &#123;&#125;;</span><br><span class="line">    flags: ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=1, locals=0, args_size=0</span><br><span class="line">         0: bipush        100</span><br><span class="line">         2: putstatic     #3                  // Field i:I</span><br><span class="line">         5: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 3: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŸºæœ¬å·®ä¸å¤šï¼Œåªæ˜¯<code>ldc</code>æ¢æˆäº†<code>bipush</code>ã€‚<code>bipush</code>å°±æ˜¯æŠŠåé¢çš„æ“ä½œæ•°ï¼ˆ100ï¼‰å‹å…¥æ ˆã€‚å¦‚æœå‹å…¥çš„ä¸æ˜¯100ï¼Œè€Œæ˜¯æ›´å¤§æˆ–æ›´å°ï¼Œé‚£ä¹ˆç”¨çš„æŒ‡ä»¤å°±ä¼šä¸åŒçš„äº†ï¼Œä¾‹å¦‚<code>iconst_1</code>æŒ‡ä»¤ï¼Œå°±æ˜¯å‹å…¥1åˆ°æ ˆã€‚è‡³äºmainå‡½æ•°é‡Œé¢ï¼Œè¿˜æ˜¯ç”¨<code>getstatic</code>æŒ‡ä»¤è·å–å­—æ®µçš„å€¼ã€‚</p>
<h1 id="æ•°å­—çš„finalé™æ€å­—æ®µ"><a href="#æ•°å­—çš„finalé™æ€å­—æ®µ" class="headerlink" title="æ•°å­—çš„finalé™æ€å­—æ®µ"></a>æ•°å­—çš„<code>final</code>é™æ€å­—æ®µ</h1><p>ä¸Šä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> i=<span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        System.out.println(i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>javapç»“æœ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  public static final int i;</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC, ACC_FINAL</span><br><span class="line">    ConstantValue: int 100</span><br><span class="line"></span><br><span class="line">  public test();</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=1, locals=1, args_size=1</span><br><span class="line">         0: aload_0</span><br><span class="line">         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">         4: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 1: 0</span><br><span class="line"></span><br><span class="line">  public static void main(java.lang.String[]);</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=1, args_size=1</span><br><span class="line">         0: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">         3: bipush        100</span><br><span class="line">         5: invokevirtual #3                  // Method java/io/PrintStream.println:(I)V</span><br><span class="line">         8: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 6: 0</span><br><span class="line">        line 7: 8</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ²¡å•¥æƒŠå–œçš„ï¼Œå°±æ˜¯é™æ€å—å»æ‰ï¼Œéœ€è¦è·å–å­—æ®µçš„å€¼çš„åœ°æ–¹ä»<code>getstatic</code>å˜æˆäº†<code>bipush</code>ã€‚</p>
<p>è‡³äºå®ä¾‹å­—æ®µæ˜¯æ€ä¹ˆæ ·çš„ï¼Œåº”è¯¥éƒ½å·®ä¸å¤šäº†ï¼Œå°±ä¸åˆ—ä¸¾äº†ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹å­—æ®µç±»å‹æ˜¯å¼•ç”¨çš„æ˜¯æ€ä¹ˆæ ·å‘¢ã€‚</p>
<h1 id="åŠ finalçš„å¼•ç”¨ç±»å‹å­—æ®µ"><a href="#åŠ finalçš„å¼•ç”¨ç±»å‹å­—æ®µ" class="headerlink" title="åŠ finalçš„å¼•ç”¨ç±»å‹å­—æ®µ"></a>åŠ <code>final</code>çš„å¼•ç”¨ç±»å‹å­—æ®µ</h1><p>ä¸Šä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Object o=<span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        System.out.println(o);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>javapç»“æœ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  public static final java.lang.Object o;</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC, ACC_FINAL</span><br><span class="line"></span><br><span class="line">  public test();</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=1, locals=1, args_size=1</span><br><span class="line">         0: aload_0</span><br><span class="line">         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">         4: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 1: 0</span><br><span class="line"></span><br><span class="line">  public static void main(java.lang.String[]);</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=1, args_size=1</span><br><span class="line">         0: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">         3: getstatic     #3                  // Field o:Ljava/lang/Object;</span><br><span class="line">         6: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/Object;)V</span><br><span class="line">         9: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 6: 0</span><br><span class="line">        line 7: 9</span><br><span class="line"></span><br><span class="line">  static &#123;&#125;;</span><br><span class="line">    flags: ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=0, args_size=0</span><br><span class="line">         0: new           #5                  // class java/lang/Object</span><br><span class="line">         3: dup</span><br><span class="line">         4: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">         7: putstatic     #3                  // Field o:Ljava/lang/Object;</span><br><span class="line">        10: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 3: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œç›´æ¥ä¸Š<code>final</code>çš„ç‰ˆæœ¬ï¼Œæ˜¯å› ä¸ºåŠ ä¸åŠ <code>final</code>ï¼Œå…¶å®éƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯æœ‰é™æ€å—ï¼Œå¼•ç”¨çš„æ—¶å€™ä¸å†æœ‰ä»€ä¹ˆå…¶ä»–æŒ‡ä»¤äº†ï¼Œè€è€å®å®çš„ç”¨<code>getstatic</code>ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å¯¹äºå­—ç¬¦ä¸²æˆ–è€…æ•°å­—ç±»å‹ï¼Œä»–ä»¬éƒ½æ˜¯å±äºå­—é¢é‡ï¼Œç¼–è¯‘æ—¶å·²ç»çŸ¥é“ï¼Œä»–ä»¬è¦ä¹ˆå­˜åœ¨å¸¸é‡æ± é‡Œé¢ï¼Œè¦ä¹ˆå­˜åœ¨æŒ‡ä»¤çš„æ“ä½œæ•°é‡Œé¢ï¼Œæ‰€ä»¥åŠ <code>final</code>æ ‡è¯†çš„æƒ…å†µä¸‹ï¼Œè·å–å€¼æ—¶ä¸ç”¨å†åˆ°å…³è”çš„å¯¹è±¡åº•ä¸‹å»è·å–äº†ï¼Œå› ä¸º<code>final</code>å°±æ˜¯ä¸å˜ï¼Œç›´æ¥è°ƒç”¨ç›¸å…³æŒ‡ä»¤å»å¸¸é‡æ± ï¼Œæˆ–è€…ç›´æ¥æ“ä½œæ•°å–å°±å¥½ã€‚</p>
<p>å¯¹äºå¼•ç”¨ç±»å‹ï¼Œè¿™ä¸ªåŸºæœ¬è¦åˆ°è¿è¡Œæ—¶æ‰èƒ½ç¡®è®¤ä»–ä»¬çš„å¼•ç”¨åœ°å€ï¼Œæ‰€ä»¥åŠ ä¸åŠ <code>final</code>éƒ½æ˜¯ä¸€æ ·ã€‚</p>
<p>çœ‹æ¥å­—èŠ‚ç æ‰æ˜¯æœ€èƒ½ç¡®å®šjavaæ˜¯æ€ä¹ˆè¿è¡Œçš„ï¼Œæ‰€ä»¥ä¸å…¶æ‰¾ç½‘ä¸Šçš„è¯´æ³•ä¸å¦‚<code>javap</code>ä¸€ä¸‹çœ‹çœ‹ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä¸€ç›´å¾ˆå¥½å¥‡&lt;code&gt;final&lt;/code&gt;çš„ç±»å­—æ®µåœ¨classæ–‡ä»¶æ˜¯æ€ä¹ˆè¡¨ç¤ºçš„ï¼Œæ‰€ä»¥ç”¨javapçœ‹çœ‹æ€ä¹ˆå›äº‹,ä¹Ÿé¡ºä¾¿å¤ä¹ ä¸‹å­—èŠ‚ç æŒ‡ä»¤ğŸ‘¿&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;æ²¡æœ‰finalä¿®é¥°çš„ç±»çš„é™æ€å­—æ®µ&quot;&gt;&lt;a href=&quot;#æ²¡æœ‰finalä¿®é¥°çš„ç±»çš„é™æ€å­—æ®µ&quot; class=&quot;headerlink&quot; title=&quot;æ²¡æœ‰finalä¿®é¥°çš„ç±»çš„é™æ€å­—æ®µ&quot;&gt;&lt;/a&gt;æ²¡æœ‰&lt;code&gt;final&lt;/code&gt;ä¿®é¥°çš„ç±»çš„é™æ€å­—æ®µ&lt;/h1&gt;&lt;p&gt;å®šä¹‰ä¸€ä¸ªç±»&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;test&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; String str=&lt;span class=&quot;string&quot;&gt;&quot;ä¸¥&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String[] args)&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        System.out.println(str);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="java" scheme="http://idiotsky.top/categories/java/"/>
    
    
      <category term="java" scheme="http://idiotsky.top/tags/java/"/>
    
      <category term="javap" scheme="http://idiotsky.top/tags/javap/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼äº‹åŠ¡æ¦‚è¿°</title>
    <link href="http://idiotsky.top/2018/06/27/distributed-transaction/"/>
    <id>http://idiotsky.top/2018/06/27/distributed-transaction/</id>
    <published>2018-06-27T12:53:24.000Z</published>
    <updated>2018-07-24T13:16:27.191Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>ğŸ‘¿markä¹‹</p>
</blockquote>
<p>åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯ä¼ä¸šé›†æˆä¸­çš„ä¸€ä¸ªæŠ€æœ¯éš¾ç‚¹ï¼Œä¹Ÿæ˜¯æ¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„ä¸­éƒ½ä¼šæ¶‰åŠåˆ°çš„ä¸€ä¸ªä¸œè¥¿ï¼Œç‰¹åˆ«æ˜¯åœ¨è¿™å‡ å¹´è¶Šæ¥è¶Šç«çš„å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå‡ ä¹å¯ä»¥è¯´æ˜¯æ— æ³•é¿å…ï¼Œæœ¬æ–‡å°±å›´ç»•åˆ†å¸ƒå¼äº‹åŠ¡å„æ–¹é¢ä¸å¤§å®¶è¿›è¡Œä»‹ç»ã€‚</p>
<h1 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h1><h2 id="ä»€ä¹ˆæ˜¯äº‹åŠ¡"><a href="#ä»€ä¹ˆæ˜¯äº‹åŠ¡" class="headerlink" title="ä»€ä¹ˆæ˜¯äº‹åŠ¡"></a>ä»€ä¹ˆæ˜¯äº‹åŠ¡</h2><p>æ•°æ®åº“äº‹åŠ¡ï¼ˆç®€ç§°ï¼šäº‹åŠ¡ï¼ŒTransactionï¼‰æ˜¯æŒ‡æ•°æ®åº“æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸€ä¸ªé€»è¾‘å•ä½ï¼Œç”±ä¸€ä¸ªæœ‰é™çš„æ•°æ®åº“æ“ä½œåºåˆ—æ„æˆã€‚</p>
<p>äº‹åŠ¡æ‹¥æœ‰ä»¥ä¸‹å››ä¸ªç‰¹æ€§ï¼Œä¹ æƒ¯ä¸Šè¢«ç§°ä¸ºACIDç‰¹æ€§ï¼š</p>
<ol>
<li>åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡ä½œä¸ºä¸€ä¸ªæ•´ä½“è¢«æ‰§è¡Œï¼ŒåŒ…å«åœ¨å…¶ä¸­çš„å¯¹æ•°æ®åº“çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨è¢«æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚</li>
<li>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡åº”ç¡®ä¿æ•°æ®åº“çš„çŠ¶æ€ä»ä¸€ä¸ªä¸€è‡´çŠ¶æ€è½¬å˜ä¸ºå¦ä¸€ä¸ªä¸€è‡´çŠ¶æ€ã€‚ä¸€è‡´çŠ¶æ€æ˜¯æŒ‡æ•°æ®åº“ä¸­çš„æ•°æ®åº”æ»¡è¶³å®Œæ•´æ€§çº¦æŸã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸€è‡´æ€§è¿˜æœ‰å¦å¤–ä¸€å±‚è¯­ä¹‰ï¼Œå°±æ˜¯äº‹åŠ¡çš„ä¸­é—´çŠ¶æ€ä¸èƒ½è¢«è§‚å¯Ÿåˆ°ï¼ˆè¿™å±‚è¯­ä¹‰ä¹Ÿæœ‰è¯´åº”è¯¥å±äºåŸå­æ€§ï¼‰ã€‚</li>
<li>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šå¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ï¼Œä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸åº”å½±å“å…¶ä»–äº‹åŠ¡çš„æ‰§è¡Œï¼Œå¦‚åŒåªæœ‰è¿™ä¸€ä¸ªæ“ä½œåœ¨è¢«æ•°æ®åº“æ‰€æ‰§è¡Œä¸€æ ·ã€‚</li>
<li>æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šå·²è¢«æäº¤çš„äº‹åŠ¡å¯¹æ•°æ®åº“çš„ä¿®æ”¹åº”è¯¥æ°¸ä¹…ä¿å­˜åœ¨æ•°æ®åº“ä¸­ã€‚åœ¨äº‹åŠ¡ç»“æŸæ—¶ï¼Œæ­¤æ“ä½œå°†ä¸å¯é€†è½¬ã€‚</li>
</ol>
<a id="more"></a>
<h2 id="æœ¬åœ°äº‹åŠ¡"><a href="#æœ¬åœ°äº‹åŠ¡" class="headerlink" title="æœ¬åœ°äº‹åŠ¡"></a>æœ¬åœ°äº‹åŠ¡</h2><p>èµ·åˆï¼Œäº‹åŠ¡ä»…é™äºå¯¹å•ä¸€æ•°æ®åº“èµ„æºçš„è®¿é—®æ§åˆ¶ï¼š</p>
<p><a href="http://idiotsky.top/images3/dt-1.jpg"><img src="http://idiotsky.top/images3/dt-1.jpg" alt=""></a></p>
<p>æ¶æ„æœåŠ¡åŒ–ä»¥åï¼Œäº‹åŠ¡çš„æ¦‚å¿µå»¶ä¼¸åˆ°äº†æœåŠ¡ä¸­ã€‚å€˜è‹¥å°†ä¸€ä¸ªå•ä¸€çš„æœåŠ¡æ“ä½œä½œä¸ºä¸€ä¸ªäº‹åŠ¡ï¼Œé‚£ä¹ˆæ•´ä¸ªæœåŠ¡æ“ä½œåªèƒ½æ¶‰åŠä¸€ä¸ªå•ä¸€çš„æ•°æ®åº“èµ„æºï¼š</p>
<p><a href="http://idiotsky.top/images3/dt-2.jpg"><img src="http://idiotsky.top/images3/dt-2.jpg" alt=""></a></p>
<p>è¿™ç±»åŸºäºå•ä¸ªæœåŠ¡å•ä¸€æ•°æ®åº“èµ„æºè®¿é—®çš„äº‹åŠ¡ï¼Œè¢«ç§°ä¸ºæœ¬åœ°äº‹åŠ¡ï¼ˆLocal Transactionï¼‰ã€‚</p>
<h1 id="åˆ†å¸ƒå¼äº‹åŠ¡åº”ç”¨æ¶æ„"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡åº”ç”¨æ¶æ„" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡åº”ç”¨æ¶æ„"></a>åˆ†å¸ƒå¼äº‹åŠ¡åº”ç”¨æ¶æ„</h1><p>æœ¬åœ°äº‹åŠ¡ä¸»è¦é™åˆ¶åœ¨å•ä¸ªä¼šè¯å†…ï¼Œä¸æ¶‰åŠå¤šä¸ªæ•°æ®åº“èµ„æºã€‚ä½†æ˜¯åœ¨åŸºäºSOAï¼ˆService-Oriented Architectureï¼Œé¢å‘æœåŠ¡æ¶æ„ï¼‰çš„åˆ†å¸ƒå¼åº”ç”¨ç¯å¢ƒä¸‹ï¼Œè¶Šæ¥è¶Šå¤šçš„åº”ç”¨è¦æ±‚å¯¹å¤šä¸ªæ•°æ®åº“èµ„æºï¼Œå¤šä¸ªæœåŠ¡çš„è®¿é—®éƒ½èƒ½çº³å…¥åˆ°åŒä¸€ä¸ªäº‹åŠ¡å½“ä¸­ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡åº”è¿è€Œç”Ÿã€‚</p>
<p>æœ€æ—©çš„åˆ†å¸ƒå¼äº‹åŠ¡åº”ç”¨æ¶æ„å¾ˆç®€å•ï¼Œä¸æ¶‰åŠæœåŠ¡é—´çš„è®¿é—®è°ƒç”¨ï¼Œä»…ä»…æ˜¯æœåŠ¡å†…æ“ä½œæ¶‰åŠåˆ°å¯¹å¤šä¸ªæ•°æ®åº“èµ„æºçš„è®¿é—®ã€‚</p>
<p><a href="http://idiotsky.top/images3/dt-3.jpg"><img src="http://idiotsky.top/images3/dt-3.jpg" alt=""></a></p>
<p>å½“ä¸€ä¸ªæœåŠ¡æ“ä½œè®¿é—®ä¸åŒçš„æ•°æ®åº“èµ„æºï¼Œåˆå¸Œæœ›å¯¹å®ƒä»¬çš„è®¿é—®å…·æœ‰äº‹åŠ¡ç‰¹æ€§æ—¶ï¼Œå°±éœ€è¦é‡‡ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æ¥åè°ƒæ‰€æœ‰çš„äº‹åŠ¡å‚ä¸è€…ã€‚</p>
<p>å¯¹äºä¸Šé¢ä»‹ç»çš„åˆ†å¸ƒå¼äº‹åŠ¡åº”ç”¨æ¶æ„ï¼Œå°½ç®¡ä¸€ä¸ªæœåŠ¡æ“ä½œä¼šè®¿é—®å¤šä¸ªæ•°æ®åº“èµ„æºï¼Œä½†æ˜¯æ¯•ç«Ÿæ•´ä¸ªäº‹åŠ¡è¿˜æ˜¯æ§åˆ¶åœ¨å•ä¸€æœåŠ¡çš„å†…éƒ¨ã€‚å¦‚æœä¸€ä¸ªæœåŠ¡æ“ä½œéœ€è¦è°ƒç”¨å¦å¤–ä¸€ä¸ªæœåŠ¡ï¼Œè¿™æ—¶çš„äº‹åŠ¡å°±éœ€è¦è·¨è¶Šå¤šä¸ªæœåŠ¡äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œèµ·å§‹äºæŸä¸ªæœåŠ¡çš„äº‹åŠ¡åœ¨è°ƒç”¨å¦å¤–ä¸€ä¸ªæœåŠ¡çš„æ—¶å€™ï¼Œéœ€è¦ä»¥æŸç§æœºåˆ¶æµè½¬åˆ°å¦å¤–ä¸€ä¸ªæœåŠ¡ï¼Œä»è€Œä½¿è¢«è°ƒç”¨çš„æœåŠ¡è®¿é—®çš„èµ„æºä¹Ÿè‡ªåŠ¨åŠ å…¥åˆ°è¯¥äº‹åŠ¡å½“ä¸­æ¥ã€‚ä¸‹å›¾åæ˜ äº†è¿™æ ·ä¸€ä¸ªè·¨è¶Šå¤šä¸ªæœåŠ¡çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼š</p>
<p><a href="http://idiotsky.top/images3/dt-4.jpg"><img src="http://idiotsky.top/images3/dt-4.jpg" alt=""></a></p>
<p>å¦‚æœå°†ä¸Šé¢è¿™ä¸¤ç§åœºæ™¯ï¼ˆä¸€ä¸ªæœåŠ¡å¯ä»¥è°ƒç”¨å¤šä¸ªæ•°æ®åº“èµ„æºï¼Œä¹Ÿå¯ä»¥è°ƒç”¨å…¶ä»–æœåŠ¡ï¼‰ç»“åˆåœ¨ä¸€èµ·ï¼Œå¯¹æ­¤è¿›è¡Œå»¶ä¼¸ï¼Œæ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„å‚ä¸è€…å°†ä¼šç»„æˆå¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ ‘å½¢æ‹“æ‰‘ç»“æ„ã€‚åœ¨ä¸€ä¸ªè·¨æœåŠ¡çš„åˆ†å¸ƒå¼äº‹åŠ¡ä¸­ï¼Œäº‹åŠ¡çš„å‘èµ·è€…å’Œæäº¤å‡ç³»åŒä¸€ä¸ªï¼Œå®ƒå¯ä»¥æ˜¯æ•´ä¸ªè°ƒç”¨çš„å®¢æˆ·ç«¯ï¼Œä¹Ÿå¯ä»¥æ˜¯å®¢æˆ·ç«¯æœ€å…ˆè°ƒç”¨çš„é‚£ä¸ªæœåŠ¡ã€‚</p>
<p><a href="http://idiotsky.top/images3/dt-5.jpg"><img src="http://idiotsky.top/images3/dt-5.jpg" alt=""></a></p>
<p>è¾ƒä¹‹åŸºäºå•ä¸€æ•°æ®åº“èµ„æºè®¿é—®çš„æœ¬åœ°äº‹åŠ¡ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡çš„åº”ç”¨æ¶æ„æ›´ä¸ºå¤æ‚ã€‚åœ¨ä¸åŒçš„åˆ†å¸ƒå¼åº”ç”¨æ¶æ„ä¸‹ï¼Œå®ç°ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡è¦è€ƒè™‘çš„é—®é¢˜å¹¶ä¸å®Œå…¨ä¸€æ ·ï¼Œæ¯”å¦‚å¯¹å¤šèµ„æºçš„åè°ƒã€äº‹åŠ¡çš„è·¨æœåŠ¡ä¼ æ’­ç­‰ï¼Œå®ç°æœºåˆ¶ä¹Ÿæ˜¯å¤æ‚å¤šå˜ã€‚å°½ç®¡æœ‰è¿™ä¹ˆå¤šå·¥ç¨‹ç»†èŠ‚éœ€è¦è€ƒè™‘ï¼Œä½†åˆ†å¸ƒå¼äº‹åŠ¡æœ€æ ¸å¿ƒçš„è¿˜æ˜¯å…¶ ACID ç‰¹æ€§ã€‚å› æ­¤ï¼Œæƒ³è¦äº†è§£ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå°±å…ˆä»äº†è§£å®ƒæ˜¯æ€ä¹ˆå®ç°äº‹åŠ¡ ACID ç‰¹æ€§å¼€å§‹ã€‚</p>
<p>ä¸‹æ–‡å°†ä»ä¸¤ä¸ªæœ€å¸¸è§çš„åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹å…¥æ‰‹ï¼Œç€é‡åˆ†æåˆ†å¸ƒå¼äº‹åŠ¡çš„åŸºç¡€å…±é€šç‚¹ï¼Œå³å¦‚ä½•ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡çš„ ACID ç‰¹æ€§ã€‚</p>
<h1 id="å¸¸è§åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹-ACID-å®ç°åˆ†æ"><a href="#å¸¸è§åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹-ACID-å®ç°åˆ†æ" class="headerlink" title="å¸¸è§åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹ ACID å®ç°åˆ†æ"></a>å¸¸è§åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹ ACID å®ç°åˆ†æ</h1><h2 id="X-Open-XA-åè®®"><a href="#X-Open-XA-åè®®" class="headerlink" title="X/Open XA åè®®"></a>X/Open XA åè®®</h2><p>æœ€æ—©çš„åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹æ˜¯ X/Open å›½é™…è”ç›Ÿæå‡ºçš„ X/Open Distributed Transaction Processingï¼ˆDTPï¼‰æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯å¤§å®¶å¸¸è¯´çš„ X/Open XA åè®®ï¼Œç®€ç§°XA åè®®ã€‚</p>
<p><a href="http://idiotsky.top/images3/dt-6.jpg"><img src="http://idiotsky.top/images3/dt-6.jpg" alt=""></a></p>
<p>DTP æ¨¡å‹ä¸­åŒ…å«ä¸€ä¸ªå…¨å±€äº‹åŠ¡ç®¡ç†å™¨ï¼ˆTMï¼ŒTransaction Managerï¼‰å’Œå¤šä¸ªèµ„æºç®¡ç†å™¨ï¼ˆRMï¼ŒResource Managerï¼‰ã€‚å…¨å±€äº‹åŠ¡ç®¡ç†å™¨è´Ÿè´£ç®¡ç†å…¨å±€äº‹åŠ¡çŠ¶æ€ä¸å‚ä¸çš„èµ„æºï¼ŒååŒèµ„æºä¸€èµ·æäº¤æˆ–å›æ»šï¼›èµ„æºç®¡ç†å™¨åˆ™è´Ÿè´£å…·ä½“çš„èµ„æºæ“ä½œã€‚</p>
<p>XA åè®®æè¿°äº† TM ä¸ RM ä¹‹é—´çš„æ¥å£ï¼Œå…è®¸å¤šä¸ªèµ„æºåœ¨åŒä¸€åˆ†å¸ƒå¼äº‹åŠ¡ä¸­è®¿é—®ã€‚</p>
<p>åŸºäº DTP æ¨¡å‹çš„åˆ†å¸ƒå¼äº‹åŠ¡æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p>
<p><a href="http://idiotsky.top/images3/dt-7.jpg"><img src="http://idiotsky.top/images3/dt-7.jpg" alt=""></a></p>
<ol>
<li>åº”ç”¨ç¨‹åºï¼ˆAPï¼ŒApplicationï¼‰å‘ TM ç”³è¯·å¼€å§‹ä¸€ä¸ªå…¨å±€äº‹åŠ¡ã€‚</li>
<li>é’ˆå¯¹è¦æ“ä½œçš„ RMï¼ŒAP ä¼šå…ˆå‘ TM æ³¨å†Œï¼ˆTM è´Ÿè´£è®°å½• AP æ“ä½œè¿‡å“ªäº› RMï¼Œå³åˆ†æ”¯äº‹åŠ¡ï¼‰ï¼ŒTM é€šè¿‡ XA æ¥å£å‡½æ•°é€šçŸ¥ç›¸åº” RM å¼€å¯åˆ†å¸ƒå¼äº‹åŠ¡çš„å­äº‹åŠ¡ï¼Œæ¥ç€ AP å°±å¯ä»¥å¯¹è¯¥ RM ç®¡ç†çš„èµ„æºè¿›è¡Œæ“ä½œã€‚</li>
<li>å½“ AP å¯¹æ‰€æœ‰ RM æ“ä½œå®Œæ¯•åï¼ŒAP æ ¹æ®æ‰§è¡Œæƒ…å†µé€šçŸ¥ TM æäº¤æˆ–å›æ»šè¯¥å…¨å±€äº‹åŠ¡ï¼ŒTM é€šè¿‡ XA æ¥å£å‡½æ•°é€šçŸ¥å„ RM å®Œæˆæ“ä½œã€‚TM ä¼šå…ˆè¦æ±‚å„ä¸ª RM åšé¢„æäº¤ï¼Œæ‰€æœ‰ RM è¿”å›æˆåŠŸåï¼Œå†è¦æ±‚å„ RM åšæ­£å¼æäº¤ï¼ŒXA åè®®è¦æ±‚ï¼Œä¸€æ—¦ RM é¢„æäº¤æˆåŠŸï¼Œåˆ™åç»­çš„æ­£å¼æäº¤ä¹Ÿå¿…é¡»èƒ½æˆåŠŸï¼›å¦‚æœä»»æ„ä¸€ä¸ª RM é¢„æäº¤å¤±è´¥ï¼Œåˆ™ TM é€šçŸ¥å„ RM å›æ»šã€‚</li>
<li>æ‰€æœ‰ RM æäº¤æˆ–å›æ»šå®Œæˆåï¼Œå…¨å±€äº‹åŠ¡ç»“æŸã€‚</li>
</ol>
<h3 id="åŸå­æ€§"><a href="#åŸå­æ€§" class="headerlink" title="åŸå­æ€§"></a>åŸå­æ€§</h3><p>XA åè®®ä½¿ç”¨ 2PCï¼ˆTwo Phase Commitï¼Œä¸¤é˜¶æ®µæäº¤ï¼‰åŸå­æäº¤åè®®æ¥ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡åŸå­æ€§ã€‚</p>
<p>ä¸¤é˜¶æ®µæäº¤æ˜¯æŒ‡å°†æäº¤è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œå³å‡†å¤‡é˜¶æ®µï¼ˆæŠ•ç¥¨é˜¶æ®µï¼‰å’Œæäº¤é˜¶æ®µï¼ˆæ‰§è¡Œé˜¶æ®µï¼‰ï¼š</p>
<p><a href="http://idiotsky.top/images3/dt-8.jpg"><img src="http://idiotsky.top/images3/dt-8.jpg" alt=""></a></p>
<p>å‡†å¤‡é˜¶æ®µï¼š</p>
<p>TM å‘æ¯ä¸ª RM å‘é€å‡†å¤‡æ¶ˆæ¯ã€‚å¦‚æœ RM çš„æœ¬åœ°äº‹åŠ¡æ“ä½œæ‰§è¡ŒæˆåŠŸï¼Œåˆ™è¿”å›æˆåŠŸï¼›å¦‚æœ RM çš„æœ¬åœ°äº‹åŠ¡æ“ä½œæ‰§è¡Œå¤±è´¥ï¼Œåˆ™è¿”å›å¤±è´¥ã€‚</p>
<p>æäº¤é˜¶æ®µ</p>
<p>å¦‚æœ TM æ”¶åˆ°äº†æ‰€æœ‰ RM å›å¤çš„æˆåŠŸæ¶ˆæ¯ï¼Œåˆ™å‘æ¯ä¸ª RM å‘é€æäº¤æ¶ˆæ¯ï¼›å¦åˆ™å‘é€å›æ»šæ¶ˆæ¯ï¼›RM æ ¹æ® TM çš„æŒ‡ä»¤æ‰§è¡Œæäº¤æˆ–è€…å›æ»šæœ¬åœ°äº‹åŠ¡æ“ä½œï¼Œé‡Šæ”¾æ‰€æœ‰äº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­ä½¿ç”¨çš„é”èµ„æºã€‚</p>
<h3 id="éš”ç¦»æ€§"><a href="#éš”ç¦»æ€§" class="headerlink" title="éš”ç¦»æ€§"></a>éš”ç¦»æ€§</h3><p>XA åè®®ä¸­æ²¡æœ‰æè¿°å¦‚ä½•å®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„éš”ç¦»æ€§ï¼Œä½†æ˜¯ XA åè®®è¦æ±‚DTP æ¨¡å‹ä¸­çš„æ¯ä¸ª RM éƒ½è¦å®ç°æœ¬åœ°äº‹åŠ¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸºäº XA åè®®å®ç°çš„åˆ†å¸ƒå¼äº‹åŠ¡çš„éš”ç¦»æ€§æ˜¯ç”±æ¯ä¸ª RM æœ¬åœ°äº‹åŠ¡çš„éš”ç¦»æ€§æ¥ä¿è¯çš„ï¼Œå½“ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„æ‰€æœ‰å­äº‹åŠ¡éƒ½æ˜¯éš”ç¦»çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡å¤©ç„¶çš„å°±å®ç°äº†éš”ç¦»æ€§ã€‚</p>
<p>ä»¥ MySQL æ¥ä¸¾ä¾‹ï¼ŒMySQL ä½¿ç”¨ 2PLï¼ˆTwo-Phase Lockingï¼Œä¸¤é˜¶æ®µé”ï¼‰æœºåˆ¶æ¥æ§åˆ¶æœ¬åœ°äº‹åŠ¡çš„å¹¶å‘ï¼Œä¿è¯éš”ç¦»æ€§ã€‚2PL ä¸ 2PC ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å°†é”æ“ä½œåˆ†ä¸ºåŠ é”å’Œè§£é”ä¸¤ä¸ªé˜¶æ®µï¼Œå¹¶ä¸”ä¿è¯ä¸¤ä¸ªé˜¶æ®µå®Œå…¨ä¸ç›¸äº¤ã€‚åŠ é”é˜¶æ®µï¼ŒåªåŠ é”ï¼Œä¸æ”¾é”ã€‚è§£é”é˜¶æ®µï¼Œåªæ”¾é”ï¼Œä¸åŠ é”ã€‚</p>
<p><a href="http://idiotsky.top/images3/dt-9.jpg"><img src="http://idiotsky.top/images3/dt-9.jpg" alt=""></a></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ä¸­ï¼Œæ¯æ‰§è¡Œä¸€æ¡æ›´æ–°æ“ä½œä¹‹å‰ï¼Œéƒ½ä¼šå…ˆè·å–å¯¹åº”çš„é”èµ„æºï¼Œåªæœ‰è·å–é”èµ„æºæˆåŠŸæ‰ä¼šæ‰§è¡Œè¯¥æ“ä½œï¼Œå¹¶ä¸”ä¸€æ—¦è·å–äº†é”èµ„æºå°±ä¼šæŒæœ‰è¯¥é”èµ„æºç›´åˆ°æœ¬äº‹åŠ¡æ‰§è¡Œç»“æŸã€‚</p>
<p>MySQL é€šè¿‡è¿™ç§ 2PL æœºåˆ¶ï¼Œå¯ä»¥ä¿è¯åœ¨æœ¬åœ°äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…¶ä»–å¹¶å‘äº‹åŠ¡ä¸èƒ½æ“ä½œç›¸åŒèµ„æºï¼Œä»è€Œå®ç°äº†äº‹åŠ¡éš”ç¦»ã€‚</p>
<h3 id="ä¸€è‡´æ€§"><a href="#ä¸€è‡´æ€§" class="headerlink" title="ä¸€è‡´æ€§"></a>ä¸€è‡´æ€§</h3><p>å‰é¢æåˆ°ä¸€è‡´æ€§æœ‰ä¸¤å±‚è¯­ä¹‰ï¼Œä¸€å±‚æ˜¯ç¡®ä¿äº‹åŠ¡æ‰§è¡Œç»“æŸåï¼Œæ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´çŠ¶æ€è½¬å˜ä¸ºå¦ä¸€ä¸ªä¸€è‡´çŠ¶æ€ã€‚å¦ä¸€å±‚è¯­ä¹‰æ˜¯äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸­é—´çŠ¶æ€ä¸èƒ½è¢«è§‚å¯Ÿåˆ°ã€‚</p>
<p>å‰ä¸€å±‚è¯­ä¹‰çš„å®ç°å¾ˆç®€å•ï¼Œé€šè¿‡åŸå­æ€§ã€éš”ç¦»æ€§ä»¥åŠ RM è‡ªèº«ä¸€è‡´æ€§çš„å®ç°å°±å¯ä»¥ä¿è¯ã€‚è‡³äºåä¸€å±‚è¯­ä¹‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å•ä¸ª RM ä¸Šçš„æœ¬åœ°äº‹åŠ¡æ˜¯æ€ä¹ˆå®ç°çš„ã€‚è¿˜æ˜¯ä»¥ MySQL ä¸¾ä¾‹ï¼ŒMySQL é€šè¿‡ MVCCï¼ˆMulti Version Concurrency Controlï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰æœºåˆ¶ï¼Œä¸ºæ¯ä¸ªä¸€è‡´æ€§çŠ¶æ€ç”Ÿæˆå¿«ç…§ï¼ˆSnapshotï¼‰ï¼Œæ¯ä¸ªäº‹åŠ¡çœ‹åˆ°çš„éƒ½æ˜¯å„Snapshotå¯¹åº”çš„ä¸€è‡´æ€§çŠ¶æ€ï¼Œä»è€Œä¹Ÿå°±ä¿è¯äº†æœ¬åœ°äº‹åŠ¡çš„ä¸­é—´çŠ¶æ€ä¸ä¼šè¢«è§‚å¯Ÿåˆ°ã€‚</p>
<p>è™½ç„¶å•ä¸ª RM ä¸Šå®ç°äº†Snapshotï¼Œä½†æ˜¯åœ¨åˆ†å¸ƒå¼åº”ç”¨æ¶æ„ä¸‹ï¼Œä¼šé‡åˆ°ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p>
<p><a href="http://idiotsky.top/images3/dt-10.jpg"><img src="http://idiotsky.top/images3/dt-10.jpg" alt=""></a></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨ RM1 çš„æœ¬åœ°å­äº‹åŠ¡æäº¤å®Œæ¯•åˆ° RM2 çš„æœ¬åœ°å­äº‹åŠ¡æäº¤å®Œæ¯•ä¹‹é—´ï¼Œåªèƒ½è¯»åˆ° RM1 ä¸Šå­äº‹åŠ¡æ‰§è¡Œçš„å†…å®¹ï¼Œè¯»ä¸åˆ° RM2 ä¸Šçš„å­äº‹åŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶åœ¨å•ä¸ª RM ä¸Šçš„æœ¬åœ°äº‹åŠ¡æ˜¯ä¸€è‡´çš„ï¼Œä½†æ˜¯ä»å…¨å±€æ¥çœ‹ï¼Œä¸€ä¸ªå…¨å±€äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹çš„ä¸­é—´çŠ¶æ€è¢«è§‚å¯Ÿåˆ°äº†ï¼Œå…¨å±€ä¸€è‡´æ€§å°±è¢«ç ´åäº†ã€‚</p>
<p>XA åè®®å¹¶æ²¡æœ‰å®šä¹‰æ€ä¹ˆå®ç°å…¨å±€çš„ Snapshotï¼Œåƒ MySQL å®˜æ–¹æ–‡æ¡£é‡Œå°±å»ºè®®ä½¿ç”¨ä¸²è¡ŒåŒ–çš„éš”ç¦»çº§åˆ«æ¥ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§ï¼š â€œAs with nondistributed transactions, SERIALIZABLE may be preferred if your applications are sensitive to read phenomena. REPEATABLE READ may not be sufficient for distributed transactions.â€ï¼ˆå¯¹äºåˆ†å¸ƒå¼äº‹åŠ¡æ¥è¯´ï¼Œå¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸è¶³ä»¥ä¿è¯äº‹åŠ¡ä¸€è‡´æ€§ï¼Œå¦‚æœä½ çš„ç¨‹åºæœ‰å…¨å±€ä¸€è‡´æ€§è¯»è¦æ±‚ï¼Œå¯ä»¥è€ƒè™‘ä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«.ï¼‰</p>
<p>å½“ç„¶ï¼Œç”±äºä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«çš„æ€§èƒ½è¾ƒå·®ï¼Œæ‰€ä»¥å¾ˆå¤šåˆ†å¸ƒå¼æ•°æ®åº“éƒ½è‡ªå·±å®ç°äº†åˆ†å¸ƒå¼ MVCC æœºåˆ¶æ¥æä¾›å…¨å±€çš„ä¸€è‡´æ€§è¯»ã€‚ä¸€ä¸ªåŸºæœ¬æ€è·¯æ˜¯ç”¨ä¸€ä¸ªé›†ä¸­å¼æˆ–è€…é€»è¾‘ä¸Šå•è°ƒé€’å¢çš„ä¸œè¥¿æ¥æ§åˆ¶ç”Ÿæˆå…¨å±€ Snapshotï¼Œæ¯ä¸ªäº‹åŠ¡æˆ–è€…æ¯æ¡ SQL æ‰§è¡Œæ—¶éƒ½å»è·å–ä¸€æ¬¡ï¼Œä»è€Œå®ç°ä¸åŒéš”ç¦»çº§åˆ«ä¸‹çš„ä¸€è‡´æ€§ã€‚æ¯”å¦‚ Google çš„ Spanner å°±æ˜¯ç”¨ TrueTime æ¥æ§åˆ¶è®¿é—®å…¨å±€ Snapshotã€‚</p>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>XA åè®®é€šå¸¸å®ç°åœ¨æ•°æ®åº“èµ„æºå±‚ï¼Œç›´æ¥ä½œç”¨äºèµ„æºç®¡ç†å™¨ä¸Šã€‚å› æ­¤ï¼ŒåŸºäº XA åè®®å®ç°çš„åˆ†å¸ƒå¼äº‹åŠ¡äº§å“ï¼Œæ— è®ºæ˜¯åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œè¿˜æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶ï¼Œå¯¹ä¸šåŠ¡å‡ ä¹éƒ½æ²¡æœ‰ä¾µå…¥ï¼Œå°±åƒä½¿ç”¨æ™®é€šæ•°æ®åº“ä¸€æ ·ã€‚</p>
<p>XA åè®®ä¸¥æ ¼ä¿éšœäº‹åŠ¡ ACID ç‰¹æ€§ï¼Œèƒ½å¤Ÿæ»¡è¶³æ‰€æœ‰ä¸šåŠ¡é¢†åŸŸçš„åŠŸèƒ½éœ€æ±‚ï¼Œä½†æ˜¯ï¼Œè¿™åŒæ ·æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ã€‚</p>
<p>ç”±äºéš”ç¦»æ€§çš„äº’æ–¥è¦æ±‚ï¼Œåœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰çš„èµ„æºéƒ½è¢«é”å®šï¼Œåªé€‚ç”¨äºæ‰§è¡Œæ—¶é—´ç¡®å®šçš„çŸ­äº‹åŠ¡ã€‚åŒæ—¶ï¼Œæ•´ä¸ªäº‹åŠ¡æœŸé—´éƒ½æ˜¯ç‹¬å æ•°æ®ï¼Œå¯¹äºçƒ­ç‚¹æ•°æ®çš„å¹¶å‘æ€§èƒ½å¯èƒ½ä¼šå¾ˆä½ï¼Œå®ç°äº†åˆ†å¸ƒå¼ MVCC æˆ–ä¹è§‚é”ï¼ˆoptimistic lockingï¼‰ä»¥åï¼Œæ€§èƒ½å¯èƒ½ä¼šæœ‰æ‰€æå‡ã€‚</p>
<p>åŒæ—¶ï¼Œä¸ºäº†ä¿éšœä¸€è‡´æ€§ï¼Œè¦æ±‚æ‰€æœ‰ RM åŒç­‰å¯ä¿¡ã€å¯é ï¼Œè¦æ±‚æ•…éšœæ¢å¤æœºåˆ¶å¯é ã€å¿«é€Ÿï¼Œåœ¨ç½‘ç»œæ•…éšœéš”ç¦»çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡åŸºæœ¬ä¸å¯ç”¨ã€‚</p>
<h2 id="TCC-æ¨¡å‹"><a href="#TCC-æ¨¡å‹" class="headerlink" title="TCC æ¨¡å‹"></a>TCC æ¨¡å‹</h2><p>TCCï¼ˆTry-Confirm-Cancelï¼‰åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹ç›¸å¯¹äº XA ç­‰ä¼ ç»Ÿæ¨¡å‹ï¼Œå…¶ç‰¹å¾åœ¨äºå®ƒä¸ä¾èµ–èµ„æºç®¡ç†å™¨ï¼ˆRMï¼‰å¯¹åˆ†å¸ƒå¼äº‹åŠ¡çš„æ”¯æŒï¼Œè€Œæ˜¯é€šè¿‡å¯¹ä¸šåŠ¡é€»è¾‘çš„åˆ†è§£æ¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p>
<p>TCC æ¨¡å‹è®¤ä¸ºå¯¹äºä¸šåŠ¡ç³»ç»Ÿä¸­ä¸€ä¸ªç‰¹å®šçš„ä¸šåŠ¡é€»è¾‘ï¼Œå…¶å¯¹å¤–æä¾›æœåŠ¡æ—¶ï¼Œå¿…é¡»æ¥å—ä¸€äº›ä¸ç¡®å®šæ€§ï¼Œå³å¯¹ä¸šåŠ¡é€»è¾‘åˆæ­¥æ“ä½œçš„è°ƒç”¨ä»…æ˜¯ä¸€ä¸ªä¸´æ—¶æ€§æ“ä½œï¼Œè°ƒç”¨å®ƒçš„ä¸»ä¸šåŠ¡æœåŠ¡ä¿ç•™äº†åç»­çš„å–æ¶ˆæƒã€‚å¦‚æœä¸»ä¸šåŠ¡æœåŠ¡è®¤ä¸ºå…¨å±€äº‹åŠ¡åº”è¯¥å›æ»šï¼Œå®ƒä¼šè¦æ±‚å–æ¶ˆä¹‹å‰çš„ä¸´æ—¶æ€§æ“ä½œï¼Œè¿™å°±å¯¹åº”ä»ä¸šåŠ¡æœåŠ¡çš„å–æ¶ˆæ“ä½œã€‚è€Œå½“ä¸»ä¸šåŠ¡æœåŠ¡è®¤ä¸ºå…¨å±€äº‹åŠ¡åº”è¯¥æäº¤æ—¶ï¼Œå®ƒä¼šæ”¾å¼ƒä¹‹å‰ä¸´æ—¶æ€§æ“ä½œçš„å–æ¶ˆæƒï¼Œè¿™å¯¹åº”ä»ä¸šåŠ¡æœåŠ¡çš„ç¡®è®¤æ“ä½œã€‚æ¯ä¸€ä¸ªåˆæ­¥æ“ä½œï¼Œæœ€ç»ˆéƒ½ä¼šè¢«ç¡®è®¤æˆ–å–æ¶ˆã€‚</p>
<p>å› æ­¤ï¼Œé’ˆå¯¹ä¸€ä¸ªå…·ä½“çš„ä¸šåŠ¡æœåŠ¡ï¼ŒTCC åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹éœ€è¦ä¸šåŠ¡ç³»ç»Ÿæä¾›ä¸‰æ®µä¸šåŠ¡é€»è¾‘ï¼š</p>
<ol>
<li>åˆæ­¥æ“ä½œ Tryï¼šå®Œæˆæ‰€æœ‰ä¸šåŠ¡æ£€æŸ¥ï¼Œé¢„ç•™å¿…é¡»çš„ä¸šåŠ¡èµ„æºã€‚</li>
<li>ç¡®è®¤æ“ä½œ Confirmï¼šçœŸæ­£æ‰§è¡Œçš„ä¸šåŠ¡é€»è¾‘ï¼Œä¸ä½œä»»ä½•ä¸šåŠ¡æ£€æŸ¥ï¼Œåªä½¿ç”¨ Try é˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æºã€‚å› æ­¤ï¼Œåªè¦ Try æ“ä½œæˆåŠŸï¼ŒConfirm å¿…é¡»èƒ½æˆåŠŸã€‚å¦å¤–ï¼ŒConfirm æ“ä½œéœ€æ»¡è¶³å¹‚ç­‰æ€§ï¼Œä¿è¯ä¸€ç¬”åˆ†å¸ƒå¼äº‹åŠ¡æœ‰ä¸”åªèƒ½æˆåŠŸä¸€æ¬¡ã€‚</li>
<li>å–æ¶ˆæ“ä½œ Cancelï¼šé‡Šæ”¾ Try é˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æºã€‚åŒæ ·çš„ï¼ŒCancel æ“ä½œä¹Ÿéœ€è¦æ»¡è¶³å¹‚ç­‰æ€§ã€‚</li>
</ol>
<p><a href="http://idiotsky.top/images3/dt-11.jpg"><img src="http://idiotsky.top/images3/dt-11.jpg" alt=""></a></p>
<p>TCC åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼š</p>
<ol>
<li>ä¸»ä¸šåŠ¡æœåŠ¡ï¼šä¸»ä¸šåŠ¡æœåŠ¡ä¸ºæ•´ä¸ªä¸šåŠ¡æ´»åŠ¨çš„å‘èµ·æ–¹ï¼ŒæœåŠ¡çš„ç¼–æ’è€…ï¼Œè´Ÿè´£å‘èµ·å¹¶å®Œæˆæ•´ä¸ªä¸šåŠ¡æ´»åŠ¨ã€‚</li>
<li>ä»ä¸šåŠ¡æœåŠ¡ï¼šä»ä¸šåŠ¡æœåŠ¡æ˜¯æ•´ä¸ªä¸šåŠ¡æ´»åŠ¨çš„å‚ä¸æ–¹ï¼Œè´Ÿè´£æä¾› TCC ä¸šåŠ¡æ“ä½œï¼Œå®ç°åˆæ­¥æ“ä½œï¼ˆTryï¼‰ã€ç¡®è®¤æ“ä½œï¼ˆConfirmï¼‰ã€å–æ¶ˆæ“ä½œï¼ˆCancelï¼‰ä¸‰ä¸ªæ¥å£ï¼Œä¾›ä¸»ä¸šåŠ¡æœåŠ¡è°ƒç”¨ã€‚</li>
<li>ä¸šåŠ¡æ´»åŠ¨ç®¡ç†å™¨ï¼šä¸šåŠ¡æ´»åŠ¨ç®¡ç†å™¨ç®¡ç†æ§åˆ¶æ•´ä¸ªä¸šåŠ¡æ´»åŠ¨ï¼ŒåŒ…æ‹¬è®°å½•ç»´æŠ¤ TCC å…¨å±€äº‹åŠ¡çš„äº‹åŠ¡çŠ¶æ€å’Œæ¯ä¸ªä»ä¸šåŠ¡æœåŠ¡çš„å­äº‹åŠ¡çŠ¶æ€ï¼Œå¹¶åœ¨ä¸šåŠ¡æ´»åŠ¨æäº¤æ—¶è°ƒç”¨æ‰€æœ‰ä»ä¸šåŠ¡æœåŠ¡çš„ Confirm æ“ä½œï¼Œåœ¨ä¸šåŠ¡æ´»åŠ¨å–æ¶ˆæ—¶è°ƒç”¨æ‰€æœ‰ä»ä¸šåŠ¡æœåŠ¡çš„ Cancel æ“ä½œã€‚</li>
</ol>
<p>ä¸€ä¸ªå®Œæ•´çš„ TCC åˆ†å¸ƒå¼äº‹åŠ¡æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>ä¸»ä¸šåŠ¡æœåŠ¡é¦–å…ˆå¼€å¯æœ¬åœ°äº‹åŠ¡ï¼›</li>
<li>ä¸»ä¸šåŠ¡æœåŠ¡å‘ä¸šåŠ¡æ´»åŠ¨ç®¡ç†å™¨ç”³è¯·å¯åŠ¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸»ä¸šåŠ¡æ´»åŠ¨ï¼›</li>
<li>ç„¶åé’ˆå¯¹è¦è°ƒç”¨çš„ä»ä¸šåŠ¡æœåŠ¡ï¼Œä¸»ä¸šåŠ¡æ´»åŠ¨å…ˆå‘ä¸šåŠ¡æ´»åŠ¨ç®¡ç†å™¨æ³¨å†Œä»ä¸šåŠ¡æ´»åŠ¨ï¼Œç„¶åè°ƒç”¨ä»ä¸šåŠ¡æœåŠ¡çš„ Try æ¥å£ï¼›</li>
<li>å½“æ‰€æœ‰ä»ä¸šåŠ¡æœåŠ¡çš„ Try æ¥å£è°ƒç”¨æˆåŠŸï¼Œä¸»ä¸šåŠ¡æœåŠ¡æäº¤æœ¬åœ°äº‹åŠ¡ï¼›è‹¥è°ƒç”¨å¤±è´¥ï¼Œä¸»ä¸šåŠ¡æœåŠ¡å›æ»šæœ¬åœ°äº‹åŠ¡ï¼›</li>
<li>è‹¥ä¸»ä¸šåŠ¡æœåŠ¡æäº¤æœ¬åœ°äº‹åŠ¡ï¼Œåˆ™ TCC æ¨¡å‹åˆ†åˆ«è°ƒç”¨æ‰€æœ‰ä»ä¸šåŠ¡æœåŠ¡çš„ Confirm æ¥å£ï¼›è‹¥ä¸»ä¸šåŠ¡æœåŠ¡å›æ»šæœ¬åœ°äº‹åŠ¡ï¼Œåˆ™åˆ†åˆ«è°ƒç”¨ Cancel æ¥å£ï¼›</li>
<li>æ‰€æœ‰ä»ä¸šåŠ¡æœåŠ¡çš„ Confirm æˆ– Cancel æ“ä½œå®Œæˆåï¼Œå…¨å±€äº‹åŠ¡ç»“æŸã€‚</li>
</ol>
<h3 id="åŸå­æ€§-1"><a href="#åŸå­æ€§-1" class="headerlink" title="åŸå­æ€§"></a>åŸå­æ€§</h3><p>TCC æ¨¡å‹ä¹Ÿä½¿ç”¨ 2PC åŸå­æäº¤åè®®æ¥ä¿è¯äº‹åŠ¡åŸå­æ€§ã€‚Try æ“ä½œå¯¹åº”2PC çš„ä¸€é˜¶æ®µå‡†å¤‡ï¼ˆPrepareï¼‰ï¼›Confirm å¯¹åº” 2PC çš„äºŒé˜¶æ®µæäº¤ï¼ˆCommitï¼‰ï¼ŒCancel å¯¹åº” 2PC çš„äºŒé˜¶æ®µå›æ»šï¼ˆRollbackï¼‰ï¼Œå¯ä»¥è¯´ TCC å°±æ˜¯åº”ç”¨å±‚çš„ 2PCã€‚</p>
<h3 id="éš”ç¦»æ€§-1"><a href="#éš”ç¦»æ€§-1" class="headerlink" title="éš”ç¦»æ€§"></a>éš”ç¦»æ€§</h3><p>TCC åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹ä»…æä¾›ä¸¤é˜¶æ®µåŸå­æäº¤åè®®ï¼Œä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡åŸå­æ€§ã€‚äº‹åŠ¡çš„éš”ç¦»äº¤ç»™ä¸šåŠ¡é€»è¾‘æ¥å®ç°ã€‚</p>
<p>éš”ç¦»çš„æœ¬è´¨æ˜¯æ§åˆ¶å¹¶å‘ï¼Œé˜²æ­¢å¹¶å‘äº‹åŠ¡æ“ä½œç›¸åŒèµ„æºè€Œå¼•èµ·çš„ç»“æœé”™ä¹±ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚é‡‘èè¡Œä¸šé‡Œç®¡ç†ç”¨æˆ·èµ„é‡‘ï¼Œå½“ç”¨æˆ·å‘èµ·äº¤æ˜“æ—¶ï¼Œä¸€èˆ¬ä¼šå…ˆæ£€æŸ¥ç”¨æˆ·èµ„é‡‘ï¼Œå¦‚æœèµ„é‡‘å……è¶³ï¼Œåˆ™æ‰£é™¤ç›¸åº”äº¤æ˜“é‡‘é¢ï¼Œå¢åŠ å–å®¶èµ„é‡‘ï¼Œå®Œæˆäº¤æ˜“ã€‚å¦‚æœæ²¡æœ‰äº‹åŠ¡éš”ç¦»ï¼Œç”¨æˆ·åŒæ—¶å‘èµ·ä¸¤ç¬”äº¤æ˜“ï¼Œä¸¤ç¬”äº¤æ˜“çš„æ£€æŸ¥éƒ½è®¤ä¸ºèµ„é‡‘å……è¶³ï¼Œå®é™…ä¸Šå´åªå¤Ÿæ”¯ä»˜ä¸€ç¬”äº¤æ˜“ï¼Œç»“æœä¸¤ç¬”äº¤æ˜“éƒ½æ”¯ä»˜æˆåŠŸï¼Œå¯¼è‡´èµ„æŸã€‚</p>
<p>å¯ä»¥å‘ç°ï¼Œå¹¶å‘æ§åˆ¶æ˜¯ä¸šåŠ¡é€»è¾‘æ‰§è¡Œæ­£ç¡®çš„ä¿è¯ï¼Œä½†æ˜¯åƒä¸¤é˜¶æ®µé”è¿™æ ·çš„å¹¶å‘è®¿é—®æ§åˆ¶æŠ€æœ¯è¦æ±‚ä¸€ç›´æŒæœ‰æ•°æ®åº“èµ„æºé”ç›´åˆ°æ•´ä¸ªäº‹åŠ¡æ‰§è¡Œç»“æŸï¼Œç‰¹åˆ«æ˜¯åœ¨åˆ†å¸ƒå¼äº‹åŠ¡æ¶æ„ä¸‹ï¼Œè¦æ±‚æŒæœ‰é”åˆ°åˆ†å¸ƒå¼äº‹åŠ¡ç¬¬äºŒé˜¶æ®µæ‰§è¡Œç»“æŸï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡ä¼šåŠ é•¿èµ„æºé”çš„æŒæœ‰æ—¶é—´ï¼Œå¯¼è‡´å¹¶å‘æ€§èƒ½è¿›ä¸€æ­¥ä¸‹é™ã€‚</p>
<p>å› æ­¤ï¼ŒTCC æ¨¡å‹çš„éš”ç¦»æ€§æ€æƒ³å°±æ˜¯é€šè¿‡ä¸šåŠ¡çš„æ”¹é€ ï¼Œåœ¨ç¬¬ä¸€é˜¶æ®µç»“æŸä¹‹åï¼Œä»åº•å±‚æ•°æ®åº“èµ„æºå±‚é¢çš„åŠ é”è¿‡æ¸¡ä¸ºä¸Šå±‚ä¸šåŠ¡å±‚é¢çš„åŠ é”ï¼Œä»è€Œé‡Šæ”¾åº•å±‚æ•°æ®åº“é”èµ„æºï¼Œæ”¾å®½åˆ†å¸ƒå¼äº‹åŠ¡é”åè®®ï¼Œæé«˜ä¸šåŠ¡å¹¶å‘æ€§èƒ½ã€‚</p>
<p>è¿˜æ˜¯ä»¥ä¸Šé¢çš„ä¾‹å­ä¸¾ä¾‹ï¼š</p>
<ol>
<li>ç¬¬ä¸€é˜¶æ®µï¼šæ£€æŸ¥ç”¨æˆ·èµ„é‡‘ï¼Œå¦‚æœèµ„é‡‘å……è¶³ï¼Œå†»ç»“ç”¨æˆ·æœ¬æ¬¡äº¤æ˜“èµ„é‡‘ï¼Œè¿™ç¬”èµ„é‡‘è¢«ä¸šåŠ¡éš”ç¦»ï¼Œä¸å…è®¸é™¤æœ¬äº‹åŠ¡ä¹‹å¤–çš„å…¶å®ƒå¹¶å‘äº‹åŠ¡åŠ¨ç”¨ã€‚</li>
<li>ç¬¬äºŒé˜¶æ®µï¼šæ‰£é™¤ç¬¬ä¸€é˜¶æ®µé¢„å†»ç»“çš„ç”¨æˆ·èµ„é‡‘ï¼Œå¢åŠ å–å®¶èµ„é‡‘ï¼Œå®Œæˆäº¤æ˜“ã€‚ é‡‡ç”¨ä¸šåŠ¡åŠ é”çš„æ–¹å¼ï¼Œéš”ç¦»ç”¨æˆ·å†»ç»“èµ„é‡‘ï¼Œåœ¨ç¬¬ä¸€é˜¶æ®µç»“æŸåç›´æ¥é‡Šæ”¾åº•å±‚èµ„æºé”ï¼Œè¯¥ç”¨æˆ·å’Œå–å®¶çš„å…¶ä»–äº¤æ˜“éƒ½å¯ä»¥ç«‹åˆ»å¹¶å‘æ‰§è¡Œï¼Œè€Œä¸ç”¨ç­‰åˆ°æ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ç»“æŸï¼Œå¯ä»¥è·å¾—æ›´é«˜çš„å¹¶å‘äº¤æ˜“èƒ½åŠ›ã€‚</li>
</ol>
<h3 id="ä¸€è‡´æ€§-1"><a href="#ä¸€è‡´æ€§-1" class="headerlink" title="ä¸€è‡´æ€§"></a>ä¸€è‡´æ€§</h3><p>å†æ¥çœ‹çœ‹ TCC åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹ä¸‹çš„ä¸€è‡´æ€§å®ç°ã€‚ä¸ XA åè®®å®ç°ä¸€è‡´æ€§ç¬¬ä¸€å±‚è¯­ä¹‰ç±»ä¼¼ï¼Œé€šè¿‡åŸå­æ€§ä¿è¯äº‹åŠ¡çš„åŸå­æäº¤ã€ä¸šåŠ¡éš”ç¦»æ€§æ§åˆ¶äº‹åŠ¡çš„å¹¶å‘è®¿é—®ï¼Œå®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸€è‡´æ€§çŠ¶æ€è½¬å˜ã€‚</p>
<p>è‡³äºç¬¬äºŒå±‚è¯­ä¹‰ï¼šäº‹åŠ¡çš„ä¸­é—´çŠ¶æ€ä¸èƒ½è¢«è§‚å¯Ÿåˆ°ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œåœ¨ SOAåˆ†å¸ƒå¼åº”ç”¨ç¯å¢ƒä¸‹æ˜¯å¦æ˜¯å¿…é¡»çš„ã€‚</p>
<p>è¿˜æ˜¯ä»¥è´¦åŠ¡æœåŠ¡ä¸¾ä¾‹ã€‚è½¬è´¦ä¸šåŠ¡ï¼ˆç”¨æˆ· A ïƒ  ç”¨æˆ· Bï¼‰ï¼Œç”±äº¤æ˜“æœåŠ¡å’Œè´¦åŠ¡æœåŠ¡ç»„æˆåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œäº¤æ˜“æœåŠ¡ä½œä¸ºä¸»ä¸šåŠ¡æœåŠ¡ï¼Œè´¦åŠ¡æœåŠ¡ä½œä¸ºä»ä¸šåŠ¡æœåŠ¡ï¼Œè´¦åŠ¡æœåŠ¡çš„ Try æ“ä½œé¢„å†»ç»“ç”¨æˆ· A çš„èµ„é‡‘ï¼›Commit æ“ä½œæ‰£é™¤ç”¨æˆ· A çš„é¢„å†»ç»“èµ„é‡‘ï¼Œå¢åŠ ç”¨æˆ· B çš„å¯ç”¨èµ„é‡‘ï¼›Cancel æ“ä½œè§£å†»ç”¨æˆ· A çš„é¢„å†»ç»“èµ„é‡‘ã€‚</p>
<p>å½“è´¦åŠ¡æœåŠ¡æ‰§è¡Œå®Œ Try é˜¶æ®µåï¼Œäº¤æ˜“ä¸»ä¸šåŠ¡å°±å¯ä»¥ Commit äº†ï¼Œç„¶åç”±TCC æ¡†æ¶è°ƒç”¨è´¦åŠ¡çš„ Commit é˜¶æ®µã€‚åœ¨è´¦åŠ¡ Commit é˜¶æ®µè¿˜æ²¡æ‰§è¡Œç»“æŸçš„æ—¶å€™ï¼Œç”¨æˆ· A å¯ä»¥æŸ¥è¯¢åˆ°è‡ªå·±çš„ä½™é¢å·²æ‰£é™¤ï¼Œä½†æ˜¯ï¼Œæ­¤æ—¶ç”¨æˆ· B çš„å¯ç”¨èµ„é‡‘è¿˜æ²¡å¢åŠ ã€‚</p>
<p>ä»ç³»ç»Ÿçš„è§’åº¦æ¥çœ‹ï¼Œç¡®å®æœ‰é—®é¢˜ä¸ä¸ç¡®å®šæ€§ã€‚åœ¨ç¬¬ä¸€é˜¶æ®µæ‰§è¡Œç»“æŸåˆ°ç¬¬äºŒé˜¶æ®µæ‰§è¡Œç»“æŸä¹‹é—´ï¼Œæœ‰ä¸€æ®µæ—¶é—´çš„å»¶æ—¶ï¼Œåœ¨è¿™æ®µæ—¶é—´å†…ï¼Œçœ‹ä¼¼ä»»ä½•ç”¨æˆ·éƒ½ä¸äº«æœ‰è¿™ç¬”èµ„äº§ã€‚</p>
<p>ä½†æ˜¯ï¼Œä»ç”¨æˆ·çš„è§’åº¦æ¥è€ƒè™‘è¿™ä¸ªé—®é¢˜çš„è¯ï¼Œè¿™ä¸ªæ—¶é—´é—´éš”å¯èƒ½å°±æ— æ‰€è°“æˆ–è€…æ ¹æœ¬å°±ä¸å­˜åœ¨ã€‚ç‰¹åˆ«æ˜¯å½“è¿™ä¸ªæ—¶é—´é—´éš”ä»…ä»…æ˜¯å‡ ç§’é’Ÿï¼Œå¯¹äºå…·ä½“æ²Ÿé€šèµ„äº§è½¬ç§»çš„ç”¨æˆ·æ¥è®²ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯éšè”½çš„æˆ–ç¡®å®å¯ä»¥æ¥å—çš„ï¼Œä¸”ä¿è¯äº†ç»“æœçš„æœ€ç»ˆä¸€è‡´æ€§ã€‚</p>
<p>å½“ç„¶ï¼Œå¯¹äºè¿™æ ·çš„ç³»ç»Ÿï¼Œå¦‚æœç¡®å®éœ€è¦æŸ¥çœ‹ç³»ç»Ÿçš„æŸä¸ªä¸€è‡´æ€§çŠ¶æ€ï¼Œå¯ä»¥é‡‡ç”¨é¢å¤–çš„æ–¹æ³•å®ç°ã€‚</p>
<p>ä¸€èˆ¬æ¥è®²ï¼ŒæœåŠ¡ä¹‹é—´çš„ä¸€è‡´æ€§æ¯”æœåŠ¡å†…éƒ¨çš„ä¸€è‡´æ€§è¦æ›´åŠ å®¹æ˜“å¼±åŒ–ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ XA ç­‰ç›´æ¥åœ¨èµ„æºå±‚é¢ä¸Šå®ç°é€šç”¨åˆ†å¸ƒå¼äº‹åŠ¡çš„æ¨¡å‹ä¼šæ³¨é‡ä¸€è‡´æ€§çš„ä¿è¯ï¼Œè€Œå½“ä¸Šå‡åˆ°æœåŠ¡å±‚é¢ï¼ŒæœåŠ¡ä¸æœåŠ¡ä¹‹é—´å·²ç»å®ç°äº†åŠŸèƒ½çš„åˆ’åˆ†ï¼Œé€»è¾‘çš„è§£è€¦ï¼Œä¹Ÿå°±æ›´å®¹æ˜“å¼±åŒ–ä¸€è‡´æ€§ï¼Œè¿™å°±æ˜¯ SOA æ¶æ„ä¸‹ BASE ç†è®ºçš„æœ€ç»ˆä¸€è‡´æ€§æ€æƒ³ã€‚</p>
<p>BASE ç†è®ºæ˜¯æŒ‡ BAï¼ˆBasic Availabilityï¼ŒåŸºæœ¬ä¸šåŠ¡å¯ç”¨æ€§ï¼‰ï¼›Sï¼ˆSoft stateï¼ŒæŸ”æ€§çŠ¶æ€ï¼‰ï¼›Eï¼ˆEventual consistencyï¼Œæœ€ç»ˆä¸€è‡´æ€§ï¼‰ã€‚è¯¥ç†è®ºè®¤ä¸ºä¸ºäº†å¯ç”¨æ€§ã€æ€§èƒ½ä¸é™çº§æœåŠ¡çš„éœ€è¦ï¼Œå¯ä»¥é€‚å½“é™ä½ä¸€ç‚¹ä¸€è‡´æ€§çš„è¦æ±‚ï¼Œå³â€œåŸºæœ¬å¯ç”¨ï¼Œæœ€ç»ˆä¸€è‡´â€ã€‚</p>
<p>ä¸šå†…é€šå¸¸æŠŠä¸¥æ ¼éµå¾ª ACID çš„äº‹åŠ¡ç§°ä¸ºåˆšæ€§äº‹åŠ¡ï¼›è€ŒåŸºäº BASE æ€æƒ³å®ç°çš„äº‹åŠ¡ç§°ä¸ºæŸ”æ€§äº‹åŠ¡ã€‚æŸ”æ€§äº‹åŠ¡å¹¶ä¸æ˜¯å®Œå…¨æ”¾å¼ƒäº† ACIDï¼Œä»…ä»…æ˜¯æ”¾å®½äº†ä¸€è‡´æ€§è¦æ±‚ï¼šäº‹åŠ¡å®Œæˆåçš„ä¸€è‡´æ€§ä¸¥æ ¼éµå¾ªï¼Œäº‹åŠ¡ä¸­çš„ä¸€è‡´æ€§å¯é€‚å½“æ”¾å®½ï¼›</p>
<h3 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>TCC åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹çš„ä¸šåŠ¡å®ç°ç‰¹æ€§å†³å®šäº†å…¶å¯ä»¥è·¨ DBã€è·¨æœåŠ¡å®ç°èµ„æºç®¡ç†ï¼Œå°†å¯¹ä¸åŒçš„ DB è®¿é—®ã€ä¸åŒçš„ä¸šåŠ¡æ“ä½œé€šè¿‡ TCC æ¨¡å‹åè°ƒä¸ºä¸€ä¸ªåŸå­æ“ä½œï¼Œè§£å†³äº†åˆ†å¸ƒå¼åº”ç”¨æ¶æ„åœºæ™¯ä¸‹çš„äº‹åŠ¡é—®é¢˜ã€‚</p>
<p>TCC æ¨¡å‹é€šè¿‡ 2PC åŸå­æäº¤åè®®ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡çš„çš„åŸå­æ€§ï¼ŒæŠŠèµ„æºå±‚çš„éš”ç¦»æ€§ä¸Šå‡åˆ°ä¸šåŠ¡å±‚ï¼Œäº¤ç»™ä¸šåŠ¡é€»è¾‘æ¥å®ç°ã€‚TCC çš„æ¯ä¸ªæ“ä½œå¯¹äºèµ„æºå±‚æ¥è¯´ï¼Œå°±æ˜¯å•ä¸ªæœ¬åœ°äº‹åŠ¡çš„ä½¿ç”¨ï¼Œæ“ä½œç»“æŸåˆ™æœ¬åœ°äº‹åŠ¡ç»“æŸï¼Œè§„é¿äº†èµ„æºå±‚åœ¨ 2PC å’Œ 2PL ä¸‹å¯¹èµ„æºå ç”¨å¯¼è‡´çš„æ€§èƒ½ä½ä¸‹é—®é¢˜ã€‚</p>
<p>åŒæ—¶ï¼ŒTCC æ¨¡å‹ä¹Ÿå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€è¦ï¼Œåšä¸€äº›å®šåˆ¶åŒ–çš„åŠŸèƒ½ï¼Œæ¯”å¦‚äº¤æ˜“å¼‚æ­¥åŒ–å®ç°å‰Šå³°å¡«è°·ç­‰ã€‚</p>
<p>ä½†æ˜¯ï¼Œä¸šåŠ¡æ¥å…¥ TCC æ¨¡å‹éœ€è¦æ‹†åˆ†ä¸šåŠ¡é€»è¾‘æˆä¸¤ä¸ªé˜¶æ®µï¼Œå¹¶å®ç° Tryã€Confirmã€Cancel ä¸‰ä¸ªæ¥å£ï¼Œå®šåˆ¶åŒ–ç¨‹åº¦é«˜ï¼Œå¼€å‘æˆæœ¬é«˜ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬æ–‡é¦–å…ˆä»‹ç»äº†å…¸å‹çš„åˆ†å¸ƒå¼äº‹åŠ¡çš„æ¶æ„åœºæ™¯ã€‚åˆ†å¸ƒå¼äº‹åŠ¡åˆšå¼€å§‹æ˜¯ä¸ºè§£å†³å•æœåŠ¡å¤šæ•°æ®åº“èµ„æºçš„åœºæ™¯è€Œè¯ç”Ÿçš„ã€‚éšç€æŠ€æœ¯çš„å‘å±•ï¼Œç‰¹åˆ«æ˜¯ SOA åˆ†å¸ƒå¼åº”ç”¨æ¶æ„ä»¥åŠå¾®æœåŠ¡æ—¶ä»£çš„åˆ°æ¥ï¼ŒæœåŠ¡å˜æˆäº†åŸºæœ¬ä¸šåŠ¡å•å…ƒã€‚å› æ­¤ï¼Œåˆäº§ç”Ÿäº†è·¨æœåŠ¡çš„åˆ†å¸ƒå¼äº‹åŠ¡éœ€æ±‚ã€‚ç„¶åä» XA å’Œ TCC ä¸¤ç§å¸¸ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹å…¥æ‰‹ï¼Œä»‹ç»äº†å…¶å®ç°æœºåˆ¶ï¼Œç€é‡åˆ†æäº†å„æ¨¡å‹æ˜¯å¦‚ä½•å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ ACID ç‰¹æ€§çš„ã€‚</p>
<p>ref <a href="https://zhuanlan.zhihu.com/p/38388143" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/38388143</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ğŸ‘¿markä¹‹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯ä¼ä¸šé›†æˆä¸­çš„ä¸€ä¸ªæŠ€æœ¯éš¾ç‚¹ï¼Œä¹Ÿæ˜¯æ¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„ä¸­éƒ½ä¼šæ¶‰åŠåˆ°çš„ä¸€ä¸ªä¸œè¥¿ï¼Œç‰¹åˆ«æ˜¯åœ¨è¿™å‡ å¹´è¶Šæ¥è¶Šç«çš„å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå‡ ä¹å¯ä»¥è¯´æ˜¯æ— æ³•é¿å…ï¼Œæœ¬æ–‡å°±å›´ç»•åˆ†å¸ƒå¼äº‹åŠ¡å„æ–¹é¢ä¸å¤§å®¶è¿›è¡Œä»‹ç»ã€‚&lt;/p&gt;
&lt;h1 id=&quot;äº‹åŠ¡&quot;&gt;&lt;a href=&quot;#äº‹åŠ¡&quot; class=&quot;headerlink&quot; title=&quot;äº‹åŠ¡&quot;&gt;&lt;/a&gt;äº‹åŠ¡&lt;/h1&gt;&lt;h2 id=&quot;ä»€ä¹ˆæ˜¯äº‹åŠ¡&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯äº‹åŠ¡&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯äº‹åŠ¡&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯äº‹åŠ¡&lt;/h2&gt;&lt;p&gt;æ•°æ®åº“äº‹åŠ¡ï¼ˆç®€ç§°ï¼šäº‹åŠ¡ï¼ŒTransactionï¼‰æ˜¯æŒ‡æ•°æ®åº“æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸€ä¸ªé€»è¾‘å•ä½ï¼Œç”±ä¸€ä¸ªæœ‰é™çš„æ•°æ®åº“æ“ä½œåºåˆ—æ„æˆã€‚&lt;/p&gt;
&lt;p&gt;äº‹åŠ¡æ‹¥æœ‰ä»¥ä¸‹å››ä¸ªç‰¹æ€§ï¼Œä¹ æƒ¯ä¸Šè¢«ç§°ä¸ºACIDç‰¹æ€§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡ä½œä¸ºä¸€ä¸ªæ•´ä½“è¢«æ‰§è¡Œï¼ŒåŒ…å«åœ¨å…¶ä¸­çš„å¯¹æ•°æ®åº“çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨è¢«æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡åº”ç¡®ä¿æ•°æ®åº“çš„çŠ¶æ€ä»ä¸€ä¸ªä¸€è‡´çŠ¶æ€è½¬å˜ä¸ºå¦ä¸€ä¸ªä¸€è‡´çŠ¶æ€ã€‚ä¸€è‡´çŠ¶æ€æ˜¯æŒ‡æ•°æ®åº“ä¸­çš„æ•°æ®åº”æ»¡è¶³å®Œæ•´æ€§çº¦æŸã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸€è‡´æ€§è¿˜æœ‰å¦å¤–ä¸€å±‚è¯­ä¹‰ï¼Œå°±æ˜¯äº‹åŠ¡çš„ä¸­é—´çŠ¶æ€ä¸èƒ½è¢«è§‚å¯Ÿåˆ°ï¼ˆè¿™å±‚è¯­ä¹‰ä¹Ÿæœ‰è¯´åº”è¯¥å±äºåŸå­æ€§ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šå¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ï¼Œä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸åº”å½±å“å…¶ä»–äº‹åŠ¡çš„æ‰§è¡Œï¼Œå¦‚åŒåªæœ‰è¿™ä¸€ä¸ªæ“ä½œåœ¨è¢«æ•°æ®åº“æ‰€æ‰§è¡Œä¸€æ ·ã€‚&lt;/li&gt;
&lt;li&gt;æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šå·²è¢«æäº¤çš„äº‹åŠ¡å¯¹æ•°æ®åº“çš„ä¿®æ”¹åº”è¯¥æ°¸ä¹…ä¿å­˜åœ¨æ•°æ®åº“ä¸­ã€‚åœ¨äº‹åŠ¡ç»“æŸæ—¶ï¼Œæ­¤æ“ä½œå°†ä¸å¯é€†è½¬ã€‚&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="åˆ†å¸ƒå¼" scheme="http://idiotsky.top/categories/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
      <category term="åˆ†å¸ƒå¼äº‹åŠ¡" scheme="http://idiotsky.top/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>HTTP æ€»ç»“</title>
    <link href="http://idiotsky.top/2018/05/22/http-summary/"/>
    <id>http://idiotsky.top/2018/05/22/http-summary/</id>
    <published>2018-05-22T14:51:18.000Z</published>
    <updated>2018-07-17T11:39:16.532Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>ğŸ‘¿ mark ï¼Œå¾ˆé•¿ ğŸ˜„</p>
</blockquote>
<h1 id="HTTP-æ¦‚è¿°"><a href="#HTTP-æ¦‚è¿°" class="headerlink" title="HTTP æ¦‚è¿°"></a>HTTP æ¦‚è¿°</h1><p>Web ä½¿ç”¨ä¸€ç§åä¸º HTTP (HyperText Transfer Protocolï¼Œè¶…æ–‡æœ¬ä¼ è¾“åè®®) çš„åè®®ä½œä¸ºè§„èŒƒçš„ã€‚</p>
<blockquote>
<p>HTTP æ›´åŠ ä¸¥è°¨çš„è¯‘ååº”è¯¥æ˜¯ è¶…æ–‡æœ¬è½¬ç§»åè®®ã€‚</p>
</blockquote>
<p>HTTP äº 1990 å¹´é—®ä¸–ã€‚é‚£æ—¶çš„ HTTP å¹¶æ²¡æœ‰ä½œä¸ºæ­£å¼çš„æ ‡å‡†ï¼Œå› ä¸ºè¢«ç§°ä¸º HTTP/0.9<br>HTTP æ­£å¼ä½œä¸ºæ ‡å‡†è¢«å…¬å¸ƒæ˜¯ 1996 å¹´ 5 æœˆï¼Œç‰ˆæœ¬å‘½åä¸º HTTP/1.0ï¼Œè®°è½½äº RFC1945<br>HTTP åœ¨ 1997 å¹´ 1 æœˆå…¬å¸ƒäº†å½“å‰æœ€ä¸»æµçš„ç‰ˆæœ¬ï¼Œç‰ˆæœ¬å‘½åä¸º HTTP/1.1ï¼Œè®°è½½äº RFC2616<br>HTTP/2 äº 2015 å¹´ 5 æœˆ 14 æ—¥å‘å¸ƒï¼Œå¼•å…¥äº†æœåŠ¡å™¨æ¨é€ç­‰å¤šç§åŠŸèƒ½ï¼Œæ˜¯ç›®å‰æœ€æ–°çš„ç‰ˆæœ¬ã€‚è®°è½½äº RFC7540<br>(å®ƒä¸å« HTTP/2.0ï¼Œæ˜¯å› ä¸ºæ ‡å‡†å§”å‘˜ä¼šä¸æ‰“ç®—å†å‘å¸ƒå­ç‰ˆæœ¬äº†ï¼Œä¸‹ä¸€ä¸ªæ–°ç‰ˆæœ¬å°†æ˜¯ HTTP/3)</p>
<a id="more"></a>
<h1 id="HTTP-æ”¯æŒçš„æ–¹æ³•"><a href="#HTTP-æ”¯æŒçš„æ–¹æ³•" class="headerlink" title="HTTP æ”¯æŒçš„æ–¹æ³•"></a>HTTP æ”¯æŒçš„æ–¹æ³•</h1><p>HTTP æ˜¯ä¸€ç§ä¸ä¿å­˜çŠ¶æ€ï¼Œå³ æ— çŠ¶æ€ï¼ˆ stateless ï¼‰åè®®ã€‚HTTP åè®®è‡ªèº«ä¸å¯¹è¯·æ±‚å’Œå“åº”ä¹‹é—´çš„é€šä¿¡çŠ¶æ€è¿›è¡Œä¿å­˜ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨ HTTP è¿™ä¸ªçº§åˆ«ï¼Œåè®®å¯¹äºå‘é€è¿‡çš„è¯·æ±‚æˆ–å“åº”éƒ½ä¸åšæŒä¹…åŒ–å¤„ç†ã€‚è¿™ä¹Ÿæ˜¯ä¸ºäº†æ›´å¿«çš„å¤„ç†å¤§é‡äº‹åŠ¡ï¼Œç¡®ä¿åè®®çš„å¯ä¼¸ç¼©æ€§ã€‚</p>
<p>HTTP/1.1 è™½ç„¶æ˜¯æ— çŠ¶æ€åè®®ï¼Œä½†æ˜¯ä¸ºäº†å®ç°æœŸæœ›çš„ä¿æŒçŠ¶æ€çš„åŠŸèƒ½ï¼Œç‰¹æ„å¼•å…¥äº† Cookie æŠ€æœ¯ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">æ–¹æ³•å</th>
<th style="text-align:center">è¯´æ˜</th>
<th style="text-align:center">æ”¯æŒçš„ HTTP åè®®ç‰ˆæœ¬</th>
<th style="text-align:center">è¯¦ç»†è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">GET</td>
<td style="text-align:center">è·å–èµ„æº</td>
<td style="text-align:center">1.0ã€1.1</td>
<td style="text-align:center">GET æ–¹æ³•ç”¨æ¥è¯·æ±‚è®¿é—®å·²è¢« URI è¯†åˆ«çš„èµ„æºã€‚æŒ‡å®šçš„èµ„æºç»æœåŠ¡å™¨ç«¯è§£æåè¿”å›å“åº”å†…å®¹ã€‚ï¼ˆæˆ‘æƒ³è®¿é—®ä½ çš„æŸä¸ªèµ„æºï¼‰</td>
</tr>
<tr>
<td style="text-align:center">POST</td>
<td style="text-align:center">ä¼ è¾“å®ä½“ä¸»ä½“</td>
<td style="text-align:center">1.0ã€1.1</td>
<td style="text-align:center">POST æ–¹æ³•ç”¨æ¥ä¼ è¾“å®ä½“çš„ä¸»ä½“ã€‚è™½ç„¶ GET ä¹Ÿå¯ä»¥ä¼ è¾“å®ä½“çš„ä¸»ä½“ï¼Œä½†ä¸€èˆ¬ä¸ç”¨ GET è€Œç”¨ POSTï¼ŒPOST çš„ä¸»è¦ç›®çš„å¹¶ä¸æ˜¯è·å–å“åº”çš„ä¸»ä½“å†…å®¹ã€‚ï¼ˆæˆ‘æƒ³æŠŠè¿™æ¡ä¿¡æ¯å‘Šè¯‰ä½ ï¼‰</td>
</tr>
<tr>
<td style="text-align:center">PUT</td>
<td style="text-align:center">ä¼ è¾“æ–‡ä»¶</td>
<td style="text-align:center">1.0ã€1.1</td>
<td style="text-align:center">è¦æ±‚åœ¨è¯·æ±‚æŠ¥æ–‡çš„ä¸»ä½“ä¸­åŒ…å«æ–‡ä»¶å†…å®¹ï¼Œç„¶åä¿å­˜åˆ°è¯·æ±‚ URI æŒ‡å®šä½ç½®ã€‚ï¼ˆæˆ‘æƒ³è¦æŠŠè¿™ä»½æ–‡ä»¶ä¼ ç»™ä½ ï¼‰</td>
</tr>
<tr>
<td style="text-align:center">HEAD</td>
<td style="text-align:center">è·å–æŠ¥æ–‡é¦–éƒ¨</td>
<td style="text-align:center">1.0ã€1.1</td>
<td style="text-align:center">HEAD æ–¹æ³•å’Œ GET æ–¹æ³•ä¸€æ ·ï¼Œåªæ˜¯ä¸è¿”å›æŠ¥æ–‡ä¸»ä½“éƒ¨åˆ†ã€‚ç”¨äºç¡®è®¤ URI çš„æœ‰æ•ˆæ€§åŠèµ„æºæ›´æ–°çš„æ—¥æœŸæ—¶é—´ç­‰ç­‰ï¼ˆæˆ‘æƒ³è¦é‚£ä¸ªç›¸å…³ä¿¡æ¯ï¼‰</td>
</tr>
<tr>
<td style="text-align:center">DELETE</td>
<td style="text-align:center">åˆ é™¤æ–‡ä»¶</td>
<td style="text-align:center">1.0ã€1.1</td>
<td style="text-align:center">ä¸ PUT ç›¸åçš„æ–¹æ³•ï¼ŒDELETE æ–¹æ³•æŒ‰è¯·æ±‚ URI åˆ é™¤æŒ‡å®šèµ„æºï¼ˆæŠŠè¿™ä»½æ–‡ä»¶åˆ æ‰å§ï¼‰</td>
</tr>
<tr>
<td style="text-align:center">OPTIONS</td>
<td style="text-align:center">è¯¢é—®æ”¯æŒçš„æ–¹æ³•</td>
<td style="text-align:center">1.1</td>
<td style="text-align:center">OPTIONS ç”¨æ¥æŸ¥è¯¢é’ˆå¯¹è¯·æ±‚ URI æŒ‡å®šçš„èµ„æºæ”¯æŒçš„æ–¹æ³•ï¼ˆä½ æ”¯æŒå“ªäº›æ–¹æ³•ï¼Ÿï¼‰</td>
</tr>
<tr>
<td style="text-align:center">TRACE</td>
<td style="text-align:center">è¿½è¸ªè·¯å¾„</td>
<td style="text-align:center">1.1</td>
<td style="text-align:center">TRACE æ–¹æ³•æ˜¯è®© Web æœåŠ¡å™¨å°†ä¹‹å‰çš„è¯·æ±‚é€šä¿¡è¿”å›ç»™å®¢æˆ·ç«¯çš„æ–¹æ³•ï¼ŒTRACE æ–¹æ³•ä¸å¸¸ç”¨ï¼Œå¹¶ä¸”å®¹æ˜“å¼•å‘ XST ( Cross-Site-Tracing ï¼Œè·¨ç«™è¿½è¸ª)æ”»å‡»ï¼Œæ‰€ä»¥é€šå¸¸æ›´ä¸ä¼šç”¨åˆ°äº†</td>
</tr>
<tr>
<td style="text-align:center">CONNECT</td>
<td style="text-align:center">è¦æ±‚ç”¨éš§é“åè®®è¿æ¥ä»£ç†</td>
<td style="text-align:center">1.1</td>
<td style="text-align:center">CONNECT æ–¹æ³•è¦æ±‚åœ¨ä¸ä»£ç†æœåŠ¡å™¨é€šä¿¡æ—¶å»ºç«‹éš§é“ï¼Œå®ç°ç”¨éš§é“åè®®è¿›è¡Œ TCP é€šä¿¡ï¼Œä¸»è¦ä½¿ç”¨ SSL ï¼ˆ Secure Sockets Layers ï¼Œå®‰å…¨å¥—æ¥å±‚ï¼‰å’Œ TLS ï¼ˆ Transport Layer Security ï¼Œä¼ è¾“å±‚å®‰å…¨ï¼‰åè®®æŠŠé€šä¿¡å†…å®¹åŠ å¯†åç»ç½‘ç»œéš§é“ä¼ è¾“</td>
</tr>
<tr>
<td style="text-align:center">PATCH</td>
<td style="text-align:center">æ›´æ–°éƒ¨åˆ†æ–‡ä»¶å†…å®¹</td>
<td style="text-align:center">1.1</td>
<td style="text-align:center"><strong>å½“èµ„æºå­˜åœ¨çš„æ—¶å€™</strong>ï¼ŒPATCH ç”¨äºèµ„æºçš„éƒ¨åˆ†å†…å®¹çš„æ›´æ–°ï¼Œä¾‹å¦‚æ›´æ–°æŸä¸€ä¸ªå­—æ®µã€‚å…·ä½“æ¯”å¦‚è¯´åªæ›´æ–°ç”¨æˆ·ä¿¡æ¯çš„ç”µè¯å·ç å­—æ®µï¼Œè€Œ PUT ç”¨äºæ›´æ–°æŸä¸ªèµ„æºè¾ƒå®Œæ•´çš„å†…å®¹ï¼Œæ¯”å¦‚è¯´ç”¨æˆ·è¦é‡å¡«å®Œæ•´è¡¨å•æ›´æ–°æ‰€æœ‰ä¿¡æ¯ï¼Œåå°å¤„ç†æ›´æ–°æ—¶å¯èƒ½åªæ˜¯ä¿ç•™å†…éƒ¨è®°å½• ID ä¸å˜ã€‚<br><strong>å½“èµ„æºä¸å­˜åœ¨çš„æ—¶å€™</strong>ï¼ŒPATCH æ˜¯ä¿®æ”¹åŸæ¥çš„å†…å®¹ï¼Œä¹Ÿå¯èƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ã€‚æ¯”å¦‚å½“èµ„æºä¸å­˜åœ¨çš„æ—¶å€™ï¼ŒPATCH å¯èƒ½ä¼šå»åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„æºï¼Œè¿™ä¸ªæ„ä¹‰ä¸Šåƒæ˜¯ saveOrUpdate æ“ä½œã€‚è€Œ PUT åªå¯¹å·²æœ‰èµ„æºè¿›è¡Œæ›´æ–°æ“ä½œï¼Œæ‰€ä»¥æ˜¯ update æ“ä½œ</td>
</tr>
<tr>
<td style="text-align:center">LINK</td>
<td style="text-align:center">å»ºç«‹å’Œèµ„æºä¹‹é—´çš„è”ç³»</td>
<td style="text-align:center">1.0</td>
<td style="text-align:center">âœ–ï¸æœ€æ–°ç‰ˆä¸­å·²ç»åºŸå¼ƒâœ–ï¸</td>
</tr>
<tr>
<td style="text-align:center">UNLINK</td>
<td style="text-align:center">æ–­å¼€è¿æ¥å…³ç³»</td>
<td style="text-align:center">1.0</td>
<td style="text-align:center">âœ–ï¸æœ€æ–°ç‰ˆä¸­å·²ç»åºŸå¼ƒâœ–ï¸</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">PROPFIND</td>
<td style="text-align:center">è·å–å±æ€§</td>
<td style="text-align:center">1.1</td>
<td style="text-align:center">WebDAV è·å–å±æ€§</td>
</tr>
<tr>
<td style="text-align:center">PROPPATCH</td>
<td style="text-align:center">ä¿®æ”¹å±æ€§</td>
<td style="text-align:center">1.1</td>
<td style="text-align:center">WebDAV ä¿®æ”¹å±æ€§</td>
</tr>
<tr>
<td style="text-align:center">MKCOL</td>
<td style="text-align:center">åˆ›å»ºå±æ€§</td>
<td style="text-align:center">1.1</td>
<td style="text-align:center">WebDAV åˆ›å»ºå±æ€§</td>
</tr>
<tr>
<td style="text-align:center">COPY</td>
<td style="text-align:center">å¤åˆ¶èµ„æºåŠå±æ€§</td>
<td style="text-align:center">1.1</td>
<td style="text-align:center">WebDAV å¤åˆ¶èµ„æºåŠå±æ€§</td>
</tr>
<tr>
<td style="text-align:center">MOVE</td>
<td style="text-align:center">ç§»åŠ¨èµ„æº</td>
<td style="text-align:center">1.1</td>
<td style="text-align:center">WebDAV ç§»åŠ¨èµ„æº</td>
</tr>
<tr>
<td style="text-align:center">LOCK</td>
<td style="text-align:center">èµ„æºåŠ é”</td>
<td style="text-align:center">1.1</td>
<td style="text-align:center">WebDAV èµ„æºåŠ é”</td>
</tr>
<tr>
<td style="text-align:center">UNLOCK</td>
<td style="text-align:center">èµ„æºè§£é”</td>
<td style="text-align:center">1.1</td>
<td style="text-align:center">WebDAV èµ„æºè§£é”</td>
</tr>
</tbody>
</table>
<p>åœ¨HTTP/1.1è§„èŒƒä¸­å¹‚ç­‰æ€§çš„å®šä¹‰æ˜¯ï¼š</p>
<blockquote>
<p>Methods can also have the property of â€œidempotenceâ€ in that (aside from error or expiration issues) the side-effects of N &gt; 0 identical requests is the same as for a single request.</p>
</blockquote>
<p>ä»å®šä¹‰ä¸Šçœ‹ï¼ŒHTTP æ–¹æ³•çš„å¹‚ç­‰æ€§æ˜¯æŒ‡ä¸€æ¬¡å’Œå¤šæ¬¡è¯·æ±‚æŸä¸€ä¸ªèµ„æºåº”è¯¥å…·æœ‰åŒæ ·çš„å‰¯ä½œç”¨ã€‚å¹‚ç­‰æ€§å±äºè¯­ä¹‰èŒƒç•´ï¼Œæ­£å¦‚ç¼–è¯‘å™¨åªèƒ½å¸®åŠ©æ£€æŸ¥è¯­æ³•é”™è¯¯ä¸€æ ·ï¼ŒHTTP è§„èŒƒä¹Ÿæ²¡æœ‰åŠæ³•é€šè¿‡æ¶ˆæ¯æ ¼å¼ç­‰è¯­æ³•æ‰‹æ®µæ¥å®šä¹‰å®ƒï¼Œè¿™å¯èƒ½æ˜¯å®ƒä¸å¤ªå—åˆ°é‡è§†çš„åŸå› ä¹‹ä¸€ã€‚ä½†å®é™…ä¸Šï¼Œå¹‚ç­‰æ€§æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ä¸­ååˆ†é‡è¦çš„æ¦‚å¿µï¼Œè€Œ HTTP çš„åˆ†å¸ƒå¼æœ¬è´¨ä¹Ÿå†³å®šäº†å®ƒåœ¨ HTTP ä¸­å…·æœ‰é‡è¦åœ°ä½ã€‚</p>
<p>HTTP æ–¹æ³•çš„å®‰å…¨æ€§æŒ‡çš„æ˜¯ä¸ä¼šæ”¹å˜æœåŠ¡å™¨çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªæ˜¯å¯è¯»çš„ã€‚æ‰€ä»¥åªæœ‰ OPTIONSã€GETã€HEAD æ˜¯å®‰å…¨çš„ï¼Œå…¶ä»–éƒ½æ˜¯ä¸å®‰å…¨çš„ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">HTTP æ–¹æ³•</th>
<th style="text-align:center">å¹‚ç­‰æ€§</th>
<th style="text-align:center">å®‰å…¨æ€§</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">OPTIONS</td>
<td style="text-align:center">yes</td>
<td style="text-align:center">yes</td>
</tr>
<tr>
<td style="text-align:center">GET</td>
<td style="text-align:center">yes</td>
<td style="text-align:center">yes</td>
</tr>
<tr>
<td style="text-align:center">HEAD</td>
<td style="text-align:center">yes</td>
<td style="text-align:center">yes</td>
</tr>
<tr>
<td style="text-align:center">PUT</td>
<td style="text-align:center">yes</td>
<td style="text-align:center">no</td>
</tr>
<tr>
<td style="text-align:center">DELETE</td>
<td style="text-align:center">yes</td>
<td style="text-align:center">no</td>
</tr>
<tr>
<td style="text-align:center">POST</td>
<td style="text-align:center">no</td>
<td style="text-align:center">no</td>
</tr>
<tr>
<td style="text-align:center">PATCH</td>
<td style="text-align:center">no</td>
<td style="text-align:center">no</td>
</tr>
</tbody>
</table>
<p><strong>POST å’Œ PATCH è¿™ä¸¤ä¸ªä¸æ˜¯å¹‚ç­‰æ€§çš„</strong>ã€‚<br>ä¸¤æ¬¡ç›¸åŒçš„POSTè¯·æ±‚ä¼šåœ¨æœåŠ¡å™¨ç«¯åˆ›å»ºä¸¤ä»½èµ„æºï¼Œå®ƒä»¬å…·æœ‰ä¸åŒçš„URIã€‚<br>å¯¹åŒä¸€URIè¿›è¡Œå¤šæ¬¡PUTçš„å‰¯ä½œç”¨å’Œä¸€æ¬¡PUTæ˜¯ç›¸åŒçš„ã€‚  </p>
<h1 id="HTTP-çŠ¶æ€ç "><a href="#HTTP-çŠ¶æ€ç " class="headerlink" title="HTTP çŠ¶æ€ç "></a>HTTP çŠ¶æ€ç </h1><p>æœåŠ¡å™¨è¿”å›çš„  <strong>å“åº”æŠ¥æ–‡</strong>  ä¸­ç¬¬ä¸€è¡Œä¸ºçŠ¶æ€è¡Œï¼ŒåŒ…å«äº†çŠ¶æ€ç ä»¥åŠåŸå› çŸ­è¯­ï¼Œç”¨æ¥å‘ŠçŸ¥å®¢æˆ·ç«¯è¯·æ±‚çš„ç»“æœã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">çŠ¶æ€ç </th>
<th style="text-align:center">ç±»åˆ«</th>
<th style="text-align:center">åŸå› çŸ­è¯­</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1XX</td>
<td style="text-align:center">Informationalï¼ˆä¿¡æ¯æ€§çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">æ¥æ”¶çš„è¯·æ±‚æ­£åœ¨å¤„ç†</td>
</tr>
<tr>
<td style="text-align:center">2XX</td>
<td style="text-align:center">Successï¼ˆæˆåŠŸçŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">è¯·æ±‚æ­£å¸¸å¤„ç†å®Œæ¯•</td>
</tr>
<tr>
<td style="text-align:center">3XX</td>
<td style="text-align:center">Redirectionï¼ˆé‡å®šå‘çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">éœ€è¦è¿›è¡Œé™„åŠ æ“ä½œä»¥å®Œæˆè¯·æ±‚</td>
</tr>
<tr>
<td style="text-align:center">4XX</td>
<td style="text-align:center">Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">æœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚</td>
</tr>
<tr>
<td style="text-align:center">5XX</td>
<td style="text-align:center">Server Errorï¼ˆæœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">æœåŠ¡å™¨å¤„ç†è¯·æ±‚å‡ºé”™</td>
</tr>
</tbody>
</table>
<h2 id="1XX-ä¿¡æ¯"><a href="#1XX-ä¿¡æ¯" class="headerlink" title="1XX ä¿¡æ¯"></a>1XX ä¿¡æ¯</h2><ul>
<li><strong>100 Continue</strong> ï¼šè¡¨æ˜åˆ°ç›®å‰ä¸ºæ­¢éƒ½å¾ˆæ­£å¸¸ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç»§ç»­å‘é€è¯·æ±‚æˆ–è€…å¿½ç•¥è¿™ä¸ªå“åº”ã€‚</li>
</ul>
<h2 id="2XX-æˆåŠŸ"><a href="#2XX-æˆåŠŸ" class="headerlink" title="2XX æˆåŠŸ"></a>2XX æˆåŠŸ</h2><ul>
<li><p><strong>200 OK</strong> </p>
</li>
<li><p><strong>204 No Content</strong> ï¼šè¯·æ±‚å·²ç»æˆåŠŸå¤„ç†ï¼Œä½†æ˜¯è¿”å›çš„å“åº”æŠ¥æ–‡ä¸åŒ…å«å®ä½“çš„ä¸»ä½“éƒ¨åˆ†ã€‚ä¸€èˆ¬åœ¨åªéœ€è¦ä»å®¢æˆ·ç«¯å¾€æœåŠ¡å™¨å‘é€ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦è¿”å›æ•°æ®æ—¶ä½¿ç”¨ã€‚</p>
</li>
<li><p><strong>206 Partial Content</strong> ï¼šè¡¨ç¤ºå®¢æˆ·ç«¯è¿›è¡Œäº†èŒƒå›´è¯·æ±‚ã€‚å“åº”æŠ¥æ–‡åŒ…å«ç”± Content-Range æŒ‡å®šèŒƒå›´çš„å®ä½“å†…å®¹ã€‚</p>
</li>
</ul>
<h2 id="3XX-é‡å®šå‘"><a href="#3XX-é‡å®šå‘" class="headerlink" title="3XX é‡å®šå‘"></a>3XX é‡å®šå‘</h2><ul>
<li><p><strong>301 Moved Permanently</strong> ï¼šæ°¸ä¹…æ€§é‡å®šå‘</p>
</li>
<li><p><strong>302 Found</strong> ï¼šä¸´æ—¶æ€§é‡å®šå‘</p>
</li>
<li><p><strong>303 See Other</strong> ï¼šå’Œ 302 æœ‰ç€ç›¸åŒçš„åŠŸèƒ½ï¼Œä½†æ˜¯ 303 æ˜ç¡®è¦æ±‚å®¢æˆ·ç«¯åº”è¯¥é‡‡ç”¨ GET æ–¹æ³•è·å–èµ„æºã€‚</p>
</li>
<li><p>æ³¨ï¼šè™½ç„¶ HTTP åè®®è§„å®š 301ã€302 çŠ¶æ€ä¸‹é‡å®šå‘æ—¶ä¸å…è®¸æŠŠ POST æ–¹æ³•æ”¹æˆ GET æ–¹æ³•ï¼Œä½†æ˜¯å¤§å¤šæ•°æµè§ˆå™¨éƒ½ä¼šåœ¨ 301ã€302 å’Œ 303 çŠ¶æ€ä¸‹çš„é‡å®šå‘æŠŠ POST æ–¹æ³•æ”¹æˆ GET æ–¹æ³•ã€‚</p>
</li>
<li><p><strong>304 Not Modified</strong> ï¼šå¦‚æœè¯·æ±‚æŠ¥æ–‡é¦–éƒ¨åŒ…å«ä¸€äº›æ¡ä»¶ï¼Œä¾‹å¦‚ï¼šIf-Matchï¼ŒIf-ModifiedSinceï¼ŒIf-None-Matchï¼ŒIf-Rangeï¼ŒIf-Unmodified-Sinceï¼Œå¦‚æœä¸æ»¡è¶³æ¡ä»¶ï¼Œåˆ™æœåŠ¡å™¨ä¼šè¿”å› 304 çŠ¶æ€ç ã€‚</p>
</li>
<li><p><strong>307 Temporary Redirect</strong> ï¼šä¸´æ—¶é‡å®šå‘ï¼Œä¸ 302 çš„å«ä¹‰ç±»ä¼¼ï¼Œä½†æ˜¯ 307 è¦æ±‚æµè§ˆå™¨ä¸ä¼šæŠŠé‡å®šå‘è¯·æ±‚çš„ POST æ–¹æ³•æ”¹æˆ GET æ–¹æ³•ã€‚</p>
</li>
</ul>
<h2 id="4XX-å®¢æˆ·ç«¯é”™è¯¯"><a href="#4XX-å®¢æˆ·ç«¯é”™è¯¯" class="headerlink" title="4XX å®¢æˆ·ç«¯é”™è¯¯"></a>4XX å®¢æˆ·ç«¯é”™è¯¯</h2><ul>
<li><p><strong>400 Bad Request</strong> ï¼šè¯·æ±‚æŠ¥æ–‡ä¸­å­˜åœ¨è¯­æ³•é”™è¯¯ã€‚</p>
</li>
<li><p><strong>401 Unauthorized</strong> ï¼šè¯¥çŠ¶æ€ç è¡¨ç¤ºå‘é€çš„è¯·æ±‚éœ€è¦æœ‰è®¤è¯ä¿¡æ¯ï¼ˆBASIC è®¤è¯ã€DIGEST è®¤è¯ï¼‰ã€‚å¦‚æœä¹‹å‰å·²è¿›è¡Œè¿‡ä¸€æ¬¡è¯·æ±‚ï¼Œåˆ™è¡¨ç¤ºç”¨æˆ·è®¤è¯å¤±è´¥ã€‚</p>
</li>
<li><p><strong>403 Forbidden</strong> ï¼šè¯·æ±‚è¢«æ‹’ç»ï¼ŒæœåŠ¡å™¨ç«¯æ²¡æœ‰å¿…è¦ç»™å‡ºæ‹’ç»çš„è¯¦ç»†ç†ç”±ã€‚</p>
</li>
<li><p><strong>404 Not Found</strong> </p>
</li>
</ul>
<h2 id="5XX-æœåŠ¡å™¨é”™è¯¯"><a href="#5XX-æœåŠ¡å™¨é”™è¯¯" class="headerlink" title="5XX æœåŠ¡å™¨é”™è¯¯"></a>5XX æœåŠ¡å™¨é”™è¯¯</h2><ul>
<li><p><strong>500 Internal Server Error</strong> ï¼šæœåŠ¡å™¨æ­£åœ¨æ‰§è¡Œè¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯ã€‚</p>
</li>
<li><p><strong>503 Service Unavilable</strong> ï¼šæœåŠ¡å™¨æš‚æ—¶å¤„äºè¶…è´Ÿè½½æˆ–æ­£åœ¨è¿›è¡Œåœæœºç»´æŠ¤ï¼Œç°åœ¨æ— æ³•å¤„ç†è¯·æ±‚ã€‚</p>
</li>
</ul>
<hr>
<h2 id="RFC-2616-çŠ¶æ€ç "><a href="#RFC-2616-çŠ¶æ€ç " class="headerlink" title="RFC 2616 çŠ¶æ€ç "></a>RFC 2616 çŠ¶æ€ç </h2><table>
<thead>
<tr>
<th style="text-align:center">çŠ¶æ€ç </th>
<th style="text-align:center">ç±»åˆ«</th>
<th style="text-align:center">åŸå› çŸ­è¯­</th>
<th style="text-align:center">å«ä¹‰</th>
<th style="text-align:center"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">100</td>
<td style="text-align:center">Informationalï¼ˆä¿¡æ¯æ€§çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Continueï¼ˆç»§ç»­ï¼‰</td>
<td style="text-align:center">æ”¶åˆ°äº†è¯·æ±‚çš„èµ·å§‹éƒ¨åˆ†ï¼Œå®¢æˆ·ç«¯åº”è¯¥ç»§ç»­è¯·æ±‚ã€‚</td>
<td style="text-align:center">â¤</td>
</tr>
<tr>
<td style="text-align:center">101</td>
<td style="text-align:center">Informationalï¼ˆä¿¡æ¯æ€§çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Switching Protocolsï¼ˆåˆ‡æ¢åè®®ï¼‰</td>
<td style="text-align:center">æœåŠ¡å™¨æ­£æ ¹æ®å®¢æˆ·ç«¯çš„æŒ‡ç¤ºå°†åè®®åˆ‡æ¢æˆ Update é¦–éƒ¨åˆ—å‡ºçš„åè®®ã€‚</td>
<td style="text-align:center">â¤</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">200</td>
<td style="text-align:center">Successï¼ˆæˆåŠŸçŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">OK</td>
<td style="text-align:center">æœåŠ¡å™¨å·²æˆåŠŸå¤„ç†è¯·æ±‚</td>
<td style="text-align:center">â¤</td>
</tr>
<tr>
<td style="text-align:center">201</td>
<td style="text-align:center">Successï¼ˆæˆåŠŸçŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Createdï¼ˆå·²åˆ›å»ºï¼‰</td>
<td style="text-align:center">å¯¹é‚£äº›è¦æœåŠ¡å™¨åˆ›å»ºå¯¹è±¡çš„è¯·æ±‚æ¥è¯´ï¼Œèµ„æºå·²åˆ›å»ºå®Œæ¯•</td>
</tr>
<tr>
<td style="text-align:center">202</td>
<td style="text-align:center">Successï¼ˆæˆåŠŸçŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Acceptedï¼ˆå·²æ¥å—ï¼‰</td>
<td style="text-align:center">è¯·æ±‚å·²æ¥å—ï¼Œä½†æœåŠ¡å™¨å°šæœªå¤„ç†</td>
</tr>
<tr>
<td style="text-align:center">203</td>
<td style="text-align:center">Successï¼ˆæˆåŠŸçŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Non-Authoritative Informationï¼ˆéæƒå¨ä¿¡æ¯ï¼‰</td>
<td style="text-align:center">æœåŠ¡å™¨å·²å°†äº‹åŠ¡æˆåŠŸå¤„ç†ï¼Œåªæ˜¯å®ä½“é¦–éƒ¨åŒ…å«çš„ä¿¡æ¯ä¸æ˜¯æ¥è‡ªåŸå§‹æœåŠ¡å™¨ï¼Œè€Œæ˜¯æ¥è‡ªèµ„æºçš„å‰¯æœ¬</td>
</tr>
<tr>
<td style="text-align:center">204</td>
<td style="text-align:center">Successï¼ˆæˆåŠŸçŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">No Contentï¼ˆæ²¡æœ‰å†…å®¹ï¼‰</td>
<td style="text-align:center">å“åº”æŠ¥æ–‡åŒ…å«ä¸€äº›é¦–éƒ¨å’Œä¸€ä¸ªçŠ¶æ€è¡Œï¼Œ<strong>ä½†ä¸åŒ…å«å®ä½“çš„ä¸»ä½“å†…å®¹</strong>ï¼Œ<strong>ä¸€èˆ¬åœ¨åªéœ€è¦ä»å®¢æˆ·ç«¯å¾€æœåŠ¡å™¨å‘é€ä¿¡æ¯ï¼Œè€Œå¯¹å®¢æˆ·ç«¯ä¸éœ€è¦å‘é€æ–°ä¿¡æ¯å†…å®¹çš„æƒ…å†µä¸‹ä½¿ç”¨</strong></td>
<td style="text-align:center">â¤</td>
</tr>
<tr>
<td style="text-align:center">205</td>
<td style="text-align:center">Successï¼ˆæˆåŠŸçŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Reset Contentï¼ˆé‡ç½®å†…å®¹ï¼‰</td>
<td style="text-align:center">å¦ä¸€ä¸ªä¸»è¦ç”¨äºæµè§ˆå™¨çš„ä»£ç ã€‚æ„æ€æ˜¯æµè§ˆå™¨åº”è¯¥é‡ç½®å½“å‰é¡µé¢ä¸Šæ‰€æœ‰çš„ HTML è¡¨å•</td>
</tr>
<tr>
<td style="text-align:center">206</td>
<td style="text-align:center">Successï¼ˆæˆåŠŸçŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Partial Contentï¼ˆéƒ¨åˆ†å†…å®¹ï¼‰</td>
<td style="text-align:center">æˆåŠŸæ‰§è¡Œäº†ä¸€ä¸ªéƒ¨åˆ†æˆ–è€… Range (èŒƒå›´)è¯·æ±‚ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ä¸€äº›ç‰¹æ®Šçš„é¦–éƒ¨æ¥è·å–éƒ¨åˆ†æˆ–æŸä¸ªèŒƒå›´å†…çš„æ–‡æ¡£<br><strong>å“åº”æŠ¥æ–‡ä¸­åŒ…å«ç”± Content-Rangeã€Dateã€ä»¥åŠ ETag æˆ–è€… Content-Location æŒ‡å®šèŒƒå›´çš„å®ä½“å†…å®¹</strong></td>
<td style="text-align:center">â¤</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">300</td>
<td style="text-align:center">Redirectionï¼ˆé‡å®šå‘çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Multiple Choicesï¼ˆå¤šé¡¹é€‰æ‹©ï¼‰</td>
<td style="text-align:center">å®¢æˆ·ç«¯è¯·æ±‚äº†å®é™…æŒ‡å‘å¤šä¸ªèµ„æºçš„ URLã€‚è¿™ä¸ªä»£ç æ˜¯å’Œä¸€ä¸ªé€‰é¡¹åˆ—è¡¨ä¸€èµ·è¿”å›çš„ï¼Œç„¶åç”¨æˆ·å°±å¯ä»¥é€‰æ‹©ä»–å¸Œæœ›ä½¿ç”¨çš„é€‰é¡¹äº†ã€‚æœåŠ¡å™¨å¯ä»¥åœ¨ Location é¦–éƒ¨åŒ…å«é¦–é€‰ URL</td>
</tr>
<tr>
<td style="text-align:center">301</td>
<td style="text-align:center">Redirectionï¼ˆé‡å®šå‘çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Moved Permanentlyï¼ˆæ°¸ä¹…ç§»é™¤ï¼‰</td>
<td style="text-align:center"><strong>æ°¸ä¹…æ€§é‡å®šå‘</strong>ï¼Œè¯·æ±‚çš„ URL å·²ç§»èµ°ã€‚å“åº”ä¸­åº”è¯¥åŒ…å«ä¸€ä¸ª Location URLï¼Œè¯´æ˜èµ„æºç°åœ¨æ‰€å¤„çš„ä½ç½®</td>
<td style="text-align:center">â¤</td>
</tr>
<tr>
<td style="text-align:center">302</td>
<td style="text-align:center">Redirectionï¼ˆé‡å®šå‘çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Foundï¼ˆå·²æ‰¾åˆ°ï¼‰</td>
<td style="text-align:center"><strong>ä¸´æ—¶æ€§é‡å®šå‘</strong>ï¼Œä¸çŠ¶æ€ç  301 ç±»ä¼¼ï¼Œ ä½†è¿™é‡Œçš„ç§»é™¤æ˜¯ä¸´æ—¶çš„ã€‚å®¢æˆ·ç«¯åº”è¯¥ç”¨ Location é¦–éƒ¨ç»™å‡ºçš„ URL å¯¹èµ„æºè¿›è¡Œä¸´æ—¶å®šä½</td>
<td style="text-align:center">â¤</td>
</tr>
<tr>
<td style="text-align:center">303</td>
<td style="text-align:center">Redirectionï¼ˆé‡å®šå‘çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">See Otherï¼ˆå‚è§å…¶ä»–ï¼‰</td>
<td style="text-align:center">å‘Šè¯‰å®¢æˆ·ç«¯åº”è¯¥ç”¨å¦ä¸€ä¸ª URL è·å–èµ„æºã€‚è¿™ä¸ªæ–°çš„ URL ä½äºå“åº”æŠ¥æ–‡çš„ Location é¦–éƒ¨ã€‚303 çŠ¶æ€ç  å’Œ 302 çŠ¶æ€ç æœ‰ç›¸åŒçš„åŠŸèƒ½ï¼Œ<strong>ä½†æ˜¯ 303 æ˜ç¡®è¡¨ç¤ºå®¢æˆ·ç«¯åº”é‡‡ç”¨ GET æ–¹æ³•è·å–èµ„æº</strong>ã€‚</td>
<td style="text-align:center">â¤</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">å½“ 301ã€302ã€303 å“åº”çŠ¶æ€ç è¿”å›æ—¶ï¼Œå‡ ä¹æ‰€æœ‰çš„æµè§ˆå™¨éƒ½ä¼šæŠŠ POST æ”¹æˆ GETï¼Œå¹¶åˆ é™¤è¯·æ±‚æŠ¥æ–‡å†…çš„ä¸»ä½“ï¼Œä¹‹åè¯·æ±‚ä¼šè‡ªåŠ¨å†æ¬¡å‘é€ã€‚<br>301ã€302 æ ‡å‡†æ˜¯ç¦æ­¢å°† POST æ–¹æ³•æ”¹å˜æˆ GET æ–¹æ³•çš„ï¼Œä½†å®é™…ä½¿ç”¨æ—¶å¤§å®¶éƒ½ä¼šè¿™ä¹ˆåš</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">304</td>
<td style="text-align:center">Redirectionï¼ˆé‡å®šå‘çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Not Modifiedï¼ˆæœªä¿®æ”¹ï¼‰</td>
<td style="text-align:center">è¯¥çŠ¶æ€ç è¡¨ç¤ºå®¢æˆ·ç«¯å‘é€é™„å¸¦æ¡ä»¶çš„è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨å…è®¸è¯·æ±‚è®¿é—®èµ„æºï¼Œä½†å› å‘ç”Ÿè¯·æ±‚æœªæ»¡è¶³æ¡ä»¶çš„æƒ…å†µåï¼Œç›´æ¥è¿”å› 304 Not Modifiedï¼ˆæœåŠ¡å™¨ç«¯èµ„æºæœªæ”¹å˜ï¼Œå¯ç›´æ¥ä½¿ç”¨å®¢æˆ·ç«¯æœªè¿‡æœŸçš„ç¼“å­˜ï¼‰304 çŠ¶æ€ç è¿”å›æ—¶ï¼Œä¸åŒ…å«ä»»ä½•å“åº”çš„ä¸»ä½“éƒ¨åˆ†ã€‚<strong>304 è™½ç„¶è¢«åˆ’åˆ†åœ¨ 3XX ç±»åˆ«ä¸­ï¼Œä½†æ˜¯å’Œé‡å®šå‘ä¸€ç‚¹å…³ç³»ä¹Ÿæ²¡æœ‰</strong></td>
<td style="text-align:center">â¤</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">ï¼ˆé™„å¸¦æ¡ä»¶çš„è¯·æ±‚æ˜¯æŒ‡é‡‡ç”¨ GET æ–¹æ³•çš„è¯·æ±‚æŠ¥æ–‡ä¸­åŒ…å« If-Matchï¼ŒIf-Modified-Since,If-None-Matchï¼ŒIf-Rangeï¼ŒIf-Unmodified-Since ä¸­ä»»ä¸€é¦–éƒ¨ï¼‰</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">305</td>
<td style="text-align:center">Redirectionï¼ˆé‡å®šå‘çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Use Proxyï¼ˆä½¿ç”¨ä»£ç†ï¼‰</td>
<td style="text-align:center">å¿…é¡»é€šè¿‡ä»£ç†è®¿é—® èµ„æºï¼Œä»£ç†çš„ä½ç½®æ˜¯åœ¨ Location é¦–éƒ¨ä¸­ç»™å‡ºçš„</td>
</tr>
<tr>
<td style="text-align:center">306</td>
<td style="text-align:center">ï¼ˆæœªä½¿ç”¨ï¼‰</td>
<td style="text-align:center"></td>
<td style="text-align:center">è¿™ä¸ªçŠ¶æ€ç å½“å‰å¹¶æœªä½¿ç”¨</td>
</tr>
<tr>
<td style="text-align:center">307</td>
<td style="text-align:center">Redirectionï¼ˆé‡å®šå‘çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Temporary Redirectï¼ˆä¸´æ—¶é‡å®šå‘ï¼‰</td>
<td style="text-align:center">å’ŒçŠ¶æ€ç  302 ç±»ä¼¼ã€‚ä½†å®¢æˆ·ç«¯åº”è¯¥ç”¨ Location é¦–éƒ¨ç»™å‡ºçš„ URL å¯¹èµ„æºè¿›è¡Œä¸´æ—¶å®šä½ã€‚<br>307 ä¼šéµå®ˆæµè§ˆå™¨æ ‡å‡†ï¼Œä¸ä¼šä» POST å˜æˆ GET</td>
<td style="text-align:center">â¤</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">400</td>
<td style="text-align:center">Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Bad requestï¼ˆåè¯·æ±‚ï¼‰</td>
<td style="text-align:center">å‘Šè¯‰å®¢æˆ·ç«¯å®ƒå‘é€äº†ä¸€æ¡å¼‚å¸¸è¯·æ±‚</td>
<td style="text-align:center">â¤</td>
</tr>
<tr>
<td style="text-align:center">401</td>
<td style="text-align:center">Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Unauthorizedï¼ˆæœªæˆæƒï¼‰</td>
<td style="text-align:center">ä¸é€‚å½“çš„é¦–éƒ¨ä¸€èµ·è¿”å›ï¼Œåœ¨å®¢æˆ·ç«¯è·å¾—èµ„æºè®¿é—®æƒä¹‹å‰ï¼Œè¯·å®ƒè¿›è¡Œèº«ä»½è®¤è¯</td>
<td style="text-align:center">â¤</td>
</tr>
<tr>
<td style="text-align:center">402</td>
<td style="text-align:center">Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Payment Requiredï¼ˆè¦æ±‚ä»˜æ¬¾ï¼‰</td>
<td style="text-align:center">å½“å‰æ­¤çŠ¶æ€ç å¹¶æœªä½¿ç”¨ï¼Œæ˜¯ä¸ºæœªæ¥ä½¿ç”¨é¢„ç•™çš„</td>
</tr>
<tr>
<td style="text-align:center">403</td>
<td style="text-align:center">Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Forbiddenï¼ˆç¦æ­¢ï¼‰</td>
<td style="text-align:center">æœåŠ¡å™¨æ‹’ç»äº†è¯·æ±‚</td>
<td style="text-align:center">â¤</td>
</tr>
<tr>
<td style="text-align:center">404</td>
<td style="text-align:center">Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Not Foundï¼ˆæœªæ‰¾åˆ°ï¼‰</td>
<td style="text-align:center">æœåŠ¡å™¨æ— æ³•æ‰¾åˆ° æ‰€è¯·æ±‚çš„ URL</td>
<td style="text-align:center">â¤</td>
</tr>
<tr>
<td style="text-align:center">405</td>
<td style="text-align:center">Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Method Not Allowedï¼ˆä¸å…è®¸ä½¿ç”¨çš„æ–¹æ³•ï¼‰</td>
<td style="text-align:center">è¯·æ±‚ä¸­æœ‰ä¸€ä¸ªæ‰€è¯·æ±‚çš„ URI ä¸æ”¯æŒçš„æ–¹æ³•ã€‚å“åº”ä¸­åº”è¯¥åŒ…å«ä¸€ä¸ª Allow é¦–éƒ¨ï¼Œä»¥å‘ŠçŸ¥å®¢æˆ·ç«¯æ‰€è¯·æ±‚çš„èµ„æºæ”¯æŒä½¿ç”¨å“ªäº›æ–¹æ³•</td>
</tr>
<tr>
<td style="text-align:center">406</td>
<td style="text-align:center">Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Not Acceptableï¼ˆæ— æ³•æ¥å—ï¼‰</td>
<td style="text-align:center">å®¢æˆ·ç«¯å¯ä»¥æŒ‡å®šä¸€äº›å‚æ•°æ¥è¯´æ˜å¸Œæœ›æ¥å—å“ªäº›ç±»å‹çš„å®ä½“ã€‚æœåŠ¡å™¨æ²¡æœ‰èµ„æºä¸å®¢æˆ·ç«¯å¯æ¥å—çš„ URL ç›¸åŒ¹é…æ—¶å¯ä½¿ç”¨æ­¤ä»£ç </td>
</tr>
<tr>
<td style="text-align:center">407</td>
<td style="text-align:center">Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Proxy Authentication Requiredï¼ˆè¦æ±‚è¿›è¡Œä»£ç†è®¤è¯ï¼‰</td>
<td style="text-align:center">å’ŒçŠ¶æ€ç  401 ç±»ä¼¼ï¼Œä½†ç”¨äºéœ€è¦è¿›è¡Œèµ„æºè®¤è¯çš„ä»£ç†æœåŠ¡å™¨</td>
</tr>
<tr>
<td style="text-align:center">408</td>
<td style="text-align:center">Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Request Timeoutï¼ˆè¯·æ±‚è¶…æ—¶ï¼‰</td>
<td style="text-align:center">å¦‚æœå®¢æˆ·ç«¯å®Œæˆå…¶è¯·æ±‚æ—¶èŠ±è´¹çš„æ—¶é—´å¤ªé•¿ï¼ŒæœåŠ¡å™¨å¯ä»¥å›é€è¿™ä¸ªçŠ¶æ€ç å¹¶å…³é—­è¿æ¥</td>
</tr>
<tr>
<td style="text-align:center">409</td>
<td style="text-align:center">Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Conflictï¼ˆ å†²çªï¼‰</td>
<td style="text-align:center">å‘å‡ºçš„è¯·æ±‚åœ¨èµ„æºä¸Šé€ æˆäº†ä¸€äº›å†²çª</td>
</tr>
<tr>
<td style="text-align:center">410</td>
<td style="text-align:center">Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Goneï¼ˆæ¶ˆå¤±äº†ï¼‰</td>
<td style="text-align:center">é™¤äº†æœåŠ¡å™¨æ›¾æŒæœ‰è¿™äº›èµ„æºä¹‹å¤–ï¼Œä¸çŠ¶æ€ç  404 ç±»ä¼¼</td>
</tr>
<tr>
<td style="text-align:center">411</td>
<td style="text-align:center">Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Length Requiredï¼ˆè¦æ±‚é•¿åº¦æŒ‡ç¤ºï¼‰</td>
<td style="text-align:center">æœåŠ¡å™¨è¦æ±‚åœ¨è¯·æ±‚æŠ¥æ–‡ä¸­åŒ…å« Content- Length é¦–éƒ¨æ—¶ä¼šä½¿ç”¨è¿™ä¸ªä»£ç ã€‚å‘èµ·çš„è¯·æ±‚ä¸­è‹¥æ²¡æœ‰ Content-Length é¦–éƒ¨ï¼ŒæœåŠ¡å™¨ æ˜¯ä¸ä¼šæ¥å—æ­¤èµ„æºè¯·æ±‚çš„</td>
</tr>
<tr>
<td style="text-align:center">412</td>
<td style="text-align:center">Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Precondition Failedï¼ˆå…ˆå†³æ¡ä»¶å¤±è´¥ï¼‰</td>
<td style="text-align:center">å¦‚æœå®¢æˆ·ç«¯å‘èµ·äº†ä¸€ä¸ªæ¡ä»¶è¯·æ±‚ï¼Œ å¦‚æœæœåŠ¡å™¨æ— æ³•æ»¡è¶³å…¶ä¸­çš„æŸä¸ªæ¡ä»¶ï¼Œå°±è¿”å›è¿™ä¸ªå“åº”ç </td>
</tr>
<tr>
<td style="text-align:center">413</td>
<td style="text-align:center">Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Request Entity Too Largeï¼ˆè¯·æ±‚å®ä½“å¤ªå¤§ï¼‰</td>
<td style="text-align:center">å®¢æˆ·ç«¯å‘é€çš„å®ä½“ä¸»ä½“éƒ¨åˆ†æ¯” æœåŠ¡å™¨èƒ½å¤Ÿæˆ–è€…å¸Œæœ›å¤„ç†çš„è¦å¤§</td>
</tr>
<tr>
<td style="text-align:center">414</td>
<td style="text-align:center">Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Request URI Too Longï¼ˆè¯·æ±‚ URI å¤ªé•¿ï¼‰</td>
<td style="text-align:center">å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚æ‰€æºå¸¦çš„è¯·æ±‚ URL è¶…è¿‡äº†æœåŠ¡å™¨èƒ½å¤Ÿæˆ–è€…å¸Œæœ›å¤„ç†çš„é•¿åº¦</td>
</tr>
<tr>
<td style="text-align:center">415</td>
<td style="text-align:center">Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Unsupported Media Typeï¼ˆä¸æ”¯æŒçš„åª’ä½“ç±»å‹ï¼‰</td>
<td style="text-align:center">æœåŠ¡å™¨æ— æ³•ç†è§£æˆ–ä¸æ”¯æŒå®¢æˆ·ç«¯æ‰€å‘é€çš„å®ä½“çš„å†…å®¹ç±»å‹</td>
</tr>
<tr>
<td style="text-align:center">416</td>
<td style="text-align:center">Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Requested Range Not Satisfiableï¼ˆæ‰€è¯·æ±‚çš„èŒƒå›´æœªå¾—åˆ°æ»¡è¶³ï¼‰</td>
<td style="text-align:center">è¯·æ±‚æŠ¥æ–‡è¯·æ±‚çš„æ˜¯æŸèŒƒå›´å†…çš„æŒ‡å®šèµ„æºï¼Œä½†é‚£ä¸ªèŒƒå›´æ— æ•ˆï¼Œæˆ–è€…æœªå¾—åˆ°æ»¡è¶³</td>
</tr>
<tr>
<td style="text-align:center">417</td>
<td style="text-align:center">Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Expectation Failedï¼ˆæ— æ³•æ»¡è¶³æœŸæœ›ï¼‰</td>
<td style="text-align:center">è¯·æ±‚çš„ Expect é¦–éƒ¨åŒ…å«äº†ä¸€ä¸ªé¢„æœŸå†…å®¹ï¼Œä½†æœåŠ¡å™¨æ— æ³•æ»¡è¶³</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">500</td>
<td style="text-align:center">Server Errorï¼ˆæœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Internal Server Errorï¼ˆå†…éƒ¨æœåŠ¡å™¨é”™è¯¯ï¼‰</td>
<td style="text-align:center">æœåŠ¡å™¨é‡åˆ°äº†ä¸€ä¸ªé”™è¯¯ï¼Œä½¿å…¶æ— æ³•ä¸ºè¯·æ±‚æä¾›æœåŠ¡</td>
<td style="text-align:center">â¤</td>
</tr>
<tr>
<td style="text-align:center">501</td>
<td style="text-align:center">Server Errorï¼ˆæœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Not Implementedï¼ˆæœªå®ç°ï¼‰</td>
<td style="text-align:center">æœåŠ¡å™¨æ— æ³•æ»¡è¶³å®¢æˆ·ç«¯è¯·æ±‚çš„æŸä¸ªåŠŸèƒ½</td>
</tr>
<tr>
<td style="text-align:center">502</td>
<td style="text-align:center">Server Errorï¼ˆæœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Bad Gatewayï¼ˆç½‘å…³æ•…éšœï¼‰</td>
<td style="text-align:center">ä½œä¸ºä»£ç†æˆ–ç½‘å…³ä½¿ç”¨çš„æœåŠ¡å™¨é‡åˆ°äº†æ¥è‡ªå“åº”é“¾ä¸­ä¸Šæ¸¸çš„æ— æ•ˆå“åº”</td>
</tr>
<tr>
<td style="text-align:center">503</td>
<td style="text-align:center">Server Errorï¼ˆæœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Service Unavailableï¼ˆæœªæä¾›æ­¤æœåŠ¡ï¼‰</td>
<td style="text-align:center">æœåŠ¡å™¨ç›®å‰æ— æ³•ä¸ºè¯·æ±‚æä¾›æœåŠ¡ï¼Œä½†è¿‡ä¸€æ®µæ—¶é—´å°±å¯ä»¥æ¢å¤æœåŠ¡</td>
<td style="text-align:center">â¤</td>
</tr>
<tr>
<td style="text-align:center">504</td>
<td style="text-align:center">Server Errorï¼ˆæœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Gateway Timeoutï¼ˆç½‘å…³è¶…æ—¶ï¼‰</td>
<td style="text-align:center">ä¸çŠ¶æ€ç  408 ç±»ä¼¼ï¼Œä½†æ˜¯å“åº”æ¥è‡ªç½‘å…³æˆ–ä»£ç†ï¼Œæ­¤ç½‘å…³æˆ–ä»£ç†åœ¨ç­‰å¾…å¦ä¸€å°æœåŠ¡å™¨çš„å“åº”æ—¶å‡ºç°äº†è¶…æ—¶</td>
</tr>
<tr>
<td style="text-align:center">505</td>
<td style="text-align:center">Server Errorï¼ˆæœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">HTTP Version Not Supportedï¼ˆä¸æ”¯æŒçš„ HTTP ç‰ˆæœ¬ï¼‰</td>
<td style="text-align:center">æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚æ˜¯ä»¥å®ƒä¸æ”¯æŒæˆ–ä¸æ„¿æ”¯æŒçš„åè®®ç‰ˆæœ¬è¡¨ç¤ºçš„</td>
</tr>
</tbody>
</table>
<blockquote>
<p>åœ¨ RFC2616 ä¸­å®šä¹‰äº† 40 ç§ HTTP çŠ¶æ€ç ï¼ŒwebDAV ( Web-based Distributed Authoring and Versioningï¼ŒåŸºäºä¸‡ç»´ç½‘çš„åˆ†å¸ƒå¼åˆ›ä½œå’Œç‰ˆæœ¬æ§åˆ¶)åœ¨ RFC4918 å’Œ RFC5842 ä¸­ï¼Œå®šä¹‰äº†ä¸€äº›ç‰¹æ®Šçš„çŠ¶æ€ç ï¼Œåœ¨ RFC2518ã€RFC2817ã€RFC2295ã€RFC2774ã€RFC6585 ä¸­è¿˜é¢å¤–å®šä¹‰äº†ä¸€äº›é™„åŠ çš„ HTTP çŠ¶æ€ç ã€‚æ€»å…±æœ‰ 60+ ç§ã€‚å…·ä½“é“¾æ¥å¯ä»¥è§ <a href="https://zh.wikipedia.org/wiki/HTTP%E7%8A%B6%E6%80%81%E7%A0%81" target="_blank" rel="noopener">HTTPçŠ¶æ€ç  (wikipedia)</a></p>
</blockquote>
<p>webDAV æ–°å¢çŠ¶æ€ç </p>
<table>
<thead>
<tr>
<th style="text-align:center">çŠ¶æ€ç </th>
<th style="text-align:center">ç±»åˆ«</th>
<th style="text-align:center">åŸå› çŸ­è¯­</th>
<th style="text-align:center">å«ä¹‰</th>
<th style="text-align:center"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">102</td>
<td style="text-align:center">Informationalï¼ˆä¿¡æ¯æ€§çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Processingï¼ˆå¤„ç†ä¸­ï¼‰</td>
<td style="text-align:center">å¯æ­£å¸¸å¤„ç†è¯·æ±‚ï¼Œä½†ç›®å‰æ˜¯å¤„ç†ä¸­çŠ¶æ€ã€‚WebDAVè¯·æ±‚å¯èƒ½åŒ…å«è®¸å¤šæ¶‰åŠæ–‡ä»¶æ“ä½œçš„å­è¯·æ±‚ï¼Œéœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½å®Œæˆè¯·æ±‚ã€‚è¯¥ä»£ç è¡¨ç¤ºâ€‹â€‹æœåŠ¡å™¨å·²ç»æ”¶åˆ°å¹¶æ­£åœ¨å¤„ç†è¯·æ±‚ï¼Œä½†æ— å“åº”å¯ç”¨ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢å®¢æˆ·ç«¯è¶…æ—¶ï¼Œå¹¶å‡è®¾è¯·æ±‚ä¸¢å¤±ã€‚</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">207</td>
<td style="text-align:center">Successï¼ˆæˆåŠŸçŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Multi-Statusï¼ˆå¤šç§çŠ¶æ€ï¼‰</td>
<td style="text-align:center">å­˜åœ¨å¤šç§çŠ¶æ€ã€‚ä»£è¡¨ä¹‹åçš„æ¶ˆæ¯ä½“å°†æ˜¯ä¸€ä¸ª XML æ¶ˆæ¯ï¼Œå¹¶ä¸”å¯èƒ½ä¾ç…§ä¹‹å‰å­è¯·æ±‚æ•°é‡çš„ä¸åŒï¼ŒåŒ…å«ä¸€ç³»åˆ—ç‹¬ç«‹çš„å“åº”ä»£ç ã€‚</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">208</td>
<td style="text-align:center">Successï¼ˆæˆåŠŸçŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Already Reportedï¼ˆå·²ç»å“åº”ï¼‰</td>
<td style="text-align:center">DAVç»‘å®šçš„æˆå‘˜å·²ç»åœ¨ï¼ˆå¤šçŠ¶æ€ï¼‰å“åº”ä¹‹å‰çš„éƒ¨åˆ†è¢«åˆ—ä¸¾ï¼Œä¸”æœªè¢«å†æ¬¡åŒ…å«ã€‚</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">422</td>
<td style="text-align:center">Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Unprocessable Entityï¼ˆä¸å¯å¤„ç†çš„å®ä½“ï¼‰</td>
<td style="text-align:center">æ ¼å¼æ­£ç¡®ï¼Œå†…å®¹æœ‰è¯¯ï¼Œæ— æ³•å¤„ç†å“åº”</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">423</td>
<td style="text-align:center">Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Lockedï¼ˆè¢«é”å®šï¼‰</td>
<td style="text-align:center">èµ„æºå·²è¢«åŠ é”</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">424</td>
<td style="text-align:center">Client Errorï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Failed Dependencyï¼ˆå¤±è´¥çš„ä¾èµ–ï¼‰</td>
<td style="text-align:center">å¤„ç†ä¸æŸè¯·æ±‚å…³è”çš„è¯·æ±‚å¤±è´¥ï¼Œå› ä¸ºä¸å†ç»´æŒä¾èµ–å…³ç³»ã€‚</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">507</td>
<td style="text-align:center">Server Errorï¼ˆæœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Insufficient Storageï¼ˆå­˜å‚¨ç©ºé—´ä¸è¶³ï¼‰</td>
<td style="text-align:center">æœåŠ¡å™¨æ— æ³•å­˜å‚¨å®Œæˆè¯·æ±‚æ‰€å¿…é¡»çš„å†…å®¹ã€‚è¿™ä¸ªçŠ¶å†µè¢«è®¤ä¸ºæ˜¯ä¸´æ—¶çš„ã€‚</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">508</td>
<td style="text-align:center">Server Errorï¼ˆæœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç ï¼‰</td>
<td style="text-align:center">Loop Detectedï¼ˆæ£€æµ‹åˆ°ç¯ï¼‰</td>
<td style="text-align:center">æœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶é™·å…¥æ­»å¾ªç¯ã€‚</td>
</tr>
</tbody>
</table>
<h1 id="MIME-åª’ä½“å†…å®¹"><a href="#MIME-åª’ä½“å†…å®¹" class="headerlink" title="MIME åª’ä½“å†…å®¹"></a>MIME åª’ä½“å†…å®¹</h1><p>HTTP ä»”ç»†åœ°ç»™æ¯ç§è¦é€šè¿‡ Web ä¼ è¾“çš„å¯¹è±¡éƒ½æ‰“ä¸Šäº†åä¸º MIME ç±»å‹ï¼ˆMIME typeï¼‰çš„æ•°æ®æ ¼å¼æ ‡ç­¾ã€‚æœ€åˆè®¾è®¡ MIMEï¼ˆMultipurpose Internet Mail Extensionï¼Œå¤šç”¨é€”å› ç‰¹ç½‘é‚®ä»¶æ‰©å±•ï¼‰æ˜¯ä¸ºäº†è§£å†³åœ¨ä¸åŒçš„ç”µå­é‚®ä»¶ç³»ç»Ÿä¹‹é—´æ¬ç§»æŠ¥æ–‡æ—¶å­˜åœ¨çš„é—®é¢˜ã€‚MIME åœ¨ç”µå­é‚®ä»¶ç³»ç»Ÿä¸­å·¥ä½œå¾—éå¸¸å¥½ï¼Œå› æ­¤ HTTP ä¹Ÿé‡‡çº³äº†å®ƒï¼Œç”¨å®ƒæ¥æè¿°å¹¶æ ‡è®°å¤šåª’ä½“å†…å®¹ã€‚</p>
<p>RFC2045ï¼Œâ€œ MIME: Format of Internet Message Bodiesâ€ï¼ˆâ€œ MIMEï¼šå› ç‰¹ç½‘æŠ¥æ–‡ä¸»ä½“çš„æ ¼å¼â€ï¼‰</p>
<p>å¸¸è§çš„ä¸» MIME ç±»å‹</p>
<table>
<thead>
<tr>
<th style="text-align:center">ç±»å‹</th>
<th style="text-align:center">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">application</td>
<td style="text-align:center">åº”ç”¨ç¨‹åºç‰¹æœ‰çš„å†…å®¹æ ¼å¼ï¼ˆç¦»æ•£ç±»å‹ï¼‰</td>
</tr>
<tr>
<td style="text-align:center">audio</td>
<td style="text-align:center">éŸ³é¢‘æ ¼å¼ï¼ˆç¦»æ•£ç±»å‹ï¼‰</td>
</tr>
<tr>
<td style="text-align:center">chemical</td>
<td style="text-align:center">åŒ–å­¦æ•°æ®é›†ï¼ˆç¦»æ•£ IETF æ‰©å±•ç±»å‹ï¼‰</td>
</tr>
<tr>
<td style="text-align:center">image</td>
<td style="text-align:center">å›¾ç‰‡æ ¼å¼ï¼ˆç¦»æ•£ç±»å‹ï¼‰</td>
</tr>
<tr>
<td style="text-align:center">message</td>
<td style="text-align:center">æŠ¥æ–‡æ ¼å¼ï¼ˆå¤åˆç±»å‹ï¼‰</td>
</tr>
<tr>
<td style="text-align:center">model</td>
<td style="text-align:center">ä¸‰ç»´æ¨¡å‹æ ¼å¼ï¼ˆç¦»æ•£ IETF æ‰©å±•ç±»å‹ï¼‰</td>
</tr>
<tr>
<td style="text-align:center">multipart</td>
<td style="text-align:center">å¤šéƒ¨åˆ†å¯¹è±¡é›†åˆï¼ˆå¤åˆç±»å‹ï¼‰</td>
</tr>
<tr>
<td style="text-align:center">text</td>
<td style="text-align:center">æ–‡æœ¬æ ¼å¼ï¼ˆç¦»æ•£ç±»å‹ï¼‰</td>
</tr>
<tr>
<td style="text-align:center">video</td>
<td style="text-align:center">è§†é¢‘ç”µå½±æ ¼å¼ï¼ˆç¦»æ•£ç±»å‹ï¼‰</td>
</tr>
</tbody>
</table>
<h1 id="HTTP-æŠ¥æ–‡ç»“æ„"><a href="#HTTP-æŠ¥æ–‡ç»“æ„" class="headerlink" title="HTTP æŠ¥æ–‡ç»“æ„"></a>HTTP æŠ¥æ–‡ç»“æ„</h1><p><a href="http://idiotsky.top/images3/http-summary-1.png"><img src="http://idiotsky.top/images3/http-summary-1.png" alt=""></a></p>
<p><a href="http://idiotsky.top/images3/http-summary-2.png"><img src="http://idiotsky.top/images3/http-summary-2.png" alt=""></a></p>
<p><a href="http://idiotsky.top/images3/http-summary-3.png"><img src="http://idiotsky.top/images3/http-summary-3.png" alt=""></a></p>
<p><a href="http://idiotsky.top/images3/http-summary-4.png"><img src="http://idiotsky.top/images3/http-summary-4.png" alt=""></a></p>
<p>Response Headers:</p>
<p><a href="http://idiotsky.top/images3/http-summary-5.png"><img src="http://idiotsky.top/images3/http-summary-5.png" alt=""></a></p>
<p>Request Headers:</p>
<p><a href="http://idiotsky.top/images3/http-summary-6.png"><img src="http://idiotsky.top/images3/http-summary-6.png" alt=""></a></p>
<p>è¯·æ±‚æŠ¥æ–‡æ˜¯ç”±è¯·æ±‚æ–¹æ³•ï¼Œè¯·æ±‚ URIï¼Œåè®®ç‰ˆæœ¬ï¼Œå¯é€‰è¯·æ±‚é¦–éƒ¨å­—æ®µå’Œå†…å®¹å®ä½“æ„æˆçš„ã€‚</p>
<p>å“åº”æŠ¥æ–‡åŸºæœ¬ä¸Šç”±åè®®ç‰ˆæœ¬ï¼ŒçŠ¶æ€ç ï¼ˆè¡¨ç¤ºè¯·æ±‚æˆåŠŸä¸å¤±è´¥çš„æ•°å­—ä»£ç ï¼‰ï¼Œç”¨ä»¥è§£é‡ŠçŠ¶æ€ç çš„åŸå› çŸ­è¯­ï¼Œå¯é€‰çš„å“åº”é¦–éƒ¨å­—æ®µä»¥åŠå®ä½“ä¸»ä½“æ„æˆã€‚</p>
<h1 id="HTTP-ç¼“å­˜æ§åˆ¶"><a href="#HTTP-ç¼“å­˜æ§åˆ¶" class="headerlink" title="HTTP ç¼“å­˜æ§åˆ¶"></a>HTTP ç¼“å­˜æ§åˆ¶</h1><h2 id="ç¼“å­˜è§„åˆ™è§£æ"><a href="#ç¼“å­˜è§„åˆ™è§£æ" class="headerlink" title="ç¼“å­˜è§„åˆ™è§£æ"></a>ç¼“å­˜è§„åˆ™è§£æ</h2><p>ä¸ºæ–¹ä¾¿å¤§å®¶ç†è§£ï¼Œæˆ‘ä»¬è®¤ä¸ºæµè§ˆå™¨å­˜åœ¨ä¸€ä¸ªç¼“å­˜æ•°æ®åº“,ç”¨äºå­˜å‚¨ç¼“å­˜ä¿¡æ¯ã€‚</p>
<p>åœ¨å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¯·æ±‚æ•°æ®æ—¶ï¼Œæ­¤æ—¶ç¼“å­˜æ•°æ®åº“ä¸­æ²¡æœ‰å¯¹åº”çš„ç¼“å­˜æ•°æ®ï¼Œéœ€è¦è¯·æ±‚æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨è¿”å›åï¼Œå°†æ•°æ®å­˜å‚¨è‡³ç¼“å­˜æ•°æ®åº“ä¸­ã€‚</p>
<p><a href="http://idiotsky.top/images3/http-summary-21.png"><img src="http://idiotsky.top/images3/http-summary-21.png" alt=""></a></p>
<p>HTTPç¼“å­˜æœ‰å¤šç§è§„åˆ™ï¼Œæ ¹æ®æ˜¯å¦éœ€è¦é‡æ–°å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚æ¥åˆ†ç±»ï¼Œæˆ‘å°†å…¶åˆ†ä¸ºä¸¤å¤§ç±»(<strong>å¼ºåˆ¶ç¼“å­˜ï¼Œå¯¹æ¯”ç¼“å­˜</strong>)</p>
<p>åœ¨è¯¦ç»†ä»‹ç»è¿™ä¸¤ç§è§„åˆ™ä¹‹å‰ï¼Œå…ˆé€šè¿‡æ—¶åºå›¾çš„æ–¹å¼ï¼Œè®©å¤§å®¶å¯¹è¿™ä¸¤ç§è§„åˆ™æœ‰ä¸ªç®€å•äº†è§£ã€‚</p>
<p>å·²å­˜åœ¨ç¼“å­˜æ•°æ®æ—¶ï¼Œä»…åŸºäºå¼ºåˆ¶ç¼“å­˜ï¼Œè¯·æ±‚æ•°æ®çš„æµç¨‹å¦‚ä¸‹</p>
<p><a href="http://idiotsky.top/images3/http-summary-22.png"><img src="http://idiotsky.top/images3/http-summary-22.png" alt=""></a></p>
<p>å·²å­˜åœ¨ç¼“å­˜æ•°æ®æ—¶ï¼Œä»…åŸºäºå¯¹æ¯”ç¼“å­˜ï¼Œè¯·æ±‚æ•°æ®çš„æµç¨‹å¦‚ä¸‹</p>
<p><a href="http://idiotsky.top/images3/http-summary-23.png"><img src="http://idiotsky.top/images3/http-summary-23.png" alt=""></a></p>
<p>å¯¹ç¼“å­˜æœºåˆ¶ä¸å¤ªäº†è§£çš„åŒå­¦å¯èƒ½ä¼šé—®ï¼ŒåŸºäºå¯¹æ¯”ç¼“å­˜çš„æµç¨‹ä¸‹ï¼Œä¸ç®¡æ˜¯å¦ä½¿ç”¨ç¼“å­˜ï¼Œéƒ½éœ€è¦å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œé‚£ä¹ˆè¿˜ç”¨ç¼“å­˜å¹²ä»€ä¹ˆï¼Ÿ</p>
<p>è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æš‚ä¸”æ”¾ä¸‹ï¼Œåæ–‡åœ¨è¯¦ç»†ä»‹ç»æ¯ç§ç¼“å­˜è§„åˆ™çš„æ—¶å€™ï¼Œä¼šå¸¦ç»™å¤§å®¶ç­”æ¡ˆã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸¤ç±»ç¼“å­˜è§„åˆ™çš„ä¸åŒï¼Œå¼ºåˆ¶ç¼“å­˜å¦‚æœç”Ÿæ•ˆï¼Œä¸éœ€è¦å†å’ŒæœåŠ¡å™¨å‘ç”Ÿäº¤äº’ï¼Œè€Œå¯¹æ¯”ç¼“å­˜ä¸ç®¡æ˜¯å¦ç”Ÿæ•ˆï¼Œéƒ½éœ€è¦ä¸æœåŠ¡ç«¯å‘ç”Ÿäº¤äº’ã€‚</p>
<p>ä¸¤ç±»ç¼“å­˜è§„åˆ™å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œå¼ºåˆ¶ç¼“å­˜ä¼˜å…ˆçº§é«˜äºå¯¹æ¯”ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æ‰§è¡Œå¼ºåˆ¶ç¼“å­˜çš„è§„åˆ™æ—¶ï¼Œå¦‚æœç¼“å­˜ç”Ÿæ•ˆï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜ï¼Œä¸å†æ‰§è¡Œå¯¹æ¯”ç¼“å­˜è§„åˆ™ã€‚</p>
<h2 id="å¼ºåˆ¶ç¼“å­˜"><a href="#å¼ºåˆ¶ç¼“å­˜" class="headerlink" title="å¼ºåˆ¶ç¼“å­˜"></a>å¼ºåˆ¶ç¼“å­˜</h2><p>ä»ä¸Šæ–‡æˆ‘ä»¬å¾—çŸ¥ï¼Œå¼ºåˆ¶ç¼“å­˜ï¼Œåœ¨ç¼“å­˜æ•°æ®æœªå¤±æ•ˆçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼Œé‚£ä¹ˆæµè§ˆå™¨æ˜¯å¦‚ä½•åˆ¤æ–­ç¼“å­˜æ•°æ®æ˜¯å¦å¤±æ•ˆå‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨æ²¡æœ‰ç¼“å­˜æ•°æ®çš„æ—¶å€™ï¼Œæµè§ˆå™¨å‘æœåŠ¡å™¨è¯·æ±‚æ•°æ®æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå°†æ•°æ®å’Œç¼“å­˜è§„åˆ™ä¸€å¹¶è¿”å›ï¼Œç¼“å­˜è§„åˆ™ä¿¡æ¯åŒ…å«åœ¨å“åº”headerä¸­ã€‚</p>
<p>å¯¹äºå¼ºåˆ¶ç¼“å­˜æ¥è¯´ï¼Œå“åº”headerä¸­ä¼šæœ‰ä¸¤ä¸ªå­—æ®µæ¥æ ‡æ˜å¤±æ•ˆè§„åˆ™ï¼ˆExpires/Cache-Controlï¼‰</p>
<p>ä½¿ç”¨chromeçš„å¼€å‘è€…å·¥å…·ï¼Œå¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°å¯¹äºå¼ºåˆ¶ç¼“å­˜ç”Ÿæ•ˆæ—¶ï¼Œç½‘ç»œè¯·æ±‚çš„æƒ…å†µ</p>
<p><a href="http://idiotsky.top/images3/http-summary-24.png"><img src="http://idiotsky.top/images3/http-summary-24.png" alt=""></a></p>
<h3 id="Expires"><a href="#Expires" class="headerlink" title="Expires"></a>Expires</h3><p>Expiresçš„å€¼ä¸ºæœåŠ¡ç«¯è¿”å›çš„åˆ°æœŸæ—¶é—´ï¼Œå³ä¸‹ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œè¯·æ±‚æ—¶é—´å°äºæœåŠ¡ç«¯è¿”å›çš„åˆ°æœŸæ—¶é—´ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜æ•°æ®ã€‚</p>
<p>ä¸è¿‡Expires æ˜¯HTTP 1.0çš„ä¸œè¥¿ï¼Œç°åœ¨é»˜è®¤æµè§ˆå™¨å‡é»˜è®¤ä½¿ç”¨HTTP 1.1ï¼Œæ‰€ä»¥å®ƒçš„ä½œç”¨åŸºæœ¬å¿½ç•¥ã€‚</p>
<p>å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œåˆ°æœŸæ—¶é—´æ˜¯ç”±æœåŠ¡ç«¯ç”Ÿæˆçš„ï¼Œä½†æ˜¯å®¢æˆ·ç«¯æ—¶é—´å¯èƒ½è·ŸæœåŠ¡ç«¯æ—¶é—´æœ‰è¯¯å·®ï¼Œè¿™å°±ä¼šå¯¼è‡´ç¼“å­˜å‘½ä¸­çš„è¯¯å·®ã€‚</p>
<p>æ‰€ä»¥HTTP 1.1 çš„ç‰ˆæœ¬ï¼Œä½¿ç”¨Cache-Controlæ›¿ä»£ã€‚</p>
<h3 id="Cache-Control"><a href="#Cache-Control" class="headerlink" title="Cache-Control"></a>Cache-Control</h3><p>Cache-Control æ˜¯æœ€é‡è¦çš„è§„åˆ™ã€‚å¸¸è§çš„å–å€¼æœ‰privateã€publicã€no-cacheã€max-ageï¼Œno-storeï¼Œé»˜è®¤ä¸ºprivateã€‚</p>
<ul>
<li>private:å®¢æˆ·ç«¯å¯ä»¥ç¼“å­˜</li>
<li>public:å®¢æˆ·ç«¯å’Œä»£ç†æœåŠ¡å™¨éƒ½å¯ç¼“å­˜ï¼ˆå‰ç«¯çš„åŒå­¦ï¼Œå¯ä»¥è®¤ä¸ºpublicå’Œprivateæ˜¯ä¸€æ ·çš„ï¼‰</li>
<li>max-age=xxx:ç¼“å­˜çš„å†…å®¹å°†åœ¨ xxx ç§’åå¤±æ•ˆ</li>
<li>no-cache:éœ€è¦ä½¿ç”¨å¯¹æ¯”ç¼“å­˜æ¥éªŒè¯ç¼“å­˜æ•°æ®ï¼ˆåé¢ä»‹ç»ï¼‰</li>
<li>no-store:æ‰€æœ‰å†…å®¹éƒ½ä¸ä¼šç¼“å­˜ï¼Œå¼ºåˆ¶ç¼“å­˜ï¼Œå¯¹æ¯”ç¼“å­˜éƒ½ä¸ä¼šè§¦å‘ï¼ˆå¯¹äºå‰ç«¯å¼€å‘æ¥è¯´ï¼Œç¼“å­˜è¶Šå¤šè¶Šå¥½ï¼Œsoâ€¦åŸºæœ¬ä¸Šå’Œå®ƒè¯´886ï¼‰</li>
</ul>
<p>ä¸¾ä¸ªæ¿æ —</p>
<p><a href="http://idiotsky.top/images3/http-summary-25.png"><img src="http://idiotsky.top/images3/http-summary-25.png" alt=""></a></p>
<p>å›¾ä¸­Cache-Controlä»…æŒ‡å®šäº†max-ageï¼Œæ‰€ä»¥é»˜è®¤ä¸ºprivateï¼Œç¼“å­˜æ—¶é—´ä¸º31536000ç§’ï¼ˆ365å¤©ï¼‰</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨365å¤©å†…å†æ¬¡è¯·æ±‚è¿™æ¡æ•°æ®ï¼Œéƒ½ä¼šç›´æ¥è·å–ç¼“å­˜æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œç›´æ¥ä½¿ç”¨ã€‚</p>
<h2 id="å¯¹æ¯”ç¼“å­˜"><a href="#å¯¹æ¯”ç¼“å­˜" class="headerlink" title="å¯¹æ¯”ç¼“å­˜"></a>å¯¹æ¯”ç¼“å­˜</h2><p>å¯¹æ¯”ç¼“å­˜ï¼Œé¡¾åæ€ä¹‰ï¼Œéœ€è¦è¿›è¡Œæ¯”è¾ƒåˆ¤æ–­æ˜¯å¦å¯ä»¥ä½¿ç”¨ç¼“å­˜ã€‚</p>
<p>æµè§ˆå™¨ç¬¬ä¸€æ¬¡è¯·æ±‚æ•°æ®æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå°†ç¼“å­˜æ ‡è¯†ä¸æ•°æ®ä¸€èµ·è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°†äºŒè€…å¤‡ä»½è‡³ç¼“å­˜æ•°æ®åº“ä¸­ã€‚</p>
<p>å†æ¬¡è¯·æ±‚æ•°æ®æ—¶ï¼Œå®¢æˆ·ç«¯å°†å¤‡ä»½çš„ç¼“å­˜æ ‡è¯†å‘é€ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ ¹æ®ç¼“å­˜æ ‡è¯†è¿›è¡Œåˆ¤æ–­ï¼Œåˆ¤æ–­æˆåŠŸåï¼Œè¿”å›304çŠ¶æ€ç ï¼Œé€šçŸ¥å®¢æˆ·ç«¯æ¯”è¾ƒæˆåŠŸï¼Œå¯ä»¥ä½¿ç”¨ç¼“å­˜æ•°æ®ã€‚</p>
<p>ç¬¬ä¸€æ¬¡è®¿é—®ï¼š</p>
<p><a href="http://idiotsky.top/images3/http-summary-26.png"><img src="http://idiotsky.top/images3/http-summary-26.png" alt=""></a></p>
<p>å†æ¬¡è®¿é—®ï¼š</p>
<p><a href="http://idiotsky.top/images3/http-summary-27.png"><img src="http://idiotsky.top/images3/http-summary-27.png" alt=""></a></p>
<p>é€šè¿‡ä¸¤å›¾çš„å¯¹æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ¥šçš„å‘ç°ï¼Œåœ¨å¯¹æ¯”ç¼“å­˜ç”Ÿæ•ˆæ—¶ï¼ŒçŠ¶æ€ç ä¸º304ï¼Œå¹¶ä¸”æŠ¥æ–‡å¤§å°å’Œè¯·æ±‚æ—¶é—´å¤§å¤§å‡å°‘ã€‚</p>
<p>åŸå› æ˜¯ï¼ŒæœåŠ¡ç«¯åœ¨è¿›è¡Œæ ‡è¯†æ¯”è¾ƒåï¼Œåªè¿”å›headeréƒ¨åˆ†ï¼Œé€šè¿‡çŠ¶æ€ç é€šçŸ¥å®¢æˆ·ç«¯ä½¿ç”¨ç¼“å­˜ï¼Œä¸å†éœ€è¦å°†æŠ¥æ–‡ä¸»ä½“éƒ¨åˆ†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>å¯¹äºå¯¹æ¯”ç¼“å­˜æ¥è¯´ï¼Œç¼“å­˜æ ‡è¯†çš„ä¼ é€’æ˜¯æˆ‘ä»¬ç€é‡éœ€è¦ç†è§£çš„ï¼Œå®ƒåœ¨è¯·æ±‚headerå’Œå“åº”headeré—´è¿›è¡Œä¼ é€’ï¼Œ</p>
<p>ä¸€å…±åˆ†ä¸ºä¸¤ç§æ ‡è¯†ä¼ é€’ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ†å¼€ä»‹ç»ã€‚</p>
<h3 id="Last-Modified-If-Modified-Since"><a href="#Last-Modified-If-Modified-Since" class="headerlink" title="Last-Modified  /  If-Modified-Since"></a>Last-Modified  /  If-Modified-Since</h3><p>Last-Modifiedï¼š</p>
<p>æœåŠ¡å™¨åœ¨å“åº”è¯·æ±‚æ—¶ï¼Œå‘Šè¯‰æµè§ˆå™¨èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´ã€‚</p>
<p><a href="http://idiotsky.top/images3/http-summary-28.png"><img src="http://idiotsky.top/images3/http-summary-28.png" alt=""></a></p>
<p>If-Modified-Sinceï¼š</p>
<p>å†æ¬¡è¯·æ±‚æœåŠ¡å™¨æ—¶ï¼Œé€šè¿‡æ­¤å­—æ®µé€šçŸ¥æœåŠ¡å™¨ä¸Šæ¬¡è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨è¿”å›çš„èµ„æºæœ€åä¿®æ”¹æ—¶é—´ã€‚</p>
<p>æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åå‘ç°æœ‰å¤´If-Modified-Since åˆ™ä¸è¢«è¯·æ±‚èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´è¿›è¡Œæ¯”å¯¹ã€‚</p>
<p>è‹¥èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´å¤§äºIf-Modified-Sinceï¼Œè¯´æ˜èµ„æºåˆè¢«æ”¹åŠ¨è¿‡ï¼Œåˆ™å“åº”æ•´ç‰‡èµ„æºå†…å®¹ï¼Œè¿”å›çŠ¶æ€ç 200ï¼›</p>
<p>è‹¥èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´å°äºæˆ–ç­‰äºIf-Modified-Sinceï¼Œè¯´æ˜èµ„æºæ— æ–°ä¿®æ”¹ï¼Œåˆ™å“åº”HTTP 304ï¼Œå‘ŠçŸ¥æµè§ˆå™¨ç»§ç»­ä½¿ç”¨æ‰€ä¿å­˜çš„cacheã€‚</p>
<p><a href="http://idiotsky.top/images3/http-summary-29.png"><img src="http://idiotsky.top/images3/http-summary-29.png" alt=""></a></p>
<h3 id="Etag-If-None-Match"><a href="#Etag-If-None-Match" class="headerlink" title="Etag  /  If-None-Match"></a>Etag  /  If-None-Match</h3><p>ï¼ˆä¼˜å…ˆçº§é«˜äºLast-Modified  /  If-Modified-Sinceï¼‰</p>
<p>Etagï¼š</p>
<p>æœåŠ¡å™¨å“åº”è¯·æ±‚æ—¶ï¼Œå‘Šè¯‰æµè§ˆå™¨å½“å‰èµ„æºåœ¨æœåŠ¡å™¨çš„å”¯ä¸€æ ‡è¯†ï¼ˆç”Ÿæˆè§„åˆ™ç”±æœåŠ¡å™¨å†³å®šï¼‰ã€‚</p>
<p><a href="http://idiotsky.top/images3/http-summary-30.png"><img src="http://idiotsky.top/images3/http-summary-30.png" alt=""></a></p>
<p>If-None-Matchï¼š</p>
<p>å†æ¬¡è¯·æ±‚æœåŠ¡å™¨æ—¶ï¼Œé€šè¿‡æ­¤å­—æ®µé€šçŸ¥æœåŠ¡å™¨å®¢æˆ·æ®µç¼“å­˜æ•°æ®çš„å”¯ä¸€æ ‡è¯†ã€‚</p>
<p>æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åå‘ç°æœ‰å¤´If-None-Match åˆ™ä¸è¢«è¯·æ±‚èµ„æºçš„å”¯ä¸€æ ‡è¯†è¿›è¡Œæ¯”å¯¹ï¼Œ</p>
<p>ä¸åŒï¼Œè¯´æ˜èµ„æºåˆè¢«æ”¹åŠ¨è¿‡ï¼Œåˆ™å“åº”æ•´ç‰‡èµ„æºå†…å®¹ï¼Œè¿”å›çŠ¶æ€ç 200ï¼›</p>
<p>ç›¸åŒï¼Œè¯´æ˜èµ„æºæ— æ–°ä¿®æ”¹ï¼Œåˆ™å“åº”HTTP 304ï¼Œå‘ŠçŸ¥æµè§ˆå™¨ç»§ç»­ä½¿ç”¨æ‰€ä¿å­˜çš„cacheã€‚</p>
<p><a href="http://idiotsky.top/images3/http-summary-31.png"><img src="http://idiotsky.top/images3/http-summary-31.png" alt=""></a></p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>å¯¹äºå¼ºåˆ¶ç¼“å­˜ï¼ŒæœåŠ¡å™¨é€šçŸ¥æµè§ˆå™¨ä¸€ä¸ªç¼“å­˜æ—¶é—´ï¼Œåœ¨ç¼“å­˜æ—¶é—´å†…ï¼Œä¸‹æ¬¡è¯·æ±‚ï¼Œç›´æ¥ç”¨ç¼“å­˜ï¼Œä¸åœ¨æ—¶é—´å†…ï¼Œæ‰§è¡Œæ¯”è¾ƒç¼“å­˜ç­–ç•¥ã€‚</p>
<p>å¯¹äºæ¯”è¾ƒç¼“å­˜ï¼Œå°†ç¼“å­˜ä¿¡æ¯ä¸­çš„Etagå’ŒLast-Modifiedé€šè¿‡è¯·æ±‚å‘é€ç»™æœåŠ¡å™¨ï¼Œç”±æœåŠ¡å™¨æ ¡éªŒï¼Œè¿”å›304çŠ¶æ€ç æ—¶ï¼Œæµè§ˆå™¨ç›´æ¥ä½¿ç”¨ç¼“å­˜ã€‚</p>
<p>æµè§ˆå™¨ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼š</p>
<p><a href="http://idiotsky.top/images3/http-summary-32.png"><img src="http://idiotsky.top/images3/http-summary-32.png" alt=""></a></p>
<p>æµè§ˆå™¨å†æ¬¡è¯·æ±‚æ—¶ï¼š</p>
<p><a href="http://idiotsky.top/images3/http-summary-9.png"><img src="http://idiotsky.top/images3/http-summary-9.png" alt=""></a></p>
<p>è¿˜æœ‰ä¸€å¼ å›¾æ€»ç»“ä¸‹ï¼š</p>
<p><a href="http://idiotsky.top/images3/http-summary-33.jpg"><img src="http://idiotsky.top/images3/http-summary-33.jpg" alt=""></a></p>
<h1 id="è¯·æ±‚é¦–éƒ¨"><a href="#è¯·æ±‚é¦–éƒ¨" class="headerlink" title="è¯·æ±‚é¦–éƒ¨"></a>è¯·æ±‚é¦–éƒ¨</h1><h2 id="è¯·æ±‚ä¿¡æ¯æ€§é¦–éƒ¨"><a href="#è¯·æ±‚ä¿¡æ¯æ€§é¦–éƒ¨" class="headerlink" title="è¯·æ±‚ä¿¡æ¯æ€§é¦–éƒ¨"></a>è¯·æ±‚ä¿¡æ¯æ€§é¦–éƒ¨</h2><table>
<thead>
<tr>
<th style="text-align:center">é¦–éƒ¨</th>
<th style="text-align:center">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Client-IP4</td>
<td style="text-align:center">æä¾›äº†è¿è¡Œå®¢æˆ·ç«¯çš„æœºå™¨çš„ IP åœ°å€</td>
</tr>
<tr>
<td style="text-align:center">From</td>
<td style="text-align:center">æä¾›äº†å®¢æˆ·ç«¯ç”¨æˆ·çš„ E-mail åœ°å€</td>
</tr>
<tr>
<td style="text-align:center">Host</td>
<td style="text-align:center">ç»™å‡ºäº†æ¥æ”¶è¯·æ±‚çš„æœåŠ¡å™¨çš„ä¸»æœºåå’Œç«¯å£å·</td>
</tr>
<tr>
<td style="text-align:center">Referer</td>
<td style="text-align:center">æä¾›äº†åŒ…å«å½“å‰è¯·æ±‚ URI çš„æ–‡æ¡£çš„ URLï¼ˆæ­£ç¡®çš„æ‹¼å†™å…¶å®åº”è¯¥æ˜¯Referrer ï¼Œå¤§å®¶ä¸€è‡´æ²¿ç”¨é”™è¯¯è‡³ä»Šï¼‰</td>
</tr>
<tr>
<td style="text-align:center">UA-Color</td>
<td style="text-align:center">æä¾›äº†ä¸å®¢æˆ·ç«¯æ˜¾ç¤ºå™¨çš„æ˜¾ç¤ºé¢œè‰²æœ‰å…³çš„ä¿¡æ¯</td>
</tr>
<tr>
<td style="text-align:center">UA-CPU</td>
<td style="text-align:center">ç»™å‡ºäº†å®¢æˆ·ç«¯ CPU çš„ç±»å‹æˆ–åˆ¶é€ å•†</td>
</tr>
<tr>
<td style="text-align:center">UA-Disp</td>
<td style="text-align:center">æä¾›äº†ä¸å®¢æˆ·ç«¯æ˜¾ç¤ºå™¨ï¼ˆå±å¹•ï¼‰èƒ½åŠ›æœ‰å…³çš„ä¿¡æ¯</td>
</tr>
<tr>
<td style="text-align:center">UA-OS</td>
<td style="text-align:center">ç»™å‡ºäº†è¿è¡Œåœ¨å®¢æˆ·ç«¯æœºå™¨ä¸Šçš„æ“ä½œç³»ç»Ÿåç§°åŠç‰ˆæœ¬</td>
</tr>
<tr>
<td style="text-align:center">UA-Pixels</td>
<td style="text-align:center">æä¾›äº†å®¢æˆ·ç«¯æ˜¾ç¤ºå™¨çš„åƒç´ ä¿¡æ¯</td>
</tr>
<tr>
<td style="text-align:center">User-Agent</td>
<td style="text-align:center">å°†å‘èµ·è¯·æ±‚çš„åº”ç”¨ç¨‹åºåç§°å‘ŠçŸ¥æœåŠ¡å™¨</td>
</tr>
</tbody>
</table>
<h2 id="Accept-é¦–éƒ¨"><a href="#Accept-é¦–éƒ¨" class="headerlink" title="Accept é¦–éƒ¨"></a>Accept é¦–éƒ¨</h2><table>
<thead>
<tr>
<th style="text-align:center">é¦–éƒ¨</th>
<th style="text-align:center">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Accept</td>
<td style="text-align:center">å‘Šè¯‰æœåŠ¡å™¨èƒ½å¤Ÿå‘é€å“ªäº›åª’ä½“ç±»å‹</td>
</tr>
<tr>
<td style="text-align:center">Accept- Charset</td>
<td style="text-align:center">å‘Šè¯‰æœåŠ¡å™¨èƒ½å¤Ÿå‘é€å“ªäº›å­—ç¬¦é›†</td>
</tr>
<tr>
<td style="text-align:center">Accept- Encoding</td>
<td style="text-align:center">å‘Šè¯‰æœåŠ¡å™¨èƒ½å¤Ÿå‘é€å“ªäº›ç¼–ç æ–¹å¼</td>
</tr>
<tr>
<td style="text-align:center">Accept- Language</td>
<td style="text-align:center">å‘Šè¯‰æœåŠ¡å™¨èƒ½å¤Ÿå‘é€å“ªäº›è¯­è¨€</td>
</tr>
<tr>
<td style="text-align:center">TE</td>
<td style="text-align:center">å‘Šè¯‰æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨å“ªäº›æ‰©å±•ä¼ è¾“çš„ç¼–ç </td>
</tr>
</tbody>
</table>
<p>å¸¸è§å†…å®¹ç¼–ç </p>
<p>å¸¸ç”¨çš„å†…å®¹ç¼–ç æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>gzipï¼ˆGNU zipï¼‰<br>ç”±æ–‡ä»¶å‹ç¼©ç¨‹åº gzipï¼ˆGNU zipï¼‰ç”Ÿæˆçš„ç¼–ç æ ¼å¼ï¼ˆRFC1952ï¼‰ï¼Œé‡‡ç”¨ Lempel-Ziv ç®—æ³•ï¼ˆLZ77ï¼‰åŠ 32 ä½å¾ªç¯å†—ä½™æ ¡éªŒï¼ˆCyclic Redundancy Checkï¼Œç»Ÿç§° CRCï¼‰</li>
<li>compressï¼ˆUNIX ç³»ç»Ÿçš„æ ‡å‡†å‹ç¼©ï¼‰<br>ç”± UNIX æ–‡ä»¶å‹ç¼©ç¨‹åº compress ç”Ÿæˆçš„ç¼–ç æ ¼å¼ï¼Œé‡‡ç”¨ Lempel-Ziv-Welch ç®—æ³• ï¼ˆLZWï¼‰</li>
<li>deflateï¼ˆzlibï¼‰<br>ç»„åˆä½¿ç”¨ zlib æ ¼å¼ï¼ˆRFC1950ï¼‰åŠç”± deflate å‹ç¼©ç®—æ³•ï¼ˆRFC1951ï¼‰ç”Ÿæˆçš„ç¼–ç æ ¼å¼</li>
<li>identityï¼ˆä¸è¿›è¡Œç¼–ç ï¼‰<br>ä¸æ‰§è¡Œå‹ç¼©æˆ–ä¸ä¼šå˜åŒ–çš„é»˜è®¤ç¼–ç æ ¼å¼</li>
</ul>
<h2 id="æ¡ä»¶è¯·æ±‚é¦–éƒ¨"><a href="#æ¡ä»¶è¯·æ±‚é¦–éƒ¨" class="headerlink" title="æ¡ä»¶è¯·æ±‚é¦–éƒ¨"></a>æ¡ä»¶è¯·æ±‚é¦–éƒ¨</h2><table>
<thead>
<tr>
<th style="text-align:center">é¦–éƒ¨</th>
<th style="text-align:center">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Expect</td>
<td style="text-align:center">å…è®¸å®¢æˆ·ç«¯åˆ—å‡ºæŸè¯·æ±‚æ‰€è¦æ±‚çš„æœåŠ¡å™¨è¡Œä¸º</td>
</tr>
<tr>
<td style="text-align:center">If-Match</td>
<td style="text-align:center">å¦‚æœå®ä½“æ ‡è®°ä¸æ–‡æ¡£å½“å‰çš„å®ä½“æ ‡è®°ç›¸åŒ¹é…ï¼Œå°±è·å–è¿™ä»½æ–‡æ¡£</td>
</tr>
<tr>
<td style="text-align:center">If-Modified-Since</td>
<td style="text-align:center">é™¤éåœ¨æŸä¸ªæŒ‡å®šçš„æ—¥æœŸä¹‹åèµ„æºè¢«ä¿®æ”¹è¿‡ï¼Œå¦åˆ™å°±é™åˆ¶è¿™ä¸ªè¯·æ±‚</td>
</tr>
<tr>
<td style="text-align:center">If-None-Match</td>
<td style="text-align:center">å¦‚æœæä¾›çš„å®ä½“æ ‡è®°ä¸å½“å‰æ–‡æ¡£çš„å®ä½“æ ‡è®°ä¸ç›¸ç¬¦ï¼Œå°±è·å–æ–‡æ¡£</td>
</tr>
<tr>
<td style="text-align:center">If-Range</td>
<td style="text-align:center">å…è®¸å¯¹æ–‡æ¡£çš„æŸä¸ªèŒƒå›´è¿›è¡Œæ¡ä»¶è¯·æ±‚</td>
</tr>
<tr>
<td style="text-align:center">If-Unmodified-Since</td>
<td style="text-align:center">é™¤éåœ¨æŸä¸ªæŒ‡å®šæ—¥æœŸä¹‹åèµ„æºæ²¡æœ‰è¢«ä¿®æ”¹è¿‡ï¼Œå¦åˆ™å°±é™åˆ¶è¿™ä¸ªè¯·æ±‚</td>
</tr>
<tr>
<td style="text-align:center">Range</td>
<td style="text-align:center">å¦‚æœæœåŠ¡å™¨æ”¯æŒèŒƒå›´è¯·æ±‚ï¼Œå°±è¯·æ±‚èµ„æºçš„æŒ‡å®šèŒƒå›´</td>
</tr>
</tbody>
</table>
<h2 id="å®‰å…¨è¯·æ±‚é¦–éƒ¨"><a href="#å®‰å…¨è¯·æ±‚é¦–éƒ¨" class="headerlink" title="å®‰å…¨è¯·æ±‚é¦–éƒ¨"></a>å®‰å…¨è¯·æ±‚é¦–éƒ¨</h2><table>
<thead>
<tr>
<th style="text-align:center">é¦–éƒ¨</th>
<th style="text-align:center">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Authorization</td>
<td style="text-align:center">åŒ…å«äº†å®¢æˆ·ç«¯æä¾›ç»™æœåŠ¡å™¨ï¼Œä»¥ä¾¿å¯¹å…¶è‡ªèº«è¿›è¡Œè®¤è¯çš„æ•°æ®</td>
</tr>
<tr>
<td style="text-align:center">Cookie</td>
<td style="text-align:center">å®¢æˆ·ç«¯ç”¨å®ƒå‘æœåŠ¡å™¨ä¼ é€ä¸€ä¸ªä»¤ç‰Œ â€”â€” å®ƒå¹¶ä¸æ˜¯çœŸæ­£çš„å®‰å…¨é¦–éƒ¨ï¼Œä½†ç¡®å®éšå«äº†å®‰å…¨åŠŸèƒ½</td>
</tr>
<tr>
<td style="text-align:center">Cookie</td>
<td style="text-align:center">ç”¨æ¥è¯´æ˜è¯·æ±‚ç«¯æ”¯æŒçš„ cookie ç‰ˆæœ¬</td>
</tr>
</tbody>
</table>
<h2 id="ä»£ç†è¯·æ±‚é¦–éƒ¨"><a href="#ä»£ç†è¯·æ±‚é¦–éƒ¨" class="headerlink" title="ä»£ç†è¯·æ±‚é¦–éƒ¨"></a>ä»£ç†è¯·æ±‚é¦–éƒ¨</h2><table>
<thead>
<tr>
<th style="text-align:center">é¦–éƒ¨</th>
<th style="text-align:center">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Max-Forward</td>
<td style="text-align:center">åœ¨é€šå¾€æºç«¯æœåŠ¡å™¨çš„è·¯å¾„ä¸Šï¼Œå°†è¯·æ±‚è½¬å‘ç»™å…¶ä»–ä»£ç†æˆ–ç½‘å…³çš„æœ€å¤§æ¬¡æ•° â€”â€” ä¸ TRACE æ–¹æ³•ä¸€åŒä½¿ç”¨</td>
</tr>
<tr>
<td style="text-align:center">Proxy-Authorization</td>
<td style="text-align:center">ä¸ Authorization é¦–éƒ¨ç›¸åŒï¼Œ ä½†è¿™ä¸ªé¦–éƒ¨æ˜¯åœ¨ä¸ä»£ç†è¿›è¡Œè®¤è¯æ—¶ä½¿ç”¨çš„</td>
</tr>
<tr>
<td style="text-align:center">Proxy-Connection</td>
<td style="text-align:center">ä¸ Connection é¦–éƒ¨ç›¸åŒï¼Œ ä½†è¿™ä¸ªé¦–éƒ¨æ˜¯åœ¨ä¸ä»£ç†å»ºç«‹è¿æ¥æ—¶ä½¿ç”¨çš„</td>
</tr>
</tbody>
</table>
<h1 id="å“åº”é¦–éƒ¨"><a href="#å“åº”é¦–éƒ¨" class="headerlink" title="å“åº”é¦–éƒ¨"></a>å“åº”é¦–éƒ¨</h1><h2 id="å“åº”ä¿¡æ¯æ€§é¦–éƒ¨"><a href="#å“åº”ä¿¡æ¯æ€§é¦–éƒ¨" class="headerlink" title="å“åº”ä¿¡æ¯æ€§é¦–éƒ¨"></a>å“åº”ä¿¡æ¯æ€§é¦–éƒ¨</h2><table>
<thead>
<tr>
<th style="text-align:center">é¦–éƒ¨</th>
<th style="text-align:center">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Age</td>
<td style="text-align:center">ï¼ˆä»æœ€åˆåˆ›å»ºå¼€å§‹ï¼‰å“åº”æŒç»­æ—¶é—´</td>
</tr>
<tr>
<td style="text-align:center">Public</td>
<td style="text-align:center">æœåŠ¡å™¨ä¸ºå…¶èµ„æºæ”¯æŒçš„è¯·æ±‚æ–¹æ³•åˆ—è¡¨</td>
</tr>
<tr>
<td style="text-align:center">Retry-After</td>
<td style="text-align:center">å¦‚æœèµ„æºä¸å¯ç”¨çš„è¯ï¼Œåœ¨æ­¤æ—¥æœŸæˆ–æ—¶é—´é‡è¯• Server æœåŠ¡å™¨åº”ç”¨ç¨‹åºè½¯ä»¶çš„åç§°å’Œç‰ˆæœ¬</td>
</tr>
<tr>
<td style="text-align:center">Title</td>
<td style="text-align:center">å¯¹ HTML æ–‡æ¡£æ¥è¯´ï¼Œå°±æ˜¯ HTML æ–‡æ¡£ çš„æºç«¯ç»™å‡ºçš„æ ‡é¢˜</td>
</tr>
<tr>
<td style="text-align:center">Warning</td>
<td style="text-align:center">æ¯”åŸå› çŸ­è¯­ä¸­æ›´è¯¦ç»†ä¸€äº›çš„è­¦å‘ŠæŠ¥æ–‡</td>
</tr>
</tbody>
</table>
<h2 id="åå•†é¦–éƒ¨"><a href="#åå•†é¦–éƒ¨" class="headerlink" title="åå•†é¦–éƒ¨"></a>åå•†é¦–éƒ¨</h2><table>
<thead>
<tr>
<th style="text-align:center">é¦–éƒ¨</th>
<th style="text-align:center">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Accept-Ranges</td>
<td style="text-align:center">å¯¹æ­¤èµ„æºæ¥è¯´ï¼ŒæœåŠ¡å™¨å¯æ¥å—çš„èŒƒå›´ç±»å‹</td>
</tr>
<tr>
<td style="text-align:center">Vary</td>
<td style="text-align:center">æœåŠ¡å™¨æŸ¥çœ‹çš„å…¶ä»–é¦–éƒ¨çš„åˆ—è¡¨ï¼Œå¯èƒ½ä¼šä½¿å“åº”å‘ç”Ÿå˜åŒ–ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªé¦–éƒ¨åˆ—è¡¨ï¼ŒæœåŠ¡å™¨ä¼šæ ¹æ®è¿™äº›é¦–éƒ¨çš„å†…å®¹æŒ‘é€‰å‡ºæœ€é€‚åˆçš„èµ„æºç‰ˆæœ¬å‘é€ç»™å®¢æˆ·ç«¯ã€‚é¦–éƒ¨å­—æ®µ Vary å¯å¯¹ç¼“å­˜è¿›è¡Œæ§åˆ¶ã€‚æºæœåŠ¡å™¨ä¼šå‘ä»£ç†æœåŠ¡å™¨ä¼ è¾¾å…³äºæœ¬åœ°ç¼“å­˜ä½¿ç”¨æ–¹æ³•çš„å‘½ä»¤ã€‚ä»ä»£ç†æœåŠ¡å™¨æ¥æ”¶åˆ°æºæœåŠ¡å™¨è¿”å›åŒ…å« Vary æŒ‡å®šé¡¹çš„å“åº”ä¹‹åï¼Œè‹¥å†è¿›è¡Œç¼“å­˜ï¼Œä»…å¯¹è¯·æ±‚ä¸­å«æœ‰ç›¸åŒ Vary æŒ‡å®šé¦–éƒ¨å­—æ®µçš„è¯·æ±‚è¿”å›ç¼“å­˜ã€‚å³ä½¿å¯¹ç›¸åŒèµ„æºå‘èµ·è¯·æ±‚ï¼Œä½†ç”±äº Vary æŒ‡å®šçš„é¦–éƒ¨å­—æ®µä¸ç›¸åŒï¼Œå› æ­¤å¿…é¡»è¦ä»æºæœåŠ¡å™¨é‡æ–°è·å–èµ„æºã€‚</td>
</tr>
</tbody>
</table>
<h2 id="å®‰å…¨å“åº”é¦–éƒ¨"><a href="#å®‰å…¨å“åº”é¦–éƒ¨" class="headerlink" title="å®‰å…¨å“åº”é¦–éƒ¨"></a>å®‰å…¨å“åº”é¦–éƒ¨</h2><table>
<thead>
<tr>
<th style="text-align:center">é¦–éƒ¨</th>
<th style="text-align:center">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Proxy-Authenticate</td>
<td style="text-align:center">æ¥è‡ªä»£ç†çš„å¯¹å®¢æˆ·ç«¯çš„è´¨è¯¢åˆ—è¡¨</td>
</tr>
<tr>
<td style="text-align:center">Set-Cookie</td>
<td style="text-align:center">ä¸æ˜¯çœŸæ­£çš„å®‰å…¨é¦–éƒ¨ï¼Œä½†éšå«æœ‰å®‰å…¨åŠŸèƒ½ï¼›å¯ä»¥åœ¨å®¢æˆ·ç«¯è®¾ç½®ä¸€ä¸ªä»¤ç‰Œï¼Œä»¥ä¾¿æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯è¿›è¡Œæ ‡è¯†</td>
</tr>
<tr>
<td style="text-align:center">Set-Cookie2</td>
<td style="text-align:center">ä¸ Set-Cookie ç±»ä¼¼ï¼ŒRFC 2965 Cookie å®šä¹‰ï¼›</td>
</tr>
<tr>
<td style="text-align:center">WWW-Authenticate</td>
<td style="text-align:center">æ¥è‡ªæœåŠ¡å™¨çš„å¯¹å®¢æˆ·ç«¯çš„è´¨è¯¢åˆ—è¡¨ã€‚å®ƒä¼šå‘ŠçŸ¥å®¢æˆ·ç«¯é€‚ç”¨äºè®¿é—®è¯·æ±‚ URI æ‰€æŒ‡å®šèµ„æºçš„è®¤è¯æ–¹æ¡ˆï¼ˆBasic æˆ–æ˜¯ Digestï¼‰å’Œå¸¦å‚æ•°æç¤ºçš„è´¨è¯¢ï¼ˆchallengeï¼‰</td>
</tr>
</tbody>
</table>
<p>Cookie çš„ HttpOnly å±æ€§æ˜¯ Cookie çš„æ‰©å±•åŠŸèƒ½ï¼Œå®ƒä½¿ JavaScript è„šæœ¬æ— æ³•è·å¾— Cookieã€‚å…¶ä¸»è¦ç›®çš„ä¸ºäº†é˜²æ­¢è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆCross-site scriptingï¼ŒXSSï¼‰å¯¹ Cookie çš„ä¿¡æ¯çªƒå–ã€‚</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Set-Cookie</span>: name-value;HttpOnly</span><br></pre></td></tr></table></figure>
<p>é¡ºå¸¦ä¸€æï¼Œè¯¥æ‰©å±•å¹¶éæ˜¯ä¸ºäº†é˜²æ­¢ XSS è€Œå¼€å‘çš„ã€‚</p>
<h1 id="å®ä½“é¦–éƒ¨"><a href="#å®ä½“é¦–éƒ¨" class="headerlink" title="å®ä½“é¦–éƒ¨"></a>å®ä½“é¦–éƒ¨</h1><h2 id="å®ä½“ä¿¡æ¯æ€§é¦–éƒ¨"><a href="#å®ä½“ä¿¡æ¯æ€§é¦–éƒ¨" class="headerlink" title="å®ä½“ä¿¡æ¯æ€§é¦–éƒ¨"></a>å®ä½“ä¿¡æ¯æ€§é¦–éƒ¨</h2><table>
<thead>
<tr>
<th style="text-align:center">é¦–éƒ¨</th>
<th style="text-align:center">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Allow</td>
<td style="text-align:center">åˆ—å‡ºäº†å¯ä»¥å¯¹æ­¤å®ä½“æ‰§è¡Œçš„è¯·æ±‚æ–¹æ³•</td>
</tr>
<tr>
<td style="text-align:center">Location</td>
<td style="text-align:center">å‘ŠçŸ¥å®¢æˆ·ç«¯å®ä½“å®é™…ä¸Šä½äºä½•å¤„ï¼›ç”¨äºå°†æ¥æ”¶ç«¯å®šå‘åˆ°èµ„æºçš„ï¼ˆå¯èƒ½æ˜¯æ–°çš„ï¼‰ä½ç½®ï¼ˆURLï¼‰ä¸Šå»</td>
</tr>
</tbody>
</table>
<h2 id="å†…å®¹é¦–éƒ¨"><a href="#å†…å®¹é¦–éƒ¨" class="headerlink" title="å†…å®¹é¦–éƒ¨"></a>å†…å®¹é¦–éƒ¨</h2><table>
<thead>
<tr>
<th style="text-align:center">é¦–éƒ¨</th>
<th style="text-align:center">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Content-Base16</td>
<td style="text-align:center">è§£æä¸»ä½“ä¸­çš„ç›¸å¯¹ URL æ—¶ä½¿ç”¨çš„åŸºç¡€ URL</td>
</tr>
<tr>
<td style="text-align:center">Content-Encoding</td>
<td style="text-align:center">å¯¹ä¸»ä½“æ‰§è¡Œçš„ä»»æ„ç¼–ç æ–¹å¼</td>
</tr>
<tr>
<td style="text-align:center">Content-Language</td>
<td style="text-align:center">ç†è§£ä¸»ä½“æ—¶æœ€é€‚å®œä½¿ç”¨çš„è‡ªç„¶è¯­è¨€</td>
</tr>
<tr>
<td style="text-align:center">Content-Length</td>
<td style="text-align:center">ä¸»ä½“çš„é•¿åº¦æˆ–å°ºå¯¸</td>
</tr>
<tr>
<td style="text-align:center">Content-Location</td>
<td style="text-align:center">èµ„æºå®é™…æ‰€å¤„çš„ä½ç½®</td>
</tr>
<tr>
<td style="text-align:center">Content-MD5</td>
<td style="text-align:center">ä¸»ä½“çš„ MD5 æ ¡éªŒå’Œ</td>
</tr>
<tr>
<td style="text-align:center">Content-Range</td>
<td style="text-align:center">åœ¨æ•´ä¸ªèµ„æºä¸­æ­¤å®ä½“è¡¨ç¤ºçš„å­—èŠ‚èŒƒå›´</td>
</tr>
<tr>
<td style="text-align:center">Content-Type</td>
<td style="text-align:center">è¿™ä¸ªä¸»ä½“çš„å¯¹è±¡ç±»å‹</td>
</tr>
</tbody>
</table>
<p>ç”±äº HTTP é¦–éƒ¨æ— æ³•è®°å½•äºŒè¿›åˆ¶å€¼ï¼Œæ‰€ä»¥è¦é€šè¿‡ Base-64 ç¼–ç å¤„ç†ã€‚é‡‡ç”¨ Content-MD5 è¿™ç§æ–¹æ³•ï¼Œå¯¹å†…å®¹ä¸Šçš„å¶å‘æ€§æ”¹å˜æ˜¯æ— ä»æŸ¥è¯çš„ï¼Œä¹Ÿæ— æ³•æ£€æµ‹å‡ºæ¶æ„ç¯¡æ”¹ã€‚åŸå› åœ¨äºï¼Œå†…å®¹å¦‚æœè¢«ç¯¡æ”¹äº†ï¼Œé‚£ä¹ˆåŒæ—¶æ„å‘³ç€ Content-MD5 ä¹Ÿå¯ä»¥è¢«é‡æ–°è®¡ç®—åæ›´æ–°ï¼Œè¢«ç¯¡æ”¹ã€‚æ‰€ä»¥å¤„åœ¨æ¥æ”¶é˜¶æ®µçš„å®¢æˆ·ç«¯æ˜¯æ— æ³•æ„è¯†åˆ°æŠ¥æ–‡ä¸»ä½“ä»¥åŠé¦–éƒ¨å­—æ®µ Content-MD5 æ˜¯å·²ç»è¢«ç¯¡æ”¹è¿‡çš„ã€‚</p>
<h2 id="å®ä½“ç¼“å­˜é¦–éƒ¨"><a href="#å®ä½“ç¼“å­˜é¦–éƒ¨" class="headerlink" title="å®ä½“ç¼“å­˜é¦–éƒ¨"></a>å®ä½“ç¼“å­˜é¦–éƒ¨</h2><table>
<thead>
<tr>
<th style="text-align:center">é¦–éƒ¨</th>
<th style="text-align:center">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ETag</td>
<td style="text-align:center">ä¸æ­¤å®ä½“ç›¸å…³çš„å®ä½“æ ‡è®°</td>
</tr>
<tr>
<td style="text-align:center">Expires</td>
<td style="text-align:center">å®ä½“ä¸å†æœ‰æ•ˆï¼Œè¦ä»åŸå§‹çš„æºç«¯å†æ¬¡è·å–æ­¤å®ä½“çš„æ—¥æœŸå’Œæ—¶é—´</td>
</tr>
<tr>
<td style="text-align:center">Last-Modified</td>
<td style="text-align:center">è¿™ä¸ªå®ä½“æœ€åä¸€æ¬¡è¢«ä¿®æ”¹çš„æ—¥æœŸå’Œæ—¶é—´</td>
</tr>
</tbody>
</table>
<p>Expires æ˜¯ Web æœåŠ¡å™¨å“åº”æ¶ˆæ¯å¤´å­—æ®µï¼Œåœ¨å“åº” http è¯·æ±‚æ—¶å‘Šè¯‰æµè§ˆå™¨åœ¨è¿‡æœŸæ—¶é—´å‰æµè§ˆå™¨å¯ä»¥ç›´æ¥ä»æµè§ˆå™¨ç¼“å­˜å–æ•°æ®ï¼Œè€Œæ— éœ€å†æ¬¡è¯·æ±‚ã€‚</p>
<p>Expires çš„ç¼ºç‚¹æ˜¯ï¼šå“åº”æŠ¥æ–‡ä¸­ Expires æ‰€å®šä¹‰çš„ç¼“å­˜æ—¶é—´æ˜¯ç›¸å¯¹æœåŠ¡å™¨ä¸Šçš„æ—¶é—´è€Œè¨€çš„ï¼Œå…¶å®šä¹‰çš„æ˜¯èµ„æºâ€œå¤±æ•ˆæ—¶åˆ»â€ï¼Œå¦‚æœå®¢æˆ·ç«¯ä¸Šçš„æ—¶é—´è·ŸæœåŠ¡å™¨ä¸Šçš„æ—¶é—´ä¸ä¸€è‡´ï¼Œç¼“å­˜å°†å¤±æ•ˆã€‚  </p>
<p>å¦å¤–ï¼ŒExpires ä¸»è¦ä½¿ç”¨åœ¨ HTTP1.0 ç‰ˆæœ¬ã€‚</p>
<p>å¦‚æœä¸¤è€…çš„ URI æ˜¯ç›¸åŒï¼Œæ‰€ä»¥ä»…å‡­ URI æŒ‡å®šç¼“å­˜çš„èµ„æºæ˜¯å¾ˆå›°éš¾çš„ã€‚è‹¥ä¸‹è½½è¿‡ç¨‹ä¸­å‡ºç°è¿ç»­ä¸­æ–­ã€å†è¿æ¥çš„æƒ…å†µï¼Œéƒ½ä¼šä¾æ® ETag å€¼æŒ‡å®šèµ„æºã€‚</p>
<p>ETag ä¹Ÿåˆ†ä¸ºå¼º ETag å€¼å’Œå¼± ETag å€¼ï¼š</p>
<p>å¼º ETag å€¼ï¼š</p>
<p>å¼º ETag å€¼ï¼Œä¸è®ºå®ä½“å‘ç”Ÿå¤šå°‘ç»†å¾®çš„å˜åŒ–éƒ½ä¼šæ”¹å˜å…¶å€¼ã€‚</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ETag</span>: "usagi-1234"</span><br></pre></td></tr></table></figure>
<p>å¼± ETag å€¼ï¼š</p>
<p>å¼± ETag å€¼åªç”¨äºæç¤ºèµ„æºæ˜¯å¦ç›¸åŒã€‚åªæœ‰èµ„æºå‘ç”Ÿäº†æ ¹æœ¬æ”¹å˜ï¼Œäº§ç”Ÿå·®å¼‚æ—¶æ‰ä¼šæ”¹å˜ ETag å€¼ã€‚è¿™æ—¶ï¼Œä¼šåœ¨å­—æ®µå€¼æœ€å¼€å§‹å¤„é™„åŠ  W/</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ETag</span>: W/"usagi-1234"</span><br></pre></td></tr></table></figure>
<h1 id="æ‰©å±•é¦–éƒ¨"><a href="#æ‰©å±•é¦–éƒ¨" class="headerlink" title="æ‰©å±•é¦–éƒ¨"></a>æ‰©å±•é¦–éƒ¨</h1><h2 id="X-Frame-Options"><a href="#X-Frame-Options" class="headerlink" title="X-Frame-Options"></a>X-Frame-Options</h2><p>é¦–éƒ¨å­—æ®µ X-Frame-Options å±äº HTTP å“åº”é¦–éƒ¨ï¼Œç”¨äºæ§åˆ¶ç½‘ç«™å†…å®¹åœ¨å…¶ä»– Web ç½‘ç«™çš„ Frame æ ‡ç­¾å†…çš„æ˜¾ç¤ºé—®é¢˜ã€‚å…¶ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢ç‚¹å‡»åŠ«æŒï¼ˆclickjackingï¼‰æ”»å‡»ã€‚</p>
<h2 id="X-XSS-Protection"><a href="#X-XSS-Protection" class="headerlink" title="X-XSS-Protection"></a>X-XSS-Protection</h2><p>é¦–éƒ¨å­—æ®µ X-XSS-Protection å±äº HTTP å“åº”é¦–éƒ¨ï¼Œå®ƒæ˜¯é’ˆå¯¹è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰çš„ä¸€ç§å¯¹ç­–ï¼Œç”¨äºæ§åˆ¶æµè§ˆå™¨ XSS é˜²æŠ¤æœºåˆ¶çš„å¼€å…³ã€‚0ï¼šå°† XSS è¿‡æ»¤è®¾ç½®æˆæ— æ•ˆçŠ¶æ€ï¼Œ1ï¼šå°† XSS è¿‡æ»¤è®¾ç½®æˆæœ‰æ•ˆçŠ¶æ€ã€‚</p>
<h2 id="DNT"><a href="#DNT" class="headerlink" title="DNT"></a>DNT</h2><p>é¦–éƒ¨å­—æ®µ DNT å±äº HTTP è¯·æ±‚é¦–éƒ¨ï¼Œå…¶ä¸­ DNT æ˜¯ Do Not Track çš„ç®€ç§°ï¼Œæ„ä¸ºæ‹’ç»ä¸ªäººä¿¡æ¯è¢«æ”¶é›†ï¼Œæ˜¯è¡¨ç¤ºæ‹’ç»è¢«ç²¾å‡†å¹¿å‘Šè¿½è¸ªçš„ä¸€ç§æ–¹æ³•ã€‚0ï¼šåŒæ„è¢«è¿½è¸ªï¼Œ1ï¼šæ‹’ç»è¢«è¿½è¸ªã€‚</p>
<h2 id="P3P"><a href="#P3P" class="headerlink" title="P3P"></a>P3P</h2><p>é¦–éƒ¨å­—æ®µ P3P å±äº HTTP å“åº”é¦–éƒ¨ï¼Œé€šè¿‡åˆ©ç”¨ P3Pï¼ˆThe Platform for Privacy Preferencesï¼Œåœ¨çº¿éšç§åå¥½å¹³å°ï¼‰æŠ€æœ¯ï¼Œå¯ä»¥è®© Web ç½‘ç«™ä¸Šçš„ä¸ªäººéšç§å˜æˆä¸€ç§ä»…ä¾›ç¨‹åºå¯ç†è§£çš„å½¢å¼ï¼Œä»¥è¾¾åˆ°ä¿æŠ¤ç”¨æˆ·éšç§çš„ç›®çš„ã€‚</p>
<blockquote>
<p>åœ¨ HTTP ç­‰å¤šç§åè®®ä¸­ï¼Œé€šè¿‡ç»™éæ ‡å‡†å‚æ•°åŠ ä¸Šå‰ç¼€ X- ï¼Œæ¥åŒºåˆ«äºæ ‡å‡†å‚æ•°ï¼Œå¹¶ä½¿é‚£äº›éæ ‡å‡†çš„å‚æ•°ä½œä¸ºæ‰©å±•å˜æˆå¯èƒ½ã€‚ä½†æ˜¯è¿™ç§ç®€å•ç²—æš´çš„åšæ³•æœ‰ç™¾å®³è€Œæ— ä¸€ç›Šï¼Œå› æ­¤åœ¨ â€œRFC6648 - Deprecating the â€œX-â€œ Prefix and Similar Constructs in Application Protocols â€ä¸­æè®®åœæ­¢è¯¥åšæ³•ã€‚ç„¶è€Œï¼Œå¯¹å·²ç»åœ¨ä½¿ç”¨ä¸­çš„ X- å‰ç¼€æ¥è¯´ï¼Œä¸åº”è¯¥è¦æ±‚å…¶å˜æ›´ã€‚</p>
</blockquote>
<p>HTTP é¦–éƒ¨å­—æ®µå°†å®šä¹‰æˆç¼“å­˜ä»£ç†å’Œéç¼“å­˜ä»£ç†çš„è¡Œä¸ºï¼Œåˆ†ä¸º ç«¯åˆ°ç«¯é¦–éƒ¨ï¼ˆEnd-to-end Headerï¼‰ã€é€è·³é¦–éƒ¨ï¼ˆHop-by-hop Headerï¼‰</p>
<ul>
<li>ç«¯åˆ°ç«¯é¦–éƒ¨ï¼šåˆ†åœ¨æ­¤ç±»åˆ«ä¸­çš„é¦–éƒ¨ä¼šè½¬å‘ç»™è¯·æ±‚ / å“åº”å¯¹åº”çš„æœ€ç»ˆæ¥æ”¶ç›®æ ‡ï¼Œä¸”å¿…é¡»ä¿å­˜åœ¨ç”±ç¼“å­˜ç”Ÿæˆçš„ç›¸åº”ä¸­ï¼Œå¦å¤–è§„å®šå®ƒå¿…é¡»è¢«è½¬å‘ã€‚</li>
<li>é€è·³é¦–éƒ¨ï¼šåˆ†åœ¨æ­¤ç±»åˆ«ä¸­çš„é¦–éƒ¨åªå¯¹å•æ¬¡è½¬å‘æœ‰æ•ˆï¼Œä¼šå› é€šè¿‡ç¼“å­˜æˆ–ä»£ç†è€Œä¸å†è½¬å‘ã€‚HTTP/1.1 å’Œä¹‹åç‰ˆæœ¬ä¸­ï¼Œå¦‚æœè¦ä½¿ç”¨ hop-by-hop é¦–éƒ¨ï¼Œéœ€æä¾› Connection é¦–éƒ¨å­—æ®µã€‚ï¼ˆConnectionã€Keep-Aliveã€Proxy-Authenticateã€Proxy-Authorizationã€Trailerã€TEã€Transfer-Encodingã€Upgrade è¿™ 8 ä¸ªé¦–éƒ¨å­—æ®µå±äºé€è·³é¦–éƒ¨ï¼Œé™¤æ­¤ä»¥å¤–çš„å­—æ®µéƒ½å±äºç«¯åˆ°ç«¯é¦–éƒ¨ï¼‰</li>
</ul>
<h1 id="æé«˜-HTTP-æ€§èƒ½"><a href="#æé«˜-HTTP-æ€§èƒ½" class="headerlink" title="æé«˜ HTTP æ€§èƒ½"></a>æé«˜ HTTP æ€§èƒ½</h1><h2 id="å¹¶è¡Œè¿æ¥"><a href="#å¹¶è¡Œè¿æ¥" class="headerlink" title="å¹¶è¡Œè¿æ¥"></a>å¹¶è¡Œè¿æ¥</h2><p>é€šè¿‡å¤šæ¡ TCP è¿æ¥å‘èµ·å¹¶å‘çš„ HTTP è¯·æ±‚ã€‚</p>
<h2 id="æŒä¹…è¿æ¥"><a href="#æŒä¹…è¿æ¥" class="headerlink" title="æŒä¹…è¿æ¥"></a>æŒä¹…è¿æ¥</h2><p>é‡ç”¨ TCP è¿æ¥ï¼Œä»¥æ¶ˆé™¤è¿æ¥åŠå…³é—­çš„æ—¶å»¶ã€‚ æŒä¹…è¿æ¥ï¼ˆHTTP Persistent Connectionsï¼‰ï¼Œä¹Ÿç§°ä¸º HTTP keep-alive æˆ–è€… HTTP connection reuse ã€‚</p>
<p>åœ¨ HTTP/1.1 ä¸­ï¼Œæ‰€æœ‰çš„è¿æ¥é»˜è®¤éƒ½æ˜¯æŒä¹…è¿æ¥ã€‚ä½†æ˜¯æœåŠ¡å™¨ç«¯ä¸ä¸€å®šéƒ½èƒ½å¤Ÿæ”¯æŒæŒä¹…è¿æ¥ï¼Œæ‰€ä»¥é™¤äº†æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯ä¹Ÿéœ€è¦æ”¯æŒæŒä¹…è¿æ¥ã€‚</p>
<h2 id="ç®¡é“åŒ–è¿æ¥"><a href="#ç®¡é“åŒ–è¿æ¥" class="headerlink" title="ç®¡é“åŒ–è¿æ¥"></a>ç®¡é“åŒ–è¿æ¥</h2><p>é€šè¿‡å…±äº«çš„ TCP è¿æ¥å‘èµ·å¹¶å‘çš„ HTTP è¯·æ±‚ã€‚</p>
<p>æŒä¹…è¿æ¥ä½¿å¾—å¤šæ•°è¯·æ±‚ä»¥ç®¡çº¿åŒ–ï¼ˆpipeliningï¼‰æ–¹å¼å‘é€æˆä¸ºå¯èƒ½ã€‚ä»¥å‰å‘é€è¯·æ±‚åéœ€è¦ç­‰å¾…å¹¶æ”¶åˆ°å“åº”ï¼Œæ‰èƒ½å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚ç®¡çº¿åŒ–æŠ€æœ¯å‡ºç°åï¼Œä¸ç”¨ç­‰å¾…å“åº”ï¼Œç›´æ¥å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚</p>
<p>æ¯”å¦‚å½“è¯·æ±‚ä¸€ä¸ªåŒ…å« 10 å¼ å›¾ç‰‡çš„ HTML Web é¡µé¢ï¼Œä¸æŒ¨ä¸ªè¿æ¥ç›¸æ¯”ï¼Œç”¨æŒä¹…è¿æ¥å¯ä»¥è®©è¯·æ±‚æ›´å¿«ç»“æŸã€‚è€Œç®¡çº¿åŒ–æŠ€æœ¯åˆ™æ¯”æŒä¹…è¿æ¥è¿˜è¦å¿«ã€‚è¯·æ±‚æ•°è¶Šå¤šï¼Œæ—¶é—´å·®å°±è¶Šæ˜æ˜¾ã€‚</p>
<h2 id="å¤ç”¨çš„è¿æ¥"><a href="#å¤ç”¨çš„è¿æ¥" class="headerlink" title="å¤ç”¨çš„è¿æ¥"></a>å¤ç”¨çš„è¿æ¥</h2><p>äº¤æ›¿ä¼ é€è¯·æ±‚å’Œå“åº”æŠ¥æ–‡ï¼ˆå®éªŒé˜¶æ®µï¼‰ã€‚</p>
<h1 id="GET-å’Œ-POST-çš„åŒºåˆ«"><a href="#GET-å’Œ-POST-çš„åŒºåˆ«" class="headerlink" title="GET å’Œ POST çš„åŒºåˆ«"></a>GET å’Œ POST çš„åŒºåˆ«</h1><h2 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h2><p>GET å’Œ POST çš„è¯·æ±‚éƒ½èƒ½ä½¿ç”¨é¢å¤–çš„å‚æ•°ï¼Œä½†æ˜¯ GET çš„å‚æ•°æ˜¯ä»¥æŸ¥è¯¢å­—ç¬¦ä¸²å‡ºç°åœ¨ URL ä¸­ï¼Œè€Œ POST çš„å‚æ•°å­˜å‚¨åœ¨å†…å®¹å®ä½“ä¸­(ä¾æ—§æ˜¯æ˜æ–‡ä¼ è¾“ï¼Œåªæ˜¯å’Œ GET å­˜æ”¾çš„ä½ç½®ä¸åŒç½¢äº†)ã€‚</p>
<p>GET çš„ä¼ å‚æ–¹å¼ç›¸æ¯”äº POST å®‰å…¨æ€§è¾ƒå·®ï¼Œå› ä¸º GET ä¼ çš„å‚æ•°åœ¨ URL ä¸­æ˜¯å¯è§çš„ï¼Œå¯èƒ½ä¼šæ³„éœ²ç§å¯†ä¿¡æ¯ã€‚å¹¶ä¸” GET åªæ”¯æŒ ASCII å­—ç¬¦ï¼Œå¦‚æœå‚æ•°ä¸ºä¸­æ–‡åˆ™å¯èƒ½ä¼šå‡ºç°ä¹±ç ï¼Œè€Œ POST æ”¯æŒæ ‡å‡†å­—ç¬¦é›†ã€‚</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/test/demo_form.asp?name1=value1&amp;name2=value2</span> HTTP/1.1</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/test/demo_form.asp</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: w3schools.com</span><br><span class="line">name1=value1&amp;name2=value2</span><br></pre></td></tr></table></figure>
<h2 id="å®‰å…¨"><a href="#å®‰å…¨" class="headerlink" title="å®‰å…¨"></a>å®‰å…¨</h2><p>å®‰å…¨çš„ HTTP æ–¹æ³•ä¸ä¼šæ”¹å˜æœåŠ¡å™¨çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªæ˜¯å¯è¯»çš„ã€‚</p>
<p>GET æ–¹æ³•æ˜¯å®‰å…¨çš„ï¼Œè€Œ POST å´ä¸æ˜¯ï¼Œå› ä¸º POST çš„ç›®çš„æ˜¯ä¼ é€å®ä½“ä¸»ä½“å†…å®¹ï¼Œè¿™ä¸ªå†…å®¹å¯èƒ½æ˜¯ç”¨æˆ·ä¸Šä¼ çš„è¡¨å•æ•°æ®ï¼Œä¸Šä¼ æˆåŠŸä¹‹åï¼ŒæœåŠ¡å™¨å¯èƒ½æŠŠè¿™ä¸ªæ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œå› æ­¤çŠ¶æ€ä¹Ÿå°±å‘ç”Ÿäº†æ”¹å˜ã€‚</p>
<p>å®‰å…¨çš„æ–¹æ³•é™¤äº† GET ä¹‹å¤–è¿˜æœ‰ï¼šHEADã€OPTIONSã€‚</p>
<p>ä¸å®‰å…¨çš„æ–¹æ³•é™¤äº† POST ä¹‹å¤–è¿˜æœ‰ PUTã€DELETEã€‚</p>
<h2 id="å¹‚ç­‰æ€§"><a href="#å¹‚ç­‰æ€§" class="headerlink" title="å¹‚ç­‰æ€§"></a>å¹‚ç­‰æ€§</h2><p>å¹‚ç­‰çš„ HTTP æ–¹æ³•ï¼ŒåŒæ ·çš„è¯·æ±‚è¢«æ‰§è¡Œä¸€æ¬¡ä¸è¿ç»­æ‰§è¡Œå¤šæ¬¡çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼ŒæœåŠ¡å™¨çš„çŠ¶æ€ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚æ¢å¥è¯è¯´å°±æ˜¯ï¼Œå¹‚ç­‰æ–¹æ³•ä¸åº”è¯¥å…·æœ‰å‰¯ä½œç”¨ï¼ˆç»Ÿè®¡ç”¨é€”é™¤å¤–ï¼‰ã€‚åœ¨æ­£ç¡®å®ç°çš„æ¡ä»¶ä¸‹ï¼ŒGETï¼ŒHEADï¼ŒPUT å’Œ DELETE ç­‰æ–¹æ³•éƒ½æ˜¯å¹‚ç­‰çš„ï¼Œè€Œ POST æ–¹æ³•ä¸æ˜¯ã€‚æ‰€æœ‰çš„å®‰å…¨æ–¹æ³•ä¹Ÿéƒ½æ˜¯å¹‚ç­‰çš„ã€‚</p>
<p>GET /pageX HTTP/1.1 æ˜¯å¹‚ç­‰çš„ã€‚è¿ç»­è°ƒç”¨å¤šæ¬¡ï¼Œå®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼š</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/pageX</span> HTTP/1.1</span><br><span class="line"><span class="keyword">GET</span> <span class="string">/pageX</span> HTTP/1.1</span><br><span class="line"><span class="keyword">GET</span> <span class="string">/pageX</span> HTTP/1.1</span><br><span class="line"><span class="keyword">GET</span> <span class="string">/pageX</span> HTTP/1.1</span><br></pre></td></tr></table></figure>
<p>POST /add_row HTTP/1.1 ä¸æ˜¯å¹‚ç­‰çš„ã€‚å¦‚æœè°ƒç”¨å¤šæ¬¡ï¼Œå°±ä¼šå¢åŠ å¤šè¡Œè®°å½•ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/add_row</span> HTTP/1.1</span><br><span class="line">POST /add_row HTTP/1.1   -&gt; Adds a 2nd row</span><br><span class="line">POST /add_row HTTP/1.1   -&gt; Adds a 3rd row</span><br></pre></td></tr></table></figure>
<p>DELETE /idX/delete HTTP/1.1 æ˜¯å¹‚ç­‰çš„ï¼Œå³ä¾¿æ˜¯ä¸åŒè¯·æ±‚ä¹‹é—´æ¥æ”¶åˆ°çš„çŠ¶æ€ç ä¸ä¸€æ ·ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DELETE /idX/delete HTTP/1.1   -&gt; Returns 200 if idX exists</span><br><span class="line">DELETE /idX/delete HTTP/1.1   -&gt; Returns 404 as it just got deleted</span><br><span class="line">DELETE /idX/delete HTTP/1.1   -&gt; Returns 404</span><br></pre></td></tr></table></figure>
<h2 id="å¯ç¼“å­˜"><a href="#å¯ç¼“å­˜" class="headerlink" title="å¯ç¼“å­˜"></a>å¯ç¼“å­˜</h2><p>å¦‚æœè¦å¯¹å“åº”è¿›è¡Œç¼“å­˜ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<ol>
<li>è¯·æ±‚æŠ¥æ–‡çš„ HTTP æ–¹æ³•æœ¬èº«æ˜¯å¯ç¼“å­˜çš„ï¼ŒåŒ…æ‹¬ GET å’Œ HEADï¼Œä½†æ˜¯ PUT å’Œ DELETE ä¸å¯ç¼“å­˜ï¼ŒPOST åœ¨å¤šæ•°æƒ…å†µä¸‹ä¸å¯ç¼“å­˜çš„ã€‚</li>
<li>å“åº”æŠ¥æ–‡çš„çŠ¶æ€ç æ˜¯å¯ç¼“å­˜çš„ï¼ŒåŒ…æ‹¬ï¼š200, 203, 204, 206, 300, 301, 404, 405, 410, 414, and 501ã€‚</li>
<li>å“åº”æŠ¥æ–‡çš„ Cache-Control é¦–éƒ¨å­—æ®µæ²¡æœ‰æŒ‡å®šä¸è¿›è¡Œç¼“å­˜ã€‚</li>
</ol>
<h2 id="XMLHttpRequest"><a href="#XMLHttpRequest" class="headerlink" title="XMLHttpRequest"></a>XMLHttpRequest</h2><p>ä¸ºäº†é˜è¿° POST å’Œ GET çš„å¦ä¸€ä¸ªåŒºåˆ«ï¼Œéœ€è¦å…ˆäº†è§£ XMLHttpRequestï¼š</p>
<blockquote>
<p>XMLHttpRequest æ˜¯ä¸€ä¸ª APIï¼Œå®ƒä¸ºå®¢æˆ·ç«¯æä¾›äº†åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®çš„åŠŸèƒ½ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé€šè¿‡ URL æ¥è·å–æ•°æ®çš„ç®€å•æ–¹å¼ï¼Œå¹¶ä¸”ä¸ä¼šä½¿æ•´ä¸ªé¡µé¢åˆ·æ–°ã€‚è¿™ä½¿å¾—ç½‘é¡µåªæ›´æ–°ä¸€éƒ¨åˆ†é¡µé¢è€Œä¸ä¼šæ‰“æ‰°åˆ°ç”¨æˆ·ã€‚XMLHttpRequest åœ¨ AJAX ä¸­è¢«å¤§é‡ä½¿ç”¨ã€‚</p>
</blockquote>
<p>åœ¨ä½¿ç”¨ XMLHttpRequest çš„ POST æ–¹æ³•æ—¶ï¼Œæµè§ˆå™¨ä¼šå…ˆå‘é€ Header å†å‘é€ Dataã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨ä¼šè¿™ä¹ˆåšï¼Œä¾‹å¦‚ç«ç‹å°±ä¸ä¼šã€‚</p>
<h1 id="HTTP-å„ç‰ˆæœ¬æ¯”è¾ƒ"><a href="#HTTP-å„ç‰ˆæœ¬æ¯”è¾ƒ" class="headerlink" title="HTTP å„ç‰ˆæœ¬æ¯”è¾ƒ"></a>HTTP å„ç‰ˆæœ¬æ¯”è¾ƒ</h1><h2 id="HTTP-1-0-ä¸-HTTP-1-1-çš„åŒºåˆ«"><a href="#HTTP-1-0-ä¸-HTTP-1-1-çš„åŒºåˆ«" class="headerlink" title="HTTP/1.0 ä¸ HTTP/1.1 çš„åŒºåˆ«"></a>HTTP/1.0 ä¸ HTTP/1.1 çš„åŒºåˆ«</h2><ol>
<li>HTTP/1.1 é»˜è®¤æ˜¯æŒä¹…è¿æ¥</li>
<li>HTTP/1.1 æ”¯æŒç®¡çº¿åŒ–å¤„ç†</li>
<li>HTTP/1.1 æ”¯æŒè™šæ‹Ÿä¸»æœº</li>
<li>HTTP/1.1 æ–°å¢çŠ¶æ€ç  100</li>
<li>HTTP/1.1 æ”¯æŒåˆ†å—ä¼ è¾“ç¼–ç </li>
<li>HTTP/1.1 æ–°å¢ç¼“å­˜å¤„ç†æŒ‡ä»¤ max-age</li>
</ol>
<p>å…·ä½“å†…å®¹è§ä¸Šæ–‡</p>
<h2 id="HTTP-1-1-ä¸-HTTP-2-0-çš„åŒºåˆ«"><a href="#HTTP-1-1-ä¸-HTTP-2-0-çš„åŒºåˆ«" class="headerlink" title="HTTP/1.1 ä¸ HTTP/2.0 çš„åŒºåˆ«"></a>HTTP/1.1 ä¸ HTTP/2.0 çš„åŒºåˆ«</h2><blockquote>
<p><a href="https://developers.google.com/web/fundamentals/performance/http2/?hl=zh-cn" target="_blank" rel="noopener">HTTP/2 ç®€ä»‹</a></p>
</blockquote>
<h3 id="å¤šè·¯å¤ç”¨"><a href="#å¤šè·¯å¤ç”¨" class="headerlink" title="å¤šè·¯å¤ç”¨"></a>å¤šè·¯å¤ç”¨</h3><p>HTTP/2.0 ä½¿ç”¨å¤šè·¯å¤ç”¨æŠ€æœ¯ï¼ŒåŒä¸€ä¸ª TCP è¿æ¥å¯ä»¥å¤„ç†å¤šä¸ªè¯·æ±‚ã€‚</p>
<h3 id="é¦–éƒ¨å‹ç¼©"><a href="#é¦–éƒ¨å‹ç¼©" class="headerlink" title="é¦–éƒ¨å‹ç¼©"></a>é¦–éƒ¨å‹ç¼©</h3><p>HTTP/1.1 çš„é¦–éƒ¨å¸¦æœ‰å¤§é‡ä¿¡æ¯ï¼Œè€Œä¸”æ¯æ¬¡éƒ½è¦é‡å¤å‘é€ã€‚HTTP/2.0 è¦æ±‚é€šè®¯åŒæ–¹å„è‡ªç¼“å­˜ä¸€ä»½é¦–éƒ¨å­—æ®µè¡¨ï¼Œä»è€Œé¿å…äº†é‡å¤ä¼ è¾“ã€‚</p>
<h3 id="æœåŠ¡ç«¯æ¨é€"><a href="#æœåŠ¡ç«¯æ¨é€" class="headerlink" title="æœåŠ¡ç«¯æ¨é€"></a>æœåŠ¡ç«¯æ¨é€</h3><p>HTTP/2.0 åœ¨å®¢æˆ·ç«¯è¯·æ±‚ä¸€ä¸ªèµ„æºæ—¶ï¼Œä¼šæŠŠç›¸å…³çš„èµ„æºä¸€èµ·å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°±ä¸éœ€è¦å†æ¬¡å‘èµ·è¯·æ±‚äº†ã€‚ä¾‹å¦‚å®¢æˆ·ç«¯è¯·æ±‚ index.html é¡µé¢ï¼ŒæœåŠ¡ç«¯å°±æŠŠ index.js ä¸€èµ·å‘ç»™å®¢æˆ·ç«¯ã€‚</p>
<h3 id="äºŒè¿›åˆ¶æ ¼å¼"><a href="#äºŒè¿›åˆ¶æ ¼å¼" class="headerlink" title="äºŒè¿›åˆ¶æ ¼å¼"></a>äºŒè¿›åˆ¶æ ¼å¼</h3><p>HTTP/1.1 çš„è§£ææ˜¯åŸºäºæ–‡æœ¬çš„ï¼Œè€Œ HTTP/2.0 é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼ã€‚</p>
<h1 id="æµè§ˆå™¨åŒæºæ”¿ç­–åŠå…¶è§„é¿æ–¹æ³•"><a href="#æµè§ˆå™¨åŒæºæ”¿ç­–åŠå…¶è§„é¿æ–¹æ³•" class="headerlink" title="æµè§ˆå™¨åŒæºæ”¿ç­–åŠå…¶è§„é¿æ–¹æ³•"></a>æµè§ˆå™¨åŒæºæ”¿ç­–åŠå…¶è§„é¿æ–¹æ³•</h1><p>1995å¹´ï¼ŒåŒæºæ”¿ç­–ç”± Netscape å…¬å¸å¼•å…¥æµè§ˆå™¨ã€‚ç›®å‰ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½å®è¡Œè¿™ä¸ªæ”¿ç­–ã€‚</p>
<p>æœ€åˆï¼Œå®ƒçš„å«ä¹‰æ˜¯æŒ‡ï¼ŒAç½‘é¡µè®¾ç½®çš„ Cookieï¼ŒBç½‘é¡µä¸èƒ½æ‰“å¼€ï¼Œé™¤éè¿™ä¸¤ä¸ªç½‘é¡µâ€åŒæºâ€ã€‚æ‰€è°“â€åŒæºâ€æŒ‡çš„æ˜¯â€ä¸‰ä¸ªç›¸åŒâ€ã€‚</p>
<ul>
<li>åè®®ç›¸åŒ</li>
<li>åŸŸåç›¸åŒ</li>
<li>ç«¯å£ç›¸åŒ</li>
</ul>
<p>ä¸¾ä¾‹æ¥è¯´ï¼Œ<a href="http://www.example.com/dir/page.html" target="_blank" rel="noopener">http://www.example.com/dir/page.html</a>  è¿™ä¸ªç½‘å€ï¼Œåè®®æ˜¯http://ï¼ŒåŸŸåæ˜¯<a href="http://www.example.comï¼Œç«¯å£æ˜¯80ï¼ˆé»˜è®¤ç«¯å£å¯ä»¥çœç•¥ï¼‰ã€‚å®ƒçš„åŒæºæƒ…å†µå¦‚ä¸‹ã€‚" target="_blank" rel="noopener">www.example.comï¼Œç«¯å£æ˜¯80ï¼ˆé»˜è®¤ç«¯å£å¯ä»¥çœç•¥ï¼‰ã€‚å®ƒçš„åŒæºæƒ…å†µå¦‚ä¸‹ã€‚</a></p>
<ul>
<li><a href="http://www.example.com/dir2/other.html" target="_blank" rel="noopener">http://www.example.com/dir2/other.html</a>  åŒæº</li>
<li><a href="http://example.com/dir/other.html" target="_blank" rel="noopener">http://example.com/dir/other.html</a> ä¸åŒæºï¼ˆåŸŸåä¸åŒï¼‰</li>
<li><a href="http://v2.www.example.com/dir/other.html" target="_blank" rel="noopener">http://v2.www.example.com/dir/other.html</a> ä¸åŒæºï¼ˆåŸŸåä¸åŒï¼‰</li>
<li><a href="http://www.example.com:81/dir/other.html" target="_blank" rel="noopener">http://www.example.com:81/dir/other.html</a> ä¸åŒæºï¼ˆç«¯å£ä¸åŒï¼‰</li>
</ul>
<p>åŒæºæ”¿ç­–çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†ä¿è¯ç”¨æˆ·ä¿¡æ¯çš„å®‰å…¨ï¼Œé˜²æ­¢æ¶æ„çš„ç½‘ç«™çªƒå–æ•°æ®ã€‚<br>è®¾æƒ³è¿™æ ·ä¸€ç§æƒ…å†µï¼šAç½‘ç«™æ˜¯ä¸€å®¶é“¶è¡Œï¼Œç”¨æˆ·ç™»å½•ä»¥åï¼Œåˆå»æµè§ˆå…¶ä»–ç½‘ç«™ã€‚å¦‚æœå…¶ä»–ç½‘ç«™å¯ä»¥è¯»å–Aç½‘ç«™çš„ Cookieï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ<br>å¾ˆæ˜¾ç„¶ï¼Œå¦‚æœ Cookie åŒ…å«éšç§ï¼ˆæ¯”å¦‚å­˜æ¬¾æ€»é¢ï¼‰ï¼Œè¿™äº›ä¿¡æ¯å°±ä¼šæ³„æ¼ã€‚æ›´å¯æ€•çš„æ˜¯ï¼ŒCookie å¾€å¾€ç”¨æ¥ä¿å­˜ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰é€€å‡ºç™»å½•ï¼Œå…¶ä»–ç½‘ç«™å°±å¯ä»¥å†’å……ç”¨æˆ·ï¼Œä¸ºæ‰€æ¬²ä¸ºã€‚å› ä¸ºæµè§ˆå™¨åŒæ—¶è¿˜è§„å®šï¼Œæäº¤è¡¨å•ä¸å—åŒæºæ”¿ç­–çš„é™åˆ¶ã€‚<br>ç”±æ­¤å¯è§ï¼Œâ€åŒæºæ”¿ç­–â€æ˜¯å¿…éœ€çš„ï¼Œå¦åˆ™ Cookie å¯ä»¥å…±äº«ï¼Œäº’è”ç½‘å°±æ¯«æ— å®‰å…¨å¯è¨€äº†ã€‚</p>
<p>éšç€äº’è”ç½‘çš„å‘å±•ï¼Œâ€åŒæºæ”¿ç­–â€è¶Šæ¥è¶Šä¸¥æ ¼ã€‚ç›®å‰ï¼Œå¦‚æœéåŒæºï¼Œå…±æœ‰ä¸‰ç§è¡Œä¸ºå—åˆ°é™åˆ¶ã€‚</p>
<ol>
<li>Cookieã€LocalStorage å’Œ IndexDB æ— æ³•è¯»å–ã€‚</li>
<li>DOM æ— æ³•è·å¾—ã€‚</li>
<li>AJAX è¯·æ±‚ä¸èƒ½å‘é€ã€‚</li>
</ol>
<p>è™½ç„¶è¿™äº›é™åˆ¶æ˜¯å¿…è¦çš„ï¼Œä½†æ˜¯æœ‰æ—¶å¾ˆä¸æ–¹ä¾¿ï¼Œåˆç†çš„ç”¨é€”ä¹Ÿå—åˆ°å½±å“ã€‚ä¸‹é¢ï¼Œæˆ‘å°†è¯¦ç»†ä»‹ç»ï¼Œå¦‚ä½•è§„é¿ä¸Šé¢ä¸‰ç§é™åˆ¶ã€‚</p>
<h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><p>Cookie æ˜¯æœåŠ¡å™¨å†™å…¥æµè§ˆå™¨çš„ä¸€å°æ®µä¿¡æ¯ï¼Œåªæœ‰åŒæºçš„ç½‘é¡µæ‰èƒ½å…±äº«ã€‚ä½†æ˜¯ï¼Œä¸¤ä¸ªç½‘é¡µä¸€çº§åŸŸåç›¸åŒï¼Œåªæ˜¯äºŒçº§åŸŸåä¸åŒï¼Œæµè§ˆå™¨å…è®¸é€šè¿‡è®¾ç½®document.domainå…±äº« Cookieã€‚<br>ä¸¾ä¾‹æ¥è¯´ï¼ŒAç½‘é¡µæ˜¯<a href="http://w1.example.com/a.htmlï¼ŒBç½‘é¡µæ˜¯http://w2.example.com/b.htmlï¼Œé‚£ä¹ˆåªè¦è®¾ç½®ç›¸åŒçš„document.domainï¼Œä¸¤ä¸ªç½‘é¡µå°±å¯ä»¥å…±äº«Cookieã€‚" target="_blank" rel="noopener">http://w1.example.com/a.htmlï¼ŒBç½‘é¡µæ˜¯http://w2.example.com/b.htmlï¼Œé‚£ä¹ˆåªè¦è®¾ç½®ç›¸åŒçš„document.domainï¼Œä¸¤ä¸ªç½‘é¡µå°±å¯ä»¥å…±äº«Cookieã€‚</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.domain = &apos;example.com&apos;;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼ŒAç½‘é¡µé€šè¿‡è„šæœ¬è®¾ç½®ä¸€ä¸ª Cookieã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.cookie = &quot;test1=hello&quot;;</span><br></pre></td></tr></table></figure>
<p>Bç½‘é¡µå°±å¯ä»¥è¯»åˆ°è¿™ä¸ª Cookieã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var allCookie = document.cookie;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œè¿™ç§æ–¹æ³•åªé€‚ç”¨äº Cookie å’Œ iframe çª—å£ï¼ŒLocalStorage å’Œ IndexDB æ— æ³•é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œè§„é¿åŒæºæ”¿ç­–ï¼Œè€Œè¦ä½¿ç”¨ä¸‹æ–‡ä»‹ç»çš„PostMessage APIã€‚<br>å¦å¤–ï¼ŒæœåŠ¡å™¨ä¹Ÿå¯ä»¥åœ¨è®¾ç½®Cookieçš„æ—¶å€™ï¼ŒæŒ‡å®šCookieçš„æ‰€å±åŸŸåä¸ºä¸€çº§åŸŸåï¼Œæ¯”å¦‚.example.comã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: key=value; domain=.example.com; path=/</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çš„è¯ï¼ŒäºŒçº§åŸŸåå’Œä¸‰çº§åŸŸåä¸ç”¨åšä»»ä½•è®¾ç½®ï¼Œéƒ½å¯ä»¥è¯»å–è¿™ä¸ªCookieã€‚</p>
<h2 id="iframe"><a href="#iframe" class="headerlink" title="iframe"></a>iframe</h2><p>å¦‚æœä¸¤ä¸ªç½‘é¡µä¸åŒæºï¼Œå°±æ— æ³•æ‹¿åˆ°å¯¹æ–¹çš„DOMã€‚å…¸å‹çš„ä¾‹å­æ˜¯iframeçª—å£å’Œwindow.openæ–¹æ³•æ‰“å¼€çš„çª—å£ï¼Œå®ƒä»¬ä¸çˆ¶çª—å£æ— æ³•é€šä¿¡ã€‚<br>æ¯”å¦‚ï¼Œçˆ¶çª—å£è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå¦‚æœiframeçª—å£ä¸æ˜¯åŒæºï¼Œå°±ä¼šæŠ¥é”™ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">document.getElementById(&quot;myIFrame&quot;).contentWindow.document</span><br><span class="line">// Uncaught DOMException: Blocked a frame from accessing a cross-origin frame.</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢å‘½ä»¤ä¸­ï¼Œçˆ¶çª—å£æƒ³è·å–å­çª—å£çš„DOMï¼Œå› ä¸ºè·¨æºå¯¼è‡´æŠ¥é”™ã€‚</p>
<p>åä¹‹äº¦ç„¶ï¼Œå­çª—å£è·å–ä¸»çª—å£çš„DOMä¹Ÿä¼šæŠ¥é”™ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">window.parent.document.body</span><br><span class="line">// æŠ¥é”™</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸¤ä¸ªçª—å£ä¸€çº§åŸŸåç›¸åŒï¼Œåªæ˜¯äºŒçº§åŸŸåä¸åŒï¼Œé‚£ä¹ˆè®¾ç½®ä¸Šä¸€èŠ‚ä»‹ç»çš„document.domainå±æ€§ï¼Œå°±å¯ä»¥è§„é¿åŒæºæ”¿ç­–ï¼Œæ‹¿åˆ°DOMã€‚<br>å¯¹äºå®Œå…¨ä¸åŒæºçš„ç½‘ç«™ï¼Œç›®å‰æœ‰ä¸‰ç§æ–¹æ³•ï¼Œå¯ä»¥è§£å†³è·¨åŸŸçª—å£çš„é€šä¿¡é—®é¢˜ã€‚</p>
<ul>
<li>ç‰‡æ®µè¯†åˆ«ç¬¦ï¼ˆfragment identifierï¼‰</li>
<li>window.name</li>
<li>è·¨æ–‡æ¡£é€šä¿¡APIï¼ˆCross-document messagingï¼‰</li>
</ul>
<h3 id="ç‰‡æ®µè¯†åˆ«ç¬¦"><a href="#ç‰‡æ®µè¯†åˆ«ç¬¦" class="headerlink" title="ç‰‡æ®µè¯†åˆ«ç¬¦"></a>ç‰‡æ®µè¯†åˆ«ç¬¦</h3><p>ç‰‡æ®µæ ‡è¯†ç¬¦ï¼ˆfragment identifierï¼‰æŒ‡çš„æ˜¯ï¼ŒURLçš„#å·åé¢çš„éƒ¨åˆ†ï¼Œæ¯”å¦‚ <a href="http://example.com/x.html#fragment" target="_blank" rel="noopener">http://example.com/x.html#fragment</a> çš„ <code>#fragment</code>ã€‚å¦‚æœåªæ˜¯æ”¹å˜ç‰‡æ®µæ ‡è¯†ç¬¦ï¼Œé¡µé¢ä¸ä¼šé‡æ–°åˆ·æ–°ã€‚</p>
<p>çˆ¶çª—å£å¯ä»¥æŠŠä¿¡æ¯ï¼Œå†™å…¥å­çª—å£çš„ç‰‡æ®µæ ‡è¯†ç¬¦ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var src = originURL + &apos;#&apos; + data;</span><br><span class="line">document.getElementById(&apos;myIFrame&apos;).src = src;</span><br></pre></td></tr></table></figure>
<p>å­çª—å£é€šè¿‡ç›‘å¬hashchangeäº‹ä»¶å¾—åˆ°é€šçŸ¥ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">window.onhashchange = checkMessage;</span><br><span class="line"></span><br><span class="line">function checkMessage() &#123;</span><br><span class="line">  var message = window.location.hash;</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒæ ·çš„ï¼Œå­çª—å£ä¹Ÿå¯ä»¥æ”¹å˜çˆ¶çª—å£çš„ç‰‡æ®µæ ‡è¯†ç¬¦ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parent.location.href= target + &quot;#&quot; + hash;</span><br></pre></td></tr></table></figure>
<h3 id="window-name"><a href="#window-name" class="headerlink" title="window.name"></a>window.name</h3><p>æµè§ˆå™¨çª—å£æœ‰window.nameå±æ€§ã€‚è¿™ä¸ªå±æ€§çš„æœ€å¤§ç‰¹ç‚¹æ˜¯ï¼Œæ— è®ºæ˜¯å¦åŒæºï¼Œåªè¦åœ¨åŒä¸€ä¸ªçª—å£é‡Œï¼Œå‰ä¸€ä¸ªç½‘é¡µè®¾ç½®äº†è¿™ä¸ªå±æ€§ï¼Œåä¸€ä¸ªç½‘é¡µå¯ä»¥è¯»å–å®ƒã€‚</p>
<p>çˆ¶çª—å£å…ˆæ‰“å¼€ä¸€ä¸ªå­çª—å£ï¼Œè½½å…¥ä¸€ä¸ªä¸åŒæºçš„ç½‘é¡µï¼Œè¯¥ç½‘é¡µå°†ä¿¡æ¯å†™å…¥window.nameå±æ€§ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window.name = data;</span><br></pre></td></tr></table></figure>
<p>æ¥ç€ï¼Œå­çª—å£è·³å›ä¸€ä¸ªä¸ä¸»çª—å£åŒåŸŸçš„ç½‘å€ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">location = &apos;http://parent.url.com/xxx.html&apos;;</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œä¸»çª—å£å°±å¯ä»¥è¯»å–å­çª—å£çš„window.nameäº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var data = document.getElementById(&apos;myFrame&apos;).contentWindow.name;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯ï¼Œwindow.nameå®¹é‡å¾ˆå¤§ï¼Œå¯ä»¥æ”¾ç½®éå¸¸é•¿çš„å­—ç¬¦ä¸²ï¼›ç¼ºç‚¹æ˜¯å¿…é¡»ç›‘å¬å­çª—å£window.nameå±æ€§çš„å˜åŒ–ï¼Œå½±å“ç½‘é¡µæ€§èƒ½ã€‚</p>
<h3 id="window-postMessage"><a href="#window-postMessage" class="headerlink" title="window.postMessage"></a>window.postMessage</h3><p>ä¸Šé¢ä¸¤ç§æ–¹æ³•éƒ½å±äºç ´è§£ï¼ŒHTML5ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼•å…¥äº†ä¸€ä¸ªå…¨æ–°çš„APIï¼šè·¨æ–‡æ¡£é€šä¿¡ APIï¼ˆCross-document messagingï¼‰ã€‚<br>è¿™ä¸ªAPIä¸ºwindowå¯¹è±¡æ–°å¢äº†ä¸€ä¸ªwindow.postMessageæ–¹æ³•ï¼Œå…è®¸è·¨çª—å£é€šä¿¡ï¼Œä¸è®ºè¿™ä¸¤ä¸ªçª—å£æ˜¯å¦åŒæºã€‚<br>ä¸¾ä¾‹æ¥è¯´ï¼Œçˆ¶çª—å£<code>http://aaa.com</code>å‘å­çª—å£<code>http://bbb.com</code>å‘æ¶ˆæ¯ï¼Œè°ƒç”¨postMessageæ–¹æ³•å°±å¯ä»¥äº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var popup = window.open(&apos;http://bbb.com&apos;, &apos;title&apos;);</span><br><span class="line">popup.postMessage(&apos;Hello World!&apos;, &apos;http://bbb.com&apos;);</span><br></pre></td></tr></table></figure>
<p>postMessageæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å…·ä½“çš„ä¿¡æ¯å†…å®¹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ¥æ”¶æ¶ˆæ¯çš„çª—å£çš„æºï¼ˆoriginï¼‰ï¼Œå³â€åè®® + åŸŸå + ç«¯å£â€ã€‚ä¹Ÿå¯ä»¥è®¾ä¸º*ï¼Œè¡¨ç¤ºä¸é™åˆ¶åŸŸåï¼Œå‘æ‰€æœ‰çª—å£å‘é€ã€‚</p>
<p>å­çª—å£å‘çˆ¶çª—å£å‘é€æ¶ˆæ¯çš„å†™æ³•ç±»ä¼¼ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window.opener.postMessage(&apos;Nice to see you&apos;, &apos;http://aaa.com&apos;);</span><br></pre></td></tr></table></figure>
<p>çˆ¶çª—å£å’Œå­çª—å£éƒ½å¯ä»¥é€šè¿‡messageäº‹ä»¶ï¼Œç›‘å¬å¯¹æ–¹çš„æ¶ˆæ¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">window.addEventListener(&apos;message&apos;, function(e) &#123;</span><br><span class="line">  console.log(e.data);</span><br><span class="line">&#125;,false);</span><br></pre></td></tr></table></figure>
<p>messageäº‹ä»¶çš„äº‹ä»¶å¯¹è±¡eventï¼Œæä¾›ä»¥ä¸‹ä¸‰ä¸ªå±æ€§ã€‚</p>
<ul>
<li>event.sourceï¼šå‘é€æ¶ˆæ¯çš„çª—å£</li>
<li>event.origin: æ¶ˆæ¯å‘å‘çš„ç½‘å€</li>
<li>event.data: æ¶ˆæ¯å†…å®¹</li>
</ul>
<p>ä¸‹é¢çš„ä¾‹å­æ˜¯ï¼Œå­çª—å£é€šè¿‡event.sourceå±æ€§å¼•ç”¨çˆ¶çª—å£ï¼Œç„¶åå‘é€æ¶ˆæ¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">window.addEventListener(&apos;message&apos;, receiveMessage);</span><br><span class="line">function receiveMessage(event) &#123;</span><br><span class="line">  event.source.postMessage(&apos;Nice to see you!&apos;, &apos;*&apos;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>event.originå±æ€§å¯ä»¥è¿‡æ»¤ä¸æ˜¯å‘ç»™æœ¬çª—å£çš„æ¶ˆæ¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">window.addEventListener(&apos;message&apos;, receiveMessage);</span><br><span class="line">function receiveMessage(event) &#123;</span><br><span class="line">  if (event.origin !== &apos;http://aaa.com&apos;) return;</span><br><span class="line">  if (event.data === &apos;Hello World&apos;) &#123;</span><br><span class="line">      event.source.postMessage(&apos;Hello&apos;, event.origin);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    console.log(event.data);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="LocalStorage"><a href="#LocalStorage" class="headerlink" title="LocalStorage"></a>LocalStorage</h3><p>é€šè¿‡window.postMessageï¼Œè¯»å†™å…¶ä»–çª—å£çš„ LocalStorage ä¹Ÿæˆä¸ºäº†å¯èƒ½ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œä¸»çª—å£å†™å…¥iframeå­çª—å£çš„localStorageã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">window.onmessage = function(e) &#123;</span><br><span class="line">  if (e.origin !== &apos;http://bbb.com&apos;) &#123;</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line">  var payload = JSON.parse(e.data);</span><br><span class="line">  localStorage.setItem(payload.key, JSON.stringify(payload.data));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œå­çª—å£å°†çˆ¶çª—å£å‘æ¥çš„æ¶ˆæ¯ï¼Œå†™å…¥è‡ªå·±çš„LocalStorageã€‚</p>
<p>çˆ¶çª—å£å‘é€æ¶ˆæ¯çš„ä»£ç å¦‚ä¸‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var win = document.getElementsByTagName(&apos;iframe&apos;)[0].contentWindow;</span><br><span class="line">var obj = &#123; name: &apos;Jack&apos; &#125;;</span><br><span class="line">win.postMessage(JSON.stringify(&#123;key: &apos;storage&apos;, data: obj&#125;), &apos;http://bbb.com&apos;);</span><br></pre></td></tr></table></figure>
<p>åŠ å¼ºç‰ˆçš„å­çª—å£æ¥æ”¶æ¶ˆæ¯çš„ä»£ç å¦‚ä¸‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">window.onmessage = function(e) &#123;</span><br><span class="line">  if (e.origin !== &apos;http://bbb.com&apos;) return;</span><br><span class="line">  var payload = JSON.parse(e.data);</span><br><span class="line">  switch (payload.method) &#123;</span><br><span class="line">    case &apos;set&apos;:</span><br><span class="line">      localStorage.setItem(payload.key, JSON.stringify(payload.data));</span><br><span class="line">      break;</span><br><span class="line">    case &apos;get&apos;:</span><br><span class="line">      var parent = window.parent;</span><br><span class="line">      var data = localStorage.getItem(payload.key);</span><br><span class="line">      parent.postMessage(data, &apos;http://aaa.com&apos;);</span><br><span class="line">      break;</span><br><span class="line">    case &apos;remove&apos;:</span><br><span class="line">      localStorage.removeItem(payload.key);</span><br><span class="line">      break;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>åŠ å¼ºç‰ˆçš„çˆ¶çª—å£å‘é€æ¶ˆæ¯ä»£ç å¦‚ä¸‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var win = document.getElementsByTagName(&apos;iframe&apos;)[0].contentWindow;</span><br><span class="line">var obj = &#123; name: &apos;Jack&apos; &#125;;</span><br><span class="line">// å­˜å…¥å¯¹è±¡</span><br><span class="line">win.postMessage(JSON.stringify(&#123;key: &apos;storage&apos;, method: &apos;set&apos;, data: obj&#125;), &apos;http://bbb.com&apos;);</span><br><span class="line">// è¯»å–å¯¹è±¡</span><br><span class="line">win.postMessage(JSON.stringify(&#123;key: &apos;storage&apos;, method: &quot;get&quot;&#125;), &quot;*&quot;);</span><br><span class="line">window.onmessage = function(e) &#123;</span><br><span class="line">  if (e.origin != &apos;http://aaa.com&apos;) return;</span><br><span class="line">  // &quot;Jack&quot;</span><br><span class="line">  console.log(JSON.parse(e.data).name);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="AJAX"><a href="#AJAX" class="headerlink" title="AJAX"></a>AJAX</h2><p>åŒæºæ”¿ç­–è§„å®šï¼ŒAJAXè¯·æ±‚åªèƒ½å‘ç»™åŒæºçš„ç½‘å€ï¼Œå¦åˆ™å°±æŠ¥é”™ã€‚</p>
<p>é™¤äº†æ¶è®¾æœåŠ¡å™¨ä»£ç†ï¼ˆæµè§ˆå™¨è¯·æ±‚åŒæºæœåŠ¡å™¨ï¼Œå†ç”±åè€…è¯·æ±‚å¤–éƒ¨æœåŠ¡ï¼‰ï¼Œæœ‰ä¸‰ç§æ–¹æ³•è§„é¿è¿™ä¸ªé™åˆ¶ã€‚</p>
<ul>
<li>JSONP</li>
<li>WebSocket</li>
<li>CORS</li>
</ul>
<h3 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h3><p>JSONPæ˜¯æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯è·¨æºé€šä¿¡çš„å¸¸ç”¨æ–¹æ³•ã€‚æœ€å¤§ç‰¹ç‚¹å°±æ˜¯ç®€å•é€‚ç”¨ï¼Œè€å¼æµè§ˆå™¨å…¨éƒ¨æ”¯æŒï¼ŒæœåŠ¡å™¨æ”¹é€ éå¸¸å°ã€‚</p>
<p>å®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼Œç½‘é¡µé€šè¿‡æ·»åŠ ä¸€ä¸ª<code>&lt;script&gt;</code>å…ƒç´ ï¼Œå‘æœåŠ¡å™¨è¯·æ±‚JSONæ•°æ®ï¼Œè¿™ç§åšæ³•ä¸å—åŒæºæ”¿ç­–é™åˆ¶ï¼›æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œå°†æ•°æ®æ”¾åœ¨ä¸€ä¸ªæŒ‡å®šåå­—çš„å›è°ƒå‡½æ•°é‡Œä¼ å›æ¥ã€‚</p>
<p>é¦–å…ˆï¼Œç½‘é¡µåŠ¨æ€æ’å…¥<code>&lt;script&gt;</code>å…ƒç´ ï¼Œç”±å®ƒå‘è·¨æºç½‘å€å‘å‡ºè¯·æ±‚ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function addScriptTag(src) &#123;</span><br><span class="line">  var script = document.createElement(&apos;script&apos;);</span><br><span class="line">  script.setAttribute(&quot;type&quot;,&quot;text/javascript&quot;);</span><br><span class="line">  script.src = src;</span><br><span class="line">  document.body.appendChild(script);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">window.onload = function () &#123;</span><br><span class="line">  addScriptTag(&apos;http://example.com/ip?callback=foo&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function foo(data) &#123;</span><br><span class="line">  console.log(&apos;Your public IP address is: &apos; + data.ip);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç é€šè¿‡åŠ¨æ€æ·»åŠ <code>&lt;script&gt;</code>å…ƒç´ ï¼Œå‘æœåŠ¡å™¨example.comå‘å‡ºè¯·æ±‚ã€‚æ³¨æ„ï¼Œè¯¥è¯·æ±‚çš„æŸ¥è¯¢å­—ç¬¦ä¸²æœ‰ä¸€ä¸ªcallbackå‚æ•°ï¼Œç”¨æ¥æŒ‡å®šå›è°ƒå‡½æ•°çš„åå­—ï¼Œè¿™å¯¹äºJSONPæ˜¯å¿…éœ€çš„ã€‚</p>
<p>æœåŠ¡å™¨æ”¶åˆ°è¿™ä¸ªè¯·æ±‚ä»¥åï¼Œä¼šå°†æ•°æ®æ”¾åœ¨å›è°ƒå‡½æ•°çš„å‚æ•°ä½ç½®è¿”å›ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">foo(&#123;</span><br><span class="line">  &quot;ip&quot;: &quot;8.8.8.8&quot;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ç”±äº<code>&lt;script&gt;</code>å…ƒç´ è¯·æ±‚çš„è„šæœ¬ï¼Œç›´æ¥ä½œä¸ºä»£ç è¿è¡Œã€‚è¿™æ—¶ï¼Œåªè¦æµè§ˆå™¨å®šä¹‰äº†fooå‡½æ•°ï¼Œè¯¥å‡½æ•°å°±ä¼šç«‹å³è°ƒç”¨ã€‚ä½œä¸ºå‚æ•°çš„JSONæ•°æ®è¢«è§†ä¸ºJavaScriptå¯¹è±¡ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²ï¼Œå› æ­¤é¿å…äº†ä½¿ç”¨JSON.parseçš„æ­¥éª¤ã€‚</p>
<h3 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h3><p>WebSocketæ˜¯ä¸€ç§é€šä¿¡åè®®ï¼Œä½¿ç”¨ws://ï¼ˆéåŠ å¯†ï¼‰å’Œwss://ï¼ˆåŠ å¯†ï¼‰ä½œä¸ºåè®®å‰ç¼€ã€‚è¯¥åè®®ä¸å®è¡ŒåŒæºæ”¿ç­–ï¼Œåªè¦æœåŠ¡å™¨æ”¯æŒï¼Œå°±å¯ä»¥é€šè¿‡å®ƒè¿›è¡Œè·¨æºé€šä¿¡ã€‚<br>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œæµè§ˆå™¨å‘å‡ºçš„WebSocketè¯·æ±‚çš„å¤´ä¿¡æ¯.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /chat HTTP/1.1</span><br><span class="line">Host: server.example.com</span><br><span class="line">Upgrade: websocket</span><br><span class="line">Connection: Upgrade</span><br><span class="line">Sec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==</span><br><span class="line">Sec-WebSocket-Protocol: chat, superchat</span><br><span class="line">Sec-WebSocket-Version: 13</span><br><span class="line">Origin: http://example.com</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œæœ‰ä¸€ä¸ªå­—æ®µæ˜¯Originï¼Œè¡¨ç¤ºè¯¥è¯·æ±‚çš„è¯·æ±‚æºï¼ˆoriginï¼‰ï¼Œå³å‘è‡ªå“ªä¸ªåŸŸåã€‚</p>
<p>æ­£æ˜¯å› ä¸ºæœ‰äº†Originè¿™ä¸ªå­—æ®µï¼Œæ‰€ä»¥WebSocketæ‰æ²¡æœ‰å®è¡ŒåŒæºæ”¿ç­–ã€‚å› ä¸ºæœåŠ¡å™¨å¯ä»¥æ ¹æ®è¿™ä¸ªå­—æ®µï¼Œåˆ¤æ–­æ˜¯å¦è®¸å¯æœ¬æ¬¡é€šä¿¡ã€‚å¦‚æœè¯¥åŸŸååœ¨ç™½åå•å†…ï¼ŒæœåŠ¡å™¨å°±ä¼šåšå‡ºå¦‚ä¸‹å›åº”ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 101 Switching Protocols</span><br><span class="line">Upgrade: websocket</span><br><span class="line">Connection: Upgrade</span><br><span class="line">Sec-WebSocket-Accept: HSmrc0sMlYUkAGmm5OPpG2HaGWk=</span><br><span class="line">Sec-WebSocket-Protocol: chat</span><br></pre></td></tr></table></figure>
<h2 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h2><p>CORSæ˜¯ä¸€ä¸ªW3Cæ ‡å‡†ï¼Œå…¨ç§°æ˜¯â€è·¨åŸŸèµ„æºå…±äº«â€ï¼ˆCross-origin resource sharingï¼‰ã€‚</p>
<p>å®ƒå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨ï¼Œå‘å‡ºXMLHttpRequestè¯·æ±‚ï¼Œä»è€Œå…‹æœäº†AJAXåªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶ã€‚</p>
<p>æœ¬æ–‡è¯¦ç»†ä»‹ç»CORSçš„å†…éƒ¨æœºåˆ¶ã€‚</p>
<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>CORSéœ€è¦æµè§ˆå™¨å’ŒæœåŠ¡å™¨åŒæ—¶æ”¯æŒã€‚ç›®å‰ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒè¯¥åŠŸèƒ½ï¼ŒIEæµè§ˆå™¨ä¸èƒ½ä½äºIE10ã€‚</p>
<p>æ•´ä¸ªCORSé€šä¿¡è¿‡ç¨‹ï¼Œéƒ½æ˜¯æµè§ˆå™¨è‡ªåŠ¨å®Œæˆï¼Œä¸éœ€è¦ç”¨æˆ·å‚ä¸ã€‚å¯¹äºå¼€å‘è€…æ¥è¯´ï¼ŒCORSé€šä¿¡ä¸åŒæºçš„AJAXé€šä¿¡æ²¡æœ‰å·®åˆ«ï¼Œä»£ç å®Œå…¨ä¸€æ ·ã€‚æµè§ˆå™¨ä¸€æ—¦å‘ç°AJAXè¯·æ±‚è·¨æºï¼Œå°±ä¼šè‡ªåŠ¨æ·»åŠ ä¸€äº›é™„åŠ çš„å¤´ä¿¡æ¯ï¼Œæœ‰æ—¶è¿˜ä¼šå¤šå‡ºä¸€æ¬¡é™„åŠ çš„è¯·æ±‚ï¼Œä½†ç”¨æˆ·ä¸ä¼šæœ‰æ„Ÿè§‰ã€‚</p>
<p>å› æ­¤ï¼Œå®ç°CORSé€šä¿¡çš„å…³é”®æ˜¯æœåŠ¡å™¨ã€‚åªè¦æœåŠ¡å™¨å®ç°äº†CORSæ¥å£ï¼Œå°±å¯ä»¥è·¨æºé€šä¿¡ã€‚</p>
<h3 id="ä¸¤ç§è¯·æ±‚"><a href="#ä¸¤ç§è¯·æ±‚" class="headerlink" title="ä¸¤ç§è¯·æ±‚"></a>ä¸¤ç§è¯·æ±‚</h3><p>æµè§ˆå™¨å°†CORSè¯·æ±‚åˆ†æˆä¸¤ç±»ï¼šç®€å•è¯·æ±‚ï¼ˆsimple requestï¼‰å’Œéç®€å•è¯·æ±‚ï¼ˆnot-so-simple requestï¼‰ã€‚</p>
<p>åªè¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤å¤§æ¡ä»¶ï¼Œå°±å±äºç®€å•è¯·æ±‚ã€‚</p>
<ol>
<li><p>è¯·æ±‚æ–¹æ³•æ˜¯ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ä¹‹ä¸€ï¼š<br>HEAD<br>GET<br>POST</p>
</li>
<li><p>HTTPçš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µï¼š<br>Accept<br>Accept-Language<br>Content-Language<br>Last-Event-ID<br>Content-Typeï¼šåªé™äºä¸‰ä¸ªå€¼application/x-www-form-urlencodedã€multipart/form-dataã€text/plain</p>
</li>
</ol>
<p>å‡¡æ˜¯ä¸åŒæ—¶æ»¡è¶³ä¸Šé¢ä¸¤ä¸ªæ¡ä»¶ï¼Œå°±å±äºéç®€å•è¯·æ±‚ã€‚<br>æµè§ˆå™¨å¯¹è¿™ä¸¤ç§è¯·æ±‚çš„å¤„ç†ï¼Œæ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<h3 id="ç®€å•è¯·æ±‚"><a href="#ç®€å•è¯·æ±‚" class="headerlink" title="ç®€å•è¯·æ±‚"></a>ç®€å•è¯·æ±‚</h3><h4 id="åŸºæœ¬æµç¨‹"><a href="#åŸºæœ¬æµç¨‹" class="headerlink" title="åŸºæœ¬æµç¨‹"></a>åŸºæœ¬æµç¨‹</h4><p>å¯¹äºç®€å•è¯·æ±‚ï¼Œæµè§ˆå™¨ç›´æ¥å‘å‡ºCORSè¯·æ±‚ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åœ¨å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œå¢åŠ ä¸€ä¸ªOriginå­—æ®µã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œæµè§ˆå™¨å‘ç°è¿™æ¬¡è·¨æºAJAXè¯·æ±‚æ˜¯ç®€å•è¯·æ±‚ï¼Œå°±è‡ªåŠ¨åœ¨å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªOriginå­—æ®µã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /cors HTTP/1.1</span><br><span class="line">Origin: http://api.bob.com</span><br><span class="line">Host: api.alice.com</span><br><span class="line">Accept-Language: en-US</span><br><span class="line">Connection: keep-alive</span><br><span class="line">User-Agent: Mozilla/5.0...</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„å¤´ä¿¡æ¯ä¸­ï¼ŒOriginå­—æ®µç”¨æ¥è¯´æ˜ï¼Œæœ¬æ¬¡è¯·æ±‚æ¥è‡ªå“ªä¸ªæºï¼ˆåè®® + åŸŸå + ç«¯å£ï¼‰ã€‚æœåŠ¡å™¨æ ¹æ®è¿™ä¸ªå€¼ï¼Œå†³å®šæ˜¯å¦åŒæ„è¿™æ¬¡è¯·æ±‚ã€‚</p>
<p>å¦‚æœOriginæŒ‡å®šçš„æºï¼Œä¸åœ¨è®¸å¯èŒƒå›´å†…ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªæ­£å¸¸çš„HTTPå›åº”ã€‚æµè§ˆå™¨å‘ç°ï¼Œè¿™ä¸ªå›åº”çš„å¤´ä¿¡æ¯æ²¡æœ‰åŒ…å«Access-Control-Allow-Originå­—æ®µï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰ï¼Œå°±çŸ¥é“å‡ºé”™äº†ï¼Œä»è€ŒæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè¢«XMLHttpRequestçš„onerrorå›è°ƒå‡½æ•°æ•è·ã€‚æ³¨æ„ï¼Œè¿™ç§é”™è¯¯æ— æ³•é€šè¿‡çŠ¶æ€ç è¯†åˆ«ï¼Œå› ä¸ºHTTPå›åº”çš„çŠ¶æ€ç æœ‰å¯èƒ½æ˜¯200ã€‚</p>
<p>å¦‚æœOriginæŒ‡å®šçš„åŸŸååœ¨è®¸å¯èŒƒå›´å†…ï¼ŒæœåŠ¡å™¨è¿”å›çš„å“åº”ï¼Œä¼šå¤šå‡ºå‡ ä¸ªå¤´ä¿¡æ¯å­—æ®µã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin: http://api.bob.com</span><br><span class="line">Access-Control-Allow-Credentials: true</span><br><span class="line">Access-Control-Expose-Headers: FooBar</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œæœ‰ä¸‰ä¸ªä¸CORSè¯·æ±‚ç›¸å…³çš„å­—æ®µï¼Œéƒ½ä»¥<code>Access-Control-</code>å¼€å¤´ã€‚</p>
<ol>
<li>Access-Control-Allow-Origin<br>è¯¥å­—æ®µæ˜¯å¿…é¡»çš„ã€‚å®ƒçš„å€¼è¦ä¹ˆæ˜¯è¯·æ±‚æ—¶Originå­—æ®µçš„å€¼ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ª*ï¼Œè¡¨ç¤ºæ¥å—ä»»æ„åŸŸåçš„è¯·æ±‚ã€‚</li>
<li>Access-Control-Allow-Credentials<br>è¯¥å­—æ®µå¯é€‰ã€‚å®ƒçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å…è®¸å‘é€Cookieã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCookieä¸åŒ…æ‹¬åœ¨CORSè¯·æ±‚ä¹‹ä¸­ã€‚è®¾ä¸ºtrueï¼Œå³è¡¨ç¤ºæœåŠ¡å™¨æ˜ç¡®è®¸å¯ï¼ŒCookieå¯ä»¥åŒ…å«åœ¨è¯·æ±‚ä¸­ï¼Œä¸€èµ·å‘ç»™æœåŠ¡å™¨ã€‚è¿™ä¸ªå€¼ä¹Ÿåªèƒ½è®¾ä¸ºtrueï¼Œå¦‚æœæœåŠ¡å™¨ä¸è¦æµè§ˆå™¨å‘é€Cookieï¼Œåˆ é™¤è¯¥å­—æ®µå³å¯ã€‚</li>
<li>Access-Control-Expose-Headers<br>è¯¥å­—æ®µå¯é€‰ã€‚CORSè¯·æ±‚æ—¶ï¼ŒXMLHttpRequestå¯¹è±¡çš„getResponseHeader()æ–¹æ³•åªèƒ½æ‹¿åˆ°6ä¸ªåŸºæœ¬å­—æ®µï¼šCache-Controlã€Content-Languageã€Content-Typeã€Expiresã€Last-Modifiedã€Pragmaã€‚å¦‚æœæƒ³æ‹¿åˆ°å…¶ä»–å­—æ®µï¼Œå°±å¿…é¡»åœ¨Access-Control-Expose-Headersé‡Œé¢æŒ‡å®šã€‚ä¸Šé¢çš„ä¾‹å­æŒ‡å®šï¼ŒgetResponseHeader(â€˜FooBarâ€™)å¯ä»¥è¿”å›FooBarå­—æ®µçš„å€¼ã€‚</li>
</ol>
<h4 id="withCredentials-å±æ€§"><a href="#withCredentials-å±æ€§" class="headerlink" title="withCredentials å±æ€§"></a>withCredentials å±æ€§</h4><p>ä¸Šé¢è¯´åˆ°ï¼ŒCORSè¯·æ±‚é»˜è®¤ä¸å‘é€Cookieå’ŒHTTPè®¤è¯ä¿¡æ¯ã€‚å¦‚æœè¦æŠŠCookieå‘åˆ°æœåŠ¡å™¨ï¼Œä¸€æ–¹é¢è¦æœåŠ¡å™¨åŒæ„ï¼ŒæŒ‡å®šAccess-Control-Allow-Credentialså­—æ®µã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Credentials: true</span><br></pre></td></tr></table></figure>
<p>å¦ä¸€æ–¹é¢ï¼Œå¼€å‘è€…å¿…é¡»åœ¨AJAXè¯·æ±‚ä¸­æ‰“å¼€withCredentialså±æ€§ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var xhr = new XMLHttpRequest();</span><br><span class="line">xhr.withCredentials = true;</span><br></pre></td></tr></table></figure>
<p>å¦åˆ™ï¼Œå³ä½¿æœåŠ¡å™¨åŒæ„å‘é€Cookieï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šå‘é€ã€‚æˆ–è€…ï¼ŒæœåŠ¡å™¨è¦æ±‚è®¾ç½®Cookieï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šå¤„ç†ã€‚<br>ä½†æ˜¯ï¼Œå¦‚æœçœç•¥withCredentialsè®¾ç½®ï¼Œæœ‰çš„æµè§ˆå™¨è¿˜æ˜¯ä¼šä¸€èµ·å‘é€Cookieã€‚è¿™æ—¶ï¼Œå¯ä»¥æ˜¾å¼å…³é—­withCredentialsã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xhr.withCredentials = false;</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¦å‘é€Cookieï¼ŒAccess-Control-Allow-Originå°±ä¸èƒ½è®¾ä¸ºæ˜Ÿå·ï¼Œå¿…é¡»æŒ‡å®šæ˜ç¡®çš„ã€ä¸è¯·æ±‚ç½‘é¡µä¸€è‡´çš„åŸŸåã€‚åŒæ—¶ï¼ŒCookieä¾ç„¶éµå¾ªåŒæºæ”¿ç­–ï¼Œåªæœ‰ç”¨æœåŠ¡å™¨åŸŸåè®¾ç½®çš„Cookieæ‰ä¼šä¸Šä¼ ï¼Œå…¶ä»–åŸŸåçš„Cookieå¹¶ä¸ä¼šä¸Šä¼ ï¼Œä¸”ï¼ˆè·¨æºï¼‰åŸç½‘é¡µä»£ç ä¸­çš„document.cookieä¹Ÿæ— æ³•è¯»å–æœåŠ¡å™¨åŸŸåä¸‹çš„Cookieã€‚</p>
<h3 id="éç®€å•è¯·æ±‚"><a href="#éç®€å•è¯·æ±‚" class="headerlink" title="éç®€å•è¯·æ±‚"></a>éç®€å•è¯·æ±‚</h3><h4 id="é¢„æ£€è¯·æ±‚"><a href="#é¢„æ£€è¯·æ±‚" class="headerlink" title="é¢„æ£€è¯·æ±‚"></a>é¢„æ£€è¯·æ±‚</h4><p>éç®€å•è¯·æ±‚æ˜¯é‚£ç§å¯¹æœåŠ¡å™¨æœ‰ç‰¹æ®Šè¦æ±‚çš„è¯·æ±‚ï¼Œæ¯”å¦‚è¯·æ±‚æ–¹æ³•æ˜¯PUTæˆ–DELETEï¼Œæˆ–è€…Content-Typeå­—æ®µçš„ç±»å‹æ˜¯application/jsonã€‚</p>
<p>éç®€å•è¯·æ±‚çš„CORSè¯·æ±‚ï¼Œä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œå¢åŠ ä¸€æ¬¡HTTPæŸ¥è¯¢è¯·æ±‚ï¼Œç§°ä¸ºâ€é¢„æ£€â€è¯·æ±‚ï¼ˆpreflightï¼‰ã€‚</p>
<p>æµè§ˆå™¨å…ˆè¯¢é—®æœåŠ¡å™¨ï¼Œå½“å‰ç½‘é¡µæ‰€åœ¨çš„åŸŸåæ˜¯å¦åœ¨æœåŠ¡å™¨çš„è®¸å¯åå•ä¹‹ä¸­ï¼Œä»¥åŠå¯ä»¥ä½¿ç”¨å“ªäº›HTTPåŠ¨è¯å’Œå¤´ä¿¡æ¯å­—æ®µã€‚åªæœ‰å¾—åˆ°è‚¯å®šç­”å¤ï¼Œæµè§ˆå™¨æ‰ä¼šå‘å‡ºæ­£å¼çš„XMLHttpRequestè¯·æ±‚ï¼Œå¦åˆ™å°±æŠ¥é”™ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€æ®µæµè§ˆå™¨çš„JavaScriptè„šæœ¬ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var url = &apos;http://api.alice.com/cors&apos;;</span><br><span class="line">var xhr = new XMLHttpRequest();</span><br><span class="line">xhr.open(&apos;PUT&apos;, url, true);</span><br><span class="line">xhr.setRequestHeader(&apos;X-Custom-Header&apos;, &apos;value&apos;);</span><br><span class="line">xhr.send();</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­ï¼ŒHTTPè¯·æ±‚çš„æ–¹æ³•æ˜¯PUTï¼Œå¹¶ä¸”å‘é€ä¸€ä¸ªè‡ªå®šä¹‰å¤´ä¿¡æ¯X-Custom-Headerã€‚</p>
<p>æµè§ˆå™¨å‘ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªéç®€å•è¯·æ±‚ï¼Œå°±è‡ªåŠ¨å‘å‡ºä¸€ä¸ªâ€é¢„æ£€â€è¯·æ±‚ï¼Œè¦æ±‚æœåŠ¡å™¨ç¡®è®¤å¯ä»¥è¿™æ ·è¯·æ±‚ã€‚ä¸‹é¢æ˜¯è¿™ä¸ªâ€é¢„æ£€â€è¯·æ±‚çš„HTTPå¤´ä¿¡æ¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">OPTIONS /cors HTTP/1.1</span><br><span class="line">Origin: http://api.bob.com</span><br><span class="line">Access-Control-Request-Method: PUT</span><br><span class="line">Access-Control-Request-Headers: X-Custom-Header</span><br><span class="line">Host: api.alice.com</span><br><span class="line">Accept-Language: en-US</span><br><span class="line">Connection: keep-alive</span><br><span class="line">User-Agent: Mozilla/5.0...</span><br></pre></td></tr></table></figure>
<p>â€œé¢„æ£€â€è¯·æ±‚ç”¨çš„è¯·æ±‚æ–¹æ³•æ˜¯OPTIONSï¼Œè¡¨ç¤ºè¿™ä¸ªè¯·æ±‚æ˜¯ç”¨æ¥è¯¢é—®çš„ã€‚å¤´ä¿¡æ¯é‡Œé¢ï¼Œå…³é”®å­—æ®µæ˜¯Originï¼Œè¡¨ç¤ºè¯·æ±‚æ¥è‡ªå“ªä¸ªæºã€‚</p>
<p>é™¤äº†Originå­—æ®µï¼Œâ€é¢„æ£€â€è¯·æ±‚çš„å¤´ä¿¡æ¯åŒ…æ‹¬ä¸¤ä¸ªç‰¹æ®Šå­—æ®µã€‚</p>
<ol>
<li>Access-Control-Request-Method<br>è¯¥å­—æ®µæ˜¯å¿…é¡»çš„ï¼Œç”¨æ¥åˆ—å‡ºæµè§ˆå™¨çš„CORSè¯·æ±‚ä¼šç”¨åˆ°å“ªäº›HTTPæ–¹æ³•ï¼Œä¸Šä¾‹æ˜¯PUTã€‚</li>
<li>Access-Control-Request-Headers<br>è¯¥å­—æ®µæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šæµè§ˆå™¨CORSè¯·æ±‚ä¼šé¢å¤–å‘é€çš„å¤´ä¿¡æ¯å­—æ®µï¼Œä¸Šä¾‹æ˜¯X-Custom-Headerã€‚</li>
</ol>
<h4 id="é¢„æ£€è¯·æ±‚çš„å›åº”"><a href="#é¢„æ£€è¯·æ±‚çš„å›åº”" class="headerlink" title="é¢„æ£€è¯·æ±‚çš„å›åº”"></a>é¢„æ£€è¯·æ±‚çš„å›åº”</h4><p>æœåŠ¡å™¨æ”¶åˆ°â€é¢„æ£€â€è¯·æ±‚ä»¥åï¼Œæ£€æŸ¥äº†Originã€Access-Control-Request-Methodå’ŒAccess-Control-Request-Headerså­—æ®µä»¥åï¼Œç¡®è®¤å…è®¸è·¨æºè¯·æ±‚ï¼Œå°±å¯ä»¥åšå‡ºå›åº”ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Mon, 01 Dec 2008 01:15:39 GMT</span><br><span class="line">Server: Apache/2.0.61 (Unix)</span><br><span class="line">Access-Control-Allow-Origin: http://api.bob.com</span><br><span class="line">Access-Control-Allow-Methods: GET, POST, PUT</span><br><span class="line">Access-Control-Allow-Headers: X-Custom-Header</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Encoding: gzip</span><br><span class="line">Content-Length: 0</span><br><span class="line">Keep-Alive: timeout=2, max=100</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Content-Type: text/plain</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„HTTPå›åº”ä¸­ï¼Œå…³é”®çš„æ˜¯Access-Control-Allow-Originå­—æ®µï¼Œè¡¨ç¤º<a href="http://api.bob.comå¯ä»¥è¯·æ±‚æ•°æ®ã€‚è¯¥å­—æ®µä¹Ÿå¯ä»¥è®¾ä¸ºæ˜Ÿå·ï¼Œè¡¨ç¤ºåŒæ„ä»»æ„è·¨æºè¯·æ±‚ã€‚" target="_blank" rel="noopener">http://api.bob.comå¯ä»¥è¯·æ±‚æ•°æ®ã€‚è¯¥å­—æ®µä¹Ÿå¯ä»¥è®¾ä¸ºæ˜Ÿå·ï¼Œè¡¨ç¤ºåŒæ„ä»»æ„è·¨æºè¯·æ±‚ã€‚</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin: *</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæµè§ˆå™¨å¦å®šäº†â€é¢„æ£€â€è¯·æ±‚ï¼Œä¼šè¿”å›ä¸€ä¸ªæ­£å¸¸çš„HTTPå›åº”ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•CORSç›¸å…³çš„å¤´ä¿¡æ¯å­—æ®µã€‚è¿™æ—¶ï¼Œæµè§ˆå™¨å°±ä¼šè®¤å®šï¼ŒæœåŠ¡å™¨ä¸åŒæ„é¢„æ£€è¯·æ±‚ï¼Œå› æ­¤è§¦å‘ä¸€ä¸ªé”™è¯¯ï¼Œè¢«XMLHttpRequestå¯¹è±¡çš„onerrorå›è°ƒå‡½æ•°æ•è·ã€‚æ§åˆ¶å°ä¼šæ‰“å°å‡ºå¦‚ä¸‹çš„æŠ¥é”™ä¿¡æ¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">XMLHttpRequest cannot load http://api.alice.com.</span><br><span class="line">Origin http://api.bob.com is not allowed by Access-Control-Allow-Origin.</span><br></pre></td></tr></table></figure>
<p>æœåŠ¡å™¨å›åº”çš„å…¶ä»–CORSç›¸å…³å­—æ®µå¦‚ä¸‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Methods: GET, POST, PUT</span><br><span class="line">Access-Control-Allow-Headers: X-Custom-Header</span><br><span class="line">Access-Control-Allow-Credentials: true</span><br><span class="line">Access-Control-Max-Age: 1728000</span><br></pre></td></tr></table></figure>
<ol>
<li>Access-Control-Allow-Methods<br>è¯¥å­—æ®µå¿…éœ€ï¼Œå®ƒçš„å€¼æ˜¯é€—å·åˆ†éš”çš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨æ˜æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰è·¨åŸŸè¯·æ±‚çš„æ–¹æ³•ã€‚æ³¨æ„ï¼Œè¿”å›çš„æ˜¯æ‰€æœ‰æ”¯æŒçš„æ–¹æ³•ï¼Œè€Œä¸å•æ˜¯æµè§ˆå™¨è¯·æ±‚çš„é‚£ä¸ªæ–¹æ³•ã€‚è¿™æ˜¯ä¸ºäº†é¿å…å¤šæ¬¡â€é¢„æ£€â€è¯·æ±‚ã€‚</li>
<li>Access-Control-Allow-Headers<br>å¦‚æœæµè§ˆå™¨è¯·æ±‚åŒ…æ‹¬Access-Control-Request-Headerså­—æ®µï¼Œåˆ™Access-Control-Allow-Headerså­—æ®µæ˜¯å¿…éœ€çš„ã€‚å®ƒä¹Ÿæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œè¡¨æ˜æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰å¤´ä¿¡æ¯å­—æ®µï¼Œä¸é™äºæµè§ˆå™¨åœ¨â€é¢„æ£€â€ä¸­è¯·æ±‚çš„å­—æ®µã€‚</li>
<li>Access-Control-Allow-Credentials<br>è¯¥å­—æ®µä¸ç®€å•è¯·æ±‚æ—¶çš„å«ä¹‰ç›¸åŒã€‚</li>
<li>Access-Control-Max-Age<br>è¯¥å­—æ®µå¯é€‰ï¼Œç”¨æ¥æŒ‡å®šæœ¬æ¬¡é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚ä¸Šé¢ç»“æœä¸­ï¼Œæœ‰æ•ˆæœŸæ˜¯20å¤©ï¼ˆ1728000ç§’ï¼‰ï¼Œå³å…è®¸ç¼“å­˜è¯¥æ¡å›åº”1728000ç§’ï¼ˆå³20å¤©ï¼‰ï¼Œåœ¨æ­¤æœŸé—´ï¼Œä¸ç”¨å‘å‡ºå¦ä¸€æ¡é¢„æ£€è¯·æ±‚ã€‚</li>
</ol>
<h4 id="æµè§ˆå™¨çš„æ­£å¸¸è¯·æ±‚å’Œå›åº”"><a href="#æµè§ˆå™¨çš„æ­£å¸¸è¯·æ±‚å’Œå›åº”" class="headerlink" title="æµè§ˆå™¨çš„æ­£å¸¸è¯·æ±‚å’Œå›åº”"></a>æµè§ˆå™¨çš„æ­£å¸¸è¯·æ±‚å’Œå›åº”</h4><p>ä¸€æ—¦æœåŠ¡å™¨é€šè¿‡äº†â€é¢„æ£€â€è¯·æ±‚ï¼Œä»¥åæ¯æ¬¡æµè§ˆå™¨æ­£å¸¸çš„CORSè¯·æ±‚ï¼Œå°±éƒ½è·Ÿç®€å•è¯·æ±‚ä¸€æ ·ï¼Œä¼šæœ‰ä¸€ä¸ªOriginå¤´ä¿¡æ¯å­—æ®µã€‚æœåŠ¡å™¨çš„å›åº”ï¼Œä¹Ÿéƒ½ä¼šæœ‰ä¸€ä¸ªAccess-Control-Allow-Originå¤´ä¿¡æ¯å­—æ®µã€‚</p>
<p>ä¸‹é¢æ˜¯â€é¢„æ£€â€è¯·æ±‚ä¹‹åï¼Œæµè§ˆå™¨çš„æ­£å¸¸CORSè¯·æ±‚ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PUT /cors HTTP/1.1</span><br><span class="line">Origin: http://api.bob.com</span><br><span class="line">Host: api.alice.com</span><br><span class="line">X-Custom-Header: value</span><br><span class="line">Accept-Language: en-US</span><br><span class="line">Connection: keep-alive</span><br><span class="line">User-Agent: Mozilla/5.0...</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢å¤´ä¿¡æ¯çš„Originå­—æ®µæ˜¯æµè§ˆå™¨è‡ªåŠ¨æ·»åŠ çš„ã€‚</p>
<p>ä¸‹é¢æ˜¯æœåŠ¡å™¨æ­£å¸¸çš„å›åº”ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin: http://api.bob.com</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢å¤´ä¿¡æ¯ä¸­ï¼ŒAccess-Control-Allow-Originå­—æ®µæ˜¯æ¯æ¬¡å›åº”éƒ½å¿…å®šåŒ…å«çš„ã€‚</p>
<h3 id="ä¸JSONPçš„æ¯”è¾ƒ"><a href="#ä¸JSONPçš„æ¯”è¾ƒ" class="headerlink" title="ä¸JSONPçš„æ¯”è¾ƒ"></a>ä¸JSONPçš„æ¯”è¾ƒ</h3><p>CORSä¸JSONPçš„ä½¿ç”¨ç›®çš„ç›¸åŒï¼Œä½†æ˜¯æ¯”JSONPæ›´å¼ºå¤§ã€‚</p>
<p>JSONPåªæ”¯æŒGETè¯·æ±‚ï¼ŒCORSæ”¯æŒæ‰€æœ‰ç±»å‹çš„HTTPè¯·æ±‚ã€‚JSONPçš„ä¼˜åŠ¿åœ¨äºæ”¯æŒè€å¼æµè§ˆå™¨ï¼Œä»¥åŠå¯ä»¥å‘ä¸æ”¯æŒCORSçš„ç½‘ç«™è¯·æ±‚æ•°æ®ã€‚</p>
<h1 id="ç†è§£HTTPå¹‚ç­‰æ€§"><a href="#ç†è§£HTTPå¹‚ç­‰æ€§" class="headerlink" title="ç†è§£HTTPå¹‚ç­‰æ€§"></a>ç†è§£HTTPå¹‚ç­‰æ€§</h1><p>åŸºäºHTTPåè®®çš„Web APIæ˜¯æ—¶ä¸‹æœ€ä¸ºæµè¡Œçš„ä¸€ç§åˆ†å¸ƒå¼æœåŠ¡æä¾›æ–¹å¼ã€‚æ— è®ºæ˜¯åœ¨å¤§å‹äº’è”ç½‘åº”ç”¨è¿˜æ˜¯ä¼ä¸šçº§æ¶æ„ä¸­ï¼Œæˆ‘ä»¬éƒ½è§åˆ°äº†è¶Šæ¥è¶Šå¤šçš„SOAæˆ–RESTfulçš„Web APIã€‚ä¸ºä»€ä¹ˆWeb APIå¦‚æ­¤æµè¡Œå‘¢ï¼Ÿæˆ‘è®¤ä¸ºå¾ˆå¤§ç¨‹åº¦ä¸Šåº”å½’åŠŸäºç®€å•æœ‰æ•ˆçš„HTTPåè®®ã€‚HTTPåè®®æ˜¯ä¸€ç§åˆ†å¸ƒå¼çš„é¢å‘èµ„æºçš„ç½‘ç»œåº”ç”¨å±‚åè®®ï¼Œæ— è®ºæ˜¯æœåŠ¡å™¨ç«¯æä¾›WebæœåŠ¡ï¼Œè¿˜æ˜¯å®¢æˆ·ç«¯æ¶ˆè´¹WebæœåŠ¡éƒ½éå¸¸ç®€å•ã€‚å†åŠ ä¸Šæµè§ˆå™¨ã€Javascriptã€AJAXã€JSONä»¥åŠHTML5ç­‰æŠ€æœ¯å’Œå·¥å…·çš„å‘å±•ï¼Œäº’è”ç½‘åº”ç”¨æ¶æ„è®¾è®¡è¡¨ç°å‡ºäº†ä»ä¼ ç»Ÿçš„PHPã€JSPã€ASP.NETç­‰æœåŠ¡å™¨ç«¯åŠ¨æ€ç½‘é¡µå‘Web API + RIAï¼ˆå¯Œäº’è”ç½‘åº”ç”¨ï¼‰è¿‡æ¸¡çš„è¶‹åŠ¿ã€‚Web APIä¸“æ³¨äºæä¾›ä¸šåŠ¡æœåŠ¡ï¼ŒRIAä¸“æ³¨äºç”¨æˆ·ç•Œé¢å’Œäº¤äº’è®¾è®¡ï¼Œä»æ­¤ä¸¤ä¸ªé¢†åŸŸçš„åˆ†å·¥æ›´åŠ æ˜æ™°ã€‚åœ¨è¿™ç§è¶‹åŠ¿ä¸‹ï¼ŒWeb APIè®¾è®¡å°†æˆä¸ºæœåŠ¡å™¨ç«¯ç¨‹åºå‘˜çš„å¿…ä¿®è¯¾ã€‚ç„¶è€Œï¼Œæ­£å¦‚ç®€å•çš„Javaè¯­è¨€å¹¶ä¸æ„å‘³ç€é«˜è´¨é‡çš„Javaç¨‹åºï¼Œç®€å•çš„HTTPåè®®ä¹Ÿä¸æ„å‘³ç€é«˜è´¨é‡çš„Web APIã€‚è¦æƒ³è®¾è®¡å‡ºé«˜è´¨é‡çš„Web APIï¼Œè¿˜éœ€è¦æ·±å…¥ç†è§£åˆ†å¸ƒå¼ç³»ç»ŸåŠHTTPåè®®çš„ç‰¹æ€§ã€‚</p>
<h2 id="å¹‚ç­‰æ€§å®šä¹‰"><a href="#å¹‚ç­‰æ€§å®šä¹‰" class="headerlink" title="å¹‚ç­‰æ€§å®šä¹‰"></a>å¹‚ç­‰æ€§å®šä¹‰</h2><p>æœ¬æ–‡æ‰€è¦æ¢è®¨çš„æ­£æ˜¯HTTPåè®®æ¶‰åŠåˆ°çš„ä¸€ç§é‡è¦æ€§è´¨ï¼šå¹‚ç­‰æ€§(Idempotence)ã€‚åœ¨HTTP/1.1è§„èŒƒä¸­å¹‚ç­‰æ€§çš„å®šä¹‰æ˜¯ï¼š</p>
<blockquote>
<p>Methods can also have the property of â€œidempotenceâ€ in that (aside from error or expiration issues) the side-effects of N &gt; 0 identical requests is the same as for a single request.</p>
</blockquote>
<p>ä»å®šä¹‰ä¸Šçœ‹ï¼ŒHTTPæ–¹æ³•çš„å¹‚ç­‰æ€§æ˜¯æŒ‡ä¸€æ¬¡å’Œå¤šæ¬¡è¯·æ±‚æŸä¸€ä¸ªèµ„æºåº”è¯¥å…·æœ‰åŒæ ·çš„å‰¯ä½œç”¨ã€‚å¹‚ç­‰æ€§å±äºè¯­ä¹‰èŒƒç•´ï¼Œæ­£å¦‚ç¼–è¯‘å™¨åªèƒ½å¸®åŠ©æ£€æŸ¥è¯­æ³•é”™è¯¯ä¸€æ ·ï¼ŒHTTPè§„èŒƒä¹Ÿæ²¡æœ‰åŠæ³•é€šè¿‡æ¶ˆæ¯æ ¼å¼ç­‰è¯­æ³•æ‰‹æ®µæ¥å®šä¹‰å®ƒï¼Œè¿™å¯èƒ½æ˜¯å®ƒä¸å¤ªå—åˆ°é‡è§†çš„åŸå› ä¹‹ä¸€ã€‚ä½†å®é™…ä¸Šï¼Œå¹‚ç­‰æ€§æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ä¸­ååˆ†é‡è¦çš„æ¦‚å¿µï¼Œè€ŒHTTPçš„åˆ†å¸ƒå¼æœ¬è´¨ä¹Ÿå†³å®šäº†å®ƒåœ¨HTTPä¸­å…·æœ‰é‡è¦åœ°ä½ã€‚</p>
<h2 id="åˆ†å¸ƒå¼äº‹åŠ¡-vs-å¹‚ç­‰è®¾è®¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡-vs-å¹‚ç­‰è®¾è®¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡ vs å¹‚ç­‰è®¾è®¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡ vs å¹‚ç­‰è®¾è®¡</h2><p>ä¸ºä»€ä¹ˆéœ€è¦å¹‚ç­‰æ€§å‘¢ï¼Ÿæˆ‘ä»¬å…ˆä»ä¸€ä¸ªä¾‹å­è¯´èµ·ï¼Œå‡è®¾æœ‰ä¸€ä¸ªä»è´¦æˆ·å–é’±çš„è¿œç¨‹APIï¼ˆå¯ä»¥æ˜¯HTTPçš„ï¼Œä¹Ÿå¯ä»¥ä¸æ˜¯ï¼‰ï¼Œæˆ‘ä»¬æš‚æ—¶ç”¨ç±»å‡½æ•°çš„æ–¹å¼è®°ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bool withdraw(account_id, amount)</span><br></pre></td></tr></table></figure>
<p>withdrawçš„è¯­ä¹‰æ˜¯ä»account_idå¯¹åº”çš„è´¦æˆ·ä¸­æ‰£é™¤amountæ•°é¢çš„é’±ï¼›å¦‚æœæ‰£é™¤æˆåŠŸåˆ™è¿”å›trueï¼Œè´¦æˆ·ä½™é¢å‡å°‘amountï¼›å¦‚æœæ‰£é™¤å¤±è´¥åˆ™è¿”å›falseï¼Œè´¦æˆ·ä½™é¢ä¸å˜ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šå’Œæœ¬åœ°ç¯å¢ƒç›¸æ¯”ï¼Œæˆ‘ä»¬ä¸èƒ½è½»æ˜“å‡è®¾åˆ†å¸ƒå¼ç¯å¢ƒçš„å¯é æ€§ã€‚ä¸€ç§å…¸å‹çš„æƒ…å†µæ˜¯withdrawè¯·æ±‚å·²ç»è¢«æœåŠ¡å™¨ç«¯æ­£ç¡®å¤„ç†ï¼Œä½†æœåŠ¡å™¨ç«¯çš„è¿”å›ç»“æœç”±äºç½‘ç»œç­‰åŸå› è¢«æ‰ä¸¢äº†ï¼Œå¯¼è‡´å®¢æˆ·ç«¯æ— æ³•å¾—çŸ¥å¤„ç†ç»“æœã€‚å¦‚æœæ˜¯åœ¨ç½‘é¡µä¸Šï¼Œä¸€äº›ä¸æ°å½“çš„è®¾è®¡å¯èƒ½ä¼šä½¿ç”¨æˆ·è®¤ä¸ºä¸Šä¸€æ¬¡æ“ä½œå¤±è´¥äº†ï¼Œç„¶ååˆ·æ–°é¡µé¢ï¼Œè¿™å°±å¯¼è‡´äº†withdrawè¢«è°ƒç”¨ä¸¤æ¬¡ï¼Œè´¦æˆ·ä¹Ÿè¢«å¤šæ‰£äº†ä¸€æ¬¡é’±ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><a href="http://idiotsky.top/images3/http-summary-50.png"><img src="http://idiotsky.top/images3/http-summary-50.png" alt=""></a></p>
<p>è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆä¸€æ˜¯é‡‡ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé€šè¿‡å¼•å…¥æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸­é—´ä»¶æ¥ä¿è¯withdrawåŠŸèƒ½çš„äº‹åŠ¡æ€§ã€‚åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¼˜ç‚¹æ˜¯å¯¹äºè°ƒç”¨è€…å¾ˆç®€å•ï¼Œå¤æ‚æ€§éƒ½äº¤ç»™äº†ä¸­é—´ä»¶æ¥ç®¡ç†ã€‚ç¼ºç‚¹åˆ™æ˜¯ä¸€æ–¹é¢æ¶æ„å¤ªé‡é‡çº§ï¼Œå®¹æ˜“è¢«ç»‘åœ¨ç‰¹å®šçš„ä¸­é—´ä»¶ä¸Šï¼Œä¸åˆ©äºå¼‚æ„ç³»ç»Ÿçš„é›†æˆï¼›å¦ä¸€æ–¹é¢åˆ†å¸ƒå¼äº‹åŠ¡è™½ç„¶èƒ½ä¿è¯äº‹åŠ¡çš„ACIDæ€§è´¨ï¼Œè€Œä½†å´æ— æ³•æä¾›æ€§èƒ½å’Œå¯ç”¨æ€§çš„ä¿è¯ã€‚</p>
<p>å¦ä¸€ç§æ›´è½»é‡çº§çš„è§£å†³æ–¹æ¡ˆæ˜¯å¹‚ç­‰è®¾è®¡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›æŠ€å·§æŠŠwithdrawå˜æˆå¹‚ç­‰çš„ï¼Œæ¯”å¦‚ï¼š</p>
<p>int create_ticket()<br>bool idempotent_withdraw(ticket_id, account_id, amount)<br>create_ticketçš„è¯­ä¹‰æ˜¯è·å–ä¸€ä¸ªæœåŠ¡å™¨ç«¯ç”Ÿæˆçš„å”¯ä¸€çš„å¤„ç†å·ticket_idï¼Œå®ƒå°†ç”¨äºæ ‡è¯†åç»­çš„æ“ä½œã€‚idempotent_withdrawå’Œwithdrawçš„åŒºåˆ«åœ¨äºå…³è”äº†ä¸€ä¸ªticket_idï¼Œä¸€ä¸ªticket_idè¡¨ç¤ºçš„æ“ä½œè‡³å¤šåªä¼šè¢«å¤„ç†ä¸€æ¬¡ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½å°†è¿”å›ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶çš„å¤„ç†ç»“æœã€‚è¿™æ ·ï¼Œidempotent_withdrawå°±ç¬¦åˆå¹‚ç­‰æ€§äº†ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥æ”¾å¿ƒåœ°å¤šæ¬¡è°ƒç”¨ã€‚</p>
<p>åŸºäºå¹‚ç­‰æ€§çš„è§£å†³æ–¹æ¡ˆä¸­ä¸€ä¸ªå®Œæ•´çš„å–é’±æµç¨‹è¢«åˆ†è§£æˆäº†ä¸¤ä¸ªæ­¥éª¤ï¼š1.è°ƒç”¨create_ticket()è·å–ticket_idï¼›2.è°ƒç”¨idempotent_withdraw(ticket_id, account_id, amount)ã€‚è™½ç„¶create_ticketä¸æ˜¯å¹‚ç­‰çš„ï¼Œä½†åœ¨è¿™ç§è®¾è®¡ä¸‹ï¼Œå®ƒå¯¹ç³»ç»ŸçŠ¶æ€çš„å½±å“å¯ä»¥å¿½ç•¥ï¼ŒåŠ ä¸Šidempotent_withdrawæ˜¯å¹‚ç­‰çš„ï¼Œæ‰€ä»¥ä»»ä½•ä¸€æ­¥ç”±äºç½‘ç»œç­‰åŸå› å¤±è´¥æˆ–è¶…æ—¶ï¼Œå®¢æˆ·ç«¯éƒ½å¯ä»¥é‡è¯•ï¼Œç›´åˆ°è·å¾—ç»“æœã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><a href="http://idiotsky.top/images3/http-summary-51.png"><img src="http://idiotsky.top/images3/http-summary-51.png" alt=""></a></p>
<h2 id="HTTPçš„å¹‚ç­‰æ€§"><a href="#HTTPçš„å¹‚ç­‰æ€§" class="headerlink" title="HTTPçš„å¹‚ç­‰æ€§"></a>HTTPçš„å¹‚ç­‰æ€§</h2><p>HTTPåè®®æœ¬èº«æ˜¯ä¸€ç§é¢å‘èµ„æºçš„åº”ç”¨å±‚åè®®ï¼Œä½†å¯¹HTTPåè®®çš„ä½¿ç”¨å®é™…ä¸Šå­˜åœ¨ç€ä¸¤ç§ä¸åŒçš„æ–¹å¼ï¼šä¸€ç§æ˜¯RESTfulçš„ï¼Œå®ƒæŠŠHTTPå½“æˆåº”ç”¨å±‚åè®®ï¼Œæ¯”è¾ƒå¿ å®åœ°éµå®ˆäº†HTTPåè®®çš„å„ç§è§„å®šï¼›å¦ä¸€ç§æ˜¯SOAçš„ï¼Œå®ƒå¹¶æ²¡æœ‰å®Œå…¨æŠŠHTTPå½“æˆåº”ç”¨å±‚åè®®ï¼Œè€Œæ˜¯æŠŠHTTPåè®®ä½œä¸ºäº†ä¼ è¾“å±‚åè®®ï¼Œç„¶ååœ¨HTTPä¹‹ä¸Šå»ºç«‹äº†è‡ªå·±çš„åº”ç”¨å±‚åè®®ã€‚æœ¬æ–‡æ‰€è®¨è®ºçš„HTTPå¹‚ç­‰æ€§ä¸»è¦é’ˆå¯¹RESTfulé£æ ¼çš„ï¼Œä¸è¿‡æ­£å¦‚ä¸Šä¸€èŠ‚æ‰€çœ‹åˆ°çš„é‚£æ ·ï¼Œå¹‚ç­‰æ€§å¹¶ä¸å±äºç‰¹å®šçš„åè®®ï¼Œå®ƒæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€ç§ç‰¹æ€§ï¼›æ‰€ä»¥ï¼Œä¸è®ºæ˜¯SOAè¿˜æ˜¯RESTfulçš„Web APIè®¾è®¡éƒ½åº”è¯¥è€ƒè™‘å¹‚ç­‰æ€§ã€‚ä¸‹é¢å°†ä»‹ç»HTTP GETã€DELETEã€PUTã€POSTå››ç§ä¸»è¦æ–¹æ³•çš„è¯­ä¹‰å’Œå¹‚ç­‰æ€§ã€‚</p>
<p>HTTP GETæ–¹æ³•ç”¨äºè·å–èµ„æºï¼Œä¸åº”æœ‰å‰¯ä½œç”¨ï¼Œæ‰€ä»¥æ˜¯å¹‚ç­‰çš„ã€‚æ¯”å¦‚ï¼šGET <a href="http://www.bank.com/account/123456ï¼Œä¸ä¼šæ”¹å˜èµ„æºçš„çŠ¶æ€ï¼Œä¸è®ºè°ƒç”¨ä¸€æ¬¡è¿˜æ˜¯Næ¬¡éƒ½æ²¡æœ‰å‰¯ä½œç”¨ã€‚è¯·æ³¨æ„ï¼Œè¿™é‡Œå¼ºè°ƒçš„æ˜¯ä¸€æ¬¡å’ŒNæ¬¡å…·æœ‰ç›¸åŒçš„å‰¯ä½œç”¨ï¼Œè€Œä¸æ˜¯æ¯æ¬¡GETçš„ç»“æœç›¸åŒã€‚GET" target="_blank" rel="noopener">http://www.bank.com/account/123456ï¼Œä¸ä¼šæ”¹å˜èµ„æºçš„çŠ¶æ€ï¼Œä¸è®ºè°ƒç”¨ä¸€æ¬¡è¿˜æ˜¯Næ¬¡éƒ½æ²¡æœ‰å‰¯ä½œç”¨ã€‚è¯·æ³¨æ„ï¼Œè¿™é‡Œå¼ºè°ƒçš„æ˜¯ä¸€æ¬¡å’ŒNæ¬¡å…·æœ‰ç›¸åŒçš„å‰¯ä½œç”¨ï¼Œè€Œä¸æ˜¯æ¯æ¬¡GETçš„ç»“æœç›¸åŒã€‚GET</a> <a href="http://www.news.com/latest-newsè¿™ä¸ªHTTPè¯·æ±‚å¯èƒ½ä¼šæ¯æ¬¡å¾—åˆ°ä¸åŒçš„ç»“æœï¼Œä½†å®ƒæœ¬èº«å¹¶æ²¡æœ‰äº§ç”Ÿä»»ä½•å‰¯ä½œç”¨ï¼Œå› è€Œæ˜¯æ»¡è¶³å¹‚ç­‰æ€§çš„ã€‚" target="_blank" rel="noopener">http://www.news.com/latest-newsè¿™ä¸ªHTTPè¯·æ±‚å¯èƒ½ä¼šæ¯æ¬¡å¾—åˆ°ä¸åŒçš„ç»“æœï¼Œä½†å®ƒæœ¬èº«å¹¶æ²¡æœ‰äº§ç”Ÿä»»ä½•å‰¯ä½œç”¨ï¼Œå› è€Œæ˜¯æ»¡è¶³å¹‚ç­‰æ€§çš„ã€‚</a></p>
<p>HTTP DELETEæ–¹æ³•ç”¨äºåˆ é™¤èµ„æºï¼Œæœ‰å‰¯ä½œç”¨ï¼Œä½†å®ƒåº”è¯¥æ»¡è¶³å¹‚ç­‰æ€§ã€‚æ¯”å¦‚ï¼šDELETE <a href="http://www.forum.com/article/4231ï¼Œè°ƒç”¨ä¸€æ¬¡å’ŒNæ¬¡å¯¹ç³»ç»Ÿäº§ç”Ÿçš„å‰¯ä½œç”¨æ˜¯ç›¸åŒçš„ï¼Œå³åˆ æ‰idä¸º4231çš„å¸–å­ï¼›å› æ­¤ï¼Œè°ƒç”¨è€…å¯ä»¥å¤šæ¬¡è°ƒç”¨æˆ–åˆ·æ–°é¡µé¢è€Œä¸å¿…æ‹…å¿ƒå¼•èµ·é”™è¯¯ã€‚" target="_blank" rel="noopener">http://www.forum.com/article/4231ï¼Œè°ƒç”¨ä¸€æ¬¡å’ŒNæ¬¡å¯¹ç³»ç»Ÿäº§ç”Ÿçš„å‰¯ä½œç”¨æ˜¯ç›¸åŒçš„ï¼Œå³åˆ æ‰idä¸º4231çš„å¸–å­ï¼›å› æ­¤ï¼Œè°ƒç”¨è€…å¯ä»¥å¤šæ¬¡è°ƒç”¨æˆ–åˆ·æ–°é¡µé¢è€Œä¸å¿…æ‹…å¿ƒå¼•èµ·é”™è¯¯ã€‚</a></p>
<p>æ¯”è¾ƒå®¹æ˜“æ··æ·†çš„æ˜¯HTTP POSTå’ŒPUTã€‚POSTå’ŒPUTçš„åŒºåˆ«å®¹æ˜“è¢«ç®€å•åœ°è¯¯è®¤ä¸ºâ€œPOSTè¡¨ç¤ºåˆ›å»ºèµ„æºï¼ŒPUTè¡¨ç¤ºæ›´æ–°èµ„æºâ€ï¼›è€Œå®é™…ä¸Šï¼ŒäºŒè€…å‡å¯ç”¨äºåˆ›å»ºèµ„æºï¼Œæ›´ä¸ºæœ¬è´¨çš„å·®åˆ«æ˜¯åœ¨å¹‚ç­‰æ€§æ–¹é¢ã€‚åœ¨HTTPè§„èŒƒä¸­å¯¹POSTå’ŒPUTæ˜¯è¿™æ ·å®šä¹‰çš„ï¼š</p>
<blockquote>
<p>The POST method is used to request that the origin server accept the entity enclosed in the request as a new subordinate of the resource identified by the Request-URI in the Request-Line â€¦â€¦ If a resource has been created on the origin server, the response SHOULD be 201 (Created) and contain an entity which describes the status of the request and refers to the new resource, and a Location header.</p>
</blockquote>
<blockquote>
<p>The PUT method requests that the enclosed entity be stored under the supplied Request-URI. If the Request-URI refers to an already existing resource, the enclosed entity SHOULD be considered as a modified version of the one residing on the origin server. If the Request-URI does not point to an existing resource, and that URI is capable of being defined as a new resource by the requesting user agent, the origin server can create the resource with that URI.</p>
</blockquote>
<p>POSTæ‰€å¯¹åº”çš„URIå¹¶éåˆ›å»ºçš„èµ„æºæœ¬èº«ï¼Œè€Œæ˜¯èµ„æºçš„æ¥æ”¶è€…ã€‚æ¯”å¦‚ï¼šPOST <a href="http://www.forum.com/articles" target="_blank" rel="noopener">http://www.forum.com/articles</a> çš„è¯­ä¹‰æ˜¯åœ¨<a href="http://www.forum.com/articles" target="_blank" rel="noopener">http://www.forum.com/articles</a> ä¸‹åˆ›å»ºä¸€ç¯‡å¸–å­ï¼ŒHTTPå“åº”ä¸­åº”åŒ…å«å¸–å­çš„åˆ›å»ºçŠ¶æ€ä»¥åŠå¸–å­çš„URIã€‚ä¸¤æ¬¡ç›¸åŒçš„POSTè¯·æ±‚ä¼šåœ¨æœåŠ¡å™¨ç«¯åˆ›å»ºä¸¤ä»½èµ„æºï¼Œå®ƒä»¬å…·æœ‰ä¸åŒçš„URIï¼›æ‰€ä»¥ï¼ŒPOSTæ–¹æ³•ä¸å…·å¤‡å¹‚ç­‰æ€§ã€‚è€ŒPUTæ‰€å¯¹åº”çš„URIæ˜¯è¦åˆ›å»ºæˆ–æ›´æ–°çš„èµ„æºæœ¬èº«ã€‚æ¯”å¦‚ï¼šPUT <a href="http://www.forum/articles/4231" target="_blank" rel="noopener">http://www.forum/articles/4231</a> çš„è¯­ä¹‰æ˜¯åˆ›å»ºæˆ–æ›´æ–°IDä¸º4231çš„å¸–å­ã€‚å¯¹åŒä¸€URIè¿›è¡Œå¤šæ¬¡PUTçš„å‰¯ä½œç”¨å’Œä¸€æ¬¡PUTæ˜¯ç›¸åŒçš„ï¼›å› æ­¤ï¼ŒPUTæ–¹æ³•å…·æœ‰å¹‚ç­‰æ€§ã€‚</p>
<p>åœ¨ä»‹ç»äº†å‡ ç§æ“ä½œçš„è¯­ä¹‰å’Œå¹‚ç­‰æ€§ä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•é€šè¿‡Web APIçš„å½¢å¼å®ç°å‰é¢æ‰€æåˆ°çš„å–æ¬¾åŠŸèƒ½ã€‚å¾ˆç®€å•ï¼Œç”¨POST /ticketsæ¥å®ç°create_ticketï¼›ç”¨PUT /accounts/account_id/ticket_id?amount=xxxæ¥å®ç°idempotent_withdrawã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ä¸¥æ ¼æ¥è®²amountå‚æ•°ä¸åº”è¯¥ä½œä¸ºURIçš„ä¸€éƒ¨åˆ†ï¼ŒçœŸæ­£çš„URIåº”è¯¥æ˜¯/accounts/account_id/ticket_idï¼Œè€Œamountåº”è¯¥æ”¾åœ¨è¯·æ±‚çš„bodyä¸­ã€‚è¿™ç§æ¨¡å¼å¯ä»¥åº”ç”¨äºå¾ˆå¤šåœºåˆï¼Œæ¯”å¦‚ï¼šè®ºå›ç½‘ç«™ä¸­é˜²æ­¢æ„å¤–çš„é‡å¤å‘å¸–ã€‚</p>
<h2 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>ä¸Šé¢ç®€å•ä»‹ç»äº†å¹‚ç­‰æ€§çš„æ¦‚å¿µï¼Œç”¨å¹‚ç­‰è®¾è®¡å–ä»£åˆ†å¸ƒå¼äº‹åŠ¡çš„æ–¹æ³•ï¼Œä»¥åŠHTTPä¸»è¦æ–¹æ³•çš„è¯­ä¹‰å’Œå¹‚ç­‰æ€§ç‰¹å¾ã€‚å…¶å®ï¼Œå¦‚æœè¦è¿½æ ¹æº¯æºï¼Œå¹‚ç­‰æ€§æ˜¯æ•°å­¦ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œè¡¨è¾¾çš„æ˜¯Næ¬¡å˜æ¢ä¸1æ¬¡å˜æ¢çš„ç»“æœç›¸åŒï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥ä»Wikipediaä¸Šè¿›ä¸€æ­¥äº†è§£ã€‚</p>
<p>ref</p>
<p><a href="http://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2016/04/cors.html</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html</a></p>
<p><a href="https://github.com/halfrost/Halfrost-Field/blob/master/contents/Protocol/HTTP.md" target="_blank" rel="noopener">https://github.com/halfrost/Halfrost-Field/blob/master/contents/Protocol/HTTP.md</a></p>
<p><a href="https://www.cnblogs.com/chenqf/p/6386163.html" target="_blank" rel="noopener">https://www.cnblogs.com/chenqf/p/6386163.html</a></p>
<p><a href="http://www.cnblogs.com/weidagang2046/archive/2011/06/04/2063696.html" target="_blank" rel="noopener">http://www.cnblogs.com/weidagang2046/archive/2011/06/04/2063696.html</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ğŸ‘¿ mark ï¼Œå¾ˆé•¿ ğŸ˜„&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;HTTP-æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#HTTP-æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;HTTP æ¦‚è¿°&quot;&gt;&lt;/a&gt;HTTP æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;Web ä½¿ç”¨ä¸€ç§åä¸º HTTP (HyperText Transfer Protocolï¼Œè¶…æ–‡æœ¬ä¼ è¾“åè®®) çš„åè®®ä½œä¸ºè§„èŒƒçš„ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;HTTP æ›´åŠ ä¸¥è°¨çš„è¯‘ååº”è¯¥æ˜¯ è¶…æ–‡æœ¬è½¬ç§»åè®®ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;HTTP äº 1990 å¹´é—®ä¸–ã€‚é‚£æ—¶çš„ HTTP å¹¶æ²¡æœ‰ä½œä¸ºæ­£å¼çš„æ ‡å‡†ï¼Œå› ä¸ºè¢«ç§°ä¸º HTTP/0.9&lt;br&gt;HTTP æ­£å¼ä½œä¸ºæ ‡å‡†è¢«å…¬å¸ƒæ˜¯ 1996 å¹´ 5 æœˆï¼Œç‰ˆæœ¬å‘½åä¸º HTTP/1.0ï¼Œè®°è½½äº RFC1945&lt;br&gt;HTTP åœ¨ 1997 å¹´ 1 æœˆå…¬å¸ƒäº†å½“å‰æœ€ä¸»æµçš„ç‰ˆæœ¬ï¼Œç‰ˆæœ¬å‘½åä¸º HTTP/1.1ï¼Œè®°è½½äº RFC2616&lt;br&gt;HTTP/2 äº 2015 å¹´ 5 æœˆ 14 æ—¥å‘å¸ƒï¼Œå¼•å…¥äº†æœåŠ¡å™¨æ¨é€ç­‰å¤šç§åŠŸèƒ½ï¼Œæ˜¯ç›®å‰æœ€æ–°çš„ç‰ˆæœ¬ã€‚è®°è½½äº RFC7540&lt;br&gt;(å®ƒä¸å« HTTP/2.0ï¼Œæ˜¯å› ä¸ºæ ‡å‡†å§”å‘˜ä¼šä¸æ‰“ç®—å†å‘å¸ƒå­ç‰ˆæœ¬äº†ï¼Œä¸‹ä¸€ä¸ªæ–°ç‰ˆæœ¬å°†æ˜¯ HTTP/3)&lt;/p&gt;
    
    </summary>
    
      <category term="protocols" scheme="http://idiotsky.top/categories/protocols/"/>
    
    
      <category term="protocols" scheme="http://idiotsky.top/tags/protocols/"/>
    
      <category term="http" scheme="http://idiotsky.top/tags/http/"/>
    
  </entry>
  
  <entry>
    <title>Unicodeå’ŒUTF-8</title>
    <link href="http://idiotsky.top/2018/03/19/unicode-utf8/"/>
    <id>http://idiotsky.top/2018/03/19/unicode-utf8/</id>
    <published>2018-03-19T15:43:59.000Z</published>
    <updated>2018-03-20T14:12:23.548Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>è¿™ä¸ªå¾ˆç®€å•çš„è¯´æ˜äº†unicodeå’ŒUTF-8çš„å…³ç³» ğŸ‘¿</p>
</blockquote>
<ul>
<li>Unicode æ˜¯ã€Œå­—ç¬¦é›†ã€</li>
<li>UTF-8 æ˜¯ã€Œç¼–ç è§„åˆ™ã€</li>
</ul>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li>å­—ç¬¦é›†ï¼šä¸ºæ¯ä¸€ä¸ªã€Œå­—ç¬¦ã€åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ IDï¼ˆå­¦åä¸ºç ä½ / ç ç‚¹ / Code Pointï¼‰</li>
<li>ç¼–ç è§„åˆ™ï¼šå°†ã€Œç ä½ã€è½¬æ¢ä¸ºå­—èŠ‚åºåˆ—çš„è§„åˆ™ï¼ˆç¼–ç /è§£ç  å¯ä»¥ç†è§£ä¸º åŠ å¯†/è§£å¯† çš„è¿‡ç¨‹ï¼‰</li>
</ul>
<a id="more"></a>
<p>å¹¿ä¹‰çš„ Unicode æ˜¯ä¸€ä¸ªæ ‡å‡†ï¼Œå®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦é›†ä»¥åŠä¸€ç³»åˆ—çš„ç¼–ç è§„åˆ™ï¼Œå³ Unicode å­—ç¬¦é›†å’Œ UTF-8ã€UTF-16ã€UTF-32 ç­‰ç­‰ç¼–ç â€¦â€¦</p>
<p>Unicode å­—ç¬¦é›†ä¸ºæ¯ä¸€ä¸ªå­—ç¬¦åˆ†é…ä¸€ä¸ªç ä½ï¼Œä¾‹å¦‚ã€ŒçŸ¥ã€çš„ç ä½æ˜¯ 30693ï¼Œè®°ä½œ U+77E5ï¼ˆ30693 çš„åå…­è¿›åˆ¶ä¸º 0x77E5ï¼‰ã€‚</p>
<p>UTF-8 é¡¾åæ€ä¹‰ï¼Œæ˜¯ä¸€å¥—ä»¥ 8 ä½ä¸ºä¸€ä¸ªç¼–ç å•ä½çš„å¯å˜é•¿ç¼–ç ã€‚ä¼šå°†ä¸€ä¸ªç ä½ç¼–ç ä¸º 1 åˆ° 4 ä¸ªå­—èŠ‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">U+ 0000 ~ U+ 007F: 0XXXXXXX</span><br><span class="line">U+ 0080 ~ U+ 07FF: 110XXXXX 10XXXXXX</span><br><span class="line">U+ 0800 ~ U+ FFFF: 1110XXXX 10XXXXXX 10XXXXXX</span><br><span class="line">U+10000 ~ U+1FFFF: 11110XXX 10XXXXXX 10XXXXXX 10XXXXXX</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®ä¸Šè¡¨ä¸­çš„ç¼–ç è§„åˆ™ï¼Œä¹‹å‰çš„ã€ŒçŸ¥ã€å­—çš„ç ä½ U+77E5 å±äºç¬¬ä¸‰è¡Œçš„èŒƒå›´ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">       7    7    E    5    </span><br><span class="line">    0111 0111 1110 0101    äºŒè¿›åˆ¶çš„ 77E5</span><br><span class="line">--------------------------</span><br><span class="line">    0111   011111   100101 äºŒè¿›åˆ¶çš„ 77E5</span><br><span class="line">1110XXXX 10XXXXXX 10XXXXXX æ¨¡ç‰ˆï¼ˆä¸Šè¡¨ç¬¬ä¸‰è¡Œï¼‰</span><br><span class="line">11100111 10011111 10100101 ä»£å…¥æ¨¡ç‰ˆ</span><br><span class="line">   E   7    9   F    A   5</span><br></pre></td></tr></table></figure></p>
<p>è¿™å°±æ˜¯å°† U+77E5 æŒ‰ç…§ UTF-8 ç¼–ç ä¸ºå­—èŠ‚åºåˆ— E79FA5 çš„è¿‡ç¨‹ã€‚åä¹‹äº¦ç„¶ã€‚</p>
<p>ref <a href="https://www.zhihu.com/question/23374078" target="_blank" rel="noopener">https://www.zhihu.com/question/23374078</a></p>
<p>ç™¾åº¦ç™¾ç§‘å…¶å®ä¹Ÿè¯´å¾—ä¸é”™äº†<br><a href="https://baike.baidu.com/item/Unicode/750500" target="_blank" rel="noopener">https://baike.baidu.com/item/Unicode/750500</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;è¿™ä¸ªå¾ˆç®€å•çš„è¯´æ˜äº†unicodeå’ŒUTF-8çš„å…³ç³» ğŸ‘¿&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Unicode æ˜¯ã€Œå­—ç¬¦é›†ã€&lt;/li&gt;
&lt;li&gt;UTF-8 æ˜¯ã€Œç¼–ç è§„åˆ™ã€&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å­—ç¬¦é›†ï¼šä¸ºæ¯ä¸€ä¸ªã€Œå­—ç¬¦ã€åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ IDï¼ˆå­¦åä¸ºç ä½ / ç ç‚¹ / Code Pointï¼‰&lt;/li&gt;
&lt;li&gt;ç¼–ç è§„åˆ™ï¼šå°†ã€Œç ä½ã€è½¬æ¢ä¸ºå­—èŠ‚åºåˆ—çš„è§„åˆ™ï¼ˆç¼–ç /è§£ç  å¯ä»¥ç†è§£ä¸º åŠ å¯†/è§£å¯† çš„è¿‡ç¨‹ï¼‰&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="ç¼–ç " scheme="http://idiotsky.top/categories/%E7%BC%96%E7%A0%81/"/>
    
    
      <category term="Unicode" scheme="http://idiotsky.top/tags/Unicode/"/>
    
      <category term="UTF-8" scheme="http://idiotsky.top/tags/UTF-8/"/>
    
  </entry>
  
  <entry>
    <title>linuxçš„å†™æ—¶å¤åˆ¶</title>
    <link href="http://idiotsky.top/2018/03/13/linux-copy-on-write/"/>
    <id>http://idiotsky.top/2018/03/13/linux-copy-on-write/</id>
    <published>2018-03-13T15:32:23.000Z</published>
    <updated>2018-07-17T11:39:16.529Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>å‰é¢ä¸€ç¯‡æ–‡ç« åˆç»™è‡ªå·±æŒ–å‘ï¼Œæ‰€ä»¥å¿…é¡»å†markä¸€ç¯‡ï¼Œè¿™ç¯‡æ–‡ç« å¾ˆå¥½çš„è¯´äº†å…³äºå†™æ—¶å¤åˆ¶çš„åŸç†ã€‚</p>
</blockquote>
<p>å½“è°ƒç”¨fork()ç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹æ—¶ï¼ŒLinuxå¹¶ä¸ä¼šä¸ºå­è¿›ç¨‹åˆ›å»ºæ–°çš„ç‰©ç†å†…å­˜ç©ºé—´ï¼Œè€Œæ˜¯å…¬ç”¨çˆ¶è¿›ç¨‹çš„ç‰©ç†å†…å­˜ã€‚è¿™æ˜¯å› ä¸ºLinuxçš„å†…æ ¸å¼€å‘è€…è§‰å¾—ï¼Œè°ƒç”¨è€…è°ƒç”¨fork()ç³»ç»Ÿè°ƒç”¨åä¼šç«‹åˆ»è°ƒç”¨exec()ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œæ–°çš„ç¨‹åºï¼Œè¿™æ ·æ—§çš„ç‰©ç†å†…å­˜å†…å®¹å°±æ²¡æœ‰ä»€ä¹ˆä½œç”¨äº†ï¼ˆå› ä¸ºæ–°çš„ç¨‹åºä¸æ—§çš„ç¨‹åºå®Œå…¨æ²¡æœ‰å…³è”ï¼‰ï¼Œæ‰€ä»¥ä¸ºå­è¿›ç¨‹å¤åˆ¶çˆ¶è¿›ç¨‹çš„ç‰©ç†å†…å­˜å†…å®¹æ˜¯ä¸€ä»¶å¾’åŠ³æ— åŠŸçš„äº‹æƒ…ã€‚</p>
<p>æ‰€ä»¥Linuxçš„åšæ³•å°±æ˜¯ï¼šçˆ¶å­è¿›ç¨‹å…±ç”¨åŒä¸€ç‰©ç†å†…å­˜ã€‚å¦‚ä¸‹å›¾ï¼š</p>
<p><a href="http://idiotsky.top/images2/linux-copy-on-write-1.png"><img src="http://idiotsky.top/images2/linux-copy-on-write-1.png" alt=""></a><br><a id="more"></a></p>
<p>ä½†æ“ä½œç³»ç»Ÿçš„è¦æ±‚æ˜¯ï¼šè¿›ç¨‹ä¹‹é—´çš„å†…å­˜åº”è¯¥è¦ç‹¬ç«‹ï¼Œå°±æ˜¯è¯»å†™Aè¿›ç¨‹çš„å†…å­˜ç©ºé—´ä¸åº”è¯¥å½±å“Bè¿›ç¨‹çš„å†…å­˜å†…å®¹ã€‚è¯»æ“ä½œæ˜¯ä¸ä¼šæ”¹å˜å†…å­˜ä¸­çš„å†…å®¹ï¼Œæ‰€ä»¥å¯¹äºè¯»æ“ä½œæ¥è¯´ï¼Œå…±äº«ç‰©ç†å†…å­˜æ˜¯å®‰å…¨çš„ã€‚ä½†æ˜¯å¯¹äºå†™æ“ä½œå°±ä¸ä¸€æ ·ï¼Œå¦‚æœçˆ¶å­è¿›ç¨‹å…±ç”¨äº†ç›¸åŒçš„ç‰©ç†å†…å­˜ï¼Œé‚£ä¹ˆå¯¹å­è¿›ç¨‹çš„å†…å­˜è¿›è¡Œå†™æ“ä½œåŒæ—¶ä¼šå½±å“åˆ°çˆ¶è¿›ç¨‹ï¼Œæ‰€ä»¥è¿åäº†æ“ä½œç³»ç»Ÿçš„è¦æ±‚ã€‚</p>
<p>Linuxçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šæŠŠå…±ç”¨çš„ç‰©ç†å†…å­˜è®¾ç½®ä¸ºåªè¯»ï¼Œå› ä¸ºè¯»æ“ä½œä¸ä¼šæ”¹å˜å†…å­˜çš„å†…å®¹ï¼Œæ‰€ä»¥å¯¹äºçˆ¶å­è¿›ç¨‹éƒ½æ˜¯å…è®¸çš„ã€‚è€Œå½“çˆ¶å­è¿›ç¨‹å…¶ä¸­ä¸€ä¸ªè¿›è¡Œå†™æ“ä½œæ—¶ï¼Œå› ä¸ºå†…å­˜è¢«è®¾ç½®ä¸ºåªè¯»ï¼Œæ‰€ä»¥CPUä¼šè§¦å‘ â€œpage faultâ€ çš„é”™è¯¯ï¼Œä»è€Œè°ƒç”¨å†…æ ¸çš„<code>do_page_fault()</code>å‡½æ•°ã€‚è€Œ<code>do_page_fault()</code>å‡½æ•°åˆä¼šè°ƒç”¨<code>do_wp_page()</code>å‡½æ•°å»è¿›è¡Œå¤åˆ¶çˆ¶è¿›ç¨‹å†…å­˜çš„å†…å®¹ã€‚</p>
<p><code>do_wp_page()</code>å‡½æ•°å…ˆè¿›è¡Œä¸€äº›å®‰å…¨ç›‘æµ‹ï¼Œç„¶åè°ƒç”¨<code>__do_wp_page()</code>å‡½æ•°åšæœ€åçš„å¤åˆ¶æ“ä½œã€‚å»æ‰ä¸€äº›ç›‘æµ‹åï¼Œ<code>__do_wp_page()</code>å‡½æ•°çš„ä»£ç å¦‚ä¸‹å›¾ï¼š</p>
<p><a href="http://idiotsky.top/images2/linux-copy-on-write-3.jpg"><img src="http://idiotsky.top/images2/linux-copy-on-write-3.jpg" alt=""></a> </p>
<p><code>__do_wp_page()</code>é¦–å…ˆä¼šç”³è¯·ä¸€å—æ–°çš„ç‰©ç†å†…å­˜ï¼Œç„¶åå¤åˆ¶æ—§çš„ç‰©ç†å†…å­˜é¡µçš„å†…å®¹åˆ°æ–°çš„ç‰©ç†å†…å­˜ä¹Ÿä¸­ï¼Œç„¶åè®¾ç½®è™šæ‹Ÿå†…å­˜ä¸ç‰©ç†å†…å­˜çš„æ˜ å°„å…³ç³»ã€‚æœ€åæŠŠçˆ¶å­è¿›ç¨‹çš„ç‰©ç†å†…å­˜è®¾ç½®å¯è¯»å†™ï¼Œè¿™æ ·çˆ¶å­è¿›ç¨‹ç›¸åŒçš„è™šæ‹Ÿå†…å­˜éƒ½æŒ‡å‘ä¸åŒçš„ç‰©ç†å†…å­˜ï¼Œæ‰€ä»¥è¾¾åˆ°è¿›ç¨‹ä¹‹é—´å†…å­˜éš”ç¦»çš„ç›®çš„ã€‚å¦‚ä¸‹å›¾ï¼š</p>
<p><a href="http://idiotsky.top/images2/linux-copy-on-write-2.png"><img src="http://idiotsky.top/images2/linux-copy-on-write-2.png" alt=""></a> </p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;å‰é¢ä¸€ç¯‡æ–‡ç« åˆç»™è‡ªå·±æŒ–å‘ï¼Œæ‰€ä»¥å¿…é¡»å†markä¸€ç¯‡ï¼Œè¿™ç¯‡æ–‡ç« å¾ˆå¥½çš„è¯´äº†å…³äºå†™æ—¶å¤åˆ¶çš„åŸç†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å½“è°ƒç”¨fork()ç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹æ—¶ï¼ŒLinuxå¹¶ä¸ä¼šä¸ºå­è¿›ç¨‹åˆ›å»ºæ–°çš„ç‰©ç†å†…å­˜ç©ºé—´ï¼Œè€Œæ˜¯å…¬ç”¨çˆ¶è¿›ç¨‹çš„ç‰©ç†å†…å­˜ã€‚è¿™æ˜¯å› ä¸ºLinuxçš„å†…æ ¸å¼€å‘è€…è§‰å¾—ï¼Œè°ƒç”¨è€…è°ƒç”¨fork()ç³»ç»Ÿè°ƒç”¨åä¼šç«‹åˆ»è°ƒç”¨exec()ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œæ–°çš„ç¨‹åºï¼Œè¿™æ ·æ—§çš„ç‰©ç†å†…å­˜å†…å®¹å°±æ²¡æœ‰ä»€ä¹ˆä½œç”¨äº†ï¼ˆå› ä¸ºæ–°çš„ç¨‹åºä¸æ—§çš„ç¨‹åºå®Œå…¨æ²¡æœ‰å…³è”ï¼‰ï¼Œæ‰€ä»¥ä¸ºå­è¿›ç¨‹å¤åˆ¶çˆ¶è¿›ç¨‹çš„ç‰©ç†å†…å­˜å†…å®¹æ˜¯ä¸€ä»¶å¾’åŠ³æ— åŠŸçš„äº‹æƒ…ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥Linuxçš„åšæ³•å°±æ˜¯ï¼šçˆ¶å­è¿›ç¨‹å…±ç”¨åŒä¸€ç‰©ç†å†…å­˜ã€‚å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://idiotsky.top/images2/linux-copy-on-write-1.png&quot;&gt;&lt;img src=&quot;http://idiotsky.top/images2/linux-copy-on-write-1.png&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="http://idiotsky.top/categories/linux/"/>
    
    
      <category term="linux" scheme="http://idiotsky.top/tags/linux/"/>
    
      <category term="linuxå†…æ ¸" scheme="http://idiotsky.top/tags/linux%E5%86%85%E6%A0%B8/"/>
    
  </entry>
  
  <entry>
    <title>linuxçš„é›¶æ‹·è´æŠ€æœ¯</title>
    <link href="http://idiotsky.top/2018/03/13/linux-zero-copy/"/>
    <id>http://idiotsky.top/2018/03/13/linux-zero-copy/</id>
    <published>2018-03-13T14:01:39.000Z</published>
    <updated>2018-07-17T11:39:16.530Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>ğŸ‘¿ linuxå†…æ ¸é‡Œé¢ä¸ºæ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦å»ºç«‹ç¼“å­˜çš„ï¼Œè€Œç”¨æˆ·å±‚ä¹Ÿæœ‰è‡ªå·±çš„ç¼“å­˜ï¼Œé‚£æ ·æ¯æ¬¡readå’Œwriteç­‰ç›¸å…³ç³»ç»Ÿè°ƒç”¨ï¼Œä¸ä½†æœ‰å¯èƒ½ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè€Œä¸”è¿˜è¦ä¸æ–­ä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€æˆ–è€…ä»å†…æ ¸æ€æ‹·è´åˆ°ç”¨æˆ·æ€ã€‚å¦‚æœæœ‰äº›æ•°æ®ä¸ç”¨ç»è¿‡ç”¨æˆ·å±‚çš„è¯ï¼ˆä¾‹å¦‚ç½‘ç»œä»£ç†æœåŠ¡ï¼‰ï¼Œå¯ä»¥ä¸ç”¨è¿™ç§æ‹·è´æ¥æµªè´¹èµ„æºï¼Œæ‰€ä»¥Linuxçš„ç³»ç»Ÿè°ƒç”¨å°±æœ‰äº†å‡ ä¸ªé›¶æ‹·è´çš„å‡½æ•°æ¥è§£å†³è¿™ç§é—®é¢˜ã€‚ï¼ˆè™½è¯´é›¶æ‹·è´ï¼Œä½†å…¶å®ä¹Ÿåªæ˜¯å‡å°‘äº†ç”¨æˆ·æ€æ‹·è´ï¼ŒæŠŠæ‰€æœ‰æ‹·è´éƒ½åœ¨å†…æ ¸é‡Œé¢å¤„ç†äº†ï¼‰</p>
</blockquote>
<h1 id="å¼•æ–‡"><a href="#å¼•æ–‡" class="headerlink" title="å¼•æ–‡"></a>å¼•æ–‡</h1><p>åœ¨å†™ä¸€ä¸ªæœåŠ¡ç«¯ç¨‹åºæ—¶ï¼ˆWeb Serveræˆ–è€…æ–‡ä»¶æœåŠ¡å™¨ï¼‰ï¼Œæ–‡ä»¶ä¸‹è½½æ˜¯ä¸€ä¸ªåŸºæœ¬åŠŸèƒ½ã€‚è¿™æ—¶å€™æœåŠ¡ç«¯çš„ä»»åŠ¡æ˜¯ï¼š<strong>å°†æœåŠ¡ç«¯ä¸»æœºç£ç›˜ä¸­çš„æ–‡ä»¶ä¸åšä¿®æ”¹åœ°ä»å·²è¿æ¥çš„socketå‘å‡ºå»</strong>ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨ä¸‹é¢çš„ä»£ç å®Œæˆï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>((n = read(diskfd, buf, BUF_SIZE)) &gt; <span class="number">0</span>)</span><br><span class="line">    write(sockfd, buf , n);</span><br></pre></td></tr></table></figure></p>
<p>åŸºæœ¬æ“ä½œå°±æ˜¯å¾ªç¯çš„ä»ç£ç›˜è¯»å…¥æ–‡ä»¶å†…å®¹åˆ°ç¼“å†²åŒºï¼Œå†å°†ç¼“å†²åŒºçš„å†…å®¹å‘é€åˆ°socketã€‚ä½†æ˜¯ç”±äºLinuxçš„I/Oæ“ä½œé»˜è®¤æ˜¯ç¼“å†²I/Oã€‚è¿™é‡Œé¢ä¸»è¦ä½¿ç”¨çš„ä¹Ÿå°±æ˜¯readå’Œwriteä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“æ“ä½œç³»ç»Ÿåœ¨å…¶ä¸­åšäº†ä»€ä¹ˆã€‚å®é™…ä¸Šåœ¨ä»¥ä¸ŠI/Oæ“ä½œä¸­ï¼Œå‘ç”Ÿäº†å¤šæ¬¡çš„æ•°æ®æ‹·è´ã€‚<br><a id="more"></a></p>
<p>å½“åº”ç”¨ç¨‹åºè®¿é—®æŸå—æ•°æ®æ—¶ï¼Œæ“ä½œç³»ç»Ÿé¦–å…ˆä¼šæ£€æŸ¥ï¼Œæ˜¯ä¸æ˜¯æœ€è¿‘è®¿é—®è¿‡æ­¤æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹æ˜¯å¦ç¼“å­˜åœ¨å†…æ ¸ç¼“å†²åŒºï¼Œå¦‚æœæ˜¯ï¼Œæ“ä½œç³»ç»Ÿåˆ™ç›´æ¥æ ¹æ®readç³»ç»Ÿè°ƒç”¨æä¾›çš„bufåœ°å€ï¼Œå°†å†…æ ¸ç¼“å†²åŒºçš„å†…å®¹æ‹·è´åˆ°bufæ‰€æŒ‡å®šçš„ç”¨æˆ·ç©ºé—´ç¼“å†²åŒºä¸­å»ã€‚å¦‚æœä¸æ˜¯ï¼Œæ“ä½œç³»ç»Ÿåˆ™é¦–å…ˆå°†ç£ç›˜ä¸Šçš„æ•°æ®æ‹·è´çš„å†…æ ¸ç¼“å†²åŒºï¼Œè¿™ä¸€æ­¥ç›®å‰ä¸»è¦ä¾é DMAæ¥ä¼ è¾“ï¼Œç„¶åå†æŠŠå†…æ ¸ç¼“å†²åŒºä¸Šçš„å†…å®¹æ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒºä¸­ã€‚<br>æ¥ä¸‹æ¥ï¼Œwriteç³»ç»Ÿè°ƒç”¨å†æŠŠç”¨æˆ·ç¼“å†²åŒºçš„å†…å®¹æ‹·è´åˆ°ç½‘ç»œå †æ ˆç›¸å…³çš„å†…æ ¸ç¼“å†²åŒºä¸­ï¼Œæœ€åsocketå†æŠŠå†…æ ¸ç¼“å†²åŒºçš„å†…å®¹å‘é€åˆ°ç½‘å¡ä¸Šã€‚<br>è¯´äº†è¿™ä¹ˆå¤šï¼Œä¸å¦‚çœ‹å›¾æ¸…æ¥šï¼š</p>
<p><a href="http://idiotsky.top/images2/linux-zero-copy-1.png"><img src="http://idiotsky.top/images2/linux-zero-copy-1.png" alt=""></a> </p>
<p>ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œå…±äº§ç”Ÿäº†å››æ¬¡æ•°æ®æ‹·è´ï¼Œå³ä½¿ä½¿ç”¨äº†DMAæ¥å¤„ç†äº†ä¸ç¡¬ä»¶çš„é€šè®¯ï¼ŒCPUä»ç„¶éœ€è¦å¤„ç†ä¸¤æ¬¡æ•°æ®æ‹·è´ï¼Œä¸æ­¤åŒæ—¶ï¼Œåœ¨ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹Ÿå‘ç”Ÿäº†å¤šæ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ— ç–‘ä¹ŸåŠ é‡äº†CPUè´Ÿæ‹…ã€‚<br>åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰å¯¹æ–‡ä»¶å†…å®¹åšä»»ä½•ä¿®æ”¹ï¼Œé‚£ä¹ˆåœ¨å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´æ¥å›æ‹·è´æ•°æ®æ— ç–‘å°±æ˜¯ä¸€ç§æµªè´¹ï¼Œè€Œé›¶æ‹·è´ä¸»è¦å°±æ˜¯ä¸ºäº†è§£å†³è¿™ç§ä½æ•ˆæ€§ã€‚</p>
<h1 id="ä»€ä¹ˆæ˜¯é›¶æ‹·è´æŠ€æœ¯ï¼ˆzero-copyï¼‰ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯é›¶æ‹·è´æŠ€æœ¯ï¼ˆzero-copyï¼‰ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯é›¶æ‹·è´æŠ€æœ¯ï¼ˆzero-copyï¼‰ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯é›¶æ‹·è´æŠ€æœ¯ï¼ˆzero-copyï¼‰ï¼Ÿ</h1><p>é›¶æ‹·è´ä¸»è¦çš„ä»»åŠ¡å°±æ˜¯é¿å…CPUå°†æ•°æ®ä»ä¸€å—å­˜å‚¨æ‹·è´åˆ°å¦å¤–ä¸€å—å­˜å‚¨ï¼Œä¸»è¦å°±æ˜¯åˆ©ç”¨å„ç§é›¶æ‹·è´æŠ€æœ¯ï¼Œé¿å…è®©CPUåšå¤§é‡çš„æ•°æ®æ‹·è´ä»»åŠ¡ï¼Œå‡å°‘ä¸å¿…è¦çš„æ‹·è´ï¼Œæˆ–è€…è®©åˆ«çš„ç»„ä»¶æ¥åšè¿™ä¸€ç±»ç®€å•çš„æ•°æ®ä¼ è¾“ä»»åŠ¡ï¼Œè®©CPUè§£è„±å‡ºæ¥ä¸“æ³¨äºåˆ«çš„ä»»åŠ¡ã€‚è¿™æ ·å°±å¯ä»¥è®©ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨æ›´åŠ æœ‰æ•ˆã€‚</p>
<p>æˆ‘ä»¬ç»§ç»­å›åˆ°å¼•æ–‡ä¸­çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¦‚ä½•å‡å°‘æ•°æ®æ‹·è´çš„æ¬¡æ•°å‘¢ï¼Ÿä¸€ä¸ªå¾ˆæ˜æ˜¾çš„ç€åŠ›ç‚¹å°±æ˜¯å‡å°‘æ•°æ®åœ¨å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´æ¥å›æ‹·è´ï¼Œè¿™ä¹Ÿå¼•å…¥äº†é›¶æ‹·è´çš„ä¸€ä¸ªç±»å‹ï¼š</p>
<h2 id="ä½¿ç”¨mmap"><a href="#ä½¿ç”¨mmap" class="headerlink" title="ä½¿ç”¨mmap"></a>ä½¿ç”¨mmap</h2><p>æˆ‘ä»¬å‡å°‘æ‹·è´æ¬¡æ•°çš„ä¸€ç§æ–¹æ³•æ˜¯è°ƒç”¨mmap()æ¥ä»£æ›¿readè°ƒç”¨ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">buf = mmap(diskfd, len);</span><br><span class="line">write(sockfd, buf, len);</span><br></pre></td></tr></table></figure></p>
<p>åº”ç”¨ç¨‹åºè°ƒç”¨mmap()ï¼Œç£ç›˜ä¸Šçš„æ•°æ®ä¼šé€šè¿‡DMAè¢«æ‹·è´çš„å†…æ ¸ç¼“å†²åŒºï¼Œæ¥ç€æ“ä½œç³»ç»Ÿä¼šæŠŠè¿™æ®µå†…æ ¸ç¼“å†²åŒºä¸åº”ç”¨ç¨‹åºå…±äº«ï¼Œè¿™æ ·å°±ä¸éœ€è¦æŠŠå†…æ ¸ç¼“å†²åŒºçš„å†…å®¹å¾€ç”¨æˆ·ç©ºé—´æ‹·è´ã€‚åº”ç”¨ç¨‹åºå†è°ƒç”¨write(),æ“ä½œç³»ç»Ÿç›´æ¥å°†å†…æ ¸ç¼“å†²åŒºçš„å†…å®¹æ‹·è´åˆ°socketç¼“å†²åŒºä¸­ï¼Œè¿™ä¸€åˆ‡éƒ½å‘ç”Ÿåœ¨å†…æ ¸æ€ï¼Œæœ€åï¼Œsocketç¼“å†²åŒºå†æŠŠæ•°æ®å‘åˆ°ç½‘å¡å»ã€‚<br>åŒæ ·çš„ï¼Œçœ‹å›¾å¾ˆç®€å•ï¼š</p>
<p><a href="http://idiotsky.top/images2/linux-zero-copy-2.png"><img src="http://idiotsky.top/images2/linux-zero-copy-2.png" alt=""></a> </p>
<p>ä½¿ç”¨mmapæ›¿ä»£readå¾ˆæ˜æ˜¾å‡å°‘äº†ä¸€æ¬¡æ‹·è´ï¼Œå½“æ‹·è´æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œæ— ç–‘æå‡äº†æ•ˆç‡ã€‚ä½†æ˜¯ä½¿ç”¨mmapæ˜¯æœ‰ä»£ä»·çš„ã€‚å½“ä½ ä½¿ç”¨mmapæ—¶ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ä¸€äº›éšè—çš„é™·é˜±ã€‚ä¾‹å¦‚ï¼Œå½“ä½ çš„ç¨‹åºmapäº†ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯å½“è¿™ä¸ªæ–‡ä»¶è¢«å¦ä¸€ä¸ªè¿›ç¨‹æˆªæ–­(truncate)æ—¶, writeç³»ç»Ÿè°ƒç”¨ä¼šå› ä¸ºè®¿é—®éæ³•åœ°å€è€Œè¢«SIGBUSä¿¡å·ç»ˆæ­¢ã€‚SIGBUSä¿¡å·é»˜è®¤ä¼šæ€æ­»ä½ çš„è¿›ç¨‹å¹¶äº§ç”Ÿä¸€ä¸ªcoredump,å¦‚æœä½ çš„æœåŠ¡å™¨è¿™æ ·è¢«ä¸­æ­¢äº†ï¼Œé‚£ä¼šäº§ç”Ÿä¸€ç¬”æŸå¤±ã€‚</p>
<p>é€šå¸¸æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹è§£å†³æ–¹æ¡ˆé¿å…è¿™ç§é—®é¢˜ï¼š</p>
<ol>
<li>ä¸ºSIGBUSä¿¡å·å»ºç«‹ä¿¡å·å¤„ç†ç¨‹åº<br>å½“é‡åˆ°SIGBUSä¿¡å·æ—¶ï¼Œä¿¡å·å¤„ç†ç¨‹åºç®€å•åœ°è¿”å›ï¼Œwriteç³»ç»Ÿè°ƒç”¨åœ¨è¢«ä¸­æ–­ä¹‹å‰ä¼šè¿”å›å·²ç»å†™å…¥çš„å­—èŠ‚æ•°ï¼Œå¹¶ä¸”errnoä¼šè¢«è®¾ç½®æˆsuccess,ä½†æ˜¯è¿™æ˜¯ä¸€ç§ç³Ÿç³•çš„å¤„ç†åŠæ³•ï¼Œå› ä¸ºä½ å¹¶æ²¡æœ‰è§£å†³é—®é¢˜çš„å®è´¨æ ¸å¿ƒã€‚</li>
<li>ä½¿ç”¨æ–‡ä»¶ç§Ÿå€Ÿé”<br>é€šå¸¸æˆ‘ä»¬ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œåœ¨æ–‡ä»¶æè¿°ç¬¦ä¸Šä½¿ç”¨ç§Ÿå€Ÿé”ï¼Œæˆ‘ä»¬ä¸ºæ–‡ä»¶å‘å†…æ ¸ç”³è¯·ä¸€ä¸ªç§Ÿå€Ÿé”ï¼Œå½“å…¶å®ƒè¿›ç¨‹æƒ³è¦æˆªæ–­è¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œå†…æ ¸ä¼šå‘æˆ‘ä»¬å‘é€ä¸€ä¸ªå®æ—¶çš„RT_SIGNAL_LEASEä¿¡å·ï¼Œå‘Šè¯‰æˆ‘ä»¬å†…æ ¸æ­£åœ¨ç ´åä½ åŠ æŒåœ¨æ–‡ä»¶ä¸Šçš„è¯»å†™é”ã€‚è¿™æ ·åœ¨ç¨‹åºè®¿é—®éæ³•å†…å­˜å¹¶ä¸”è¢«SIGBUSæ€æ­»ä¹‹å‰ï¼Œä½ çš„writeç³»ç»Ÿè°ƒç”¨ä¼šè¢«ä¸­æ–­ã€‚writeä¼šè¿”å›å·²ç»å†™å…¥çš„å­—èŠ‚æ•°ï¼Œå¹¶ä¸”ç½®errnoä¸ºsuccessã€‚</li>
</ol>
<p>æˆ‘ä»¬åº”è¯¥åœ¨mmapæ–‡ä»¶ä¹‹å‰åŠ é”ï¼Œå¹¶ä¸”åœ¨æ“ä½œå®Œæ–‡ä»¶åè§£é”ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(fcntl(diskfd, F_SETSIG, RT_SIGNAL_LEASE) == <span class="number">-1</span>) &#123;</span><br><span class="line">    perror(<span class="string">"kernel lease set signal"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* l_type can be F_RDLCK F_WRLCK  åŠ é”*/</span></span><br><span class="line"><span class="comment">/* l_type can be  F_UNLCK è§£é”*/</span></span><br><span class="line"><span class="keyword">if</span>(fcntl(diskfd, F_SETLEASE, l_type))&#123;</span><br><span class="line">    perror(<span class="string">"kernel lease set type"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="ä½¿ç”¨sendfile"><a href="#ä½¿ç”¨sendfile" class="headerlink" title="ä½¿ç”¨sendfile"></a>ä½¿ç”¨sendfile</h2><p>ä»2.1ç‰ˆå†…æ ¸å¼€å§‹ï¼ŒLinuxå¼•å…¥äº†sendfileæ¥ç®€åŒ–æ“ä½œ:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/sendfile.h&gt;</span></span></span><br><span class="line"><span class="keyword">ssize_t</span> sendfile(<span class="keyword">int</span> out_fd, <span class="keyword">int</span> in_fd, <span class="keyword">off_t</span> *offset, <span class="keyword">size_t</span> count);</span><br></pre></td></tr></table></figure></p>
<p>ç³»ç»Ÿè°ƒç”¨sendfile()åœ¨ä»£è¡¨è¾“å…¥æ–‡ä»¶çš„æè¿°ç¬¦in_fdå’Œä»£è¡¨è¾“å‡ºæ–‡ä»¶çš„æè¿°ç¬¦out_fdä¹‹é—´ä¼ é€æ–‡ä»¶å†…å®¹ï¼ˆå­—èŠ‚ï¼‰ã€‚æè¿°ç¬¦out_fdå¿…é¡»æŒ‡å‘ä¸€ä¸ªå¥—æ¥å­—ï¼Œè€Œin_fdæŒ‡å‘çš„æ–‡ä»¶å¿…é¡»æ˜¯å¯ä»¥mmapçš„ã€‚è¿™äº›å±€é™é™åˆ¶äº†sendfileçš„ä½¿ç”¨ï¼Œä½¿sendfileåªèƒ½å°†æ•°æ®ä»æ–‡ä»¶ä¼ é€’åˆ°å¥—æ¥å­—ä¸Šï¼Œåä¹‹åˆ™ä¸è¡Œã€‚<br>ä½¿ç”¨sendfileä¸ä»…å‡å°‘äº†æ•°æ®æ‹·è´çš„æ¬¡æ•°ï¼Œè¿˜å‡å°‘äº†ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ•°æ®ä¼ é€å§‹ç»ˆåªå‘ç”Ÿåœ¨kernel spaceã€‚</p>
<p><a href="http://idiotsky.top/images2/linux-zero-copy-3.png"><img src="http://idiotsky.top/images2/linux-zero-copy-3.png" alt=""></a> </p>
<p>åœ¨æˆ‘ä»¬è°ƒç”¨sendfileæ—¶ï¼Œå¦‚æœæœ‰å…¶å®ƒè¿›ç¨‹æˆªæ–­äº†æ–‡ä»¶ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿå‡è®¾æˆ‘ä»¬æ²¡æœ‰è®¾ç½®ä»»ä½•ä¿¡å·å¤„ç†ç¨‹åºï¼Œsendfileè°ƒç”¨ä»…ä»…è¿”å›å®ƒåœ¨è¢«ä¸­æ–­ä¹‹å‰å·²ç»ä¼ è¾“çš„å­—èŠ‚æ•°ï¼Œerrnoä¼šè¢«ç½®ä¸ºsuccessã€‚å¦‚æœæˆ‘ä»¬åœ¨è°ƒç”¨sendfileä¹‹å‰ç»™æ–‡ä»¶åŠ äº†é”ï¼Œsendfileçš„è¡Œä¸ºä»ç„¶å’Œä¹‹å‰ç›¸åŒï¼Œæˆ‘ä»¬è¿˜ä¼šæ”¶åˆ°RT_SIGNAL_LEASEçš„ä¿¡å·ã€‚</p>
<p>ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å‡å°‘äº†æ•°æ®æ‹·è´çš„æ¬¡æ•°äº†ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨ä¸€æ¬¡æ‹·è´ï¼Œå°±æ˜¯é¡µç¼“å­˜åˆ°socketç¼“å­˜çš„æ‹·è´ã€‚é‚£ä¹ˆèƒ½ä¸èƒ½æŠŠè¿™ä¸ªæ‹·è´ä¹Ÿçœç•¥å‘¢ï¼Ÿ</p>
<p>å€ŸåŠ©äºç¡¬ä»¶ä¸Šçš„å¸®åŠ©ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥åŠåˆ°çš„ã€‚ä¹‹å‰æˆ‘ä»¬æ˜¯æŠŠé¡µç¼“å­˜çš„æ•°æ®æ‹·è´åˆ°socketç¼“å­˜ä¸­ï¼Œå®é™…ä¸Šï¼Œæˆ‘ä»¬ä»…ä»…éœ€è¦æŠŠç¼“å†²åŒºæè¿°ç¬¦ä¼ åˆ°socketç¼“å†²åŒºï¼Œå†æŠŠæ•°æ®é•¿åº¦ä¼ è¿‡å»ï¼Œè¿™æ ·DMAæ§åˆ¶å™¨ç›´æ¥å°†é¡µç¼“å­˜ä¸­çš„æ•°æ®æ‰“åŒ…å‘é€åˆ°ç½‘ç»œä¸­å°±å¯ä»¥äº†ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œsendfileç³»ç»Ÿè°ƒç”¨åˆ©ç”¨DMAå¼•æ“å°†æ–‡ä»¶å†…å®¹æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºå»ï¼Œç„¶åå°†å¸¦æœ‰æ–‡ä»¶ä½ç½®å’Œé•¿åº¦ä¿¡æ¯çš„ç¼“å†²åŒºæè¿°ç¬¦æ·»åŠ socketç¼“å†²åŒºå»ï¼Œè¿™ä¸€æ­¥ä¸ä¼šå°†å†…æ ¸ä¸­çš„æ•°æ®æ‹·è´åˆ°socketç¼“å†²åŒºä¸­ï¼ŒDMAå¼•æ“ä¼šå°†å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®æ‹·è´åˆ°åè®®å¼•æ“ä¸­å»ï¼Œé¿å…äº†æœ€åä¸€æ¬¡æ‹·è´ã€‚</p>
<p><a href="http://idiotsky.top/images2/linux-zero-copy-4.png"><img src="http://idiotsky.top/images2/linux-zero-copy-4.png" alt=""></a> </p>
<p>ä¸è¿‡è¿™ä¸€ç§æ”¶é›†æ‹·è´åŠŸèƒ½æ˜¯éœ€è¦ç¡¬ä»¶ä»¥åŠé©±åŠ¨ç¨‹åºæ”¯æŒçš„ã€‚</p>
<h2 id="ä½¿ç”¨splice"><a href="#ä½¿ç”¨splice" class="headerlink" title="ä½¿ç”¨splice"></a>ä½¿ç”¨splice</h2><p>sendfileåªé€‚ç”¨äºå°†æ•°æ®ä»æ–‡ä»¶æ‹·è´åˆ°å¥—æ¥å­—ä¸Šï¼Œé™å®šäº†å®ƒçš„ä½¿ç”¨èŒƒå›´ã€‚Linuxåœ¨2.6.17ç‰ˆæœ¬å¼•å…¥spliceç³»ç»Ÿè°ƒç”¨ï¼Œç”¨äºåœ¨ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸­ç§»åŠ¨æ•°æ®ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _GNU_SOURCE         <span class="comment">/* See feature_test_macros(7) */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="keyword">ssize_t</span> splice(<span class="keyword">int</span> fd_in, <span class="keyword">loff_t</span> *off_in, <span class="keyword">int</span> fd_out, <span class="keyword">loff_t</span> *off_out, <span class="keyword">size_t</span> len, <span class="keyword">unsigned</span> <span class="keyword">int</span> flags);</span><br></pre></td></tr></table></figure></p>
<p>spliceè°ƒç”¨åœ¨ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¹‹é—´ç§»åŠ¨æ•°æ®ï¼Œè€Œä¸éœ€è¦æ•°æ®åœ¨å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´æ¥å›æ‹·è´ã€‚ä»–ä»fd_inæ‹·è´lené•¿åº¦çš„æ•°æ®åˆ°fd_outï¼Œä½†æ˜¯æœ‰ä¸€æ–¹å¿…é¡»æ˜¯ç®¡é“è®¾å¤‡ï¼Œè¿™ä¹Ÿæ˜¯ç›®å‰spliceçš„ä¸€äº›å±€é™æ€§ã€‚flagså‚æ•°æœ‰ä»¥ä¸‹å‡ ç§å–å€¼ï¼š</p>
<ul>
<li>SPLICE_F_MOVE ï¼šå°è¯•å»ç§»åŠ¨æ•°æ®è€Œä¸æ˜¯æ‹·è´æ•°æ®ã€‚è¿™ä»…ä»…æ˜¯å¯¹å†…æ ¸çš„ä¸€ä¸ªå°æç¤ºï¼šå¦‚æœå†…æ ¸ä¸èƒ½ä»pipeç§»åŠ¨æ•°æ®æˆ–è€…pipeçš„ç¼“å­˜ä¸æ˜¯ä¸€ä¸ªæ•´é¡µé¢ï¼Œä»ç„¶éœ€è¦æ‹·è´æ•°æ®ã€‚Linuxæœ€åˆçš„å®ç°æœ‰äº›é—®é¢˜ï¼Œæ‰€ä»¥ä»2.6.21å¼€å§‹è¿™ä¸ªé€‰é¡¹ä¸èµ·ä½œç”¨ï¼Œåé¢çš„Linuxç‰ˆæœ¬åº”è¯¥ä¼šå®ç°ã€‚</li>
<li>SPLICE_F_NONBLOCK ï¼šsplice æ“ä½œä¸ä¼šè¢«é˜»å¡ã€‚ç„¶è€Œï¼Œå¦‚æœæ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰è¢«è®¾ç½®ä¸ºä¸å¯è¢«é˜»å¡æ–¹å¼çš„ I/O ï¼Œé‚£ä¹ˆè°ƒç”¨ splice æœ‰å¯èƒ½ä»ç„¶è¢«é˜»å¡ã€‚</li>
<li>SPLICE_F_MORE ï¼š åé¢çš„spliceè°ƒç”¨ä¼šæœ‰æ›´å¤šçš„æ•°æ®ã€‚</li>
</ul>
<p>spliceè°ƒç”¨åˆ©ç”¨äº†Linuxæå‡ºçš„ç®¡é“ç¼“å†²åŒºæœºåˆ¶ï¼Œ æ‰€ä»¥è‡³å°‘ä¸€ä¸ªæè¿°ç¬¦è¦ä¸ºç®¡é“ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä»¥ä¸Šå‡ ç§é›¶æ‹·è´æŠ€æœ¯éƒ½æ˜¯å‡å°‘æ•°æ®åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´æ‹·è´æŠ€æœ¯å®ç°çš„ï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™ï¼Œæ•°æ®å¿…é¡»åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´æ‹·è´ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬åªèƒ½é’ˆå¯¹æ•°æ®åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´æ‹·è´çš„æ—¶æœºä¸Šä¸‹åŠŸå¤«äº†ã€‚Linuxé€šå¸¸åˆ©ç”¨å†™æ—¶å¤åˆ¶(copy on write)æ¥å‡å°‘ç³»ç»Ÿå¼€é”€ï¼Œè¿™ä¸ªæŠ€æœ¯åˆæ—¶å¸¸ç§°ä½œCOWã€‚</p>
<p>ç”±äºç¯‡å¹…åŸå› ï¼Œæœ¬æ–‡ä¸è¯¦ç»†ä»‹ç»å†™æ—¶å¤åˆ¶ã€‚å¤§æ¦‚æè¿°ä¸‹å°±æ˜¯ï¼šå¦‚æœå¤šä¸ªç¨‹åºåŒæ—¶è®¿é—®åŒä¸€å—æ•°æ®ï¼Œé‚£ä¹ˆæ¯ä¸ªç¨‹åºéƒ½æ‹¥æœ‰æŒ‡å‘è¿™å—æ•°æ®çš„æŒ‡é’ˆï¼Œåœ¨æ¯ä¸ªç¨‹åºçœ‹æ¥ï¼Œè‡ªå·±éƒ½æ˜¯ç‹¬ç«‹æ‹¥æœ‰è¿™å—æ•°æ®çš„ï¼Œåªæœ‰å½“ç¨‹åºéœ€è¦å¯¹æ•°æ®å†…å®¹è¿›è¡Œä¿®æ”¹æ—¶ï¼Œæ‰ä¼šæŠŠæ•°æ®å†…å®¹æ‹·è´åˆ°ç¨‹åºè‡ªå·±çš„åº”ç”¨ç©ºé—´é‡Œå»ï¼Œè¿™æ—¶å€™ï¼Œæ•°æ®æ‰æˆä¸ºè¯¥ç¨‹åºçš„ç§æœ‰æ•°æ®ã€‚å¦‚æœç¨‹åºä¸éœ€è¦å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆæ°¸è¿œéƒ½ä¸éœ€è¦æ‹·è´æ•°æ®åˆ°è‡ªå·±çš„åº”ç”¨ç©ºé—´é‡Œã€‚è¿™æ ·å°±å‡å°‘äº†æ•°æ®çš„æ‹·è´</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›é›¶æ‹·è´æŠ€æœ¯ï¼Œæ¯”å¦‚ä¼ ç»Ÿçš„Linux I/Oä¸­åŠ ä¸ŠO_DIRECTæ ‡è®°å¯ä»¥ç›´æ¥I/Oï¼Œé¿å…äº†è‡ªåŠ¨ç¼“å­˜ï¼Œè¿˜æœ‰å°šæœªæˆç†Ÿçš„fbufsæŠ€æœ¯ï¼Œæœ¬æ–‡å°šæœªè¦†ç›–æ‰€æœ‰é›¶æ‹·è´æŠ€æœ¯ï¼Œåªæ˜¯ä»‹ç»å¸¸è§çš„ä¸€äº›ï¼Œå¦‚æœ‰å…´è¶£ï¼Œå¯ä»¥è‡ªè¡Œç ”ç©¶ï¼Œä¸€èˆ¬æˆç†Ÿçš„æœåŠ¡ç«¯é¡¹ç›®ä¹Ÿä¼šè‡ªå·±æ”¹é€ å†…æ ¸ä¸­æœ‰å…³I/Oçš„éƒ¨åˆ†ï¼Œæé«˜è‡ªå·±çš„æ•°æ®ä¼ è¾“é€Ÿç‡ã€‚</p>
<p>ref <a href="https://www.jianshu.com/p/fad3339e3448" target="_blank" rel="noopener">https://www.jianshu.com/p/fad3339e3448</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ğŸ‘¿ linuxå†…æ ¸é‡Œé¢ä¸ºæ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦å»ºç«‹ç¼“å­˜çš„ï¼Œè€Œç”¨æˆ·å±‚ä¹Ÿæœ‰è‡ªå·±çš„ç¼“å­˜ï¼Œé‚£æ ·æ¯æ¬¡readå’Œwriteç­‰ç›¸å…³ç³»ç»Ÿè°ƒç”¨ï¼Œä¸ä½†æœ‰å¯èƒ½ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè€Œä¸”è¿˜è¦ä¸æ–­ä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€æˆ–è€…ä»å†…æ ¸æ€æ‹·è´åˆ°ç”¨æˆ·æ€ã€‚å¦‚æœæœ‰äº›æ•°æ®ä¸ç”¨ç»è¿‡ç”¨æˆ·å±‚çš„è¯ï¼ˆä¾‹å¦‚ç½‘ç»œä»£ç†æœåŠ¡ï¼‰ï¼Œå¯ä»¥ä¸ç”¨è¿™ç§æ‹·è´æ¥æµªè´¹èµ„æºï¼Œæ‰€ä»¥Linuxçš„ç³»ç»Ÿè°ƒç”¨å°±æœ‰äº†å‡ ä¸ªé›¶æ‹·è´çš„å‡½æ•°æ¥è§£å†³è¿™ç§é—®é¢˜ã€‚ï¼ˆè™½è¯´é›¶æ‹·è´ï¼Œä½†å…¶å®ä¹Ÿåªæ˜¯å‡å°‘äº†ç”¨æˆ·æ€æ‹·è´ï¼ŒæŠŠæ‰€æœ‰æ‹·è´éƒ½åœ¨å†…æ ¸é‡Œé¢å¤„ç†äº†ï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;å¼•æ–‡&quot;&gt;&lt;a href=&quot;#å¼•æ–‡&quot; class=&quot;headerlink&quot; title=&quot;å¼•æ–‡&quot;&gt;&lt;/a&gt;å¼•æ–‡&lt;/h1&gt;&lt;p&gt;åœ¨å†™ä¸€ä¸ªæœåŠ¡ç«¯ç¨‹åºæ—¶ï¼ˆWeb Serveræˆ–è€…æ–‡ä»¶æœåŠ¡å™¨ï¼‰ï¼Œæ–‡ä»¶ä¸‹è½½æ˜¯ä¸€ä¸ªåŸºæœ¬åŠŸèƒ½ã€‚è¿™æ—¶å€™æœåŠ¡ç«¯çš„ä»»åŠ¡æ˜¯ï¼š&lt;strong&gt;å°†æœåŠ¡ç«¯ä¸»æœºç£ç›˜ä¸­çš„æ–‡ä»¶ä¸åšä¿®æ”¹åœ°ä»å·²è¿æ¥çš„socketå‘å‡ºå»&lt;/strong&gt;ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨ä¸‹é¢çš„ä»£ç å®Œæˆï¼š&lt;br&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt;((n = read(diskfd, buf, BUF_SIZE)) &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    write(sockfd, buf , n);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;åŸºæœ¬æ“ä½œå°±æ˜¯å¾ªç¯çš„ä»ç£ç›˜è¯»å…¥æ–‡ä»¶å†…å®¹åˆ°ç¼“å†²åŒºï¼Œå†å°†ç¼“å†²åŒºçš„å†…å®¹å‘é€åˆ°socketã€‚ä½†æ˜¯ç”±äºLinuxçš„I/Oæ“ä½œé»˜è®¤æ˜¯ç¼“å†²I/Oã€‚è¿™é‡Œé¢ä¸»è¦ä½¿ç”¨çš„ä¹Ÿå°±æ˜¯readå’Œwriteä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“æ“ä½œç³»ç»Ÿåœ¨å…¶ä¸­åšäº†ä»€ä¹ˆã€‚å®é™…ä¸Šåœ¨ä»¥ä¸ŠI/Oæ“ä½œä¸­ï¼Œå‘ç”Ÿäº†å¤šæ¬¡çš„æ•°æ®æ‹·è´ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="linux" scheme="http://idiotsky.top/categories/linux/"/>
    
    
      <category term="linux" scheme="http://idiotsky.top/tags/linux/"/>
    
      <category term="sendfile" scheme="http://idiotsky.top/tags/sendfile/"/>
    
      <category term="mmap" scheme="http://idiotsky.top/tags/mmap/"/>
    
      <category term="splice" scheme="http://idiotsky.top/tags/splice/"/>
    
  </entry>
  
  <entry>
    <title>linuxçš„é˜»å¡å’Œéé˜»å¡socketçš„åŒºåˆ«</title>
    <link href="http://idiotsky.top/2018/03/12/linux-non-blocking-io/"/>
    <id>http://idiotsky.top/2018/03/12/linux-non-blocking-io/</id>
    <published>2018-03-12T15:44:11.000Z</published>
    <updated>2018-03-13T13:59:01.326Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« æœ‰æåˆ°éé˜»å¡socketï¼Œæ‰€ä»¥è¿™ç¯‡æ–‡ç« å°±çœ‹çœ‹è¿™ä¸ªæ˜¯ä»€ä¹ˆä¸œä¸œğŸ‘¿</p>
</blockquote>
<h1 id="è¯»æ“ä½œ"><a href="#è¯»æ“ä½œ" class="headerlink" title="è¯»æ“ä½œ"></a>è¯»æ“ä½œ</h1><p>å¯¹äºé˜»å¡çš„socket,å½“socketçš„æ¥æ”¶ç¼“å†²åŒºä¸­æ²¡æœ‰æ•°æ®æ—¶ï¼Œreadè°ƒç”¨ä¼šä¸€ç›´é˜»å¡ä½ï¼Œç›´åˆ°æœ‰æ•°æ®åˆ°æ¥æ‰è¿”å›ã€‚å½“socketç¼“å†²åŒºä¸­çš„æ•°æ®é‡å°äºæœŸæœ›è¯»å–çš„æ•°æ®é‡æ—¶ï¼Œè¿”å›å®é™…è¯»å–çš„å­—èŠ‚æ•°ã€‚å½“socktçš„æ¥æ”¶ç¼“å†²åŒºä¸­çš„æ•°æ®å¤§äºæœŸæœ›è¯»å–çš„å­—èŠ‚æ•°æ—¶ï¼Œè¯»å–æœŸæœ›è¯»å–çš„å­—èŠ‚æ•°ï¼Œè¿”å›å®é™…è¯»å–çš„é•¿åº¦ã€‚</p>
<p>å¯¹äºéé˜»å¡socketè€Œè¨€ï¼Œsocketçš„æ¥æ”¶ç¼“å†²åŒºä¸­æœ‰æ²¡æœ‰æ•°æ®ï¼Œreadè°ƒç”¨éƒ½ä¼šç«‹åˆ»è¿”å›ã€‚æ¥æ”¶ç¼“å†²åŒºä¸­æœ‰æ•°æ®æ—¶ï¼Œä¸é˜»å¡socketæœ‰æ•°æ®çš„æƒ…å†µæ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœæ¥æ”¶ç¼“å†²åŒºä¸­æ²¡æœ‰æ•°æ®ï¼Œåˆ™è¿”å›é”™è¯¯å·ä¸ºEWOULDBLOCK,è¡¨ç¤ºè¯¥æ“ä½œæœ¬æ¥åº”è¯¥é˜»å¡çš„ï¼Œä½†æ˜¯ç”±äºæœ¬socketä¸ºéé˜»å¡çš„socketï¼Œå› æ­¤ç«‹åˆ»è¿”å›ï¼Œé‡åˆ°è¿™æ ·çš„æƒ…å†µï¼Œå¯ä»¥åœ¨ä¸‹æ¬¡æ¥ç€å»å°è¯•è¯»å–ã€‚å¦‚æœè¿”å›å€¼æ˜¯å…¶å®ƒè´Ÿå€¼ï¼Œåˆ™è¡¨æ˜è¯»å–é”™è¯¯ã€‚</p>
<p>å› æ­¤ï¼Œéé˜»å¡çš„reaè°ƒç”¨ä¸€èˆ¬è¿™æ ·å†™:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((nread = read(sock_fd, buffer, len)) &lt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"> <span class="keyword">if</span> (errno == EWOULDBLOCK)</span><br><span class="line">  &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">//è¡¨ç¤ºæ²¡æœ‰è¯»åˆ°æ•°æ®</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> </span><br><span class="line">   <span class="keyword">return</span> <span class="number">-1</span>; <span class="comment">//è¡¨ç¤ºè¯»å–å¤±è´¥</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">   <span class="keyword">return</span> nread;è¯»åˆ°æ•°æ®é•¿åº¦</span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<h1 id="å†™æ“ä½œ"><a href="#å†™æ“ä½œ" class="headerlink" title="å†™æ“ä½œ"></a>å†™æ“ä½œ</h1><p>å¯¹äºå†™æ“ä½œwrite,åŸç†æ˜¯ç±»ä¼¼çš„ï¼Œéé˜»å¡socketåœ¨å‘é€ç¼“å†²åŒºæ²¡æœ‰ç©ºé—´æ—¶ä¼šç›´æ¥è¿”å›é”™è¯¯å·EWOULDBLOCK,è¡¨ç¤ºæ²¡æœ‰ç©ºé—´å¯å†™æ•°æ®ï¼Œå¦‚æœé”™è¯¯å·æ˜¯åˆ«çš„å€¼ï¼Œåˆ™è¡¨æ˜å‘é€å¤±è´¥ã€‚å¦‚æœå‘é€ç¼“å†²åŒºä¸­æœ‰è¶³å¤Ÿç©ºé—´æˆ–è€…æ˜¯ä¸è¶³ä»¥æ‹·è´æ‰€æœ‰å¾…å‘é€æ•°æ®çš„ç©ºé—´çš„è¯ï¼Œåˆ™æ‹·è´å‰é¢Nä¸ªèƒ½å¤Ÿå®¹çº³çš„æ•°æ®ï¼Œè¿”å›å®é™…æ‹·è´çš„å­—èŠ‚æ•°ã€‚</p>
<p>è€Œå¯¹äºé˜»å¡Socketè€Œè¨€ï¼Œå¦‚æœå‘é€ç¼“å†²åŒºæ²¡æœ‰ç©ºé—´æˆ–è€…ç©ºé—´ä¸è¶³çš„è¯ï¼Œwriteæ“ä½œä¼šç›´æ¥é˜»å¡ä½ï¼Œå¦‚æœæœ‰è¶³å¤Ÿç©ºé—´ï¼Œåˆ™æ‹·è´æ‰€æœ‰æ•°æ®åˆ°å‘é€ç¼“å†²åŒºï¼Œç„¶åè¿”å›.</p>
<p>éé˜»å¡çš„writeæ“ä½œä¸€èˆ¬å†™æ³•æ˜¯:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> write_pos = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> nLeft = nLen;</span><br><span class="line"><span class="keyword">while</span> (nLeft &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"> <span class="keyword">int</span> nWrite = <span class="number">0</span>;</span><br><span class="line"> <span class="keyword">if</span> ((nWrite = write(sock_fd, data + write_pos, nLeft)) &lt;= <span class="number">0</span>)</span><br><span class="line"> &#123;</span><br><span class="line">  <span class="keyword">if</span> (errno == EWOULDBLOCK)</span><br><span class="line">  &#123;</span><br><span class="line">    nWrite = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> </span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>; <span class="comment">//è¡¨ç¤ºå†™å¤±è´¥</span></span><br><span class="line"> &#125;</span><br><span class="line"> nLeft -= nWrite;</span><br><span class="line"> write_pos += nWrite;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> nLen;</span><br></pre></td></tr></table></figure></p>
<h1 id="å»ºç«‹è¿æ¥"><a href="#å»ºç«‹è¿æ¥" class="headerlink" title="å»ºç«‹è¿æ¥"></a>å»ºç«‹è¿æ¥</h1><p>é˜»å¡æ–¹å¼ä¸‹ï¼Œconnecté¦–å…ˆå‘é€SYNè¯·æ±‚é“æœåŠ¡å™¨ï¼Œå½“å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„SYNçš„ç¡®è®¤æ—¶ï¼Œåˆ™connectè¿”å›.å¦åˆ™çš„è¯ä¸€ç›´é˜»å¡.</p>
<p>éé˜»å¡æ–¹å¼ï¼Œconnectå°†å¯ç”¨TCPåè®®çš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œä½†æ˜¯connectå‡½æ•°å¹¶ä¸ç­‰å¾…è¿æ¥å»ºç«‹å¥½æ‰è¿”å›ï¼Œè€Œæ˜¯ç«‹å³è¿”å›ã€‚è¿”å›çš„é”™è¯¯ç ä¸ºEINPROGRESS,è¡¨ç¤ºæ­£åœ¨è¿›è¡ŒæŸç§è¿‡ç¨‹.</p>
<h1 id="æ¥æ”¶è¿æ¥"><a href="#æ¥æ”¶è¿æ¥" class="headerlink" title="æ¥æ”¶è¿æ¥"></a>æ¥æ”¶è¿æ¥</h1><p>å¯¹äºé˜»å¡æ–¹å¼çš„å€¾å¬socket,acceptåœ¨è¿æ¥é˜Ÿåˆ—ä¸­æ²¡æœ‰å»ºç«‹å¥½çš„è¿æ¥æ—¶å°†é˜»å¡ï¼Œç›´åˆ°æœ‰å¯ç”¨çš„è¿æ¥ï¼Œæ‰è¿”å›ã€‚</p>
<p>éé˜»å¡å€¾å¬socket,åœ¨æœ‰æ²¡æœ‰è¿æ¥æ—¶éƒ½ç«‹å³è¿”å›ï¼Œæ²¡æœ‰è¿æ¥æ—¶ï¼Œè¿”å›çš„é”™è¯¯ç ä¸ºEWOULDBLOCK,è¡¨ç¤ºæœ¬æ¥åº”è¯¥é˜»å¡ã€‚</p>
<h1 id="æ— é˜»å¡çš„è®¾ç½®æ–¹æ³•"><a href="#æ— é˜»å¡çš„è®¾ç½®æ–¹æ³•" class="headerlink" title="æ— é˜»å¡çš„è®¾ç½®æ–¹æ³•"></a>æ— é˜»å¡çš„è®¾ç½®æ–¹æ³•</h1><p>æ–¹æ³•ä¸€:fcntl<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> flag;</span><br><span class="line"><span class="keyword">if</span> (flag = fcntl(fd, F_GETFL, <span class="number">0</span>) &lt;<span class="number">0</span>) perror(<span class="string">"get flag"</span>);</span><br><span class="line">flag |= O_NONBLOCK;</span><br><span class="line"><span class="keyword">if</span> (fcntl(fd, F_SETFL, flag) &lt; <span class="number">0</span>)</span><br><span class="line">perror(<span class="string">"set flag"</span>);</span><br></pre></td></tr></table></figure></p>
<p>æ–¹æ³•äºŒ:ioctl<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int b_on = 1;</span><br><span class="line">ioctl (fd, FIONBIO, &amp;b_on);</span><br></pre></td></tr></table></figure></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>éé˜»å¡socketå¯ä»¥é€šè¿‡ä¸æ–­è½®è¯¢æ¥å®ç°ç±»ä¼¼ioå¤ç”¨çš„æ•ˆæœï¼Œä½†æ˜¯ä¸å»ºè®®ï¼Œå› ä¸ºä¼šé€ æˆcpuçš„ç©ºè½¬ï¼ˆå¦‚æœä¸€ç›´æ²¡æ•°æ®è¯»å†™çš„è¯ï¼‰ã€‚æ„Ÿè§‰è·Ÿjavaçš„nioä¸Šè®¾ç½®channelä¸ºéé˜»å¡æœ‰ç‚¹å…³ç³»å§ğŸ‘¿</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;åœ¨ä¸Šä¸€ç¯‡æ–‡ç« æœ‰æåˆ°éé˜»å¡socketï¼Œæ‰€ä»¥è¿™ç¯‡æ–‡ç« å°±çœ‹çœ‹è¿™ä¸ªæ˜¯ä»€ä¹ˆä¸œä¸œğŸ‘¿&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;è¯»æ“ä½œ&quot;&gt;&lt;a href=&quot;#è¯»æ“ä½œ&quot; class=&quot;headerlink&quot; title=&quot;è¯»æ“ä½œ&quot;&gt;&lt;/a&gt;è¯»æ“ä½œ&lt;/h1&gt;&lt;p&gt;å¯¹äºé˜»å¡çš„socket,å½“socketçš„æ¥æ”¶ç¼“å†²åŒºä¸­æ²¡æœ‰æ•°æ®æ—¶ï¼Œreadè°ƒç”¨ä¼šä¸€ç›´é˜»å¡ä½ï¼Œç›´åˆ°æœ‰æ•°æ®åˆ°æ¥æ‰è¿”å›ã€‚å½“socketç¼“å†²åŒºä¸­çš„æ•°æ®é‡å°äºæœŸæœ›è¯»å–çš„æ•°æ®é‡æ—¶ï¼Œè¿”å›å®é™…è¯»å–çš„å­—èŠ‚æ•°ã€‚å½“socktçš„æ¥æ”¶ç¼“å†²åŒºä¸­çš„æ•°æ®å¤§äºæœŸæœ›è¯»å–çš„å­—èŠ‚æ•°æ—¶ï¼Œè¯»å–æœŸæœ›è¯»å–çš„å­—èŠ‚æ•°ï¼Œè¿”å›å®é™…è¯»å–çš„é•¿åº¦ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºéé˜»å¡socketè€Œè¨€ï¼Œsocketçš„æ¥æ”¶ç¼“å†²åŒºä¸­æœ‰æ²¡æœ‰æ•°æ®ï¼Œreadè°ƒç”¨éƒ½ä¼šç«‹åˆ»è¿”å›ã€‚æ¥æ”¶ç¼“å†²åŒºä¸­æœ‰æ•°æ®æ—¶ï¼Œä¸é˜»å¡socketæœ‰æ•°æ®çš„æƒ…å†µæ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœæ¥æ”¶ç¼“å†²åŒºä¸­æ²¡æœ‰æ•°æ®ï¼Œåˆ™è¿”å›é”™è¯¯å·ä¸ºEWOULDBLOCK,è¡¨ç¤ºè¯¥æ“ä½œæœ¬æ¥åº”è¯¥é˜»å¡çš„ï¼Œä½†æ˜¯ç”±äºæœ¬socketä¸ºéé˜»å¡çš„socketï¼Œå› æ­¤ç«‹åˆ»è¿”å›ï¼Œé‡åˆ°è¿™æ ·çš„æƒ…å†µï¼Œå¯ä»¥åœ¨ä¸‹æ¬¡æ¥ç€å»å°è¯•è¯»å–ã€‚å¦‚æœè¿”å›å€¼æ˜¯å…¶å®ƒè´Ÿå€¼ï¼Œåˆ™è¡¨æ˜è¯»å–é”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œéé˜»å¡çš„reaè°ƒç”¨ä¸€èˆ¬è¿™æ ·å†™:&lt;br&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ((nread = read(sock_fd, buffer, len)) &amp;lt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (errno == EWOULDBLOCK)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; &lt;span class=&quot;comment&quot;&gt;//è¡¨ç¤ºæ²¡æœ‰è¯»åˆ°æ•°æ®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;; &lt;span class=&quot;comment&quot;&gt;//è¡¨ç¤ºè¯»å–å¤±è´¥&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; nread;è¯»åˆ°æ•°æ®é•¿åº¦&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="linux" scheme="http://idiotsky.top/categories/linux/"/>
    
    
      <category term="linux" scheme="http://idiotsky.top/tags/linux/"/>
    
      <category term="nio" scheme="http://idiotsky.top/tags/nio/"/>
    
      <category term="éé˜»å¡socket" scheme="http://idiotsky.top/tags/%E9%9D%9E%E9%98%BB%E5%A1%9Esocket/"/>
    
      <category term="é˜»å¡socket" scheme="http://idiotsky.top/tags/%E9%98%BB%E5%A1%9Esocket/"/>
    
  </entry>
  
  <entry>
    <title>linux epollé€šä¿—ç†è§£</title>
    <link href="http://idiotsky.top/2018/03/12/epoll-easy-understanding/"/>
    <id>http://idiotsky.top/2018/03/12/epoll-easy-understanding/</id>
    <published>2018-03-12T14:39:46.000Z</published>
    <updated>2018-03-12T15:43:50.651Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>ä¸€ä¸ªepollé€šä¿—ç®€å•ç†è§£çš„æ–‡ç« ï¼ŒmarkğŸ‘¿</p>
</blockquote>
<p>é¦–å…ˆæˆ‘ä»¬æ¥å®šä¹‰æµçš„æ¦‚å¿µï¼Œä¸€ä¸ªæµå¯ä»¥æ˜¯æ–‡ä»¶ï¼Œsocketï¼Œpipeç­‰ç­‰å¯ä»¥è¿›è¡ŒI/Oæ“ä½œçš„å†…æ ¸å¯¹è±¡ã€‚<br>ä¸ç®¡æ˜¯æ–‡ä»¶ï¼Œè¿˜æ˜¯å¥—æ¥å­—ï¼Œè¿˜æ˜¯ç®¡é“ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æŠŠä»–ä»¬çœ‹ä½œæµã€‚<br>ä¹‹åæˆ‘ä»¬æ¥è®¨è®ºI/Oçš„æ“ä½œï¼Œé€šè¿‡readï¼Œæˆ‘ä»¬å¯ä»¥ä»æµä¸­è¯»å…¥æ•°æ®ï¼›é€šè¿‡writeï¼Œæˆ‘ä»¬å¯ä»¥å¾€æµå†™å…¥æ•°æ®ã€‚ç°åœ¨å‡å®šä¸€ä¸ªæƒ…å½¢ï¼Œæˆ‘ä»¬éœ€è¦ä»æµä¸­è¯»æ•°æ®ï¼Œä½†æ˜¯æµä¸­è¿˜æ²¡æœ‰æ•°æ®ï¼Œï¼ˆå…¸å‹çš„ä¾‹å­ä¸ºï¼Œå®¢æˆ·ç«¯è¦ä»socketè¯»å¦‚æ•°æ®ï¼Œä½†æ˜¯æœåŠ¡å™¨è¿˜æ²¡æœ‰æŠŠæ•°æ®ä¼ å›æ¥ï¼‰ï¼Œè¿™æ—¶å€™è¯¥æ€ä¹ˆåŠï¼Ÿ</p>
<ul>
<li>é˜»å¡ã€‚é˜»å¡æ˜¯ä¸ªä»€ä¹ˆæ¦‚å¿µå‘¢ï¼Ÿæ¯”å¦‚æŸä¸ªæ—¶å€™ä½ åœ¨ç­‰å¿«é€’ï¼Œä½†æ˜¯ä½ ä¸çŸ¥é“å¿«é€’ä»€ä¹ˆæ—¶å€™è¿‡æ¥ï¼Œè€Œä¸”ä½ æ²¡æœ‰åˆ«çš„äº‹å¯ä»¥å¹²ï¼ˆæˆ–è€…è¯´æ¥ä¸‹æ¥çš„äº‹è¦ç­‰å¿«é€’æ¥äº†æ‰èƒ½åšï¼‰ï¼›é‚£ä¹ˆä½ å¯ä»¥å»ç¡è§‰äº†ï¼Œå› ä¸ºä½ çŸ¥é“å¿«é€’æŠŠè´§é€æ¥æ—¶ä¸€å®šä¼šç»™ä½ æ‰“ä¸ªç”µè¯ï¼ˆå‡å®šä¸€å®šèƒ½å«é†’ä½ ï¼‰ã€‚</li>
<li>éé˜»å¡å¿™è½®è¯¢ã€‚æ¥ç€ä¸Šé¢ç­‰å¿«é€’çš„ä¾‹å­ï¼Œå¦‚æœç”¨å¿™è½®è¯¢çš„æ–¹æ³•ï¼Œé‚£ä¹ˆä½ éœ€è¦çŸ¥é“å¿«é€’å‘˜çš„æ‰‹æœºå·ï¼Œç„¶åæ¯åˆ†é’Ÿç»™ä»–æŒ‚ä¸ªç”µè¯ï¼šâ€œä½ åˆ°äº†æ²¡ï¼Ÿâ€</li>
</ul>
<a id="more"></a>
<p>å¾ˆæ˜æ˜¾ä¸€èˆ¬äººä¸ä¼šç”¨ç¬¬äºŒç§åšæ³•ï¼Œä¸ä»…æ˜¾å¾ˆæ— è„‘ï¼Œæµªè´¹è¯è´¹ä¸è¯´ï¼Œè¿˜å ç”¨äº†å¿«é€’å‘˜å¤§é‡çš„æ—¶é—´ã€‚<br>å¤§éƒ¨åˆ†ç¨‹åºä¹Ÿä¸ä¼šç”¨ç¬¬äºŒç§åšæ³•ï¼Œå› ä¸ºç¬¬ä¸€ç§æ–¹æ³•ç»æµè€Œç®€å•ï¼Œç»æµæ˜¯æŒ‡æ¶ˆè€—å¾ˆå°‘çš„CPUæ—¶é—´ï¼Œå¦‚æœçº¿ç¨‹ç¡çœ äº†ï¼Œå°±æ‰å‡ºäº†ç³»ç»Ÿçš„è°ƒåº¦é˜Ÿåˆ—ï¼Œæš‚æ—¶ä¸ä¼šå»ç“œåˆ†CPUå®è´µçš„æ—¶é—´ç‰‡äº†ã€‚</p>
<p>ä¸ºäº†äº†è§£é˜»å¡æ˜¯å¦‚ä½•è¿›è¡Œçš„ï¼Œæˆ‘ä»¬æ¥è®¨è®ºç¼“å†²åŒºï¼Œä»¥åŠå†…æ ¸ç¼“å†²åŒºï¼Œæœ€ç»ˆæŠŠI/Oäº‹ä»¶è§£é‡Šæ¸…æ¥šã€‚ç¼“å†²åŒºçš„å¼•å…¥æ˜¯ä¸ºäº†å‡å°‘é¢‘ç¹I/Oæ“ä½œè€Œå¼•èµ·é¢‘ç¹çš„ç³»ç»Ÿè°ƒç”¨ï¼ˆä½ çŸ¥é“å®ƒå¾ˆæ…¢çš„ï¼‰ï¼Œå½“ä½ æ“ä½œä¸€ä¸ªæµæ—¶ï¼Œæ›´å¤šçš„æ˜¯ä»¥ç¼“å†²åŒºä¸ºå•ä½è¿›è¡Œæ“ä½œï¼Œè¿™æ˜¯ç›¸å¯¹äºç”¨æˆ·ç©ºé—´è€Œè¨€ã€‚å¯¹äºå†…æ ¸æ¥è¯´ï¼Œä¹Ÿéœ€è¦ç¼“å†²åŒºã€‚<br>å‡è®¾æœ‰ä¸€ä¸ªç®¡é“ï¼Œè¿›ç¨‹Aä¸ºç®¡é“çš„å†™å…¥æ–¹ï¼Œï¼¢ä¸ºç®¡é“çš„è¯»å‡ºæ–¹ã€‚</p>
<ol>
<li>å‡è®¾ä¸€å¼€å§‹å†…æ ¸ç¼“å†²åŒºæ˜¯ç©ºçš„ï¼ŒBä½œä¸ºè¯»å‡ºæ–¹ï¼Œè¢«é˜»å¡ç€ã€‚ç„¶åé¦–å…ˆAå¾€ç®¡é“å†™å…¥ï¼Œè¿™æ—¶å€™å†…æ ¸ç¼“å†²åŒºç”±ç©ºçš„çŠ¶æ€å˜åˆ°éç©ºçŠ¶æ€ï¼Œå†…æ ¸å°±ä¼šäº§ç”Ÿä¸€ä¸ªäº‹ä»¶å‘Šè¯‰ï¼¢è¯¥é†’æ¥äº†ï¼Œè¿™ä¸ªäº‹ä»¶å§‘ä¸”ç§°ä¹‹ä¸ºâ€œç¼“å†²åŒºéç©ºâ€ã€‚</li>
<li>ä½†æ˜¯â€œç¼“å†²åŒºéç©ºâ€äº‹ä»¶é€šçŸ¥Båï¼ŒBå´è¿˜æ²¡æœ‰è¯»å‡ºæ•°æ®ï¼›ä¸”å†…æ ¸è®¸è¯ºäº†ä¸èƒ½æŠŠå†™å…¥ç®¡é“ä¸­çš„æ•°æ®ä¸¢æ‰è¿™ä¸ªæ—¶å€™ï¼Œï¼¡å†™å…¥çš„æ•°æ®ä¼šæ»ç•™åœ¨å†…æ ¸ç¼“å†²åŒºä¸­ï¼Œå¦‚æœå†…æ ¸ä¹Ÿç¼“å†²åŒºæ»¡äº†ï¼ŒBä»æœªå¼€å§‹è¯»æ•°æ®ï¼Œæœ€ç»ˆå†…æ ¸ç¼“å†²åŒºä¼šè¢«å¡«æ»¡ï¼Œè¿™ä¸ªæ—¶å€™ä¼šäº§ç”Ÿä¸€ä¸ªI/Oäº‹ä»¶ï¼Œå‘Šè¯‰è¿›ç¨‹Aï¼Œä½ è¯¥ç­‰ç­‰ï¼ˆé˜»å¡ï¼‰äº†ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªäº‹ä»¶å®šä¹‰ä¸ºâ€œç¼“å†²åŒºæ»¡â€ã€‚</li>
<li>å‡è®¾åæ¥ï¼¢ç»ˆäºå¼€å§‹è¯»æ•°æ®äº†ï¼Œäºæ˜¯å†…æ ¸çš„ç¼“å†²åŒºç©ºäº†å‡ºæ¥ï¼Œè¿™æ—¶å€™å†…æ ¸ä¼šå‘Šè¯‰Aï¼Œå†…æ ¸ç¼“å†²åŒºæœ‰ç©ºä½äº†ï¼Œä½ å¯ä»¥ä»é•¿çœ ä¸­é†’æ¥äº†ï¼Œç»§ç»­å†™æ•°æ®äº†ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªäº‹ä»¶å«åšâ€œç¼“å†²åŒºéæ»¡â€</li>
<li>ä¹Ÿè®¸åƒ3é‚£æ ·å·²ç»é€šçŸ¥äº†Aï¼Œä½†æ˜¯Aä¹Ÿæ²¡æœ‰æ•°æ®å†™å…¥äº†ï¼Œè€Œï¼¢ç»§ç»­è¯»å‡ºæ•°æ®ï¼Œç›´åˆ°å†…æ ¸ç¼“å†²åŒºç©ºäº†ã€‚è¿™ä¸ªæ—¶å€™å†…æ ¸å°±å‘Šè¯‰Bï¼Œä½ éœ€è¦é˜»å¡äº†ï¼ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ—¶é—´å®šä¸ºâ€œç¼“å†²åŒºç©ºâ€ã€‚</li>
</ol>
<p>è¿™å››ä¸ªæƒ…å½¢æ¶µç›–äº†å››ä¸ªI/Oäº‹ä»¶ï¼Œç¼“å†²åŒºæ»¡ï¼Œç¼“å†²åŒºç©ºï¼Œç¼“å†²åŒºéç©ºï¼Œç¼“å†²åŒºéæ»¡ï¼ˆæ³¨éƒ½æ˜¯è¯´çš„å†…æ ¸ç¼“å†²åŒºï¼Œä¸”è¿™å››ä¸ªæœ¯è¯­éƒ½æ˜¯æˆ‘ç”Ÿé€ çš„ï¼Œä»…ä¸ºè§£é‡Šå…¶åŸç†è€Œé€ ï¼‰ã€‚è¿™å››ä¸ªI/Oäº‹ä»¶æ˜¯è¿›è¡Œé˜»å¡åŒæ­¥çš„æ ¹æœ¬ã€‚ï¼ˆå¦‚æœä¸èƒ½ç†è§£â€œåŒæ­¥â€æ˜¯ä»€ä¹ˆæ¦‚å¿µï¼Œè¯·å­¦ä¹ æ“ä½œç³»ç»Ÿçš„é”ï¼Œä¿¡å·é‡ï¼Œæ¡ä»¶å˜é‡ç­‰ä»»åŠ¡åŒæ­¥æ–¹é¢çš„ç›¸å…³çŸ¥è¯†ï¼‰ã€‚</p>
<p>ç„¶åæˆ‘ä»¬æ¥è¯´è¯´é˜»å¡I/Oçš„ç¼ºç‚¹ã€‚ä½†æ˜¯é˜»å¡I/Oæ¨¡å¼ä¸‹ï¼Œä¸€ä¸ªçº¿ç¨‹åªèƒ½å¤„ç†ä¸€ä¸ªæµçš„I/Oäº‹ä»¶ã€‚å¦‚æœæƒ³è¦åŒæ—¶å¤„ç†å¤šä¸ªæµï¼Œè¦ä¹ˆå¤šè¿›ç¨‹(fork)ï¼Œè¦ä¹ˆå¤šçº¿ç¨‹(pthread_create)ï¼Œå¾ˆä¸å¹¸è¿™ä¸¤ç§æ–¹æ³•æ•ˆç‡éƒ½ä¸é«˜ã€‚<br>äºæ˜¯å†æ¥è€ƒè™‘éé˜»å¡å¿™è½®è¯¢çš„I/Oæ–¹å¼ï¼Œæˆ‘ä»¬å‘ç°æˆ‘ä»¬å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªæµäº†ï¼ˆæŠŠä¸€ä¸ªæµä»é˜»å¡æ¨¡å¼åˆ‡æ¢åˆ°éé˜»å¡æ¨¡å¼å†æ­¤ä¸äºˆè®¨è®ºï¼‰ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">while true &#123;</span><br><span class="line">for i in stream[]; &#123;</span><br><span class="line">if i has data</span><br><span class="line">read until unavailable</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬åªè¦ä¸åœçš„æŠŠæ‰€æœ‰æµä»å¤´åˆ°å°¾é—®ä¸€éï¼Œåˆä»å¤´å¼€å§‹ã€‚è¿™æ ·å°±å¯ä»¥å¤„ç†å¤šä¸ªæµäº†ï¼Œä½†è¿™æ ·çš„åšæ³•æ˜¾ç„¶ä¸å¥½ï¼Œå› ä¸ºå¦‚æœæ‰€æœ‰çš„æµéƒ½æ²¡æœ‰æ•°æ®ï¼Œé‚£ä¹ˆåªä¼šç™½ç™½æµªè´¹CPUã€‚è¿™é‡Œè¦è¡¥å……ä¸€ç‚¹ï¼Œé˜»å¡æ¨¡å¼ä¸‹ï¼Œå†…æ ¸å¯¹äºI/Oäº‹ä»¶çš„å¤„ç†æ˜¯é˜»å¡æˆ–è€…å”¤é†’ï¼Œè€Œéé˜»å¡æ¨¡å¼ä¸‹åˆ™æŠŠI/Oäº‹ä»¶äº¤ç»™å…¶ä»–å¯¹è±¡ï¼ˆåæ–‡ä»‹ç»çš„selectä»¥åŠepollï¼‰å¤„ç†ç”šè‡³ç›´æ¥å¿½ç•¥ã€‚</p>
<p>ä¸ºäº†é¿å…CPUç©ºè½¬ï¼Œå¯ä»¥å¼•è¿›äº†ä¸€ä¸ªä»£ç†ï¼ˆä¸€å¼€å§‹æœ‰ä¸€ä½å«åšselectçš„ä»£ç†ï¼Œåæ¥åˆæœ‰ä¸€ä½å«åšpollçš„ä»£ç†ï¼Œä¸è¿‡ä¸¤è€…çš„æœ¬è´¨æ˜¯ä¸€æ ·çš„ï¼‰ã€‚è¿™ä¸ªä»£ç†æ¯”è¾ƒå‰å®³ï¼Œå¯ä»¥åŒæ—¶è§‚å¯Ÿè®¸å¤šæµçš„I/Oäº‹ä»¶ï¼Œåœ¨ç©ºé—²çš„æ—¶å€™ï¼Œä¼šæŠŠå½“å‰çº¿ç¨‹é˜»å¡æ‰ï¼Œå½“æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæµæœ‰I/Oäº‹ä»¶æ—¶ï¼Œå°±ä»é˜»å¡æ€ä¸­é†’æ¥ï¼Œäºæ˜¯æˆ‘ä»¬çš„ç¨‹åºå°±ä¼šè½®è¯¢ä¸€éæ‰€æœ‰çš„æµï¼ˆäºæ˜¯æˆ‘ä»¬å¯ä»¥æŠŠâ€œå¿™â€å­—å»æ‰äº†ï¼‰ã€‚ä»£ç é•¿è¿™æ ·:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">while true &#123;</span><br><span class="line">select(streams[])</span><br><span class="line">for i in streams[] &#123;</span><br><span class="line">if i has data</span><br><span class="line">read until unavailable</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>äºæ˜¯ï¼Œå¦‚æœæ²¡æœ‰I/Oäº‹ä»¶äº§ç”Ÿï¼Œæˆ‘ä»¬çš„ç¨‹åºå°±ä¼šé˜»å¡åœ¨selectå¤„ã€‚ä½†æ˜¯ä¾ç„¶æœ‰ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä»selecté‚£é‡Œä»…ä»…çŸ¥é“äº†ï¼Œæœ‰I/Oäº‹ä»¶å‘ç”Ÿäº†ï¼Œä½†å´å¹¶ä¸çŸ¥é“æ˜¯é‚£å‡ ä¸ªæµï¼ˆå¯èƒ½æœ‰ä¸€ä¸ªï¼Œå¤šä¸ªï¼Œç”šè‡³å…¨éƒ¨ï¼‰ï¼Œæˆ‘ä»¬åªèƒ½æ— å·®åˆ«è½®è¯¢æ‰€æœ‰æµï¼Œæ‰¾å‡ºèƒ½è¯»å‡ºæ•°æ®ï¼Œæˆ–è€…å†™å…¥æ•°æ®çš„æµï¼Œå¯¹ä»–ä»¬è¿›è¡Œæ“ä½œã€‚<br>ä½†æ˜¯ä½¿ç”¨selectï¼Œæˆ‘ä»¬æœ‰O(n)çš„æ— å·®åˆ«è½®è¯¢å¤æ‚åº¦ï¼ŒåŒæ—¶å¤„ç†çš„æµè¶Šå¤šï¼Œæ¯ä¸€æ¬¡æ— å·®åˆ«è½®è¯¢æ—¶é—´å°±è¶Šé•¿ã€‚å†æ¬¡</p>
<p><strong>è¯´äº†è¿™ä¹ˆå¤šï¼Œç»ˆäºèƒ½å¥½å¥½è§£é‡Šepolläº†</strong></p>
<p>epollå¯ä»¥ç†è§£ä¸ºevent pollï¼Œä¸åŒäºå¿™è½®è¯¢å’Œæ— å·®åˆ«è½®è¯¢ï¼Œepollä¹‹ä¼šæŠŠå“ªä¸ªæµå‘ç”Ÿäº†æ€æ ·çš„I/Oäº‹ä»¶é€šçŸ¥æˆ‘ä»¬ã€‚æ­¤æ—¶æˆ‘ä»¬å¯¹è¿™äº›æµçš„æ“ä½œéƒ½æ˜¯æœ‰æ„ä¹‰çš„ã€‚ï¼ˆå¤æ‚åº¦é™ä½åˆ°äº†O(k)ï¼Œkä¸ºäº§ç”ŸI/Oäº‹ä»¶çš„æµçš„ä¸ªæ•°)<br>åœ¨è®¨è®ºepollçš„å®ç°ç»†èŠ‚ä¹‹å‰ï¼Œå…ˆæŠŠepollçš„ç›¸å…³æ“ä½œåˆ—å‡ºï¼š<br>epoll_create åˆ›å»ºä¸€ä¸ªepollå¯¹è±¡ï¼Œä¸€èˆ¬epollfd = epoll_create()<br>epoll_ctl ï¼ˆepoll_add/epoll_delçš„åˆä½“ï¼‰ï¼Œå¾€epollå¯¹è±¡ä¸­å¢åŠ /åˆ é™¤æŸä¸€ä¸ªæµçš„æŸä¸€ä¸ªäº‹ä»¶<br>æ¯”å¦‚<br>epoll_ctl(epollfd, EPOLL_CTL_ADD, socket, EPOLLIN);//æœ‰ç¼“å†²åŒºå†…æœ‰æ•°æ®æ—¶epoll_waitè¿”å›<br>epoll_ctl(epollfd, EPOLL_CTL_ADD, socket, EPOLLOUT);//ç¼“å†²åŒºå¯å†™å…¥æ—¶epoll_waitè¿”å›<br>epoll_wait(epollfd,â€¦)ç­‰å¾…ç›´åˆ°æ³¨å†Œçš„äº‹ä»¶å‘ç”Ÿ<br>ï¼ˆæ³¨ï¼šå½“å¯¹ä¸€ä¸ªéé˜»å¡æµçš„è¯»å†™å‘ç”Ÿç¼“å†²åŒºæ»¡æˆ–ç¼“å†²åŒºç©ºï¼Œwrite/readä¼šè¿”å›-1ï¼Œå¹¶è®¾ç½®errno=EAGAINã€‚è€Œepollåªå…³å¿ƒç¼“å†²åŒºéæ»¡å’Œç¼“å†²åŒºéç©ºäº‹ä»¶ï¼‰ã€‚<br>ä¸€ä¸ªepollæ¨¡å¼çš„ä»£ç å¤§æ¦‚çš„æ ·å­æ˜¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">while true &#123;</span><br><span class="line">active_stream[] = epoll_wait(epollfd)</span><br><span class="line">for i in active_stream[] &#123;</span><br><span class="line">read or write till unavailable</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é™äºç¯‡å¹…ï¼Œæˆ‘åªè¯´è¿™ä¹ˆå¤šï¼Œä»¥æ­ç¤ºåŸç†æ€§çš„ä¸œè¥¿ï¼Œè‡³äºepollçš„ä½¿ç”¨ç»†èŠ‚ï¼Œè¯·å‚è€ƒmanå’Œgoogleï¼Œå®ç°ç»†èŠ‚ï¼Œè¯·å‚é˜…linux kernel sourceã€‚</p>
<p>ref <a href="https://www.zhihu.com/question/20122137" target="_blank" rel="noopener">https://www.zhihu.com/question/20122137</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä¸€ä¸ªepollé€šä¿—ç®€å•ç†è§£çš„æ–‡ç« ï¼ŒmarkğŸ‘¿&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é¦–å…ˆæˆ‘ä»¬æ¥å®šä¹‰æµçš„æ¦‚å¿µï¼Œä¸€ä¸ªæµå¯ä»¥æ˜¯æ–‡ä»¶ï¼Œsocketï¼Œpipeç­‰ç­‰å¯ä»¥è¿›è¡ŒI/Oæ“ä½œçš„å†…æ ¸å¯¹è±¡ã€‚&lt;br&gt;ä¸ç®¡æ˜¯æ–‡ä»¶ï¼Œè¿˜æ˜¯å¥—æ¥å­—ï¼Œè¿˜æ˜¯ç®¡é“ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æŠŠä»–ä»¬çœ‹ä½œæµã€‚&lt;br&gt;ä¹‹åæˆ‘ä»¬æ¥è®¨è®ºI/Oçš„æ“ä½œï¼Œé€šè¿‡readï¼Œæˆ‘ä»¬å¯ä»¥ä»æµä¸­è¯»å…¥æ•°æ®ï¼›é€šè¿‡writeï¼Œæˆ‘ä»¬å¯ä»¥å¾€æµå†™å…¥æ•°æ®ã€‚ç°åœ¨å‡å®šä¸€ä¸ªæƒ…å½¢ï¼Œæˆ‘ä»¬éœ€è¦ä»æµä¸­è¯»æ•°æ®ï¼Œä½†æ˜¯æµä¸­è¿˜æ²¡æœ‰æ•°æ®ï¼Œï¼ˆå…¸å‹çš„ä¾‹å­ä¸ºï¼Œå®¢æˆ·ç«¯è¦ä»socketè¯»å¦‚æ•°æ®ï¼Œä½†æ˜¯æœåŠ¡å™¨è¿˜æ²¡æœ‰æŠŠæ•°æ®ä¼ å›æ¥ï¼‰ï¼Œè¿™æ—¶å€™è¯¥æ€ä¹ˆåŠï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é˜»å¡ã€‚é˜»å¡æ˜¯ä¸ªä»€ä¹ˆæ¦‚å¿µå‘¢ï¼Ÿæ¯”å¦‚æŸä¸ªæ—¶å€™ä½ åœ¨ç­‰å¿«é€’ï¼Œä½†æ˜¯ä½ ä¸çŸ¥é“å¿«é€’ä»€ä¹ˆæ—¶å€™è¿‡æ¥ï¼Œè€Œä¸”ä½ æ²¡æœ‰åˆ«çš„äº‹å¯ä»¥å¹²ï¼ˆæˆ–è€…è¯´æ¥ä¸‹æ¥çš„äº‹è¦ç­‰å¿«é€’æ¥äº†æ‰èƒ½åšï¼‰ï¼›é‚£ä¹ˆä½ å¯ä»¥å»ç¡è§‰äº†ï¼Œå› ä¸ºä½ çŸ¥é“å¿«é€’æŠŠè´§é€æ¥æ—¶ä¸€å®šä¼šç»™ä½ æ‰“ä¸ªç”µè¯ï¼ˆå‡å®šä¸€å®šèƒ½å«é†’ä½ ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;éé˜»å¡å¿™è½®è¯¢ã€‚æ¥ç€ä¸Šé¢ç­‰å¿«é€’çš„ä¾‹å­ï¼Œå¦‚æœç”¨å¿™è½®è¯¢çš„æ–¹æ³•ï¼Œé‚£ä¹ˆä½ éœ€è¦çŸ¥é“å¿«é€’å‘˜çš„æ‰‹æœºå·ï¼Œç„¶åæ¯åˆ†é’Ÿç»™ä»–æŒ‚ä¸ªç”µè¯ï¼šâ€œä½ åˆ°äº†æ²¡ï¼Ÿâ€&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="linux" scheme="http://idiotsky.top/categories/linux/"/>
    
    
      <category term="linux" scheme="http://idiotsky.top/tags/linux/"/>
    
      <category term="nio" scheme="http://idiotsky.top/tags/nio/"/>
    
      <category term="epoll" scheme="http://idiotsky.top/tags/epoll/"/>
    
      <category term="select" scheme="http://idiotsky.top/tags/select/"/>
    
  </entry>
  
  <entry>
    <title>MySQLç´¢å¼•èƒŒåçš„æ•°æ®ç»“æ„åŠç®—æ³•åŸç†</title>
    <link href="http://idiotsky.top/2018/03/04/b-tree/"/>
    <id>http://idiotsky.top/2018/03/04/b-tree/</id>
    <published>2018-03-04T14:23:29.000Z</published>
    <updated>2018-07-17T11:39:16.532Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>è½¬ä¸€ä¸ªä¸é”™çš„æ–‡ç« ï¼Œé‡Œé¢çš„å¹²è´§è¿˜æ˜¯å¾ˆå¤šçš„ï¼ŒåŒ…æ‹¬å±€éƒ¨æ€§ï¼Œç¡¬ç›˜ç­‰æ•°æ®åº“ä»¥å¤–çš„ä¸œè¥¿ï¼ŒMarkä¹‹ğŸ‘¿</p>
</blockquote>
<h1 id="æ•°æ®ç»“æ„åŠç®—æ³•åŸºç¡€"><a href="#æ•°æ®ç»“æ„åŠç®—æ³•åŸºç¡€" class="headerlink" title="æ•°æ®ç»“æ„åŠç®—æ³•åŸºç¡€"></a>æ•°æ®ç»“æ„åŠç®—æ³•åŸºç¡€</h1><h2 id="ç´¢å¼•çš„æœ¬è´¨"><a href="#ç´¢å¼•çš„æœ¬è´¨" class="headerlink" title="ç´¢å¼•çš„æœ¬è´¨"></a>ç´¢å¼•çš„æœ¬è´¨</h2><p>MySQLå®˜æ–¹å¯¹ç´¢å¼•çš„å®šä¹‰ä¸ºï¼šç´¢å¼•ï¼ˆIndexï¼‰æ˜¯å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ã€‚æå–å¥å­ä¸»å¹²ï¼Œå°±å¯ä»¥å¾—åˆ°ç´¢å¼•çš„æœ¬è´¨ï¼šç´¢å¼•æ˜¯æ•°æ®ç»“æ„ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œæ•°æ®åº“æŸ¥è¯¢æ˜¯æ•°æ®åº“çš„æœ€ä¸»è¦åŠŸèƒ½ä¹‹ä¸€ã€‚æˆ‘ä»¬éƒ½å¸Œæœ›æŸ¥è¯¢æ•°æ®çš„é€Ÿåº¦èƒ½å°½å¯èƒ½çš„å¿«ï¼Œå› æ­¤æ•°æ®åº“ç³»ç»Ÿçš„è®¾è®¡è€…ä¼šä»æŸ¥è¯¢ç®—æ³•çš„è§’åº¦è¿›è¡Œä¼˜åŒ–ã€‚æœ€åŸºæœ¬çš„æŸ¥è¯¢ç®—æ³•å½“ç„¶æ˜¯<a href="http://en.wikipedia.org/wiki/Linear_search" target="_blank" rel="noopener">é¡ºåºæŸ¥æ‰¾</a>ï¼ˆlinear searchï¼‰ï¼Œè¿™ç§å¤æ‚åº¦ä¸ºO(n)çš„ç®—æ³•åœ¨æ•°æ®é‡å¾ˆå¤§æ—¶æ˜¾ç„¶æ˜¯ç³Ÿç³•çš„ï¼Œå¥½åœ¨è®¡ç®—æœºç§‘å­¦çš„å‘å±•æä¾›äº†å¾ˆå¤šæ›´ä¼˜ç§€çš„æŸ¥æ‰¾ç®—æ³•ï¼Œä¾‹å¦‚<a href="http://en.wikipedia.org/wiki/Binary_search_algorithm" target="_blank" rel="noopener">äºŒåˆ†æŸ¥æ‰¾</a>ï¼ˆbinary searchï¼‰ã€<a href="http://en.wikipedia.org/wiki/Binary_search_tree" target="_blank" rel="noopener">äºŒå‰æ ‘æŸ¥æ‰¾æ ‘</a>ï¼ˆbinary tree searchï¼‰ç­‰ã€‚å¦‚æœç¨å¾®åˆ†æä¸€ä¸‹ä¼šå‘ç°ï¼Œæ¯ç§æŸ¥æ‰¾ç®—æ³•éƒ½åªèƒ½åº”ç”¨äºç‰¹å®šçš„æ•°æ®ç»“æ„ä¹‹ä¸Šï¼Œä¾‹å¦‚äºŒåˆ†æŸ¥æ‰¾è¦æ±‚è¢«æ£€ç´¢æ•°æ®æœ‰åºï¼Œè€ŒäºŒå‰æ ‘æŸ¥æ‰¾åªèƒ½åº”ç”¨äº<a href="http://en.wikipedia.org/wiki/Binary_search_tree" target="_blank" rel="noopener">äºŒå‰æŸ¥æ‰¾æ ‘</a>ä¸Šï¼Œä½†æ˜¯æ•°æ®æœ¬èº«çš„ç»„ç»‡ç»“æ„ä¸å¯èƒ½å®Œå…¨æ»¡è¶³å„ç§æ•°æ®ç»“æ„ï¼ˆä¾‹å¦‚ï¼Œç†è®ºä¸Šä¸å¯èƒ½åŒæ—¶å°†ä¸¤åˆ—éƒ½æŒ‰é¡ºåºè¿›è¡Œç»„ç»‡ï¼‰ï¼Œæ‰€ä»¥ï¼Œåœ¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤ç€æ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œè¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„ä¸Šå®ç°é«˜çº§æŸ¥æ‰¾ç®—æ³•ã€‚è¿™ç§æ•°æ®ç»“æ„ï¼Œå°±æ˜¯ç´¢å¼•ã€‚</p>
<p>çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<p><a href="http://idiotsky.top/images2/b-tree-1.png"><img src="http://idiotsky.top/images2/b-tree-1.png" alt=""></a></p>
<a id="more"></a>
<p>ä¸Šå›¾å±•ç¤ºäº†ä¸€ç§å¯èƒ½çš„ç´¢å¼•æ–¹å¼ã€‚å·¦è¾¹æ˜¯æ•°æ®è¡¨ï¼Œä¸€å…±æœ‰ä¸¤åˆ—ä¸ƒæ¡è®°å½•ï¼Œæœ€å·¦è¾¹çš„æ˜¯æ•°æ®è®°å½•çš„ç‰©ç†åœ°å€ï¼ˆæ³¨æ„é€»è¾‘ä¸Šç›¸é‚»çš„è®°å½•åœ¨ç£ç›˜ä¸Šä¹Ÿå¹¶ä¸æ˜¯ä¸€å®šç‰©ç†ç›¸é‚»çš„ï¼‰ã€‚ä¸ºäº†åŠ å¿«Col2çš„æŸ¥æ‰¾ï¼Œå¯ä»¥ç»´æŠ¤ä¸€ä¸ªå³è¾¹æ‰€ç¤ºçš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹åˆ†åˆ«åŒ…å«ç´¢å¼•é”®å€¼å’Œä¸€ä¸ªæŒ‡å‘å¯¹åº”æ•°æ®è®°å½•ç‰©ç†åœ°å€çš„æŒ‡é’ˆï¼Œè¿™æ ·å°±å¯ä»¥è¿ç”¨äºŒå‰æŸ¥æ‰¾åœ¨O(log2n)<br>çš„å¤æ‚åº¦å†…è·å–åˆ°ç›¸åº”æ•°æ®ã€‚</p>
<p>è™½ç„¶è¿™æ˜¯ä¸€ä¸ªè´§çœŸä»·å®çš„ç´¢å¼•ï¼Œä½†æ˜¯å®é™…çš„æ•°æ®åº“ç³»ç»Ÿå‡ ä¹æ²¡æœ‰ä½¿ç”¨äºŒå‰æŸ¥æ‰¾æ ‘æˆ–å…¶è¿›åŒ–å“ç§<a href="http://en.wikipedia.org/wiki/Red-black_tree" target="_blank" rel="noopener">çº¢é»‘æ ‘</a>ï¼ˆred-black treeï¼‰å®ç°çš„ï¼ŒåŸå› ä¼šåœ¨ä¸‹æ–‡ä»‹ç»ã€‚</p>
<h2 id="B-Treeå’ŒB-Tree"><a href="#B-Treeå’ŒB-Tree" class="headerlink" title="B-Treeå’ŒB+Tree"></a>B-Treeå’ŒB+Tree</h2><p>ç›®å‰å¤§éƒ¨åˆ†æ•°æ®åº“ç³»ç»ŸåŠæ–‡ä»¶ç³»ç»Ÿéƒ½é‡‡ç”¨B-Treeæˆ–å…¶å˜ç§B+Treeä½œä¸ºç´¢å¼•ç»“æ„ï¼Œåœ¨æœ¬æ–‡çš„ä¸‹ä¸€èŠ‚ä¼šç»“åˆå­˜å‚¨å™¨åŸç†åŠè®¡ç®—æœºå­˜å–åŸç†è®¨è®ºä¸ºä»€ä¹ˆB-Treeå’ŒB+Treeåœ¨è¢«å¦‚æ­¤å¹¿æ³›ç”¨äºç´¢å¼•ï¼Œè¿™ä¸€èŠ‚å…ˆå•çº¯ä»æ•°æ®ç»“æ„è§’åº¦æè¿°å®ƒä»¬ã€‚</p>
<h3 id="B-Tree"><a href="#B-Tree" class="headerlink" title="B-Tree"></a>B-Tree</h3><p>ä¸ºäº†æè¿°B-Treeï¼Œé¦–å…ˆå®šä¹‰ä¸€æ¡æ•°æ®è®°å½•ä¸ºä¸€ä¸ªäºŒå…ƒç»„[key, data]ï¼Œkeyä¸ºè®°å½•çš„é”®å€¼ï¼Œå¯¹äºä¸åŒæ•°æ®è®°å½•ï¼Œkeyæ˜¯äº’ä¸ç›¸åŒçš„ï¼›dataä¸ºæ•°æ®è®°å½•é™¤keyå¤–çš„æ•°æ®ã€‚é‚£ä¹ˆB-Treeæ˜¯æ»¡è¶³ä¸‹åˆ—æ¡ä»¶çš„æ•°æ®ç»“æ„ï¼š</p>
<p>dä¸ºå¤§äº1çš„ä¸€ä¸ªæ­£æ•´æ•°ï¼Œç§°ä¸ºB-Treeçš„åº¦ã€‚</p>
<p>hä¸ºä¸€ä¸ªæ­£æ•´æ•°ï¼Œç§°ä¸ºB-Treeçš„é«˜åº¦ã€‚</p>
<p>æ¯ä¸ªéå¶å­èŠ‚ç‚¹ç”±n-1ä¸ªkeyå’Œnä¸ªæŒ‡é’ˆç»„æˆï¼Œå…¶ä¸­d&lt;=n&lt;=2dã€‚</p>
<p>æ¯ä¸ªå¶å­èŠ‚ç‚¹æœ€å°‘åŒ…å«ä¸€ä¸ªkeyå’Œä¸¤ä¸ªæŒ‡é’ˆï¼Œæœ€å¤šåŒ…å«2d-1ä¸ªkeyå’Œ2dä¸ªæŒ‡é’ˆï¼Œå¶èŠ‚ç‚¹çš„æŒ‡é’ˆå‡ä¸ºnull ã€‚</p>
<p>æ‰€æœ‰å¶èŠ‚ç‚¹å…·æœ‰ç›¸åŒçš„æ·±åº¦ï¼Œç­‰äºæ ‘é«˜hã€‚</p>
<p>keyå’ŒæŒ‡é’ˆäº’ç›¸é—´éš”ï¼ŒèŠ‚ç‚¹ä¸¤ç«¯æ˜¯æŒ‡é’ˆã€‚</p>
<p>ä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„keyä»å·¦åˆ°å³éé€’å‡æ’åˆ—ã€‚</p>
<p>æ‰€æœ‰èŠ‚ç‚¹ç»„æˆæ ‘ç»“æ„ã€‚</p>
<p>æ¯ä¸ªæŒ‡é’ˆè¦ä¹ˆä¸ºnullï¼Œè¦ä¹ˆæŒ‡å‘å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p>
<p>å¦‚æœæŸä¸ªæŒ‡é’ˆåœ¨èŠ‚ç‚¹nodeæœ€å·¦è¾¹ä¸”ä¸ä¸ºnullï¼Œåˆ™å…¶æŒ‡å‘èŠ‚ç‚¹çš„æ‰€æœ‰keyå°äºkey[1]ï¼Œå…¶ä¸­key[1]ä¸ºnodeçš„ç¬¬ä¸€ä¸ªkeyçš„å€¼ã€‚</p>
<p>å¦‚æœæŸä¸ªæŒ‡é’ˆåœ¨èŠ‚ç‚¹nodeæœ€å³è¾¹ä¸”ä¸ä¸ºnullï¼Œåˆ™å…¶æŒ‡å‘èŠ‚ç‚¹çš„æ‰€æœ‰keyå¤§äºkey[m]ï¼Œå…¶ä¸­key[m]ä¸ºnodeçš„æœ€åä¸€ä¸ªkeyçš„å€¼ã€‚</p>
<p>å¦‚æœæŸä¸ªæŒ‡é’ˆåœ¨èŠ‚ç‚¹nodeçš„å·¦å³ç›¸é‚»keyåˆ†åˆ«æ˜¯key[i]å’Œkey[i+1]ä¸”ä¸ä¸ºnullï¼Œåˆ™å…¶æŒ‡å‘èŠ‚ç‚¹çš„æ‰€æœ‰keyå°äºkey[i+1]ä¸”å¤§äºkey[i].</p>
<p>ä¸‹å›¾æ˜¯ä¸€ä¸ªd=2çš„B-Treeç¤ºæ„å›¾ã€‚</p>
<p><a href="http://idiotsky.top/images2/b-tree-2.png"><img src="http://idiotsky.top/images2/b-tree-2.png" alt=""></a></p>
<p>ç”±äºB-Treeçš„ç‰¹æ€§ï¼Œåœ¨B-Treeä¸­æŒ‰keyæ£€ç´¢æ•°æ®çš„ç®—æ³•éå¸¸ç›´è§‚ï¼šé¦–å…ˆä»æ ¹èŠ‚ç‚¹è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°åˆ™è¿”å›å¯¹åº”èŠ‚ç‚¹çš„dataï¼Œå¦åˆ™å¯¹ç›¸åº”åŒºé—´çš„æŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹é€’å½’è¿›è¡ŒæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°èŠ‚ç‚¹æˆ–æ‰¾åˆ°nullæŒ‡é’ˆï¼Œå‰è€…æŸ¥æ‰¾æˆåŠŸï¼Œåè€…æŸ¥æ‰¾å¤±è´¥ã€‚B-Treeä¸ŠæŸ¥æ‰¾ç®—æ³•çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">BTree_Search(node, key) &#123;</span><br><span class="line">    <span class="keyword">if</span>(node == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    foreach(node.key)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(node.key[i] == key) <span class="keyword">return</span> node.data[i];</span><br><span class="line">            <span class="keyword">if</span>(node.key[i] &gt; key) <span class="keyword">return</span> BTree_Search(point[i]-&gt;node);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> BTree_Search(point[i+<span class="number">1</span>]-&gt;node);</span><br><span class="line">&#125;</span><br><span class="line">data = BTree_Search(root, my_key);</span><br></pre></td></tr></table></figure>
<p>å…³äºB-Treeæœ‰ä¸€ç³»åˆ—æœ‰è¶£çš„æ€§è´¨ï¼Œä¾‹å¦‚ä¸€ä¸ªåº¦ä¸ºdçš„B-Treeï¼Œè®¾å…¶ç´¢å¼•Nä¸ªkeyï¼Œåˆ™å…¶æ ‘é«˜hçš„ä¸Šé™ä¸ºlogd((N+1)/2)ï¼Œæ£€ç´¢ä¸€ä¸ªkeyï¼Œå…¶æŸ¥æ‰¾èŠ‚ç‚¹ä¸ªæ•°çš„æ¸è¿›å¤æ‚åº¦ä¸ºO(logdN)ã€‚ä»è¿™ç‚¹å¯ä»¥çœ‹å‡ºï¼ŒB-Treeæ˜¯ä¸€ä¸ªéå¸¸æœ‰æ•ˆç‡çš„ç´¢å¼•æ•°æ®ç»“æ„ã€‚</p>
<p>å¦å¤–ï¼Œç”±äºæ’å…¥åˆ é™¤æ–°çš„æ•°æ®è®°å½•ä¼šç ´åB-Treeçš„æ€§è´¨ï¼Œå› æ­¤åœ¨æ’å…¥åˆ é™¤æ—¶ï¼Œéœ€è¦å¯¹æ ‘è¿›è¡Œä¸€ä¸ªåˆ†è£‚ã€åˆå¹¶ã€è½¬ç§»ç­‰æ“ä½œä»¥ä¿æŒB-Treeæ€§è´¨ï¼Œæœ¬æ–‡ä¸æ‰“ç®—å®Œæ•´è®¨è®ºB-Treeè¿™äº›å†…å®¹ï¼Œå› ä¸ºå·²ç»æœ‰è®¸å¤šèµ„æ–™è¯¦ç»†è¯´æ˜äº†B-Treeçš„æ•°å­¦æ€§è´¨åŠæ’å…¥åˆ é™¤ç®—æ³•ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥æ‰¾ç™¾åº¦è°·æ­Œç»´åŸºè¿›è¡Œé˜…è¯»ã€‚</p>
<h3 id="B-Tree-1"><a href="#B-Tree-1" class="headerlink" title="B+Tree"></a>B+Tree</h3><p>B-Treeæœ‰è®¸å¤šå˜ç§ï¼Œå…¶ä¸­æœ€å¸¸è§çš„æ˜¯B+Treeï¼Œä¾‹å¦‚MySQLå°±æ™®éä½¿ç”¨B+Treeå®ç°å…¶ç´¢å¼•ç»“æ„ã€‚</p>
<p>ä¸B-Treeç›¸æ¯”ï¼ŒB+Treeæœ‰ä»¥ä¸‹ä¸åŒç‚¹ï¼š</p>
<p>æ¯ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆä¸Šé™ä¸º2dè€Œä¸æ˜¯2d+1ã€‚</p>
<p>å†…èŠ‚ç‚¹ä¸å­˜å‚¨dataï¼Œåªå­˜å‚¨keyï¼›å¶å­èŠ‚ç‚¹ä¸å­˜å‚¨æŒ‡é’ˆã€‚</p>
<p>ä¸‹å›¾æ˜¯ä¸€ä¸ªç®€å•çš„B+Treeç¤ºæ„ã€‚</p>
<p><a href="http://idiotsky.top/images2/b-tree-3.png"><img src="http://idiotsky.top/images2/b-tree-3.png" alt=""></a></p>
<p>ç”±äºå¹¶ä¸æ˜¯æ‰€æœ‰èŠ‚ç‚¹éƒ½å…·æœ‰ç›¸åŒçš„åŸŸï¼Œå› æ­¤B+Treeä¸­å¶èŠ‚ç‚¹å’Œå†…èŠ‚ç‚¹ä¸€èˆ¬å¤§å°ä¸åŒã€‚è¿™ç‚¹ä¸B-Treeä¸åŒï¼Œè™½ç„¶B-Treeä¸­ä¸åŒèŠ‚ç‚¹å­˜æ”¾çš„keyå’ŒæŒ‡é’ˆå¯èƒ½æ•°é‡ä¸ä¸€è‡´ï¼Œä½†æ˜¯æ¯ä¸ªèŠ‚ç‚¹çš„åŸŸå’Œä¸Šé™æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥åœ¨å®ç°ä¸­B-Treeå¾€å¾€å¯¹æ¯ä¸ªèŠ‚ç‚¹ç”³è¯·åŒç­‰å¤§å°çš„ç©ºé—´ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼ŒB+Treeæ¯”B-Treeæ›´é€‚åˆå®ç°å¤–å­˜å‚¨ç´¢å¼•ç»“æ„ï¼Œå…·ä½“åŸå› ä¸å¤–å­˜å‚¨å™¨åŸç†åŠè®¡ç®—æœºå­˜å–åŸç†æœ‰å…³ï¼Œå°†åœ¨ä¸‹é¢è®¨è®ºã€‚</p>
<h3 id="å¸¦æœ‰é¡ºåºè®¿é—®æŒ‡é’ˆçš„B-Tree"><a href="#å¸¦æœ‰é¡ºåºè®¿é—®æŒ‡é’ˆçš„B-Tree" class="headerlink" title="å¸¦æœ‰é¡ºåºè®¿é—®æŒ‡é’ˆçš„B+Tree"></a>å¸¦æœ‰é¡ºåºè®¿é—®æŒ‡é’ˆçš„B+Tree</h3><p>ä¸€èˆ¬åœ¨æ•°æ®åº“ç³»ç»Ÿæˆ–æ–‡ä»¶ç³»ç»Ÿä¸­ä½¿ç”¨çš„B+Treeç»“æ„éƒ½åœ¨ç»å…¸B+Treeçš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¢åŠ äº†é¡ºåºè®¿é—®æŒ‡é’ˆã€‚</p>
<p><a href="http://idiotsky.top/images2/b-tree-4.png"><img src="http://idiotsky.top/images2/b-tree-4.png" alt=""></a></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨B+Treeçš„æ¯ä¸ªå¶å­èŠ‚ç‚¹å¢åŠ ä¸€ä¸ªæŒ‡å‘ç›¸é‚»å¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå°±å½¢æˆäº†å¸¦æœ‰é¡ºåºè®¿é—®æŒ‡é’ˆçš„B+Treeã€‚åšè¿™ä¸ªä¼˜åŒ–çš„ç›®çš„æ˜¯ä¸ºäº†æé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½ï¼Œä¾‹å¦‚å›¾4ä¸­å¦‚æœè¦æŸ¥è¯¢keyä¸ºä»18åˆ°49çš„æ‰€æœ‰æ•°æ®è®°å½•ï¼Œå½“æ‰¾åˆ°18åï¼Œåªéœ€é¡ºç€èŠ‚ç‚¹å’ŒæŒ‡é’ˆé¡ºåºéå†å°±å¯ä»¥ä¸€æ¬¡æ€§è®¿é—®åˆ°æ‰€æœ‰æ•°æ®èŠ‚ç‚¹ï¼Œæå¤§æåˆ°äº†åŒºé—´æŸ¥è¯¢æ•ˆç‡ã€‚</p>
<p>è¿™ä¸€èŠ‚å¯¹B-Treeå’ŒB+Treeè¿›è¡Œäº†ä¸€ä¸ªç®€å•çš„ä»‹ç»ï¼Œä¸‹ä¸€èŠ‚ç»“åˆå­˜å‚¨å™¨å­˜å–åŸç†ä»‹ç»ä¸ºä»€ä¹ˆç›®å‰B+Treeæ˜¯æ•°æ®åº“ç³»ç»Ÿå®ç°ç´¢å¼•çš„é¦–é€‰æ•°æ®ç»“æ„ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨B-Treeï¼ˆB-Treeï¼‰"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨B-Treeï¼ˆB-Treeï¼‰" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨B-Treeï¼ˆB+Treeï¼‰"></a>ä¸ºä»€ä¹ˆä½¿ç”¨B-Treeï¼ˆB+Treeï¼‰</h2><p>ä¸Šæ–‡è¯´è¿‡ï¼Œçº¢é»‘æ ‘ç­‰æ•°æ®ç»“æ„ä¹Ÿå¯ä»¥ç”¨æ¥å®ç°ç´¢å¼•ï¼Œä½†æ˜¯æ–‡ä»¶ç³»ç»ŸåŠæ•°æ®åº“ç³»ç»Ÿæ™®éé‡‡ç”¨B-/+Treeä½œä¸ºç´¢å¼•ç»“æ„ï¼Œè¿™ä¸€èŠ‚å°†ç»“åˆè®¡ç®—æœºç»„æˆåŸç†ç›¸å…³çŸ¥è¯†è®¨è®ºB-/+Treeä½œä¸ºç´¢å¼•çš„ç†è®ºåŸºç¡€ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œç´¢å¼•æœ¬èº«ä¹Ÿå¾ˆå¤§ï¼Œä¸å¯èƒ½å…¨éƒ¨å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤ç´¢å¼•å¾€å¾€ä»¥ç´¢å¼•æ–‡ä»¶çš„å½¢å¼å­˜å‚¨çš„ç£ç›˜ä¸Šã€‚è¿™æ ·çš„è¯ï¼Œç´¢å¼•æŸ¥æ‰¾è¿‡ç¨‹ä¸­å°±è¦äº§ç”Ÿç£ç›˜I/Oæ¶ˆè€—ï¼Œç›¸å¯¹äºå†…å­˜å­˜å–ï¼ŒI/Oå­˜å–çš„æ¶ˆè€—è¦é«˜å‡ ä¸ªæ•°é‡çº§ï¼Œæ‰€ä»¥è¯„ä»·ä¸€ä¸ªæ•°æ®ç»“æ„ä½œä¸ºç´¢å¼•çš„ä¼˜åŠ£æœ€é‡è¦çš„æŒ‡æ ‡å°±æ˜¯åœ¨æŸ¥æ‰¾è¿‡ç¨‹ä¸­ç£ç›˜I/Oæ“ä½œæ¬¡æ•°çš„æ¸è¿›å¤æ‚åº¦ã€‚æ¢å¥è¯è¯´ï¼Œç´¢å¼•çš„ç»“æ„ç»„ç»‡è¦å°½é‡å‡å°‘æŸ¥æ‰¾è¿‡ç¨‹ä¸­ç£ç›˜I/Oçš„å­˜å–æ¬¡æ•°ã€‚ä¸‹é¢å…ˆä»‹ç»å†…å­˜å’Œç£ç›˜å­˜å–åŸç†ï¼Œç„¶åå†ç»“åˆè¿™äº›åŸç†åˆ†æB-/+Treeä½œä¸ºç´¢å¼•çš„æ•ˆç‡ã€‚</p>
<h3 id="ä¸»å­˜å­˜å–åŸç†"><a href="#ä¸»å­˜å­˜å–åŸç†" class="headerlink" title="ä¸»å­˜å­˜å–åŸç†"></a>ä¸»å­˜å­˜å–åŸç†</h3><p>ç›®å‰è®¡ç®—æœºä½¿ç”¨çš„ä¸»å­˜åŸºæœ¬éƒ½æ˜¯éšæœºè¯»å†™å­˜å‚¨å™¨ï¼ˆRAMï¼‰ï¼Œç°ä»£RAMçš„ç»“æ„å’Œå­˜å–åŸç†æ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œæœ¬æ–‡æŠ›å´å…·ä½“å·®åˆ«ï¼ŒæŠ½è±¡å‡ºä¸€ä¸ªååˆ†ç®€å•çš„å­˜å–æ¨¡å‹æ¥è¯´æ˜RAMçš„å·¥ä½œåŸç†ã€‚</p>
<p><a href="http://idiotsky.top/images2/b-tree-5.png"><img src="http://idiotsky.top/images2/b-tree-5.png" alt=""></a></p>
<p>ä»æŠ½è±¡è§’åº¦çœ‹ï¼Œä¸»å­˜æ˜¯ä¸€ç³»åˆ—çš„å­˜å‚¨å•å…ƒç»„æˆçš„çŸ©é˜µï¼Œæ¯ä¸ªå­˜å‚¨å•å…ƒå­˜å‚¨å›ºå®šå¤§å°çš„æ•°æ®ã€‚æ¯ä¸ªå­˜å‚¨å•å…ƒæœ‰å”¯ä¸€çš„åœ°å€ï¼Œç°ä»£ä¸»å­˜çš„ç¼–å€è§„åˆ™æ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œå°†å…¶ç®€åŒ–æˆä¸€ä¸ªäºŒç»´åœ°å€ï¼šé€šè¿‡ä¸€ä¸ªè¡Œåœ°å€å’Œä¸€ä¸ªåˆ—åœ°å€å¯ä»¥å”¯ä¸€å®šä½åˆ°ä¸€ä¸ªå­˜å‚¨å•å…ƒã€‚ä¸Šå›¾å±•ç¤ºäº†ä¸€ä¸ª4 x 4çš„ä¸»å­˜æ¨¡å‹ã€‚</p>
<p>ä¸»å­˜çš„å­˜å–è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<p>å½“ç³»ç»Ÿéœ€è¦è¯»å–ä¸»å­˜æ—¶ï¼Œåˆ™å°†åœ°å€ä¿¡å·æ”¾åˆ°åœ°å€æ€»çº¿ä¸Šä¼ ç»™ä¸»å­˜ï¼Œä¸»å­˜è¯»åˆ°åœ°å€ä¿¡å·åï¼Œè§£æä¿¡å·å¹¶å®šä½åˆ°æŒ‡å®šå­˜å‚¨å•å…ƒï¼Œç„¶åå°†æ­¤å­˜å‚¨å•å…ƒæ•°æ®æ”¾åˆ°æ•°æ®æ€»çº¿ä¸Šï¼Œä¾›å…¶å®ƒéƒ¨ä»¶è¯»å–ã€‚</p>
<p>å†™ä¸»å­˜çš„è¿‡ç¨‹ç±»ä¼¼ï¼Œç³»ç»Ÿå°†è¦å†™å…¥å•å…ƒåœ°å€å’Œæ•°æ®åˆ†åˆ«æ”¾åœ¨åœ°å€æ€»çº¿å’Œæ•°æ®æ€»çº¿ä¸Šï¼Œä¸»å­˜è¯»å–ä¸¤ä¸ªæ€»çº¿çš„å†…å®¹ï¼Œåšç›¸åº”çš„å†™æ“ä½œã€‚</p>
<p>è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œä¸»å­˜å­˜å–çš„æ—¶é—´ä»…ä¸å­˜å–æ¬¡æ•°å‘ˆçº¿æ€§å…³ç³»ï¼Œå› ä¸ºä¸å­˜åœ¨æœºæ¢°æ“ä½œï¼Œä¸¤æ¬¡å­˜å–çš„æ•°æ®çš„â€œè·ç¦»â€ä¸ä¼šå¯¹æ—¶é—´æœ‰ä»»ä½•å½±å“ï¼Œä¾‹å¦‚ï¼Œå…ˆå–A0å†å–A1å’Œå…ˆå–A0å†å–D3çš„æ—¶é—´æ¶ˆè€—æ˜¯ä¸€æ ·çš„ã€‚</p>
<h3 id="ç£ç›˜å­˜å–åŸç†"><a href="#ç£ç›˜å­˜å–åŸç†" class="headerlink" title="ç£ç›˜å­˜å–åŸç†"></a>ç£ç›˜å­˜å–åŸç†</h3><p>ä¸Šæ–‡è¯´è¿‡ï¼Œç´¢å¼•ä¸€èˆ¬ä»¥æ–‡ä»¶å½¢å¼å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œç´¢å¼•æ£€ç´¢éœ€è¦ç£ç›˜I/Oæ“ä½œã€‚ä¸ä¸»å­˜ä¸åŒï¼Œç£ç›˜I/Oå­˜åœ¨æœºæ¢°è¿åŠ¨è€—è´¹ï¼Œå› æ­¤ç£ç›˜I/Oçš„æ—¶é—´æ¶ˆè€—æ˜¯å·¨å¤§çš„ã€‚</p>
<p>ä¸‹å›¾æ˜¯ç£ç›˜çš„æ•´ä½“ç»“æ„ç¤ºæ„å›¾ã€‚</p>
<p><a href="http://idiotsky.top/images2/b-tree-6.png"><img src="http://idiotsky.top/images2/b-tree-6.png" alt=""></a></p>
<p>ä¸€ä¸ªç£ç›˜ç”±å¤§å°ç›¸åŒä¸”åŒè½´çš„åœ†å½¢ç›˜ç‰‡ç»„æˆï¼Œç£ç›˜å¯ä»¥è½¬åŠ¨ï¼ˆå„ä¸ªç£ç›˜å¿…é¡»åŒæ­¥è½¬åŠ¨ï¼‰ã€‚åœ¨ç£ç›˜çš„ä¸€ä¾§æœ‰ç£å¤´æ”¯æ¶ï¼Œç£å¤´æ”¯æ¶å›ºå®šäº†ä¸€ç»„ç£å¤´ï¼Œæ¯ä¸ªç£å¤´è´Ÿè´£å­˜å–ä¸€ä¸ªç£ç›˜çš„å†…å®¹ã€‚ç£å¤´ä¸èƒ½è½¬åŠ¨ï¼Œä½†æ˜¯å¯ä»¥æ²¿ç£ç›˜åŠå¾„æ–¹å‘è¿åŠ¨ï¼ˆå®é™…æ˜¯æ–œåˆ‡å‘è¿åŠ¨ï¼‰ï¼Œæ¯ä¸ªç£å¤´åŒä¸€æ—¶åˆ»ä¹Ÿå¿…é¡»æ˜¯åŒè½´çš„ï¼Œå³ä»æ­£ä¸Šæ–¹å‘ä¸‹çœ‹ï¼Œæ‰€æœ‰ç£å¤´ä»»ä½•æ—¶å€™éƒ½æ˜¯é‡å çš„ï¼ˆä¸è¿‡ç›®å‰å·²ç»æœ‰å¤šç£å¤´ç‹¬ç«‹æŠ€æœ¯ï¼Œå¯ä¸å—æ­¤é™åˆ¶ï¼‰ã€‚</p>
<p>ä¸‹å›¾æ˜¯ç£ç›˜ç»“æ„çš„ç¤ºæ„å›¾ã€‚</p>
<p><a href="http://idiotsky.top/images2/b-tree-7.png"><img src="http://idiotsky.top/images2/b-tree-7.png" alt=""></a></p>
<p>ç›˜ç‰‡è¢«åˆ’åˆ†æˆä¸€ç³»åˆ—åŒå¿ƒç¯ï¼Œåœ†å¿ƒæ˜¯ç›˜ç‰‡ä¸­å¿ƒï¼Œæ¯ä¸ªåŒå¿ƒç¯å«åšä¸€ä¸ªç£é“ï¼Œæ‰€æœ‰åŠå¾„ç›¸åŒçš„ç£é“ç»„æˆä¸€ä¸ªæŸ±é¢ã€‚ç£é“è¢«æ²¿åŠå¾„çº¿åˆ’åˆ†æˆä¸€ä¸ªä¸ªå°çš„æ®µï¼Œæ¯ä¸ªæ®µå«åšä¸€ä¸ªæ‰‡åŒºï¼Œæ¯ä¸ªæ‰‡åŒºæ˜¯ç£ç›˜çš„æœ€å°å­˜å‚¨å•å…ƒã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä¸‹é¢å‡è®¾ç£ç›˜åªæœ‰ä¸€ä¸ªç›˜ç‰‡å’Œä¸€ä¸ªç£å¤´ã€‚</p>
<p>å½“éœ€è¦ä»ç£ç›˜è¯»å–æ•°æ®æ—¶ï¼Œç³»ç»Ÿä¼šå°†æ•°æ®é€»è¾‘åœ°å€ä¼ ç»™ç£ç›˜ï¼Œç£ç›˜çš„æ§åˆ¶ç”µè·¯æŒ‰ç…§å¯»å€é€»è¾‘å°†é€»è¾‘åœ°å€ç¿»è¯‘æˆç‰©ç†åœ°å€ï¼Œå³ç¡®å®šè¦è¯»çš„æ•°æ®åœ¨å“ªä¸ªç£é“ï¼Œå“ªä¸ªæ‰‡åŒºã€‚ä¸ºäº†è¯»å–è¿™ä¸ªæ‰‡åŒºçš„æ•°æ®ï¼Œéœ€è¦å°†ç£å¤´æ”¾åˆ°è¿™ä¸ªæ‰‡åŒºä¸Šæ–¹ï¼Œä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œç£å¤´éœ€è¦ç§»åŠ¨å¯¹å‡†ç›¸åº”ç£é“ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšå¯»é“ï¼Œæ‰€è€—è´¹æ—¶é—´å«åšå¯»é“æ—¶é—´ï¼Œç„¶åç£ç›˜æ—‹è½¬å°†ç›®æ ‡æ‰‡åŒºæ—‹è½¬åˆ°ç£å¤´ä¸‹ï¼Œè¿™ä¸ªè¿‡ç¨‹è€—è´¹çš„æ—¶é—´å«åšæ—‹è½¬æ—¶é—´ã€‚</p>
<h3 id="å±€éƒ¨æ€§åŸç†ä¸ç£ç›˜é¢„è¯»"><a href="#å±€éƒ¨æ€§åŸç†ä¸ç£ç›˜é¢„è¯»" class="headerlink" title="å±€éƒ¨æ€§åŸç†ä¸ç£ç›˜é¢„è¯»"></a>å±€éƒ¨æ€§åŸç†ä¸ç£ç›˜é¢„è¯»</h3><p>ç”±äºå­˜å‚¨ä»‹è´¨çš„ç‰¹æ€§ï¼Œç£ç›˜æœ¬èº«å­˜å–å°±æ¯”ä¸»å­˜æ…¢å¾ˆå¤šï¼Œå†åŠ ä¸Šæœºæ¢°è¿åŠ¨è€—è´¹ï¼Œç£ç›˜çš„å­˜å–é€Ÿåº¦å¾€å¾€æ˜¯ä¸»å­˜çš„å‡ ç™¾åˆ†åˆ†ä¹‹ä¸€ï¼Œå› æ­¤ä¸ºäº†æé«˜æ•ˆç‡ï¼Œè¦å°½é‡å‡å°‘ç£ç›˜I/Oã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œç£ç›˜å¾€å¾€ä¸æ˜¯ä¸¥æ ¼æŒ‰éœ€è¯»å–ï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½ä¼šé¢„è¯»ï¼Œå³ä½¿åªéœ€è¦ä¸€ä¸ªå­—èŠ‚ï¼Œç£ç›˜ä¹Ÿä¼šä»è¿™ä¸ªä½ç½®å¼€å§‹ï¼Œé¡ºåºå‘åè¯»å–ä¸€å®šé•¿åº¦çš„æ•°æ®æ”¾å…¥å†…å­˜ã€‚è¿™æ ·åšçš„ç†è®ºä¾æ®æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­è‘—åçš„å±€éƒ¨æ€§åŸç†ï¼š</p>
<p>å½“ä¸€ä¸ªæ•°æ®è¢«ç”¨åˆ°æ—¶ï¼Œå…¶é™„è¿‘çš„æ•°æ®ä¹Ÿé€šå¸¸ä¼šé©¬ä¸Šè¢«ä½¿ç”¨ã€‚</p>
<p>ç¨‹åºè¿è¡ŒæœŸé—´æ‰€éœ€è¦çš„æ•°æ®é€šå¸¸æ¯”è¾ƒé›†ä¸­ã€‚</p>
<p>ç”±äºç£ç›˜é¡ºåºè¯»å–çš„æ•ˆç‡å¾ˆé«˜ï¼ˆä¸éœ€è¦å¯»é“æ—¶é—´ï¼Œåªéœ€å¾ˆå°‘çš„æ—‹è½¬æ—¶é—´ï¼‰ï¼Œå› æ­¤å¯¹äºå…·æœ‰å±€éƒ¨æ€§çš„ç¨‹åºæ¥è¯´ï¼Œé¢„è¯»å¯ä»¥æé«˜I/Oæ•ˆç‡ã€‚</p>
<p>é¢„è¯»çš„é•¿åº¦ä¸€èˆ¬ä¸ºé¡µï¼ˆpageï¼‰çš„æ•´å€æ•°ã€‚é¡µæ˜¯è®¡ç®—æœºç®¡ç†å­˜å‚¨å™¨çš„é€»è¾‘å—ï¼Œç¡¬ä»¶åŠæ“ä½œç³»ç»Ÿå¾€å¾€å°†ä¸»å­˜å’Œç£ç›˜å­˜å‚¨åŒºåˆ†å‰²ä¸ºè¿ç»­çš„å¤§å°ç›¸ç­‰çš„å—ï¼Œæ¯ä¸ªå­˜å‚¨å—ç§°ä¸ºä¸€é¡µï¼ˆåœ¨è®¸å¤šæ“ä½œç³»ç»Ÿä¸­ï¼Œé¡µå¾—å¤§å°é€šå¸¸ä¸º4kï¼‰ï¼Œä¸»å­˜å’Œç£ç›˜ä»¥é¡µä¸ºå•ä½äº¤æ¢æ•°æ®ã€‚å½“ç¨‹åºè¦è¯»å–çš„æ•°æ®ä¸åœ¨ä¸»å­˜ä¸­æ—¶ï¼Œä¼šè§¦å‘ä¸€ä¸ªç¼ºé¡µå¼‚å¸¸ï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šå‘ç£ç›˜å‘å‡ºè¯»ç›˜ä¿¡å·ï¼Œç£ç›˜ä¼šæ‰¾åˆ°æ•°æ®çš„èµ·å§‹ä½ç½®å¹¶å‘åè¿ç»­è¯»å–ä¸€é¡µæˆ–å‡ é¡µè½½å…¥å†…å­˜ä¸­ï¼Œç„¶åå¼‚å¸¸è¿”å›ï¼Œç¨‹åºç»§ç»­è¿è¡Œã€‚</p>
<h3 id="B-Treeç´¢å¼•çš„æ€§èƒ½åˆ†æ"><a href="#B-Treeç´¢å¼•çš„æ€§èƒ½åˆ†æ" class="headerlink" title="B-/+Treeç´¢å¼•çš„æ€§èƒ½åˆ†æ"></a>B-/+Treeç´¢å¼•çš„æ€§èƒ½åˆ†æ</h3><p>åˆ°è¿™é‡Œç»ˆäºå¯ä»¥åˆ†æB-/+Treeç´¢å¼•çš„æ€§èƒ½äº†ã€‚</p>
<p>ä¸Šæ–‡è¯´è¿‡ä¸€èˆ¬ä½¿ç”¨ç£ç›˜I/Oæ¬¡æ•°è¯„ä»·ç´¢å¼•ç»“æ„çš„ä¼˜åŠ£ã€‚å…ˆä»B-Treeåˆ†æï¼Œæ ¹æ®B-Treeçš„å®šä¹‰ï¼Œå¯çŸ¥æ£€ç´¢ä¸€æ¬¡æœ€å¤šéœ€è¦è®¿é—®hä¸ªèŠ‚ç‚¹ã€‚æ•°æ®åº“ç³»ç»Ÿçš„è®¾è®¡è€…å·§å¦™åˆ©ç”¨äº†ç£ç›˜é¢„è¯»åŸç†ï¼Œå°†ä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°è®¾ä¸ºç­‰äºä¸€ä¸ªé¡µï¼Œè¿™æ ·æ¯ä¸ªèŠ‚ç‚¹åªéœ€è¦ä¸€æ¬¡I/Oå°±å¯ä»¥å®Œå…¨è½½å…¥ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œåœ¨å®é™…å®ç°B-Treeè¿˜éœ€è¦ä½¿ç”¨å¦‚ä¸‹æŠ€å·§ï¼š</p>
<p>æ¯æ¬¡æ–°å»ºèŠ‚ç‚¹æ—¶ï¼Œç›´æ¥ç”³è¯·ä¸€ä¸ªé¡µçš„ç©ºé—´ï¼Œè¿™æ ·å°±ä¿è¯ä¸€ä¸ªèŠ‚ç‚¹ç‰©ç†ä¸Šä¹Ÿå­˜å‚¨åœ¨ä¸€ä¸ªé¡µé‡Œï¼ŒåŠ ä¹‹è®¡ç®—æœºå­˜å‚¨åˆ†é…éƒ½æ˜¯æŒ‰é¡µå¯¹é½çš„ï¼Œå°±å®ç°äº†ä¸€ä¸ªnodeåªéœ€ä¸€æ¬¡I/Oã€‚</p>
<p>B-Treeä¸­ä¸€æ¬¡æ£€ç´¢æœ€å¤šéœ€è¦h-1æ¬¡I/Oï¼ˆæ ¹èŠ‚ç‚¹å¸¸é©»å†…å­˜ï¼‰ï¼Œæ¸è¿›å¤æ‚åº¦ä¸ºO(h)=O(logdN)ã€‚ä¸€èˆ¬å®é™…åº”ç”¨ä¸­ï¼Œå‡ºåº¦dæ˜¯éå¸¸å¤§çš„æ•°å­—ï¼Œé€šå¸¸è¶…è¿‡100ï¼Œå› æ­¤héå¸¸å°ï¼ˆé€šå¸¸ä¸è¶…è¿‡3ï¼‰ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œç”¨B-Treeä½œä¸ºç´¢å¼•ç»“æ„æ•ˆç‡æ˜¯éå¸¸é«˜çš„ã€‚</p>
<p>è€Œçº¢é»‘æ ‘è¿™ç§ç»“æ„ï¼Œhæ˜æ˜¾è¦æ·±çš„å¤šã€‚ç”±äºé€»è¾‘ä¸Šå¾ˆè¿‘çš„èŠ‚ç‚¹ï¼ˆçˆ¶å­ï¼‰ç‰©ç†ä¸Šå¯èƒ½å¾ˆè¿œï¼Œæ— æ³•åˆ©ç”¨å±€éƒ¨æ€§ï¼Œæ‰€ä»¥çº¢é»‘æ ‘çš„I/Oæ¸è¿›å¤æ‚åº¦ä¹Ÿä¸ºO(h)ï¼Œæ•ˆç‡æ˜æ˜¾æ¯”B-Treeå·®å¾ˆå¤šã€‚</p>
<p>ä¸Šæ–‡è¿˜è¯´è¿‡ï¼ŒB+Treeæ›´é€‚åˆå¤–å­˜ç´¢å¼•ï¼ŒåŸå› å’Œå†…èŠ‚ç‚¹å‡ºåº¦dæœ‰å…³ã€‚ä»ä¸Šé¢åˆ†æå¯ä»¥çœ‹åˆ°ï¼Œdè¶Šå¤§ç´¢å¼•çš„æ€§èƒ½è¶Šå¥½ï¼Œè€Œå‡ºåº¦çš„ä¸Šé™å–å†³äºèŠ‚ç‚¹å†…keyå’Œdataçš„å¤§å°ï¼š</p>
<p>dmax=floor(pagesize/(keysize+datasize+pointsize)) floorè¡¨ç¤ºå‘ä¸‹å–æ•´ã€‚ç”±äºB+Treeå†…èŠ‚ç‚¹å»æ‰äº†dataåŸŸï¼Œå› æ­¤å¯ä»¥æ‹¥æœ‰æ›´å¤§çš„å‡ºåº¦ï¼Œæ‹¥æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚</p>
<p>è¿™ä¸€ç« ä»ç†è®ºè§’åº¦è®¨è®ºäº†ä¸ç´¢å¼•ç›¸å…³çš„æ•°æ®ç»“æ„ä¸ç®—æ³•é—®é¢˜ï¼Œä¸‹ä¸€ç« å°†è®¨è®ºB+Treeæ˜¯å¦‚ä½•å…·ä½“å®ç°ä¸ºMySQLä¸­ç´¢å¼•ï¼ŒåŒæ—¶å°†ç»“åˆMyISAMå’ŒInnDBå­˜å‚¨å¼•æ“ä»‹ç»éèšé›†ç´¢å¼•å’Œèšé›†ç´¢å¼•ä¸¤ç§ä¸åŒçš„ç´¢å¼•å®ç°å½¢å¼ã€‚</p>
<h1 id="MySQLç´¢å¼•å®ç°"><a href="#MySQLç´¢å¼•å®ç°" class="headerlink" title="MySQLç´¢å¼•å®ç°"></a>MySQLç´¢å¼•å®ç°</h1><p>åœ¨MySQLä¸­ï¼Œç´¢å¼•å±äºå­˜å‚¨å¼•æ“çº§åˆ«çš„æ¦‚å¿µï¼Œä¸åŒå­˜å‚¨å¼•æ“å¯¹ç´¢å¼•çš„å®ç°æ–¹å¼æ˜¯ä¸åŒçš„ï¼Œæœ¬æ–‡ä¸»è¦è®¨è®ºMyISAMå’ŒInnoDBä¸¤ä¸ªå­˜å‚¨å¼•æ“çš„ç´¢å¼•å®ç°æ–¹å¼ã€‚</p>
<h2 id="MyISAMç´¢å¼•å®ç°"><a href="#MyISAMç´¢å¼•å®ç°" class="headerlink" title="MyISAMç´¢å¼•å®ç°"></a>MyISAMç´¢å¼•å®ç°</h2><p>MyISAMå¼•æ“ä½¿ç”¨B+Treeä½œä¸ºç´¢å¼•ç»“æ„ï¼Œå¶èŠ‚ç‚¹çš„dataåŸŸå­˜æ”¾çš„æ˜¯æ•°æ®è®°å½•çš„åœ°å€ã€‚ä¸‹å›¾æ˜¯MyISAMç´¢å¼•çš„åŸç†å›¾ï¼š</p>
<p><a href="http://idiotsky.top/images2/b-tree-8.png"><img src="http://idiotsky.top/images2/b-tree-8.png" alt=""></a></p>
<p>è¿™é‡Œè®¾è¡¨ä¸€å…±æœ‰ä¸‰åˆ—ï¼Œå‡è®¾æˆ‘ä»¬ä»¥Col1ä¸ºä¸»é”®ï¼Œåˆ™ä¸Šå›¾æ˜¯ä¸€ä¸ªMyISAMè¡¨çš„ä¸»ç´¢å¼•ï¼ˆPrimary keyï¼‰ç¤ºæ„ã€‚å¯ä»¥çœ‹å‡ºMyISAMçš„ç´¢å¼•æ–‡ä»¶ä»…ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚åœ¨MyISAMä¸­ï¼Œä¸»ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•ï¼ˆSecondary keyï¼‰åœ¨ç»“æ„ä¸Šæ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œåªæ˜¯ä¸»ç´¢å¼•è¦æ±‚keyæ˜¯å”¯ä¸€çš„ï¼Œè€Œè¾…åŠ©ç´¢å¼•çš„keyå¯ä»¥é‡å¤ã€‚å¦‚æœæˆ‘ä»¬åœ¨Col2ä¸Šå»ºç«‹ä¸€ä¸ªè¾…åŠ©ç´¢å¼•ï¼Œåˆ™æ­¤ç´¢å¼•çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><a href="http://idiotsky.top/images2/b-tree-9.png"><img src="http://idiotsky.top/images2/b-tree-9.png" alt=""></a></p>
<p>åŒæ ·ä¹Ÿæ˜¯ä¸€é¢—B+Treeï¼ŒdataåŸŸä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚å› æ­¤ï¼ŒMyISAMä¸­ç´¢å¼•æ£€ç´¢çš„ç®—æ³•ä¸ºé¦–å…ˆæŒ‰ç…§B+Treeæœç´¢ç®—æ³•æœç´¢ç´¢å¼•ï¼Œå¦‚æœæŒ‡å®šçš„Keyå­˜åœ¨ï¼Œåˆ™å–å‡ºå…¶dataåŸŸçš„å€¼ï¼Œç„¶åä»¥dataåŸŸçš„å€¼ä¸ºåœ°å€ï¼Œè¯»å–ç›¸åº”æ•°æ®è®°å½•ã€‚</p>
<p>MyISAMçš„ç´¢å¼•æ–¹å¼ä¹Ÿå«åšâ€œéèšé›†â€çš„ï¼Œä¹‹æ‰€ä»¥è¿™ä¹ˆç§°å‘¼æ˜¯ä¸ºäº†ä¸InnoDBçš„èšé›†ç´¢å¼•åŒºåˆ†ã€‚</p>
<h2 id="InnoDBç´¢å¼•å®ç°"><a href="#InnoDBç´¢å¼•å®ç°" class="headerlink" title="InnoDBç´¢å¼•å®ç°"></a>InnoDBç´¢å¼•å®ç°</h2><p>è™½ç„¶InnoDBä¹Ÿä½¿ç”¨B+Treeä½œä¸ºç´¢å¼•ç»“æ„ï¼Œä½†å…·ä½“å®ç°æ–¹å¼å´ä¸MyISAMæˆªç„¶ä¸åŒã€‚</p>
<p>ç¬¬ä¸€ä¸ªé‡å¤§åŒºåˆ«æ˜¯InnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ã€‚ä»ä¸Šæ–‡çŸ¥é“ï¼ŒMyISAMç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼Œç´¢å¼•æ–‡ä»¶ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚è€Œåœ¨InnoDBä¸­ï¼Œè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯æŒ‰B+Treeç»„ç»‡çš„ä¸€ä¸ªç´¢å¼•ç»“æ„ï¼Œè¿™æ£µæ ‘çš„å¶èŠ‚ç‚¹dataåŸŸä¿å­˜äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚è¿™ä¸ªç´¢å¼•çš„keyæ˜¯æ•°æ®è¡¨çš„ä¸»é”®ï¼Œå› æ­¤InnoDBè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ä¸»ç´¢å¼•ã€‚</p>
<p><a href="http://idiotsky.top/images2/b-tree-10.png"><img src="http://idiotsky.top/images2/b-tree-10.png" alt=""></a></p>
<p>ä¸Šå›¾æ˜¯InnoDBä¸»ç´¢å¼•ï¼ˆåŒæ—¶ä¹Ÿæ˜¯æ•°æ®æ–‡ä»¶ï¼‰çš„ç¤ºæ„å›¾ï¼Œå¯ä»¥çœ‹åˆ°å¶èŠ‚ç‚¹åŒ…å«äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚è¿™ç§ç´¢å¼•å«åšèšé›†ç´¢å¼•ã€‚å› ä¸ºInnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«è¦æŒ‰ä¸»é”®èšé›†ï¼Œæ‰€ä»¥InnoDBè¦æ±‚è¡¨å¿…é¡»æœ‰ä¸»é”®ï¼ˆMyISAMå¯ä»¥æ²¡æœ‰ï¼‰ï¼Œå¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®šï¼Œåˆ™MySQLç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªå¯ä»¥å”¯ä¸€æ ‡è¯†æ•°æ®è®°å½•çš„åˆ—ä½œä¸ºä¸»é”®ï¼Œå¦‚æœä¸å­˜åœ¨è¿™ç§åˆ—ï¼Œåˆ™MySQLè‡ªåŠ¨ä¸ºInnoDBè¡¨ç”Ÿæˆä¸€ä¸ªéšå«å­—æ®µä½œä¸ºä¸»é”®ï¼Œè¿™ä¸ªå­—æ®µé•¿åº¦ä¸º6ä¸ªå­—èŠ‚ï¼Œç±»å‹ä¸ºé•¿æ•´å½¢ã€‚</p>
<p>ç¬¬äºŒä¸ªä¸MyISAMç´¢å¼•çš„ä¸åŒæ˜¯InnoDBçš„è¾…åŠ©ç´¢å¼•dataåŸŸå­˜å‚¨ç›¸åº”è®°å½•ä¸»é”®çš„å€¼è€Œä¸æ˜¯åœ°å€ã€‚æ¢å¥è¯è¯´ï¼ŒInnoDBçš„æ‰€æœ‰è¾…åŠ©ç´¢å¼•éƒ½å¼•ç”¨ä¸»é”®ä½œä¸ºdataåŸŸã€‚ä¾‹å¦‚ï¼Œä¸‹å›¾ä¸ºå®šä¹‰åœ¨Col3ä¸Šçš„ä¸€ä¸ªè¾…åŠ©ç´¢å¼•ï¼š</p>
<p><a href="http://idiotsky.top/images2/b-tree-11.png"><img src="http://idiotsky.top/images2/b-tree-11.png" alt=""></a></p>
<p>è¿™é‡Œä»¥è‹±æ–‡å­—ç¬¦çš„ASCIIç ä½œä¸ºæ¯”è¾ƒå‡†åˆ™ã€‚èšé›†ç´¢å¼•è¿™ç§å®ç°æ–¹å¼ä½¿å¾—æŒ‰ä¸»é”®çš„æœç´¢ååˆ†é«˜æ•ˆï¼Œä½†æ˜¯è¾…åŠ©ç´¢å¼•æœç´¢éœ€è¦æ£€ç´¢ä¸¤éç´¢å¼•ï¼šé¦–å…ˆæ£€ç´¢è¾…åŠ©ç´¢å¼•è·å¾—ä¸»é”®ï¼Œç„¶åç”¨ä¸»é”®åˆ°ä¸»ç´¢å¼•ä¸­æ£€ç´¢è·å¾—è®°å½•ã€‚</p>
<p>äº†è§£ä¸åŒå­˜å‚¨å¼•æ“çš„ç´¢å¼•å®ç°æ–¹å¼å¯¹äºæ­£ç¡®ä½¿ç”¨å’Œä¼˜åŒ–ç´¢å¼•éƒ½éå¸¸æœ‰å¸®åŠ©ï¼Œä¾‹å¦‚çŸ¥é“äº†InnoDBçš„ç´¢å¼•å®ç°åï¼Œå°±å¾ˆå®¹æ˜“æ˜ç™½ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨è¿‡é•¿çš„å­—æ®µä½œä¸ºä¸»é”®ï¼Œå› ä¸ºæ‰€æœ‰è¾…åŠ©ç´¢å¼•éƒ½å¼•ç”¨ä¸»ç´¢å¼•ï¼Œè¿‡é•¿çš„ä¸»ç´¢å¼•ä¼šä»¤è¾…åŠ©ç´¢å¼•å˜å¾—è¿‡å¤§ã€‚å†ä¾‹å¦‚ï¼Œç”¨éå•è°ƒçš„å­—æ®µä½œä¸ºä¸»é”®åœ¨InnoDBä¸­ä¸æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºInnoDBæ•°æ®æ–‡ä»¶æœ¬èº«æ˜¯ä¸€é¢—B+Treeï¼Œéå•è°ƒçš„ä¸»é”®ä¼šé€ æˆåœ¨æ’å…¥æ–°è®°å½•æ—¶æ•°æ®æ–‡ä»¶ä¸ºäº†ç»´æŒB+Treeçš„ç‰¹æ€§è€Œé¢‘ç¹çš„åˆ†è£‚è°ƒæ•´ï¼Œååˆ†ä½æ•ˆï¼Œè€Œä½¿ç”¨è‡ªå¢å­—æ®µä½œä¸ºä¸»é”®åˆ™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚</p>
<p>ä¸‹ä¸€ç« å°†å…·ä½“è®¨è®ºè¿™äº›ä¸ç´¢å¼•æœ‰å…³çš„ä¼˜åŒ–ç­–ç•¥ã€‚</p>
<h1 id="ç´¢å¼•ä½¿ç”¨ç­–ç•¥åŠä¼˜åŒ–"><a href="#ç´¢å¼•ä½¿ç”¨ç­–ç•¥åŠä¼˜åŒ–" class="headerlink" title="ç´¢å¼•ä½¿ç”¨ç­–ç•¥åŠä¼˜åŒ–"></a>ç´¢å¼•ä½¿ç”¨ç­–ç•¥åŠä¼˜åŒ–</h1><p>MySQLçš„ä¼˜åŒ–ä¸»è¦åˆ†ä¸ºç»“æ„ä¼˜åŒ–ï¼ˆScheme optimizationï¼‰å’ŒæŸ¥è¯¢ä¼˜åŒ–ï¼ˆQuery optimizationï¼‰ã€‚æœ¬ç« è®¨è®ºçš„é«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥ä¸»è¦å±äºç»“æ„ä¼˜åŒ–èŒƒç•´ã€‚æœ¬ç« çš„å†…å®¹å®Œå…¨åŸºäºä¸Šæ–‡çš„ç†è®ºåŸºç¡€ï¼Œå®é™…ä¸Šä¸€æ—¦ç†è§£äº†ç´¢å¼•èƒŒåçš„æœºåˆ¶ï¼Œé‚£ä¹ˆé€‰æ‹©é«˜æ€§èƒ½çš„ç­–ç•¥å°±å˜æˆäº†çº¯ç²¹çš„æ¨ç†ï¼Œå¹¶ä¸”å¯ä»¥ç†è§£è¿™äº›ç­–ç•¥èƒŒåçš„é€»è¾‘ã€‚</p>
<h2 id="ç¤ºä¾‹æ•°æ®åº“"><a href="#ç¤ºä¾‹æ•°æ®åº“" class="headerlink" title="ç¤ºä¾‹æ•°æ®åº“"></a>ç¤ºä¾‹æ•°æ®åº“</h2><p>ä¸ºäº†è®¨è®ºç´¢å¼•ç­–ç•¥ï¼Œéœ€è¦ä¸€ä¸ªæ•°æ®é‡ä¸ç®—å°çš„æ•°æ®åº“ä½œä¸ºç¤ºä¾‹ã€‚æœ¬æ–‡é€‰ç”¨MySQLå®˜æ–¹æ–‡æ¡£ä¸­æä¾›çš„ç¤ºä¾‹æ•°æ®åº“ä¹‹ä¸€ï¼šemployeesã€‚è¿™ä¸ªæ•°æ®åº“å…³ç³»å¤æ‚åº¦é€‚ä¸­ï¼Œä¸”æ•°æ®é‡è¾ƒå¤§ã€‚ä¸‹å›¾æ˜¯è¿™ä¸ªæ•°æ®åº“çš„E-Rå…³ç³»å›¾ï¼ˆå¼•ç”¨è‡ªMySQLå®˜æ–¹æ‰‹å†Œï¼‰ï¼š</p>
<p><a href="http://idiotsky.top/images2/b-tree-12.png"><img src="http://idiotsky.top/images2/b-tree-12.png" alt=""></a></p>
<h2 id="æœ€å·¦å‰ç¼€åŸç†ä¸ç›¸å…³ä¼˜åŒ–"><a href="#æœ€å·¦å‰ç¼€åŸç†ä¸ç›¸å…³ä¼˜åŒ–" class="headerlink" title="æœ€å·¦å‰ç¼€åŸç†ä¸ç›¸å…³ä¼˜åŒ–"></a>æœ€å·¦å‰ç¼€åŸç†ä¸ç›¸å…³ä¼˜åŒ–</h2><p>é«˜æ•ˆä½¿ç”¨ç´¢å¼•çš„é¦–è¦æ¡ä»¶æ˜¯çŸ¥é“ä»€ä¹ˆæ ·çš„æŸ¥è¯¢ä¼šä½¿ç”¨åˆ°ç´¢å¼•ï¼Œè¿™ä¸ªé—®é¢˜å’ŒB+Treeä¸­çš„â€œæœ€å·¦å‰ç¼€åŸç†â€æœ‰å…³ï¼Œä¸‹é¢é€šè¿‡ä¾‹å­è¯´æ˜æœ€å·¦å‰ç¼€åŸç†ã€‚</p>
<p>è¿™é‡Œå…ˆè¯´ä¸€ä¸‹è”åˆç´¢å¼•çš„æ¦‚å¿µã€‚åœ¨ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬éƒ½æ˜¯å‡è®¾ç´¢å¼•åªå¼•ç”¨äº†å•ä¸ªçš„åˆ—ï¼Œå®é™…ä¸Šï¼ŒMySQLä¸­çš„ç´¢å¼•å¯ä»¥ä»¥ä¸€å®šé¡ºåºå¼•ç”¨å¤šä¸ªåˆ—ï¼Œè¿™ç§ç´¢å¼•å«åšè”åˆç´¢å¼•ï¼Œä¸€èˆ¬çš„ï¼Œä¸€ä¸ªè”åˆç´¢å¼•æ˜¯ä¸€ä¸ªæœ‰åºå…ƒç»„<code>&lt;a1, a2, â€¦, an&gt;</code>ï¼Œå…¶ä¸­å„ä¸ªå…ƒç´ å‡ä¸ºæ•°æ®è¡¨çš„ä¸€åˆ—ï¼Œå®é™…ä¸Šè¦ä¸¥æ ¼å®šä¹‰ç´¢å¼•éœ€è¦ç”¨åˆ°å…³ç³»ä»£æ•°ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä¸æƒ³è®¨è®ºå¤ªå¤šå…³ç³»ä»£æ•°çš„è¯é¢˜ï¼Œå› ä¸ºé‚£æ ·ä¼šæ˜¾å¾—å¾ˆæ¯ç‡¥ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸å†åšä¸¥æ ¼å®šä¹‰ã€‚å¦å¤–ï¼Œå•åˆ—ç´¢å¼•å¯ä»¥çœ‹æˆè”åˆç´¢å¼•å…ƒç´ æ•°ä¸º1çš„ç‰¹ä¾‹ã€‚</p>
<p>ä»¥employees.titlesè¡¨ä¸ºä¾‹ï¼Œä¸‹é¢å…ˆæŸ¥çœ‹å…¶ä¸Šéƒ½æœ‰å“ªäº›ç´¢å¼•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SHOW INDEX FROM employees.titles;</span><br><span class="line">+--------+------------+----------+--------------+-------------+-----------+-------------+------+------------+</span><br><span class="line">| Table  | Non_unique | Key_name | Seq_in_index | Column_name | Collation | Cardinality | Null | Index_type |</span><br><span class="line">+--------+------------+----------+--------------+-------------+-----------+-------------+------+------------+</span><br><span class="line">| titles |          0 | PRIMARY  |            1 | emp_no      | A         |        NULL |      | BTREE      |</span><br><span class="line">| titles |          0 | PRIMARY  |            2 | title       | A         |        NULL |      | BTREE      |</span><br><span class="line">| titles |          0 | PRIMARY  |            3 | from_date   | A         |      443308 |      | BTREE      |</span><br><span class="line">| titles |          1 | emp_no   |            1 | emp_no      | A         |      443308 |      | BTREE      |</span><br><span class="line">+--------+------------+----------+--------------+-------------+-----------+-------------+------+------------+</span><br></pre></td></tr></table></figure>
<p>ä»ç»“æœä¸­å¯ä»¥åˆ°titlesè¡¨çš„ä¸»ç´¢å¼•ä¸º<code>&lt;emp_no, title, from_date&gt;</code>ï¼Œè¿˜æœ‰ä¸€ä¸ªè¾…åŠ©ç´¢å¼•<code>&lt;emp_no&gt;</code>ã€‚ä¸ºäº†é¿å…å¤šä¸ªç´¢å¼•ä½¿äº‹æƒ…å˜å¤æ‚ï¼ˆMySQLçš„SQLä¼˜åŒ–å™¨åœ¨å¤šç´¢å¼•æ—¶è¡Œä¸ºæ¯”è¾ƒå¤æ‚ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬å°†è¾…åŠ©ç´¢å¼•dropæ‰ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> employees.titles <span class="keyword">DROP</span> <span class="keyword">INDEX</span> emp_no;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å¯ä»¥ä¸“å¿ƒåˆ†æç´¢å¼•PRIMARYçš„è¡Œä¸ºäº†ã€‚</p>
<h3 id="æƒ…å†µä¸€ï¼šå…¨åˆ—åŒ¹é…ã€‚"><a href="#æƒ…å†µä¸€ï¼šå…¨åˆ—åŒ¹é…ã€‚" class="headerlink" title="æƒ…å†µä¸€ï¼šå…¨åˆ—åŒ¹é…ã€‚"></a>æƒ…å†µä¸€ï¼šå…¨åˆ—åŒ¹é…ã€‚</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees.titles WHERE emp_no=&apos;10001&apos; AND title=&apos;Senior Engineer&apos; AND from_date=&apos;1986-06-26&apos;;</span><br><span class="line">+----+-------------+--------+-------+---------------+---------+---------+-------------------+------+-------+</span><br><span class="line">| id | select_type | table  | type  | possible_keys | key     | key_len | ref               | rows | Extra |</span><br><span class="line">+----+-------------+--------+-------+---------------+---------+---------+-------------------+------+-------+</span><br><span class="line">|  1 | SIMPLE      | titles | const | PRIMARY       | PRIMARY | 59      | const,const,const |    1 |       |</span><br><span class="line">+----+-------------+--------+-------+---------------+---------+---------+-------------------+------+-------+</span><br></pre></td></tr></table></figure>
<p>å¾ˆæ˜æ˜¾ï¼Œå½“æŒ‰ç…§ç´¢å¼•ä¸­æ‰€æœ‰åˆ—è¿›è¡Œç²¾ç¡®åŒ¹é…ï¼ˆè¿™é‡Œç²¾ç¡®åŒ¹é…æŒ‡â€œ=â€æˆ–â€œINâ€åŒ¹é…ï¼‰æ—¶ï¼Œç´¢å¼•å¯ä»¥è¢«ç”¨åˆ°ã€‚è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œç†è®ºä¸Šç´¢å¼•å¯¹é¡ºåºæ˜¯æ•æ„Ÿçš„ï¼Œä½†æ˜¯ç”±äºMySQLçš„æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨è°ƒæ•´whereå­å¥çš„æ¡ä»¶é¡ºåºä»¥ä½¿ç”¨é€‚åˆçš„ç´¢å¼•ï¼Œä¾‹å¦‚æˆ‘ä»¬å°†whereä¸­çš„æ¡ä»¶é¡ºåºé¢ å€’ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees.titles WHERE from_date=&apos;1986-06-26&apos; AND emp_no=&apos;10001&apos; AND title=&apos;Senior Engineer&apos;;</span><br><span class="line">+----+-------------+--------+-------+---------------+---------+---------+-------------------+------+-------+</span><br><span class="line">| id | select_type | table  | type  | possible_keys | key     | key_len | ref               | rows | Extra |</span><br><span class="line">+----+-------------+--------+-------+---------------+---------+---------+-------------------+------+-------+</span><br><span class="line">|  1 | SIMPLE      | titles | const | PRIMARY       | PRIMARY | 59      | const,const,const |    1 |       |</span><br><span class="line">+----+-------------+--------+-------+---------------+---------+---------+-------------------+------+-------+</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚</p>
<h3 id="æƒ…å†µäºŒï¼šæœ€å·¦å‰ç¼€åŒ¹é…ã€‚"><a href="#æƒ…å†µäºŒï¼šæœ€å·¦å‰ç¼€åŒ¹é…ã€‚" class="headerlink" title="æƒ…å†µäºŒï¼šæœ€å·¦å‰ç¼€åŒ¹é…ã€‚"></a>æƒ…å†µäºŒï¼šæœ€å·¦å‰ç¼€åŒ¹é…ã€‚</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees.titles WHERE emp_no=&apos;10001&apos;;</span><br><span class="line">+----+-------------+--------+------+---------------+---------+---------+-------+------+-------+</span><br><span class="line">| id | select_type | table  | type | possible_keys | key     | key_len | ref   | rows | Extra |</span><br><span class="line">+----+-------------+--------+------+---------------+---------+---------+-------+------+-------+</span><br><span class="line">|  1 | SIMPLE      | titles | ref  | PRIMARY       | PRIMARY | 4       | const |    1 |       |</span><br><span class="line">+----+-------------+--------+------+---------------+---------+---------+-------+------+-------+</span><br></pre></td></tr></table></figure>
<p>å½“æŸ¥è¯¢æ¡ä»¶ç²¾ç¡®åŒ¹é…ç´¢å¼•çš„å·¦è¾¹è¿ç»­ä¸€ä¸ªæˆ–å‡ ä¸ªåˆ—æ—¶ï¼Œå¦‚<code>&lt;emp_no&gt;</code>æˆ–<code>&lt;emp_no, title&gt;</code>ï¼Œæ‰€ä»¥å¯ä»¥è¢«ç”¨åˆ°ï¼Œä½†æ˜¯åªèƒ½ç”¨åˆ°ä¸€éƒ¨åˆ†ï¼Œå³æ¡ä»¶æ‰€ç»„æˆçš„æœ€å·¦å‰ç¼€ã€‚ä¸Šé¢çš„æŸ¥è¯¢ä»åˆ†æç»“æœçœ‹ç”¨åˆ°äº†PRIMARYç´¢å¼•ï¼Œä½†æ˜¯key_lenä¸º4ï¼Œè¯´æ˜åªç”¨åˆ°äº†ç´¢å¼•çš„ç¬¬ä¸€åˆ—å‰ç¼€ã€‚</p>
<h3 id="æƒ…å†µä¸‰ï¼šæŸ¥è¯¢æ¡ä»¶ç”¨åˆ°äº†ç´¢å¼•ä¸­åˆ—çš„ç²¾ç¡®åŒ¹é…ï¼Œä½†æ˜¯ä¸­é—´æŸä¸ªæ¡ä»¶æœªæä¾›ã€‚"><a href="#æƒ…å†µä¸‰ï¼šæŸ¥è¯¢æ¡ä»¶ç”¨åˆ°äº†ç´¢å¼•ä¸­åˆ—çš„ç²¾ç¡®åŒ¹é…ï¼Œä½†æ˜¯ä¸­é—´æŸä¸ªæ¡ä»¶æœªæä¾›ã€‚" class="headerlink" title="æƒ…å†µä¸‰ï¼šæŸ¥è¯¢æ¡ä»¶ç”¨åˆ°äº†ç´¢å¼•ä¸­åˆ—çš„ç²¾ç¡®åŒ¹é…ï¼Œä½†æ˜¯ä¸­é—´æŸä¸ªæ¡ä»¶æœªæä¾›ã€‚"></a>æƒ…å†µä¸‰ï¼šæŸ¥è¯¢æ¡ä»¶ç”¨åˆ°äº†ç´¢å¼•ä¸­åˆ—çš„ç²¾ç¡®åŒ¹é…ï¼Œä½†æ˜¯ä¸­é—´æŸä¸ªæ¡ä»¶æœªæä¾›ã€‚</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees.titles WHERE emp_no=&apos;10001&apos; AND from_date=&apos;1986-06-26&apos;;</span><br><span class="line">+----+-------------+--------+------+---------------+---------+---------+-------+------+-------------+</span><br><span class="line">| id | select_type | table  | type | possible_keys | key     | key_len | ref   | rows | Extra       |</span><br><span class="line">+----+-------------+--------+------+---------------+---------+---------+-------+------+-------------+</span><br><span class="line">|  1 | SIMPLE      | titles | ref  | PRIMARY       | PRIMARY | 4       | const |    1 | Using where |</span><br><span class="line">+----+-------------+--------+------+---------------+---------+---------+-------+------+-------------+</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶ç´¢å¼•ä½¿ç”¨æƒ…å†µå’Œæƒ…å†µäºŒç›¸åŒï¼Œå› ä¸ºtitleæœªæä¾›ï¼Œæ‰€ä»¥æŸ¥è¯¢åªç”¨åˆ°äº†ç´¢å¼•çš„ç¬¬ä¸€åˆ—ï¼Œè€Œåé¢çš„from_dateè™½ç„¶ä¹Ÿåœ¨ç´¢å¼•ä¸­ï¼Œä½†æ˜¯ç”±äºtitleä¸å­˜åœ¨è€Œæ— æ³•å’Œå·¦å‰ç¼€è¿æ¥ï¼Œå› æ­¤éœ€è¦å¯¹ç»“æœè¿›è¡Œæ‰«æè¿‡æ»¤from_dateï¼ˆè¿™é‡Œç”±äºemp_noå”¯ä¸€ï¼Œæ‰€ä»¥ä¸å­˜åœ¨æ‰«æï¼‰ã€‚å¦‚æœæƒ³è®©from_dateä¹Ÿä½¿ç”¨ç´¢å¼•è€Œä¸æ˜¯whereè¿‡æ»¤ï¼Œå¯ä»¥å¢åŠ ä¸€ä¸ªè¾…åŠ©ç´¢å¼•<code>&lt;emp_no, from_date&gt;</code>ï¼Œæ­¤æ—¶ä¸Šé¢çš„æŸ¥è¯¢ä¼šä½¿ç”¨è¿™ä¸ªç´¢å¼•ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸€ç§ç§°ä¹‹ä¸ºâ€œéš”ç¦»åˆ—â€çš„ä¼˜åŒ–æ–¹æ³•ï¼Œå°†emp_noä¸from_dateä¹‹é—´çš„â€œå‘â€å¡«ä¸Šã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹titleä¸€å…±æœ‰å‡ ç§ä¸åŒçš„å€¼ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SELECT DISTINCT(title) FROM employees.titles;</span><br><span class="line">+--------------------+</span><br><span class="line">| title              |</span><br><span class="line">+--------------------+</span><br><span class="line">| Senior Engineer    |</span><br><span class="line">| Staff              |</span><br><span class="line">| Engineer           |</span><br><span class="line">| Senior Staff       |</span><br><span class="line">| Assistant Engineer |</span><br><span class="line">| Technique Leader   |</span><br><span class="line">| Manager            |</span><br><span class="line">+--------------------+</span><br></pre></td></tr></table></figure></p>
<p>åªæœ‰7ç§ã€‚åœ¨è¿™ç§æˆä¸ºâ€œå‘â€çš„åˆ—å€¼æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è€ƒè™‘ç”¨â€œINâ€æ¥å¡«è¡¥è¿™ä¸ªâ€œå‘â€ä»è€Œå½¢æˆæœ€å·¦å‰ç¼€ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees.titles</span><br><span class="line">WHERE emp_no=&apos;10001&apos;</span><br><span class="line">AND title IN (&apos;Senior Engineer&apos;, &apos;Staff&apos;, &apos;Engineer&apos;, &apos;Senior Staff&apos;, &apos;Assistant Engineer&apos;, &apos;Technique Leader&apos;, &apos;Manager&apos;)</span><br><span class="line">AND from_date=&apos;1986-06-26&apos;;</span><br><span class="line">+----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span><br><span class="line">| id | select_type | table  | type  | possible_keys | key     | key_len | ref  | rows | Extra       |</span><br><span class="line">+----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span><br><span class="line">|  1 | SIMPLE      | titles | range | PRIMARY       | PRIMARY | 59      | NULL |    7 | Using where |</span><br><span class="line">+----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ¬¡key_lenä¸º59ï¼Œè¯´æ˜ç´¢å¼•è¢«ç”¨å…¨äº†ï¼Œä½†æ˜¯ä»typeå’Œrowsçœ‹å‡ºINå®é™…ä¸Šæ‰§è¡Œäº†ä¸€ä¸ªrangeæŸ¥è¯¢ï¼Œè¿™é‡Œæ£€æŸ¥äº†7ä¸ªkeyã€‚çœ‹ä¸‹ä¸¤ç§æŸ¥è¯¢çš„æ€§èƒ½æ¯”è¾ƒï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SHOW PROFILES;</span><br><span class="line">+----------+------------+-------------------------------------------------------------------------------+</span><br><span class="line">| Query_ID | Duration   | Query                                                                         |</span><br><span class="line">+----------+------------+-------------------------------------------------------------------------------+</span><br><span class="line">|       10 | 0.00058000 | SELECT * FROM employees.titles WHERE emp_no=&apos;10001&apos; AND from_date=&apos;1986-06-26&apos;|</span><br><span class="line">|       11 | 0.00052500 | SELECT * FROM employees.titles WHERE emp_no=&apos;10001&apos; AND title IN ...          |</span><br><span class="line">+----------+------------+-------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure></p>
<p>â€œå¡«å‘â€åæ€§èƒ½æå‡äº†ä¸€ç‚¹ã€‚å¦‚æœç»è¿‡emp_noç­›é€‰åä½™ä¸‹å¾ˆå¤šæ•°æ®ï¼Œåˆ™åè€…æ€§èƒ½ä¼˜åŠ¿ä¼šæ›´åŠ æ˜æ˜¾ã€‚å½“ç„¶ï¼Œå¦‚æœtitleçš„å€¼å¾ˆå¤šï¼Œç”¨å¡«å‘å°±ä¸åˆé€‚äº†ï¼Œå¿…é¡»å»ºç«‹è¾…åŠ©ç´¢å¼•ã€‚</p>
<h3 id="æƒ…å†µå››ï¼šæŸ¥è¯¢æ¡ä»¶æ²¡æœ‰æŒ‡å®šç´¢å¼•ç¬¬ä¸€åˆ—ã€‚"><a href="#æƒ…å†µå››ï¼šæŸ¥è¯¢æ¡ä»¶æ²¡æœ‰æŒ‡å®šç´¢å¼•ç¬¬ä¸€åˆ—ã€‚" class="headerlink" title="æƒ…å†µå››ï¼šæŸ¥è¯¢æ¡ä»¶æ²¡æœ‰æŒ‡å®šç´¢å¼•ç¬¬ä¸€åˆ—ã€‚"></a>æƒ…å†µå››ï¼šæŸ¥è¯¢æ¡ä»¶æ²¡æœ‰æŒ‡å®šç´¢å¼•ç¬¬ä¸€åˆ—ã€‚</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees.titles WHERE from_date=&apos;1986-06-26&apos;;</span><br><span class="line">+----+-------------+--------+------+---------------+------+---------+------+--------+-------------+</span><br><span class="line">| id | select_type | table  | type | possible_keys | key  | key_len | ref  | rows   | Extra       |</span><br><span class="line">+----+-------------+--------+------+---------------+------+---------+------+--------+-------------+</span><br><span class="line">|  1 | SIMPLE      | titles | ALL  | NULL          | NULL | NULL    | NULL | 443308 | Using where |</span><br><span class="line">+----+-------------+--------+------+---------------+------+---------+------+--------+-------------+</span><br></pre></td></tr></table></figure>
<p>ç”±äºä¸æ˜¯æœ€å·¦å‰ç¼€ï¼Œç´¢å¼•è¿™æ ·çš„æŸ¥è¯¢æ˜¾ç„¶ç”¨ä¸åˆ°ç´¢å¼•ã€‚</p>
<h3 id="æƒ…å†µäº”ï¼šåŒ¹é…æŸåˆ—çš„å‰ç¼€å­—ç¬¦ä¸²ã€‚"><a href="#æƒ…å†µäº”ï¼šåŒ¹é…æŸåˆ—çš„å‰ç¼€å­—ç¬¦ä¸²ã€‚" class="headerlink" title="æƒ…å†µäº”ï¼šåŒ¹é…æŸåˆ—çš„å‰ç¼€å­—ç¬¦ä¸²ã€‚"></a>æƒ…å†µäº”ï¼šåŒ¹é…æŸåˆ—çš„å‰ç¼€å­—ç¬¦ä¸²ã€‚</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees.titles WHERE emp_no=&apos;10001&apos; AND title LIKE &apos;Senior%&apos;;</span><br><span class="line">+----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span><br><span class="line">| id | select_type | table  | type  | possible_keys | key     | key_len | ref  | rows | Extra       |</span><br><span class="line">+----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span><br><span class="line">|  1 | SIMPLE      | titles | range | PRIMARY       | PRIMARY | 56      | NULL |    1 | Using where |</span><br><span class="line">+----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span><br></pre></td></tr></table></figure>
<p>å¦‚æœé€šé…ç¬¦%ä¸å‡ºç°åœ¨å¼€å¤´ï¼Œåˆ™å¯ä»¥ç”¨åˆ°ç´¢å¼•ï¼Œä½†æ ¹æ®å…·ä½“æƒ…å†µä¸åŒå¯èƒ½åªä¼šç”¨å…¶ä¸­ä¸€ä¸ªå‰ç¼€.</p>
<h3 id="æƒ…å†µå…­ï¼šèŒƒå›´æŸ¥è¯¢ã€‚"><a href="#æƒ…å†µå…­ï¼šèŒƒå›´æŸ¥è¯¢ã€‚" class="headerlink" title="æƒ…å†µå…­ï¼šèŒƒå›´æŸ¥è¯¢ã€‚"></a>æƒ…å†µå…­ï¼šèŒƒå›´æŸ¥è¯¢ã€‚</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees.titles WHERE emp_no &lt; &apos;10010&apos; and title=&apos;Senior Engineer&apos;;</span><br><span class="line">+----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span><br><span class="line">| id | select_type | table  | type  | possible_keys | key     | key_len | ref  | rows | Extra       |</span><br><span class="line">+----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span><br><span class="line">|  1 | SIMPLE      | titles | range | PRIMARY       | PRIMARY | 4       | NULL |   16 | Using where |</span><br><span class="line">+----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span><br></pre></td></tr></table></figure>
<p>èŒƒå›´åˆ—å¯ä»¥ç”¨åˆ°ç´¢å¼•ï¼ˆå¿…é¡»æ˜¯æœ€å·¦å‰ç¼€ï¼‰ï¼Œä½†æ˜¯èŒƒå›´åˆ—åé¢çš„åˆ—æ— æ³•ç”¨åˆ°ç´¢å¼•ã€‚åŒæ—¶ï¼Œç´¢å¼•æœ€å¤šç”¨äºä¸€ä¸ªèŒƒå›´åˆ—ï¼Œå› æ­¤å¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸­æœ‰ä¸¤ä¸ªèŒƒå›´åˆ—åˆ™æ— æ³•å…¨ç”¨åˆ°ç´¢å¼•ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees.titles</span><br><span class="line">WHERE emp_no &lt; &apos;10010&apos;</span><br><span class="line">AND title=&apos;Senior Engineer&apos;</span><br><span class="line">AND from_date BETWEEN &apos;1986-01-01&apos; AND &apos;1986-12-31&apos;;</span><br><span class="line">+----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span><br><span class="line">| id | select_type | table  | type  | possible_keys | key     | key_len | ref  | rows | Extra       |</span><br><span class="line">+----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span><br><span class="line">|  1 | SIMPLE      | titles | range | PRIMARY       | PRIMARY | 4       | NULL |   16 | Using where |</span><br><span class="line">+----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°ç´¢å¼•å¯¹ç¬¬äºŒä¸ªèŒƒå›´ç´¢å¼•æ— èƒ½ä¸ºåŠ›ã€‚è¿™é‡Œç‰¹åˆ«è¦è¯´æ˜MySQLä¸€ä¸ªæœ‰æ„æ€çš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯ä»…ç”¨explainå¯èƒ½æ— æ³•åŒºåˆ†èŒƒå›´ç´¢å¼•å’Œå¤šå€¼åŒ¹é…ï¼Œå› ä¸ºåœ¨typeä¸­è¿™ä¸¤è€…éƒ½æ˜¾ç¤ºä¸ºrangeã€‚åŒæ—¶ï¼Œç”¨äº†â€œbetweenâ€å¹¶ä¸æ„å‘³ç€å°±æ˜¯èŒƒå›´æŸ¥è¯¢ï¼Œä¾‹å¦‚ä¸‹é¢çš„æŸ¥è¯¢ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees.titles</span><br><span class="line">WHERE emp_no BETWEEN &apos;10001&apos; AND &apos;10010&apos;</span><br><span class="line">AND title=&apos;Senior Engineer&apos;</span><br><span class="line">AND from_date BETWEEN &apos;1986-01-01&apos; AND &apos;1986-12-31&apos;;</span><br><span class="line">+----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span><br><span class="line">| id | select_type | table  | type  | possible_keys | key     | key_len | ref  | rows | Extra       |</span><br><span class="line">+----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span><br><span class="line">|  1 | SIMPLE      | titles | range | PRIMARY       | PRIMARY | 59      | NULL |   16 | Using where |</span><br><span class="line">+----+-------------+--------+-------+---------------+---------+---------+------+------+-------------+</span><br></pre></td></tr></table></figure></p>
<p>çœ‹èµ·æ¥æ˜¯ç”¨äº†ä¸¤ä¸ªèŒƒå›´æŸ¥è¯¢ï¼Œä½†ä½œç”¨äºemp_noä¸Šçš„â€œBETWEENâ€å®é™…ä¸Šç›¸å½“äºâ€œINâ€ï¼Œä¹Ÿå°±æ˜¯è¯´emp_noå®é™…æ˜¯å¤šå€¼ç²¾ç¡®åŒ¹é…ã€‚å¯ä»¥çœ‹åˆ°è¿™ä¸ªæŸ¥è¯¢ç”¨åˆ°äº†ç´¢å¼•å…¨éƒ¨ä¸‰ä¸ªåˆ—ã€‚å› æ­¤åœ¨MySQLä¸­è¦è°¨æ…åœ°åŒºåˆ†å¤šå€¼åŒ¹é…å’ŒèŒƒå›´åŒ¹é…ï¼Œå¦åˆ™ä¼šå¯¹MySQLçš„è¡Œä¸ºäº§ç”Ÿå›°æƒ‘ã€‚</p>
<h3 id="æƒ…å†µä¸ƒï¼šæŸ¥è¯¢æ¡ä»¶ä¸­å«æœ‰å‡½æ•°æˆ–è¡¨è¾¾å¼ã€‚"><a href="#æƒ…å†µä¸ƒï¼šæŸ¥è¯¢æ¡ä»¶ä¸­å«æœ‰å‡½æ•°æˆ–è¡¨è¾¾å¼ã€‚" class="headerlink" title="æƒ…å†µä¸ƒï¼šæŸ¥è¯¢æ¡ä»¶ä¸­å«æœ‰å‡½æ•°æˆ–è¡¨è¾¾å¼ã€‚"></a>æƒ…å†µä¸ƒï¼šæŸ¥è¯¢æ¡ä»¶ä¸­å«æœ‰å‡½æ•°æˆ–è¡¨è¾¾å¼ã€‚</h3><p>å¾ˆä¸å¹¸ï¼Œå¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸­å«æœ‰å‡½æ•°æˆ–è¡¨è¾¾å¼ï¼Œåˆ™MySQLä¸ä¼šä¸ºè¿™åˆ—ä½¿ç”¨ç´¢å¼•ï¼ˆè™½ç„¶æŸäº›åœ¨æ•°å­¦æ„ä¹‰ä¸Šå¯ä»¥ä½¿ç”¨ï¼‰ã€‚ä¾‹å¦‚ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees.titles WHERE emp_no=&apos;10001&apos; AND left(title, 6)=&apos;Senior&apos;;</span><br><span class="line">+----+-------------+--------+------+---------------+---------+---------+-------+------+-------------+</span><br><span class="line">| id | select_type | table  | type | possible_keys | key     | key_len | ref   | rows | Extra       |</span><br><span class="line">+----+-------------+--------+------+---------------+---------+---------+-------+------+-------------+</span><br><span class="line">|  1 | SIMPLE      | titles | ref  | PRIMARY       | PRIMARY | 4       | const |    1 | Using where |</span><br><span class="line">+----+-------------+--------+------+---------------+---------+---------+-------+------+-------------+</span><br></pre></td></tr></table></figure></p>
<p>è™½ç„¶è¿™ä¸ªæŸ¥è¯¢å’Œæƒ…å†µäº”ä¸­åŠŸèƒ½ç›¸åŒï¼Œä½†æ˜¯ç”±äºä½¿ç”¨äº†å‡½æ•°leftï¼Œåˆ™æ— æ³•ä¸ºtitleåˆ—åº”ç”¨ç´¢å¼•ï¼Œè€Œæƒ…å†µäº”ä¸­ç”¨LIKEåˆ™å¯ä»¥ã€‚å†å¦‚ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees.titles WHERE emp_no - 1=&apos;10000&apos;;</span><br><span class="line">+----+-------------+--------+------+---------------+------+---------+------+--------+-------------+</span><br><span class="line">| id | select_type | table  | type | possible_keys | key  | key_len | ref  | rows   | Extra       |</span><br><span class="line">+----+-------------+--------+------+---------------+------+---------+------+--------+-------------+</span><br><span class="line">|  1 | SIMPLE      | titles | ALL  | NULL          | NULL | NULL    | NULL | 443308 | Using where |</span><br><span class="line">+----+-------------+--------+------+---------------+------+---------+------+--------+-------------+</span><br></pre></td></tr></table></figure></p>
<p>æ˜¾ç„¶è¿™ä¸ªæŸ¥è¯¢ç­‰ä»·äºæŸ¥è¯¢emp_noä¸º10001çš„å‡½æ•°ï¼Œä½†æ˜¯ç”±äºæŸ¥è¯¢æ¡ä»¶æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼ŒMySQLæ— æ³•ä¸ºå…¶ä½¿ç”¨ç´¢å¼•ã€‚çœ‹æ¥MySQLè¿˜æ²¡æœ‰æ™ºèƒ½åˆ°è‡ªåŠ¨ä¼˜åŒ–å¸¸é‡è¡¨è¾¾å¼çš„ç¨‹åº¦ï¼Œå› æ­¤åœ¨å†™æŸ¥è¯¢è¯­å¥æ—¶å°½é‡é¿å…è¡¨è¾¾å¼å‡ºç°åœ¨æŸ¥è¯¢ä¸­ï¼Œè€Œæ˜¯å…ˆæ‰‹å·¥ç§ä¸‹ä»£æ•°è¿ç®—ï¼Œè½¬æ¢ä¸ºæ— è¡¨è¾¾å¼çš„æŸ¥è¯¢è¯­å¥ã€‚</p>
<h2 id="ç´¢å¼•é€‰æ‹©æ€§ä¸å‰ç¼€ç´¢å¼•"><a href="#ç´¢å¼•é€‰æ‹©æ€§ä¸å‰ç¼€ç´¢å¼•" class="headerlink" title="ç´¢å¼•é€‰æ‹©æ€§ä¸å‰ç¼€ç´¢å¼•"></a>ç´¢å¼•é€‰æ‹©æ€§ä¸å‰ç¼€ç´¢å¼•</h2><p>æ—¢ç„¶ç´¢å¼•å¯ä»¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯åªè¦æ˜¯æŸ¥è¯¢è¯­å¥éœ€è¦ï¼Œå°±å»ºä¸Šç´¢å¼•ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚å› ä¸ºç´¢å¼•è™½ç„¶åŠ å¿«äº†æŸ¥è¯¢é€Ÿåº¦ï¼Œä½†ç´¢å¼•ä¹Ÿæ˜¯æœ‰ä»£ä»·çš„ï¼šç´¢å¼•æ–‡ä»¶æœ¬èº«è¦æ¶ˆè€—å­˜å‚¨ç©ºé—´ï¼ŒåŒæ—¶ç´¢å¼•ä¼šåŠ é‡æ’å…¥ã€åˆ é™¤å’Œä¿®æ”¹è®°å½•æ—¶çš„è´Ÿæ‹…ï¼Œå¦å¤–ï¼ŒMySQLåœ¨è¿è¡Œæ—¶ä¹Ÿè¦æ¶ˆè€—èµ„æºç»´æŠ¤ç´¢å¼•ï¼Œå› æ­¤ç´¢å¼•å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ã€‚ä¸€èˆ¬ä¸¤ç§æƒ…å†µä¸‹ä¸å»ºè®®å»ºç´¢å¼•ã€‚</p>
<p>ç¬¬ä¸€ç§æƒ…å†µæ˜¯è¡¨è®°å½•æ¯”è¾ƒå°‘ï¼Œä¾‹å¦‚ä¸€ä¸¤åƒæ¡ç”šè‡³åªæœ‰å‡ ç™¾æ¡è®°å½•çš„è¡¨ï¼Œæ²¡å¿…è¦å»ºç´¢å¼•ï¼Œè®©æŸ¥è¯¢åšå…¨è¡¨æ‰«æå°±å¥½äº†ã€‚è‡³äºå¤šå°‘æ¡è®°å½•æ‰ç®—å¤šï¼Œè¿™ä¸ªä¸ªäººæœ‰ä¸ªäººçš„çœ‹æ³•ï¼Œæˆ‘ä¸ªäººçš„ç»éªŒæ˜¯ä»¥2000ä½œä¸ºåˆ†ç•Œçº¿ï¼Œè®°å½•æ•°ä¸è¶…è¿‡ 2000å¯ä»¥è€ƒè™‘ä¸å»ºç´¢å¼•ï¼Œè¶…è¿‡2000æ¡å¯ä»¥é…Œæƒ…è€ƒè™‘ç´¢å¼•ã€‚</p>
<p>å¦ä¸€ç§ä¸å»ºè®®å»ºç´¢å¼•çš„æƒ…å†µæ˜¯ç´¢å¼•çš„é€‰æ‹©æ€§è¾ƒä½ã€‚æ‰€è°“ç´¢å¼•çš„é€‰æ‹©æ€§ï¼ˆSelectivityï¼‰ï¼Œæ˜¯æŒ‡ä¸é‡å¤çš„ç´¢å¼•å€¼ï¼ˆä¹Ÿå«åŸºæ•°ï¼ŒCardinalityï¼‰ä¸è¡¨è®°å½•æ•°ï¼ˆ#Tï¼‰çš„æ¯”å€¼ï¼š</p>
<p>Index Selectivity = Cardinality / #T</p>
<p>æ˜¾ç„¶é€‰æ‹©æ€§çš„å–å€¼èŒƒå›´ä¸º(0, 1]ï¼Œé€‰æ‹©æ€§è¶Šé«˜çš„ç´¢å¼•ä»·å€¼è¶Šå¤§ï¼Œè¿™æ˜¯ç”±B+Treeçš„æ€§è´¨å†³å®šçš„ã€‚ä¾‹å¦‚ï¼Œä¸Šæ–‡ç”¨åˆ°çš„employees.titlesè¡¨ï¼Œå¦‚æœtitleå­—æ®µç»å¸¸è¢«å•ç‹¬æŸ¥è¯¢ï¼Œæ˜¯å¦éœ€è¦å»ºç´¢å¼•ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å®ƒçš„é€‰æ‹©æ€§ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">count</span>(<span class="keyword">DISTINCT</span>(title))/<span class="keyword">count</span>(*) <span class="keyword">AS</span> Selectivity <span class="keyword">FROM</span> employees.titles;</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">| Selectivity |</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">|      0.0000 |</span><br><span class="line">+<span class="comment">-------------+</span></span><br></pre></td></tr></table></figure></p>
<p>titleçš„é€‰æ‹©æ€§ä¸è¶³0.0001ï¼ˆç²¾ç¡®å€¼ä¸º0.00001579ï¼‰ï¼Œæ‰€ä»¥å®åœ¨æ²¡æœ‰ä»€ä¹ˆå¿…è¦ä¸ºå…¶å•ç‹¬å»ºç´¢å¼•ã€‚</p>
<p>æœ‰ä¸€ç§ä¸ç´¢å¼•é€‰æ‹©æ€§æœ‰å…³çš„ç´¢å¼•ä¼˜åŒ–ç­–ç•¥å«åšå‰ç¼€ç´¢å¼•ï¼Œå°±æ˜¯ç”¨åˆ—çš„å‰ç¼€ä»£æ›¿æ•´ä¸ªåˆ—ä½œä¸ºç´¢å¼•keyï¼Œå½“å‰ç¼€é•¿åº¦åˆé€‚æ—¶ï¼Œå¯ä»¥åšåˆ°æ—¢ä½¿å¾—å‰ç¼€ç´¢å¼•çš„é€‰æ‹©æ€§æ¥è¿‘å…¨åˆ—ç´¢å¼•ï¼ŒåŒæ—¶å› ä¸ºç´¢å¼•keyå˜çŸ­è€Œå‡å°‘äº†ç´¢å¼•æ–‡ä»¶çš„å¤§å°å’Œç»´æŠ¤å¼€é”€ã€‚ä¸‹é¢ä»¥employees.employeesè¡¨ä¸ºä¾‹ä»‹ç»å‰ç¼€ç´¢å¼•çš„é€‰æ‹©å’Œä½¿ç”¨ã€‚</p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°employeesè¡¨åªæœ‰ä¸€ä¸ªç´¢å¼•<code>&lt;emp_no&gt;</code>ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬æƒ³æŒ‰åå­—æœç´¢ä¸€ä¸ªäººï¼Œå°±åªèƒ½å…¨è¡¨æ‰«æäº†ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees.employees WHERE first_name=&apos;Eric&apos; AND last_name=&apos;Anido&apos;;</span><br><span class="line">+----+-------------+-----------+------+---------------+------+---------+------+--------+-------------+</span><br><span class="line">| id | select_type | table     | type | possible_keys | key  | key_len | ref  | rows   | Extra       |</span><br><span class="line">+----+-------------+-----------+------+---------------+------+---------+------+--------+-------------+</span><br><span class="line">|  1 | SIMPLE      | employees | ALL  | NULL          | NULL | NULL    | NULL | 300024 | Using where |</span><br><span class="line">+----+-------------+-----------+------+---------------+------+---------+------+--------+-------------+</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœé¢‘ç¹æŒ‰åå­—æœç´¢å‘˜å·¥ï¼Œè¿™æ ·æ˜¾ç„¶æ•ˆç‡å¾ˆä½ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è€ƒè™‘å»ºç´¢å¼•ã€‚æœ‰ä¸¤ç§é€‰æ‹©ï¼Œå»º<code>&lt;first_name&gt;</code>æˆ–<code>&lt;first_name, last_name&gt;</code>ï¼Œçœ‹ä¸‹ä¸¤ä¸ªç´¢å¼•çš„é€‰æ‹©æ€§ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">count</span>(<span class="keyword">DISTINCT</span>(first_name))/<span class="keyword">count</span>(*) <span class="keyword">AS</span> Selectivity <span class="keyword">FROM</span> employees.employees;</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">| Selectivity |</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">|      0.0042 |</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">count</span>(<span class="keyword">DISTINCT</span>(<span class="keyword">concat</span>(first_name, last_name)))/<span class="keyword">count</span>(*) <span class="keyword">AS</span> Selectivity <span class="keyword">FROM</span> employees.employees;</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">| Selectivity |</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">|      0.9313 |</span><br><span class="line">+<span class="comment">-------------+</span></span><br></pre></td></tr></table></figure></p>
<p><code>&lt;first_name&gt;</code>æ˜¾ç„¶é€‰æ‹©æ€§å¤ªä½ï¼Œ<code>&lt;first_name, last_name&gt;</code>é€‰æ‹©æ€§å¾ˆå¥½ï¼Œä½†æ˜¯first_nameå’Œlast_nameåŠ èµ·æ¥é•¿åº¦ä¸º30ï¼Œæœ‰æ²¡æœ‰å…¼é¡¾é•¿åº¦å’Œé€‰æ‹©æ€§çš„åŠæ³•ï¼Ÿå¯ä»¥è€ƒè™‘ç”¨first_nameå’Œlast_nameçš„å‰å‡ ä¸ªå­—ç¬¦å»ºç«‹ç´¢å¼•ï¼Œä¾‹å¦‚<code>&lt;first_name, left(last_name, 3)&gt;</code>ï¼Œçœ‹çœ‹å…¶é€‰æ‹©æ€§ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">count</span>(<span class="keyword">DISTINCT</span>(<span class="keyword">concat</span>(first_name, <span class="keyword">left</span>(last_name, <span class="number">3</span>))))/<span class="keyword">count</span>(*) <span class="keyword">AS</span> Selectivity <span class="keyword">FROM</span> employees.employees;</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">| Selectivity |</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">|      0.7879 |</span><br><span class="line">+<span class="comment">-------------+</span></span><br></pre></td></tr></table></figure></p>
<p>é€‰æ‹©æ€§è¿˜ä¸é”™ï¼Œä½†ç¦»0.9313è¿˜æ˜¯æœ‰ç‚¹è·ç¦»ï¼Œé‚£ä¹ˆæŠŠlast_nameå‰ç¼€åŠ åˆ°4ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">count</span>(<span class="keyword">DISTINCT</span>(<span class="keyword">concat</span>(first_name, <span class="keyword">left</span>(last_name, <span class="number">4</span>))))/<span class="keyword">count</span>(*) <span class="keyword">AS</span> Selectivity <span class="keyword">FROM</span> employees.employees;</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">| Selectivity |</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">|      0.9007 |</span><br><span class="line">+<span class="comment">-------------+</span></span><br></pre></td></tr></table></figure></p>
<p>è¿™æ—¶é€‰æ‹©æ€§å·²ç»å¾ˆç†æƒ³äº†ï¼Œè€Œè¿™ä¸ªç´¢å¼•çš„é•¿åº¦åªæœ‰18ï¼Œæ¯”<code>&lt;first_name, last_name&gt;</code>çŸ­äº†æ¥è¿‘ä¸€åŠï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªå‰ç¼€ç´¢å¼• å»ºä¸Šï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> employees.employees</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">INDEX</span> <span class="string">`first_name_last_name4`</span> (first_name, last_name(<span class="number">4</span>));</span><br></pre></td></tr></table></figure></p>
<p>æ­¤æ—¶å†æ‰§è¡Œä¸€éæŒ‰åå­—æŸ¥è¯¢ï¼Œæ¯”è¾ƒåˆ†æä¸€ä¸‹ä¸å»ºç´¢å¼•å‰çš„ç»“æœï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">PROFILES</span>;</span><br><span class="line">+<span class="comment">----------+------------+---------------------------------------------------------------------------------+</span></span><br><span class="line">| Query_ID | Duration   | Query                                                                           |</span><br><span class="line">+<span class="comment">----------+------------+---------------------------------------------------------------------------------+</span></span><br><span class="line">|       87 | 0.11941700 | <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees.employees <span class="keyword">WHERE</span> first_name=<span class="string">'Eric'</span> <span class="keyword">AND</span> last_name=<span class="string">'Anido'</span> |</span><br><span class="line">|       <span class="number">90</span> | <span class="number">0.00092400</span> | <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees.employees <span class="keyword">WHERE</span> first_name=<span class="string">'Eric'</span> <span class="keyword">AND</span> last_name=<span class="string">'Anido'</span> |</span><br><span class="line">+<span class="comment">----------+------------+---------------------------------------------------------------------------------+</span></span><br></pre></td></tr></table></figure></p>
<p>æ€§èƒ½çš„æå‡æ˜¯æ˜¾è‘—çš„ï¼ŒæŸ¥è¯¢é€Ÿåº¦æé«˜äº†120å¤šå€ã€‚</p>
<p>å‰ç¼€ç´¢å¼•å…¼é¡¾ç´¢å¼•å¤§å°å’ŒæŸ¥è¯¢é€Ÿåº¦ï¼Œä½†æ˜¯å…¶ç¼ºç‚¹æ˜¯ä¸èƒ½ç”¨äºORDER BYå’ŒGROUP BYæ“ä½œï¼Œä¹Ÿä¸èƒ½ç”¨äºCovering indexï¼ˆå³å½“ç´¢å¼•æœ¬èº«åŒ…å«æŸ¥è¯¢æ‰€éœ€å…¨éƒ¨æ•°æ®æ—¶ï¼Œä¸å†è®¿é—®æ•°æ®æ–‡ä»¶æœ¬èº«ï¼‰ã€‚</p>
<h2 id="InnoDBçš„ä¸»é”®é€‰æ‹©ä¸æ’å…¥ä¼˜åŒ–"><a href="#InnoDBçš„ä¸»é”®é€‰æ‹©ä¸æ’å…¥ä¼˜åŒ–" class="headerlink" title="InnoDBçš„ä¸»é”®é€‰æ‹©ä¸æ’å…¥ä¼˜åŒ–"></a>InnoDBçš„ä¸»é”®é€‰æ‹©ä¸æ’å…¥ä¼˜åŒ–</h2><p>åœ¨ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“æ—¶ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«çš„éœ€è¦ï¼Œè¯·æ°¸è¿œä½¿ç”¨ä¸€ä¸ªä¸ä¸šåŠ¡æ— å…³çš„è‡ªå¢å­—æ®µä½œä¸ºä¸»é”®ã€‚</p>
<p>ç»å¸¸çœ‹åˆ°æœ‰å¸–å­æˆ–åšå®¢è®¨è®ºä¸»é”®é€‰æ‹©é—®é¢˜ï¼Œæœ‰äººå»ºè®®ä½¿ç”¨ä¸šåŠ¡æ— å…³çš„è‡ªå¢ä¸»é”®ï¼Œæœ‰äººè§‰å¾—æ²¡æœ‰å¿…è¦ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨å¦‚å­¦å·æˆ–èº«ä»½è¯å·è¿™ç§å”¯ä¸€å­—æ®µä½œä¸ºä¸»é”®ã€‚ä¸è®ºæ”¯æŒå“ªç§è®ºç‚¹ï¼Œå¤§å¤šæ•°è®ºæ®éƒ½æ˜¯ä¸šåŠ¡å±‚é¢çš„ã€‚å¦‚æœä»æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–è§’åº¦çœ‹ï¼Œä½¿ç”¨InnoDBå¼•æ“è€Œä¸ä½¿ç”¨è‡ªå¢ä¸»é”®ç»å¯¹æ˜¯ä¸€ä¸ªç³Ÿç³•çš„ä¸»æ„ã€‚</p>
<p>ä¸Šæ–‡è®¨è®ºè¿‡InnoDBçš„ç´¢å¼•å®ç°ï¼ŒInnoDBä½¿ç”¨èšé›†ç´¢å¼•ï¼Œæ•°æ®è®°å½•æœ¬èº«è¢«å­˜äºä¸»ç´¢å¼•ï¼ˆä¸€é¢—B+Treeï¼‰çš„å¶å­èŠ‚ç‚¹ä¸Šã€‚è¿™å°±è¦æ±‚åŒä¸€ä¸ªå¶å­èŠ‚ç‚¹å†…ï¼ˆå¤§å°ä¸ºä¸€ä¸ªå†…å­˜é¡µæˆ–ç£ç›˜é¡µï¼‰çš„å„æ¡æ•°æ®è®°å½•æŒ‰ä¸»é”®é¡ºåºå­˜æ”¾ï¼Œå› æ­¤æ¯å½“æœ‰ä¸€æ¡æ–°çš„è®°å½•æ’å…¥æ—¶ï¼ŒMySQLä¼šæ ¹æ®å…¶ä¸»é”®å°†å…¶æ’å…¥é€‚å½“çš„èŠ‚ç‚¹å’Œä½ç½®ï¼Œå¦‚æœé¡µé¢è¾¾åˆ°è£…è½½å› å­ï¼ˆInnoDBé»˜è®¤ä¸º15/16ï¼‰ï¼Œåˆ™å¼€è¾Ÿä¸€ä¸ªæ–°çš„é¡µï¼ˆèŠ‚ç‚¹ï¼‰ã€‚</p>
<p>å¦‚æœè¡¨ä½¿ç”¨è‡ªå¢ä¸»é”®ï¼Œé‚£ä¹ˆæ¯æ¬¡æ’å…¥æ–°çš„è®°å½•ï¼Œè®°å½•å°±ä¼šé¡ºåºæ·»åŠ åˆ°å½“å‰ç´¢å¼•èŠ‚ç‚¹çš„åç»­ä½ç½®ï¼Œå½“ä¸€é¡µå†™æ»¡ï¼Œå°±ä¼šè‡ªåŠ¨å¼€è¾Ÿä¸€ä¸ªæ–°çš„é¡µã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><a href="http://idiotsky.top/images2/b-tree-13.png"><img src="http://idiotsky.top/images2/b-tree-13.png" alt=""></a></p>
<p>è¿™æ ·å°±ä¼šå½¢æˆä¸€ä¸ªç´§å‡‘çš„ç´¢å¼•ç»“æ„ï¼Œè¿‘ä¼¼é¡ºåºå¡«æ»¡ã€‚ç”±äºæ¯æ¬¡æ’å…¥æ—¶ä¹Ÿä¸éœ€è¦ç§»åŠ¨å·²æœ‰æ•°æ®ï¼Œå› æ­¤æ•ˆç‡å¾ˆé«˜ï¼Œä¹Ÿä¸ä¼šå¢åŠ å¾ˆå¤šå¼€é”€åœ¨ç»´æŠ¤ç´¢å¼•ä¸Šã€‚</p>
<p>å¦‚æœä½¿ç”¨éè‡ªå¢ä¸»é”®ï¼ˆå¦‚æœèº«ä»½è¯å·æˆ–å­¦å·ç­‰ï¼‰ï¼Œç”±äºæ¯æ¬¡æ’å…¥ä¸»é”®çš„å€¼è¿‘ä¼¼äºéšæœºï¼Œå› æ­¤æ¯æ¬¡æ–°çºªå½•éƒ½è¦è¢«æ’åˆ°ç°æœ‰ç´¢å¼•é¡µå¾—ä¸­é—´æŸä¸ªä½ç½®ï¼š</p>
<p><a href="http://idiotsky.top/images2/b-tree-14.png"><img src="http://idiotsky.top/images2/b-tree-14.png" alt=""></a></p>
<p>æ­¤æ—¶MySQLä¸å¾—ä¸ä¸ºäº†å°†æ–°è®°å½•æ’åˆ°åˆé€‚ä½ç½®è€Œç§»åŠ¨æ•°æ®ï¼Œç”šè‡³ç›®æ ‡é¡µé¢å¯èƒ½å·²ç»è¢«å›å†™åˆ°ç£ç›˜ä¸Šè€Œä»ç¼“å­˜ä¸­æ¸…æ‰ï¼Œæ­¤æ—¶åˆè¦ä»ç£ç›˜ä¸Šè¯»å›æ¥ï¼Œè¿™å¢åŠ äº†å¾ˆå¤šå¼€é”€ï¼ŒåŒæ—¶é¢‘ç¹çš„ç§»åŠ¨ã€åˆ†é¡µæ“ä½œé€ æˆäº†å¤§é‡çš„ç¢ç‰‡ï¼Œå¾—åˆ°äº†ä¸å¤Ÿç´§å‡‘çš„ç´¢å¼•ç»“æ„ï¼Œåç»­ä¸å¾—ä¸é€šè¿‡OPTIMIZE TABLEæ¥é‡å»ºè¡¨å¹¶ä¼˜åŒ–å¡«å……é¡µé¢ã€‚</p>
<p>å› æ­¤ï¼Œåªè¦å¯ä»¥ï¼Œè¯·å°½é‡åœ¨InnoDBä¸Šé‡‡ç”¨è‡ªå¢å­—æ®µåšä¸»é”®ã€‚</p>
<p>from <a href="http://blog.codinglabs.org/articles/theory-of-mysql-index.html" target="_blank" rel="noopener">http://blog.codinglabs.org/articles/theory-of-mysql-index.html</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;è½¬ä¸€ä¸ªä¸é”™çš„æ–‡ç« ï¼Œé‡Œé¢çš„å¹²è´§è¿˜æ˜¯å¾ˆå¤šçš„ï¼ŒåŒ…æ‹¬å±€éƒ¨æ€§ï¼Œç¡¬ç›˜ç­‰æ•°æ®åº“ä»¥å¤–çš„ä¸œè¥¿ï¼ŒMarkä¹‹ğŸ‘¿&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;æ•°æ®ç»“æ„åŠç®—æ³•åŸºç¡€&quot;&gt;&lt;a href=&quot;#æ•°æ®ç»“æ„åŠç®—æ³•åŸºç¡€&quot; class=&quot;headerlink&quot; title=&quot;æ•°æ®ç»“æ„åŠç®—æ³•åŸºç¡€&quot;&gt;&lt;/a&gt;æ•°æ®ç»“æ„åŠç®—æ³•åŸºç¡€&lt;/h1&gt;&lt;h2 id=&quot;ç´¢å¼•çš„æœ¬è´¨&quot;&gt;&lt;a href=&quot;#ç´¢å¼•çš„æœ¬è´¨&quot; class=&quot;headerlink&quot; title=&quot;ç´¢å¼•çš„æœ¬è´¨&quot;&gt;&lt;/a&gt;ç´¢å¼•çš„æœ¬è´¨&lt;/h2&gt;&lt;p&gt;MySQLå®˜æ–¹å¯¹ç´¢å¼•çš„å®šä¹‰ä¸ºï¼šç´¢å¼•ï¼ˆIndexï¼‰æ˜¯å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ã€‚æå–å¥å­ä¸»å¹²ï¼Œå°±å¯ä»¥å¾—åˆ°ç´¢å¼•çš„æœ¬è´¨ï¼šç´¢å¼•æ˜¯æ•°æ®ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“ï¼Œæ•°æ®åº“æŸ¥è¯¢æ˜¯æ•°æ®åº“çš„æœ€ä¸»è¦åŠŸèƒ½ä¹‹ä¸€ã€‚æˆ‘ä»¬éƒ½å¸Œæœ›æŸ¥è¯¢æ•°æ®çš„é€Ÿåº¦èƒ½å°½å¯èƒ½çš„å¿«ï¼Œå› æ­¤æ•°æ®åº“ç³»ç»Ÿçš„è®¾è®¡è€…ä¼šä»æŸ¥è¯¢ç®—æ³•çš„è§’åº¦è¿›è¡Œä¼˜åŒ–ã€‚æœ€åŸºæœ¬çš„æŸ¥è¯¢ç®—æ³•å½“ç„¶æ˜¯&lt;a href=&quot;http://en.wikipedia.org/wiki/Linear_search&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;é¡ºåºæŸ¥æ‰¾&lt;/a&gt;ï¼ˆlinear searchï¼‰ï¼Œè¿™ç§å¤æ‚åº¦ä¸ºO(n)çš„ç®—æ³•åœ¨æ•°æ®é‡å¾ˆå¤§æ—¶æ˜¾ç„¶æ˜¯ç³Ÿç³•çš„ï¼Œå¥½åœ¨è®¡ç®—æœºç§‘å­¦çš„å‘å±•æä¾›äº†å¾ˆå¤šæ›´ä¼˜ç§€çš„æŸ¥æ‰¾ç®—æ³•ï¼Œä¾‹å¦‚&lt;a href=&quot;http://en.wikipedia.org/wiki/Binary_search_algorithm&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;äºŒåˆ†æŸ¥æ‰¾&lt;/a&gt;ï¼ˆbinary searchï¼‰ã€&lt;a href=&quot;http://en.wikipedia.org/wiki/Binary_search_tree&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;äºŒå‰æ ‘æŸ¥æ‰¾æ ‘&lt;/a&gt;ï¼ˆbinary tree searchï¼‰ç­‰ã€‚å¦‚æœç¨å¾®åˆ†æä¸€ä¸‹ä¼šå‘ç°ï¼Œæ¯ç§æŸ¥æ‰¾ç®—æ³•éƒ½åªèƒ½åº”ç”¨äºç‰¹å®šçš„æ•°æ®ç»“æ„ä¹‹ä¸Šï¼Œä¾‹å¦‚äºŒåˆ†æŸ¥æ‰¾è¦æ±‚è¢«æ£€ç´¢æ•°æ®æœ‰åºï¼Œè€ŒäºŒå‰æ ‘æŸ¥æ‰¾åªèƒ½åº”ç”¨äº&lt;a href=&quot;http://en.wikipedia.org/wiki/Binary_search_tree&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;äºŒå‰æŸ¥æ‰¾æ ‘&lt;/a&gt;ä¸Šï¼Œä½†æ˜¯æ•°æ®æœ¬èº«çš„ç»„ç»‡ç»“æ„ä¸å¯èƒ½å®Œå…¨æ»¡è¶³å„ç§æ•°æ®ç»“æ„ï¼ˆä¾‹å¦‚ï¼Œç†è®ºä¸Šä¸å¯èƒ½åŒæ—¶å°†ä¸¤åˆ—éƒ½æŒ‰é¡ºåºè¿›è¡Œç»„ç»‡ï¼‰ï¼Œæ‰€ä»¥ï¼Œåœ¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤ç€æ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œè¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„ä¸Šå®ç°é«˜çº§æŸ¥æ‰¾ç®—æ³•ã€‚è¿™ç§æ•°æ®ç»“æ„ï¼Œå°±æ˜¯ç´¢å¼•ã€‚&lt;/p&gt;
&lt;p&gt;çœ‹ä¸€ä¸ªä¾‹å­ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://idiotsky.top/images2/b-tree-1.png&quot;&gt;&lt;img src=&quot;http://idiotsky.top/images2/b-tree-1.png&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="mysql" scheme="http://idiotsky.top/categories/mysql/"/>
    
    
      <category term="mysql" scheme="http://idiotsky.top/tags/mysql/"/>
    
      <category term="Bæ ‘" scheme="http://idiotsky.top/tags/B%E6%A0%91/"/>
    
      <category term="B+æ ‘" scheme="http://idiotsky.top/tags/B-%E6%A0%91/"/>
    
  </entry>
  
  <entry>
    <title>æ·±å…¥goä¹‹goroutine</title>
    <link href="http://idiotsky.top/2018/02/26/go-goroutine/"/>
    <id>http://idiotsky.top/2018/02/26/go-goroutine/</id>
    <published>2018-02-26T11:56:31.000Z</published>
    <updated>2018-07-17T11:39:16.525Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>goroutineæ˜¯goçš„æ ¸å¿ƒï¼Œæ²¡æœ‰goroutineï¼Œgoå°±æ²¡ä»€ä¹ˆæ„æ€äº†ğŸ‘¿ã€‚goroutineç¦»ä¸å¼€åç¨‹ï¼Œçº¿ç¨‹å’Œå¹¶å‘ï¼Œæ‰€ä»¥ä¸‹é¢ä¼šè¯´è¯´ç›¸å…³çš„å†…å®¹ã€‚</p>
</blockquote>
<h1 id="åç¨‹"><a href="#åç¨‹" class="headerlink" title="åç¨‹"></a>åç¨‹</h1><p>åç¨‹(coroutine)å…¶å®å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ–¹æ³•æˆ–è€…ä¾‹ç¨‹ï¼ˆroutineï¼‰ã€‚ä¸€èˆ¬æƒ…å†µä¸‹å‡½æ•°éƒ½æ˜¯åœ¨ç”¨æˆ·çº¿ç¨‹ä¸‹é¢æ‰§è¡Œçš„ï¼Œçº¿ç¨‹çš„è°ƒåº¦ç”±å†…æ ¸è§¦å‘ï¼Œæ‰€ä»¥å‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·çº¿ç¨‹æ²¡åŠæ³•æ§åˆ¶å‡½æ•°çš„æ‰§è¡Œè°ƒåº¦ï¼Œåªèƒ½ä»»ç”±å†…æ ¸ä¸»å®°ã€‚åç¨‹å°±ä¸åŒï¼Œå®ƒå¯ä»¥ç”±ç”¨æˆ·çº¿ç¨‹æ§åˆ¶è°ƒåº¦ï¼Œåœ¨ä»»ä½•æ—¶å€™è°ƒåº¦åç¨‹çš„æ‰§è¡Œã€‚å‡½æ•°åœ¨æ‰§è¡Œæ—¶ï¼Œå†…æ ¸è°ƒåº¦ä¼šé™·å…¥å†…æ ¸å¹¶ä¿å­˜å½“å‰çº¿ç¨‹çš„æ ˆå’Œä¸Šä¸‹æ–‡ï¼Œç„¶åæ¢å¤ä¹‹å‰è¢«åœæ­¢çº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œä»£ä»·æ¯”è¾ƒé«˜ã€‚è€Œåç¨‹çš„è°ƒåº¦ï¼Œä¸ç”¨é™·å…¥å†…æ ¸ï¼Œç”¨æˆ·çº¿ç¨‹åªæ˜¯ä¿å­˜å½“å‰åç¨‹çš„æ ˆå’Œä¸Šä¸‹æ–‡ï¼Œæ¢å¤ä¹‹å‰çš„è¢«åœæ­¢åç¨‹ç»§ç»­æ‰§è¡Œã€‚</p>
<p>è¿˜æœ‰ç§è¯´æ³•æ˜¯è¯´å‡½æ•°æ˜¯åç¨‹çš„ä¸€ç§ç‰¹ä¾‹ã€‚å› ä¸ºå‡½æ•°åªæœ‰åœ¨returnè¯­å¥æ‰ä¼šè¿”å›ï¼Œè€Œåç¨‹å¯ä»¥åœ¨ä»»ä½•æ—¶åˆ»è¿”å›ã€‚</p>
<p>åç¨‹å¾ˆæ—©å°±æå‡ºæ¥äº†ï¼Œå¯æ˜¯åœ¨ç°åœ¨æ‰ç«èµ·æ¥å§ï¼Œå¤§æ¦‚ç”±äºæŸç§è¯­è¨€ï¼ˆluaï¼‰çš„å¹¿æ³›ä½¿ç”¨å§ã€‚è€Œgoæ›´æ˜¯æŠŠåç¨‹ç”¨åˆ°åº•ï¼ŒåŸºæœ¬å¯ä»¥ç†è§£goçš„æ‰€æœ‰ä»£ç éƒ½è·‘åœ¨åç¨‹ä¸‹ï¼Œå¹¶ç”¨goroutineæ¥ä»£è¡¨å®ƒè‡ªå·±çš„åç¨‹ã€‚<br><a id="more"></a></p>
<h1 id="åç¨‹-vs-çº¿ç¨‹"><a href="#åç¨‹-vs-çº¿ç¨‹" class="headerlink" title="åç¨‹ vs çº¿ç¨‹"></a>åç¨‹ vs çº¿ç¨‹</h1><p>çº¿ç¨‹æ˜¯å¤„ç†å™¨è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œåœ¨CPUåˆ‡åˆ†æ—¶é—´ç‰‡çš„å‰æä¸‹ï¼Œæ“ä½œç³»ç»Ÿè¿›è¡ŒæŠ¢å å¼è°ƒåº¦ã€‚</p>
<p>åç¨‹ä¹Ÿå¯ä»¥ç†è§£ä¸ºä¸€ç§æ›´å°çš„è°ƒåº¦åŸºæœ¬å•ä½ã€‚å®ƒç”±è¿è¡Œåœ¨ç”¨æˆ·çº¿ç¨‹çš„è°ƒåº¦å™¨æ¥è°ƒåº¦ã€‚</p>
<table>
<thead>
<tr>
<th>åå­—</th>
<th>è°ƒåº¦</th>
<th>å†…å­˜æ¶ˆè€—</th>
<th>åˆ‡æ¢ä»£ä»·</th>
</tr>
</thead>
<tbody>
<tr>
<td>çº¿ç¨‹</td>
<td>å†…æ ¸è¿›è¡Œè°ƒåº¦</td>
<td>è¾ƒå¤§ï¼ˆ1MB~8MBï¼‰</td>
<td>é™·å…¥å†…æ ¸ï¼Œå„ç§å¯„å­˜å™¨çš„ä¿å­˜å’Œåˆ·æ–°</td>
</tr>
<tr>
<td>åç¨‹</td>
<td>ç”¨æˆ·çº¿ç¨‹è°ƒåº¦</td>
<td>è¾ƒå°ï¼ˆ2KB~5KBï¼‰</td>
<td>å„ç§å¯„å­˜å™¨çš„ä¿å­˜å’Œåˆ·æ–°</td>
</tr>
</tbody>
</table>
<p>ä»ä¸Šè¡¨å¯ä»¥å‘ç°ï¼Œçº¿ç¨‹æ¯”åç¨‹æ›´åŠ è€—è´¹å†…å­˜ï¼Œè€Œä¸”è¿˜ä¼šé€ æˆé™·å…¥å†…æ ¸ã€‚ä½†æ˜¯åç¨‹çš„åˆ‡æ¢å®Œå…¨äº¤ç»™ç”¨æˆ·çº¿ç¨‹æ¥è°ƒåº¦ï¼Œè¿™ä¸ªå¢åŠ äº†å®ç°çš„éš¾åº¦ã€‚è¿˜æœ‰å°±æ˜¯åç¨‹çš„è°ƒåº¦æ˜¯ç”±å•ä¸ªçº¿ç¨‹è°ƒåº¦ï¼Œå¦‚æœå¤„ç†å™¨æ˜¯å¤šæ ¸çš„è¯ï¼Œæ²¡åŠæ³•å……åˆ†åˆ©ç”¨ã€‚å¾ˆåº†å¹¸çš„æ˜¯ï¼Œgoå·²ç»å®ç°äº†å®ƒè‡ªå·±çš„åç¨‹è°ƒåº¦é€»è¾‘ï¼Œå¹¶ä¸”å……åˆ†åˆ©ç”¨å¤šçº¿ç¨‹æ¥è°ƒåº¦goroutineã€‚</p>
<h1 id="è¦åç¨‹ä½•ç”¨ï¼Ÿ"><a href="#è¦åç¨‹ä½•ç”¨ï¼Ÿ" class="headerlink" title="è¦åç¨‹ä½•ç”¨ï¼Ÿ"></a>è¦åç¨‹ä½•ç”¨ï¼Ÿ</h1><p>åç¨‹èƒ½ç«ä¹Ÿæ˜¯æœ‰å„ç§ç†ç”±çš„ã€‚</p>
<ul>
<li>é«˜å¹¶å‘å¤„ç†ã€‚åœ¨ç”¨æˆ·ç©ºé—´åˆ‡æ¢ä¸Šä¸‹æ–‡ï¼Œä¸ç”¨é™·å…¥å†…æ ¸æ¥åšçº¿ç¨‹åˆ‡æ¢ï¼Œé¿å…ä¸å¿…è¦ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„æ•°æ®æ‹·è´ã€‚</li>
<li>ç”¨åŒæ­¥çš„æ–¹å¼å»å†™å¼‚æ­¥ä»£ç ï¼Œé«˜æ•ˆç‡ä¸”ä¸å®¹æ˜“å‡ºé”™ (nodejsé‡Œé¢çš„asyn/awaitï¼Œå°±æ˜¯è¿™ç§)</li>
<li>éæŠ¢å å¼æ¨¡å‹ï¼Œèƒ½æ§åˆ¶ä¸­æ–­ä½ç½®ï¼Œä¸ä¼šå‘ç”Ÿç”±äºå¼ºè¡Œåˆ‡æ¢çº¿ç¨‹å¯¼è‡´çš„èµ„æºç«äº‰ã€‚(æç«¯æƒ…å†µä¸‹è¿˜æ˜¯ä¼šæ‰§è¡ŒæŠ¢å ï¼Œé˜²æ­¢åç¨‹é•¿æ—¶é—´å ç”¨CPUï¼Œä½†è¿™ä¸æ˜¯æ ‡å‡†æŠ¢å å¼æ¨¡å‹ï¼‰</li>
</ul>
<h1 id="å¹¶å‘-VS-å¹¶è¡Œ"><a href="#å¹¶å‘-VS-å¹¶è¡Œ" class="headerlink" title="å¹¶å‘ VS å¹¶è¡Œ"></a>å¹¶å‘ VS å¹¶è¡Œ</h1><p>å…ˆä¸Šå›¾ï¼š</p>
<p><a href="http://idiotsky.top/images2/go-goroutine.jpg"><img src="http://idiotsky.top/images2/go-goroutine.jpg" alt=""></a></p>
<ul>
<li>å¹¶å‘ï¼šå¤„ç†å™¨è¢«åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªæ—¶é—´åˆ†ç‰‡ï¼Œå¤šä¸ªçº¿ç¨‹åœ¨å¤„ç†å™¨ä¸­äº¤æ›¿æ‰§è¡Œï¼ŒåŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹è¢«æ‰§è¡Œï¼ˆé€šç”¨åœ°æ¥è¯´ï¼Œæ”¯æŒå¹¶å‘æ˜¯ä¸€ç§ç³»ç»Ÿæ‹¥æœ‰äº¤æ›¿æ‰§è¡Œå¤šä¸ªä»»åŠ¡çš„èƒ½åŠ›çš„è¡¨ç°ï¼‰</li>
<li>å¹¶è¡Œï¼šå¤šä¸ªçº¿ç¨‹ï¼Œåœ¨å¤šä¸ªå¤„ç†å™¨ä¸ŠåŒæ—¶æ‰§è¡Œã€‚</li>
</ul>
<blockquote>
<p>ä¸¾ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼ŒåŒ»é™¢è¯Šå®¤çœ‹ç—…ã€‚æŠŠç—…äººå½“åšçº¿ç¨‹ï¼ŒåŒ»ç”Ÿå½“åšå¤„ç†å™¨ã€‚</p>
</blockquote>
<blockquote>
<p>å¹¶å‘ï¼šåªæœ‰ä¸€ä¸ªåŒ»ç”Ÿï¼Œç—…äººAçœ‹äº†ä¸€ä¼šå„¿ï¼ŒåŒ»ç”Ÿè®©ä»–ä¸‹æ¥¼æ‹Xå…‰ï¼Œç„¶åç—…äººBè¿›æ¥çœ‹è¯Šï¼Œä¹‹ååŒ»ç”Ÿè®©Bå»åšå½©è¶…ï¼Œç„¶åAæ­¤æ—¶å›æ¥äº†ï¼ŒåŒ»ç”Ÿç»§ç»­ç»™Açœ‹ç—…ã€‚ï¼ˆä»»æ„ç¬é—´ï¼ŒåŒ»ç”Ÿåªåœ¨ç»™å…¶ä¸­ä¸€ä¸ªäººçœ‹ç—…ï¼‰</p>
</blockquote>
<blockquote>
<p>å¹¶è¡Œï¼š æœ‰3ä¸ªåŒ»ç”Ÿï¼Œ3ä¸ªç—…äººï¼Œä¸€ä¸ªç—…äººå¯¹åº”ä¸€ä¸ªåŒ»ç”Ÿï¼ŒåŒæ—¶é—®è¯Šã€‚</p>
</blockquote>
<p>å¦‚æœå¹¶å‘äº¤æ›¿çš„é€Ÿåº¦å¤Ÿå¿«ï¼Œå°±èƒ½è¾¾åˆ°â€œé€»è¾‘å¹¶è¡Œâ€çš„æ•ˆæœï¼Œå¯¹å¤–çœ‹èµ·æ¥å°±å’Œå¹¶è¡Œä¸€æ ·ã€‚</p>
<p>å¹¶å‘æ‰§è¡Œå¤šçº¿ç¨‹å¹¶ä¸èƒ½çœŸçš„å……åˆ†åˆ©ç”¨CPUï¼Œè¾¾åˆ°å‡å°‘å•ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶é—´çš„æ•ˆæœï¼Œè¿™ç§äº¤æ›¿æŒ‚èµ·æ‰§è¡Œçš„æ–¹å¼å´èƒ½å¤Ÿç»™ç”¨æˆ·å¸¦æ¥æ¯ä¸ªçº¿ç¨‹éƒ½åœ¨â€åŒæ—¶æ‰§è¡Œâ€œçš„æ„Ÿè§‰ï¼Œä»è€Œå¢å¼ºäº†æœåŠ¡çš„å“åº”é€Ÿåº¦ã€‚å°±åƒä¸Šé¢ä¾‹å­ä¸­çš„ç—…äººBä¸ç”¨ä¸€ç›´æ’é˜Ÿç­‰å¾… Aæ‹å®ŒXå…‰å¹¶ä¸”åŒ»ç”Ÿç¡®å®šAçš„ç—…çœ‹å®Œäº† æ‰èƒ½å»çœ‹ç—…ã€‚</p>
<h1 id="è°ƒåº¦"><a href="#è°ƒåº¦" class="headerlink" title="è°ƒåº¦"></a>è°ƒåº¦</h1><p>goroutineçš„è°ƒåº¦å¯ä»¥ç†è§£ä¸ºå¤šçº¿ç¨‹è°ƒåº¦åç¨‹ï¼ˆgoroutineï¼‰ã€‚æ‰€ä»¥è¿™é‡Œè°ƒåº¦ä¼šæœ‰ä¸‰ä¸ªè§’è‰²ï¼šçº¿ç¨‹ï¼Œè°ƒåº¦å™¨ï¼Œåç¨‹ã€‚å®ƒä»¬åˆ†åˆ«ç”¨M,P,Gæ¥è¡¨ç¤ºå§ã€‚</p>
<p><a href="http://idiotsky.top/images2/go-goroutine-1.jpg"><img src="http://idiotsky.top/images2/go-goroutine-1.jpg" alt=""></a></p>
<ul>
<li>Mä»£è¡¨ç³»ç»Ÿçº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯å‰é¢è¯´çš„æ™®é€šçº¿ç¨‹ã€‚</li>
<li>Pä»£è¡¨è°ƒåº¦å™¨ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒå½“åšå•çº¿ç¨‹çš„æœ¬åœ°è°ƒåº¦å™¨ã€‚ï¼ˆæ³¨ï¼šGOMAXPROCSç¯å¢ƒå˜é‡ä»£è¡¨çš„ä¸ªæ•°æ˜¯Pçš„ä¸ªæ•°ï¼Œæ¨èå€¼ä¸ºCPUçš„æ ¸å¿ƒæ•°ï¼‰</li>
<li>Gä»£è¡¨goroutineï¼Œå®ƒåŒ…å«äº†SPã€PCå¯„å­˜å™¨ï¼Œä»¥åŠå…¶å®ƒè°ƒåº¦ç›¸å…³ä¿¡æ¯ã€‚</li>
</ul>
<p><a href="http://idiotsky.top/images2/go-goroutine-2.jpg"><img src="http://idiotsky.top/images2/go-goroutine-2.jpg" alt=""></a></p>
<p>ä¸Šå›¾æ˜¯2ä¸ªMï¼ˆçº¿ç¨‹ï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªå¤„ç†å™¨ï¼ˆPï¼‰ï¼ŒMæ˜¯å¿…é¡»å…³è”Pæ‰èƒ½æ‰§è¡Œåç¨‹ï¼ˆGï¼‰çš„ã€‚å›¾ä¸­è“Gä»£è¡¨çš„æ˜¯è¿è¡Œä¸­çš„goroutineï¼Œç°Gè¡¨ç¤ºçš„å¾…æ‰§è¡Œçš„Goroutineï¼Œå¾…æ‰§è¡Œçš„Goroutineå­˜å‚¨åœ¨ P ä¸­çš„ä¸€ä¸ªå±€éƒ¨é˜Ÿåˆ—ä¸­ï¼Œæ­¤æ—¶Pæ‰§è¡ŒGoroutineä¼šè¿™ä¸ªé˜Ÿåˆ—ä¸­å–ï¼Œä¸ç”¨åŠ é”ï¼Œæé«˜äº†å¹¶å‘åº¦ã€‚ï¼ˆGo1.0ç‰ˆæœ¬ä¸­ï¼Œè°ƒåº¦å™¨å–Goroutineæ˜¯å»ä¸€ä¸ªå…¨å±€é˜Ÿåˆ—ä¸­å–ï¼Œéœ€è¦åŠ é”ï¼Œçº¿ç¨‹ä¼šç»å¸¸é˜»å¡ç­‰å¾…é”ï¼‰</p>
<p><strong>å¦‚æœå…¶ä¸­ä¸€ä¸ªGæ‰§è¡Œçš„æ—¶å€™ï¼Œå‘ç”Ÿäº†ç³»ç»Ÿè°ƒç”¨ï¼Œé˜»å¡äº†æ€ä¹ˆåŠï¼Ÿ</strong></p>
<p><a href="http://idiotsky.top/images2/go-goroutine-3.jpg"><img src="http://idiotsky.top/images2/go-goroutine-3.jpg" alt=""></a></p>
<p>ä¸Šå›¾å·¦è¾¹ï¼ŒG0ä¸­é™·å…¥ç³»ç»Ÿè°ƒç”¨ï¼Œå¯¼è‡´M0é˜»å¡ã€‚</p>
<p>æ­¤æ—¶ï¼ŒM0æ”¾å¼ƒäº†å®ƒçš„Pï¼Œè®©M1å»å¤„ç†Pä¸­å‰©ä¸‹çš„Goroutineã€‚è¿™é‡Œçš„M1å¯èƒ½æ˜¯åœ¨çº¿ç¨‹ç¼“å­˜ä¸­å–çš„ï¼Œæˆ–è€…è¿è¡Œä¸­ç”Ÿæˆçš„ã€‚</p>
<p>å½“M0ä»ç³»ç»Ÿè°ƒç”¨ä¸­æ¢å¤ï¼Œå®ƒä¼šå»åˆ«çš„Mä¸­æ‰¾Pæ¥æ‰§è¡ŒG0ï¼ˆæ¯”å¦‚è¯´åˆ«çš„Mé˜»å¡ä¸¢å‡ºäº†Pï¼‰ï¼Œå¦‚æœæ²¡æœ‰Pï¼Œé‚£ä¹ˆå®ƒä¼šæŠŠG0æ”¾åˆ°å…¨å±€é˜Ÿåˆ—ä¸­ï¼Œå¹¶ä¸”æŠŠå®ƒè‡ªå·±æ”¾åˆ°çº¿ç¨‹ç¼“å­˜ä¸­ã€‚</p>
<p>å…¨å±€é˜Ÿåˆ—ä¿å­˜äº†Goroutineï¼Œå½“å„è‡ªPä¸­çš„å±€éƒ¨é˜Ÿåˆ—æ²¡æœ‰Goroutineæ—¶ï¼ŒPä¼šåˆ°å…¨å±€é˜Ÿåˆ—ä¸­å–Goroutineã€‚å¹¶ä¸”å³ä½¿Pä¸­å±€éƒ¨é˜Ÿåˆ—æœ‰Goroutineï¼Œä¹Ÿä¼šå‘¨æœŸæ€§åœ°ä»å…¨å±€é˜Ÿåˆ—ä¸­å–Goroutineï¼Œä¿æŒå…¨å±€é˜Ÿåˆ—ä¸­çš„Goroutineèƒ½å¤Ÿå°½å¿«è¢«æ‰§è¡Œã€‚</p>
<p>å¤„ç†ç³»ç»Ÿè°ƒç”¨ï¼Œä¹Ÿæ˜¯goç¨‹åºä¸ºä»€ä¹ˆè·‘åœ¨å¤šçº¿ç¨‹ä¸Šçš„ä¸€ä¸ªåŸå› ï¼Œå³ä½¿GOMAXPROCSæ˜¯1ï¼Œä¹Ÿå¯èƒ½ä¼šæœ‰å¤šä¸ªå·¥ä½œçº¿ç¨‹ã€‚</p>
<p><strong>å½“På±€éƒ¨é˜Ÿåˆ—ä¸å‡è¡¡æ—¶æ€ä¹ˆå¤„ç†ï¼Ÿå¦‚æœæœ‰å¤šä¸ªPï¼Œå…¶ä¸­ä¸€ä¸ªPçš„å±€éƒ¨é˜Ÿåˆ—Goroutineæ‰§è¡Œå®Œäº†ã€‚</strong></p>
<p><a href="http://idiotsky.top/images2/go-goroutine-4.jpg"><img src="http://idiotsky.top/images2/go-goroutine-4.jpg" alt=""></a></p>
<p>å¦‚æœä¸€ä¸ªPå±€éƒ¨é˜Ÿåˆ—ä¸ºç©ºï¼Œé‚£ä¹ˆå®ƒå°è¯•ä»å…¨å±€é˜Ÿåˆ—ä¸­å–Goroutineï¼Œå¦‚å…¨å±€é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™ä¼šéšæœºä»å…¶å®ƒPçš„å±€éƒ¨é˜Ÿåˆ—ä¸­â€œæŒªâ€ä¸€åŠGoroutineåˆ°è‡ªå·±çš„é˜Ÿåˆ—å½“ä¸­ï¼Œ ä»¥ä¿è¯æ‰€æœ‰çš„Méƒ½æ˜¯æœ‰ä»»åŠ¡æ‰§è¡Œçš„ï¼Œé—´æ¥åšåˆ°è´Ÿè½½å‡è¡¡ï¼ˆå¯ä»¥å‚è€ƒgoæºç çš„findrunnable()å‡½æ•° ï¼‰</p>
<p><strong>æœ€åä¸€ä¸ªé—®é¢˜ï¼Œå…³äºæŠ¢å ã€‚å¦‚æœä¸€ä¸ªPè¿ç»­æ‰§è¡Œé•¿æ—¶é—´ï¼Œæ²¡æœ‰åˆ‡æ¢Gï¼Œæ€ä¹ˆå¤„ç†ï¼Ÿ</strong></p>
<p>è™½ç„¶åç¨‹å¼ºè°ƒçš„æ˜¯åä½œå¼è°ƒåº¦ï¼Œä½†æ˜¯å¦‚æœå…¶ä¸­ä¸€ä¸ªåç¨‹ä¸å¤Ÿâ€œåˆä½œâ€ï¼Œä¸ä¸»åŠ¨è®©å‡ºæ§åˆ¶æƒï¼Œé‚£ä¹ˆä¼šå¯¼è‡´è¿™ä¸ªçº¿ç¨‹ä¸€ç›´è¢«å ç”¨ï¼Œé™ä½å¹¶å‘åº¦ã€‚Goä¸­æœ‰ç›¸åº”çš„å¤„ç†æ–¹æ¡ˆ~</p>
<p>é¦–å…ˆï¼ŒGo åœ¨å¯åŠ¨æ—¶ä¼šåˆ›å»ºä¸€ä¸ªç³»ç»Ÿçº¿ç¨‹ï¼Œè¿™ä¸ªç³»ç»Ÿçº¿ç¨‹ä¼šç›‘æ§æ‰€æœ‰Goroutineçš„çŠ¶æ€ã€‚å®ƒæ˜¯é€šè¿‡éå†æ‰€æœ‰çš„Pï¼Œå¦‚æœPè¿ç»­é•¿æ—¶é—´æ‰§è¡Œï¼Œå°±ä¼šè¢«æŠ¢å ã€‚è¡¨ç°ä¸ºæ”¹På¯¹åº”å½“å‰æ‰§è¡Œçš„Gä¼šè¢«ç§»é™¤ï¼Œæ”¾ç½®åˆ°å…¨å±€Goroutineé˜Ÿåˆ—ä¸­ï¼Œç„¶åPå»ææ–°çš„Gæ¥æ‰§è¡Œã€‚</p>
<blockquote>
<p>to be continueâ€¦.</p>
</blockquote>
<p>ref<br><a href="https://zhuanlan.zhihu.com/p/32497435" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/32497435</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;goroutineæ˜¯goçš„æ ¸å¿ƒï¼Œæ²¡æœ‰goroutineï¼Œgoå°±æ²¡ä»€ä¹ˆæ„æ€äº†ğŸ‘¿ã€‚goroutineç¦»ä¸å¼€åç¨‹ï¼Œçº¿ç¨‹å’Œå¹¶å‘ï¼Œæ‰€ä»¥ä¸‹é¢ä¼šè¯´è¯´ç›¸å…³çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;åç¨‹&quot;&gt;&lt;a href=&quot;#åç¨‹&quot; class=&quot;headerlink&quot; title=&quot;åç¨‹&quot;&gt;&lt;/a&gt;åç¨‹&lt;/h1&gt;&lt;p&gt;åç¨‹(coroutine)å…¶å®å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ–¹æ³•æˆ–è€…ä¾‹ç¨‹ï¼ˆroutineï¼‰ã€‚ä¸€èˆ¬æƒ…å†µä¸‹å‡½æ•°éƒ½æ˜¯åœ¨ç”¨æˆ·çº¿ç¨‹ä¸‹é¢æ‰§è¡Œçš„ï¼Œçº¿ç¨‹çš„è°ƒåº¦ç”±å†…æ ¸è§¦å‘ï¼Œæ‰€ä»¥å‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·çº¿ç¨‹æ²¡åŠæ³•æ§åˆ¶å‡½æ•°çš„æ‰§è¡Œè°ƒåº¦ï¼Œåªèƒ½ä»»ç”±å†…æ ¸ä¸»å®°ã€‚åç¨‹å°±ä¸åŒï¼Œå®ƒå¯ä»¥ç”±ç”¨æˆ·çº¿ç¨‹æ§åˆ¶è°ƒåº¦ï¼Œåœ¨ä»»ä½•æ—¶å€™è°ƒåº¦åç¨‹çš„æ‰§è¡Œã€‚å‡½æ•°åœ¨æ‰§è¡Œæ—¶ï¼Œå†…æ ¸è°ƒåº¦ä¼šé™·å…¥å†…æ ¸å¹¶ä¿å­˜å½“å‰çº¿ç¨‹çš„æ ˆå’Œä¸Šä¸‹æ–‡ï¼Œç„¶åæ¢å¤ä¹‹å‰è¢«åœæ­¢çº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œä»£ä»·æ¯”è¾ƒé«˜ã€‚è€Œåç¨‹çš„è°ƒåº¦ï¼Œä¸ç”¨é™·å…¥å†…æ ¸ï¼Œç”¨æˆ·çº¿ç¨‹åªæ˜¯ä¿å­˜å½“å‰åç¨‹çš„æ ˆå’Œä¸Šä¸‹æ–‡ï¼Œæ¢å¤ä¹‹å‰çš„è¢«åœæ­¢åç¨‹ç»§ç»­æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰ç§è¯´æ³•æ˜¯è¯´å‡½æ•°æ˜¯åç¨‹çš„ä¸€ç§ç‰¹ä¾‹ã€‚å› ä¸ºå‡½æ•°åªæœ‰åœ¨returnè¯­å¥æ‰ä¼šè¿”å›ï¼Œè€Œåç¨‹å¯ä»¥åœ¨ä»»ä½•æ—¶åˆ»è¿”å›ã€‚&lt;/p&gt;
&lt;p&gt;åç¨‹å¾ˆæ—©å°±æå‡ºæ¥äº†ï¼Œå¯æ˜¯åœ¨ç°åœ¨æ‰ç«èµ·æ¥å§ï¼Œå¤§æ¦‚ç”±äºæŸç§è¯­è¨€ï¼ˆluaï¼‰çš„å¹¿æ³›ä½¿ç”¨å§ã€‚è€Œgoæ›´æ˜¯æŠŠåç¨‹ç”¨åˆ°åº•ï¼ŒåŸºæœ¬å¯ä»¥ç†è§£goçš„æ‰€æœ‰ä»£ç éƒ½è·‘åœ¨åç¨‹ä¸‹ï¼Œå¹¶ç”¨goroutineæ¥ä»£è¡¨å®ƒè‡ªå·±çš„åç¨‹ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="go" scheme="http://idiotsky.top/categories/go/"/>
    
    
      <category term="go" scheme="http://idiotsky.top/tags/go/"/>
    
      <category term="goroutine" scheme="http://idiotsky.top/tags/goroutine/"/>
    
      <category term="åç¨‹" scheme="http://idiotsky.top/tags/%E5%8D%8F%E7%A8%8B/"/>
    
      <category term="å¹¶å‘" scheme="http://idiotsky.top/tags/%E5%B9%B6%E5%8F%91/"/>
    
      <category term="å¹¶è¡Œ" scheme="http://idiotsky.top/tags/%E5%B9%B6%E8%A1%8C/"/>
    
      <category term="å¤šçº¿ç¨‹" scheme="http://idiotsky.top/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>linuxçš„12ä¸ªipå‘½ä»¤èŒƒä¾‹</title>
    <link href="http://idiotsky.top/2018/01/26/linux-ip/"/>
    <id>http://idiotsky.top/2018/01/26/linux-ip/</id>
    <published>2018-01-26T13:21:23.000Z</published>
    <updated>2018-07-17T11:39:16.534Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€å¹´åˆä¸€å¹´ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨ä½¿ç”¨ ifconfig å‘½ä»¤æ¥æ‰§è¡Œç½‘ç»œç›¸å…³çš„ä»»åŠ¡ï¼Œæ¯”å¦‚æ£€æŸ¥å’Œé…ç½®ç½‘å¡ä¿¡æ¯ã€‚ä½†æ˜¯ ifconfig å·²ç»ä¸å†è¢«ç»´æŠ¤ï¼Œå¹¶ä¸”åœ¨æœ€è¿‘ç‰ˆæœ¬çš„ Linux ä¸­è¢«åºŸé™¤äº†ï¼ ifconfig å‘½ä»¤å·²ç»è¢« ip å‘½ä»¤æ‰€æ›¿ä»£äº†ã€‚</p>
<p>ip å‘½ä»¤è·Ÿ ifconfig å‘½ä»¤æœ‰äº›ç±»ä¼¼ï¼Œä½†è¦å¼ºåŠ›çš„å¤šï¼Œå®ƒæœ‰è®¸å¤šæ–°åŠŸèƒ½ã€‚ip å‘½ä»¤å®Œæˆå¾ˆå¤š ifconfig å‘½ä»¤æ— æ³•å®Œæˆçš„ä»»åŠ¡ã€‚</p>
<h1 id="æ¡ˆä¾‹-1ï¼šæ£€æŸ¥ç½‘å¡ä¿¡æ¯"><a href="#æ¡ˆä¾‹-1ï¼šæ£€æŸ¥ç½‘å¡ä¿¡æ¯" class="headerlink" title="æ¡ˆä¾‹ 1ï¼šæ£€æŸ¥ç½‘å¡ä¿¡æ¯"></a>æ¡ˆä¾‹ 1ï¼šæ£€æŸ¥ç½‘å¡ä¿¡æ¯</h1><p>æ£€æŸ¥ç½‘å¡çš„è¯¸å¦‚ IP åœ°å€ï¼Œå­ç½‘ç­‰ç½‘ç»œä¿¡æ¯ï¼Œä½¿ç”¨ ip addr show å‘½ä»¤ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ip addr show</span></span><br><span class="line">æˆ–</span><br><span class="line"><span class="meta">$</span><span class="bash"> ip a s</span></span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>è¿™ä¼šæ˜¾ç¤ºç³»ç»Ÿä¸­æ‰€æœ‰å¯ç”¨ç½‘å¡çš„ç›¸å…³ç½‘ç»œä¿¡æ¯ï¼Œä¸è¿‡å¦‚æœä½ æƒ³æŸ¥çœ‹æŸå—ç½‘å¡çš„ä¿¡æ¯ï¼Œåˆ™å‘½ä»¤ä¸ºï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ip addr show enp0s3</span></span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œ enp0s3 æ˜¯ç½‘å¡çš„åå­—ã€‚</p>
<p><a href="http://idiotsky.top/images3/linux-ip-1.jpg"><img src="http://idiotsky.top/images3/linux-ip-1.jpg" alt=""></a> </p>
<h1 id="æ¡ˆä¾‹-2ï¼šå¯ç”¨-ç¦ç”¨ç½‘å¡"><a href="#æ¡ˆä¾‹-2ï¼šå¯ç”¨-ç¦ç”¨ç½‘å¡" class="headerlink" title="æ¡ˆä¾‹ 2ï¼šå¯ç”¨/ç¦ç”¨ç½‘å¡"></a>æ¡ˆä¾‹ 2ï¼šå¯ç”¨/ç¦ç”¨ç½‘å¡</h1><p>ä½¿ç”¨ ip å‘½ä»¤æ¥å¯ç”¨ä¸€ä¸ªè¢«ç¦ç”¨çš„ç½‘å¡ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ip link <span class="built_in">set</span> enp0s3 up</span></span><br></pre></td></tr></table></figure></p>
<p>è€Œè¦ç¦ç”¨ç½‘å¡åˆ™ä½¿ç”¨ down è§¦å‘å™¨ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ip link <span class="built_in">set</span> enp0s3 down</span></span><br></pre></td></tr></table></figure></p>
<h1 id="æ¡ˆä¾‹-3ï¼šä¸ºç½‘å¡åˆ†é…-IP-åœ°å€ä»¥åŠå…¶ä»–ç½‘ç»œä¿¡æ¯"><a href="#æ¡ˆä¾‹-3ï¼šä¸ºç½‘å¡åˆ†é…-IP-åœ°å€ä»¥åŠå…¶ä»–ç½‘ç»œä¿¡æ¯" class="headerlink" title="æ¡ˆä¾‹ 3ï¼šä¸ºç½‘å¡åˆ†é… IP åœ°å€ä»¥åŠå…¶ä»–ç½‘ç»œä¿¡æ¯"></a>æ¡ˆä¾‹ 3ï¼šä¸ºç½‘å¡åˆ†é… IP åœ°å€ä»¥åŠå…¶ä»–ç½‘ç»œä¿¡æ¯</h1><p>è¦ä¸ºç½‘å¡åˆ†é… IP åœ°å€ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‹é¢å‘½ä»¤ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ip addr add 192.168.0.50/255.255.255.0 dev enp0s3</span></span><br></pre></td></tr></table></figure></p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ ip å‘½ä»¤æ¥è®¾ç½®å¹¿æ’­åœ°å€ã€‚é»˜è®¤æ˜¯æ²¡æœ‰è®¾ç½®å¹¿æ’­åœ°å€çš„ï¼Œè®¾ç½®å¹¿æ’­åœ°å€çš„å‘½ä»¤ä¸ºï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo  ip addr add broadcast 192.168.0.255 dev enp0s3</span></span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤æ¥æ ¹æ® IP åœ°å€è®¾ç½®æ ‡å‡†çš„å¹¿æ’­åœ°å€ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">  sudo ip addr add 192.168.0.10/24 brd + dev enp0s3</span></span><br></pre></td></tr></table></figure></p>
<p>å¦‚ä¸Šé¢ä¾‹å­æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ brd ä»£æ›¿ broadcast æ¥è®¾ç½®å¹¿æ’­åœ°å€ã€‚</p>
<h1 id="æ¡ˆä¾‹-4ï¼šåˆ é™¤ç½‘å¡ä¸­é…ç½®çš„-IP-åœ°å€"><a href="#æ¡ˆä¾‹-4ï¼šåˆ é™¤ç½‘å¡ä¸­é…ç½®çš„-IP-åœ°å€" class="headerlink" title="æ¡ˆä¾‹ 4ï¼šåˆ é™¤ç½‘å¡ä¸­é…ç½®çš„ IP åœ°å€"></a>æ¡ˆä¾‹ 4ï¼šåˆ é™¤ç½‘å¡ä¸­é…ç½®çš„ IP åœ°å€</h1><p>è‹¥æƒ³ä»ç½‘å¡ä¸­åˆ æ‰æŸä¸ª IPï¼Œä½¿ç”¨å¦‚ä¸‹ ip å‘½ä»¤ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ip addr del 192.168.0.10/24 dev enp0s3</span></span><br></pre></td></tr></table></figure></p>
<h1 id="æ¡ˆä¾‹-5ï¼šä¸ºç½‘å¡æ·»åŠ åˆ«å"><a href="#æ¡ˆä¾‹-5ï¼šä¸ºç½‘å¡æ·»åŠ åˆ«å" class="headerlink" title="æ¡ˆä¾‹ 5ï¼šä¸ºç½‘å¡æ·»åŠ åˆ«å"></a>æ¡ˆä¾‹ 5ï¼šä¸ºç½‘å¡æ·»åŠ åˆ«å</h1><p>å‡è®¾ç½‘å¡åä¸º enp0s3,æ·»åŠ åˆ«åï¼Œå³ä¸ºç½‘å¡æ·»åŠ ä¸æ­¢ä¸€ä¸ª IPï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">  sudo ip addr add 192.168.0.20/24 dev enp0s3 label enp0s3:1</span></span><br></pre></td></tr></table></figure></p>
<p><a href="http://idiotsky.top/images3/linux-ip-2.jpg"><img src="http://idiotsky.top/images3/linux-ip-2.jpg" alt=""></a> </p>
<h1 id="æ¡ˆä¾‹-6ï¼šæ£€æŸ¥è·¯ç”±-é»˜è®¤ç½‘å…³çš„ä¿¡æ¯"><a href="#æ¡ˆä¾‹-6ï¼šæ£€æŸ¥è·¯ç”±-é»˜è®¤ç½‘å…³çš„ä¿¡æ¯" class="headerlink" title="æ¡ˆä¾‹ 6ï¼šæ£€æŸ¥è·¯ç”±/é»˜è®¤ç½‘å…³çš„ä¿¡æ¯"></a>æ¡ˆä¾‹ 6ï¼šæ£€æŸ¥è·¯ç”±/é»˜è®¤ç½‘å…³çš„ä¿¡æ¯</h1><p>æŸ¥çœ‹è·¯ç”±ä¿¡æ¯ä¼šç»™æˆ‘ä»¬æ˜¾ç¤ºæ•°æ®åŒ…åˆ°è¾¾ç›®çš„åœ°çš„è·¯ç”±è·¯å¾„ã€‚è¦æŸ¥çœ‹ç½‘ç»œè·¯ç”±ä¿¡æ¯ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">  ip route show</span></span><br></pre></td></tr></table></figure></p>
<p><a href="http://idiotsky.top/images3/linux-ip-3.jpg"><img src="http://idiotsky.top/images3/linux-ip-3.jpg" alt=""></a> </p>
<p>åœ¨ä¸Šé¢è¾“å‡ºç»“æœä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°æ‰€æœ‰ç½‘å¡ä¸Šæ•°æ®åŒ…çš„è·¯ç”±ä¿¡æ¯ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥è·å–ç‰¹å®š IP çš„è·¯ç”±ä¿¡æ¯ï¼Œæ–¹æ³•æ˜¯ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ip route get 192.168.0.1</span></span><br></pre></td></tr></table></figure></p>
<h1 id="æ¡ˆä¾‹-7ï¼šæ·»åŠ é™æ€è·¯ç”±"><a href="#æ¡ˆä¾‹-7ï¼šæ·»åŠ é™æ€è·¯ç”±" class="headerlink" title="æ¡ˆä¾‹ 7ï¼šæ·»åŠ é™æ€è·¯ç”±"></a>æ¡ˆä¾‹ 7ï¼šæ·»åŠ é™æ€è·¯ç”±</h1><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ IP æ¥ä¿®æ”¹æ•°æ®åŒ…çš„é»˜è®¤è·¯ç”±ã€‚æ–¹æ³•æ˜¯ä½¿ç”¨ ip route å‘½ä»¤ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ip route add default via 192.168.0.150/24</span></span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·æ‰€æœ‰çš„ç½‘ç»œæ•°æ®åŒ…é€šè¿‡ 192.168.0.150 æ¥è½¬å‘ï¼Œè€Œä¸æ˜¯ä»¥å‰çš„é»˜è®¤è·¯ç”±äº†ã€‚è‹¥è¦ä¿®æ”¹æŸä¸ªç½‘å¡çš„é»˜è®¤è·¯ç”±ï¼Œæ‰§è¡Œï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ip route add 172.16.32.32 via 192.168.0.150/24 dev enp0s3</span></span><br></pre></td></tr></table></figure></p>
<h1 id="æ¡ˆä¾‹-8ï¼šåˆ é™¤é»˜è®¤è·¯ç”±"><a href="#æ¡ˆä¾‹-8ï¼šåˆ é™¤é»˜è®¤è·¯ç”±" class="headerlink" title="æ¡ˆä¾‹ 8ï¼šåˆ é™¤é»˜è®¤è·¯ç”±"></a>æ¡ˆä¾‹ 8ï¼šåˆ é™¤é»˜è®¤è·¯ç”±</h1><p>è¦åˆ é™¤ä¹‹å‰è®¾ç½®çš„é»˜è®¤è·¯ç”±ï¼Œæ‰“å¼€ç»ˆç«¯ç„¶åè¿è¡Œï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">  sudo ip route del 192.168.0.150/24</span></span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„ï¼š ç”¨ä¸Šé¢æ–¹æ³•ä¿®æ”¹çš„é»˜è®¤è·¯ç”±åªæ˜¯ä¸´æ—¶æœ‰æ•ˆçš„ï¼Œåœ¨ç³»ç»Ÿé‡å¯åæ‰€æœ‰çš„æ”¹åŠ¨éƒ½ä¼šä¸¢å¤±ã€‚è¦æ°¸ä¹…ä¿®æ”¹è·¯ç”±ï¼Œéœ€è¦ä¿®æ”¹æˆ–åˆ›å»º route-enp0s3 æ–‡ä»¶ã€‚å°†ä¸‹é¢è¿™è¡ŒåŠ å…¥å…¶ä¸­ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">  sudo vi /etc/sysconfig/network-scripts/route-enp0s3</span></span><br><span class="line"></span><br><span class="line">172.16.32.32 via 192.168.0.150/24 dev enp0s3</span><br></pre></td></tr></table></figure></p>
<p>ä¿å­˜å¹¶é€€å‡ºè¯¥æ–‡ä»¶ã€‚</p>
<p>è‹¥ä½ ä½¿ç”¨çš„æ˜¯åŸºäº Ubuntu æˆ– debian çš„æ“ä½œç³»ç»Ÿï¼Œåˆ™è¯¥è¦ä¿®æ”¹çš„æ–‡ä»¶ä¸º /etc/network/interfacesï¼Œç„¶åæ·»åŠ  ip route add 172.16.32.32 via 192.168.0.150/24 dev enp0s3 è¿™è¡Œåˆ°æ–‡ä»¶æœ«å°¾ã€‚</p>
<h1 id="æ¡ˆä¾‹-9ï¼šæ£€æŸ¥æ‰€æœ‰çš„-ARP-è®°å½•"><a href="#æ¡ˆä¾‹-9ï¼šæ£€æŸ¥æ‰€æœ‰çš„-ARP-è®°å½•" class="headerlink" title="æ¡ˆä¾‹ 9ï¼šæ£€æŸ¥æ‰€æœ‰çš„ ARP è®°å½•"></a>æ¡ˆä¾‹ 9ï¼šæ£€æŸ¥æ‰€æœ‰çš„ ARP è®°å½•</h1><p>RPï¼Œæ˜¯åœ°å€è§£æåè®®Address Resolution Protocolçš„ç¼©å†™ï¼Œç”¨äºå°† IP åœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ï¼ˆä¹Ÿå°±æ˜¯ MAC åœ°å€ï¼‰ã€‚æ‰€æœ‰çš„ IP å’Œå…¶å¯¹åº”çš„ MAC æ˜ç»†éƒ½å­˜å‚¨åœ¨ä¸€å¼ è¡¨ä¸­ï¼Œè¿™å¼ è¡¨å«åš ARP ç¼“å­˜ã€‚</p>
<p>è¦æŸ¥çœ‹ ARP ç¼“å­˜ä¸­çš„è®°å½•ï¼Œå³è¿æ¥åˆ°å±€åŸŸç½‘ä¸­è®¾å¤‡çš„ MAC åœ°å€ï¼Œåˆ™ä½¿ç”¨å¦‚ä¸‹ ip å‘½ä»¤ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip neigh</span><br></pre></td></tr></table></figure></p>
<p><a href="http://idiotsky.top/images3/linux-ip-4.jpg"><img src="http://idiotsky.top/images3/linux-ip-4.jpg" alt=""></a> </p>
<h1 id="æ¡ˆä¾‹-10ï¼šä¿®æ”¹-ARP-è®°å½•"><a href="#æ¡ˆä¾‹-10ï¼šä¿®æ”¹-ARP-è®°å½•" class="headerlink" title="æ¡ˆä¾‹ 10ï¼šä¿®æ”¹ ARP è®°å½•"></a>æ¡ˆä¾‹ 10ï¼šä¿®æ”¹ ARP è®°å½•</h1><p>åˆ é™¤ ARP è®°å½•çš„å‘½ä»¤ä¸ºï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ip neigh del 192.168.0.106 dev enp0s3</span></span><br></pre></td></tr></table></figure></p>
<p>è‹¥æƒ³å¾€ ARP ç¼“å­˜ä¸­æ·»åŠ æ–°è®°å½•ï¼Œåˆ™å‘½ä»¤ä¸ºï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ip neigh add 192.168.0.150 lladdr 33:1g:75:37:r3:84 dev enp0s3 nud perm</span></span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œ nud çš„æ„æ€æ˜¯ â€œneghbour stateâ€ï¼ˆç½‘ç»œé‚»å±…çŠ¶æ€ï¼‰ï¼Œå®ƒçš„å€¼å¯ä»¥æ˜¯ï¼š</p>
<ul>
<li>perm - æ°¸ä¹…æœ‰æ•ˆå¹¶ä¸”åªèƒ½è¢«ç®¡ç†å‘˜åˆ é™¤</li>
<li>noarp - è®°å½•æœ‰æ•ˆï¼Œä½†åœ¨ç”Ÿå‘½å‘¨æœŸè¿‡æœŸåå°±å…è®¸è¢«åˆ é™¤äº†</li>
<li>stale - è®°å½•æœ‰æ•ˆï¼Œä½†å¯èƒ½å·²ç»è¿‡æœŸ</li>
<li>reachable - è®°å½•æœ‰æ•ˆï¼Œä½†è¶…æ—¶åå°±å¤±æ•ˆäº†</li>
</ul>
<h1 id="æ¡ˆä¾‹-11ï¼šæŸ¥çœ‹ç½‘ç»œç»Ÿè®¡ä¿¡æ¯"><a href="#æ¡ˆä¾‹-11ï¼šæŸ¥çœ‹ç½‘ç»œç»Ÿè®¡ä¿¡æ¯" class="headerlink" title="æ¡ˆä¾‹ 11ï¼šæŸ¥çœ‹ç½‘ç»œç»Ÿè®¡ä¿¡æ¯"></a>æ¡ˆä¾‹ 11ï¼šæŸ¥çœ‹ç½‘ç»œç»Ÿè®¡ä¿¡æ¯</h1><p>é€šè¿‡ ip å‘½ä»¤è¿˜èƒ½æŸ¥çœ‹ç½‘ç»œçš„ç»Ÿè®¡ä¿¡æ¯ï¼Œæ¯”å¦‚æ‰€æœ‰ç½‘å¡ä¸Šä¼ è¾“çš„å­—èŠ‚æ•°å’ŒæŠ¥æ–‡æ•°ï¼Œé”™è¯¯æˆ–ä¸¢å¼ƒçš„æŠ¥æ–‡æ•°ç­‰ã€‚ä½¿ç”¨ ip -s link å‘½ä»¤æ¥æŸ¥çœ‹ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ip -s link</span></span><br></pre></td></tr></table></figure></p>
<p><a href="http://idiotsky.top/images3/linux-ip-5.jpg"><img src="http://idiotsky.top/images3/linux-ip-5.jpg" alt=""></a> </p>
<h1 id="æ¡ˆä¾‹-12ï¼šè·å–å¸®åŠ©"><a href="#æ¡ˆä¾‹-12ï¼šè·å–å¸®åŠ©" class="headerlink" title="æ¡ˆä¾‹ 12ï¼šè·å–å¸®åŠ©"></a>æ¡ˆä¾‹ 12ï¼šè·å–å¸®åŠ©</h1><p>è‹¥ä½ æƒ³æŸ¥çœ‹æŸä¸ªä¸Šé¢ä¾‹å­ä¸­æ²¡æœ‰çš„é€‰é¡¹ï¼Œé‚£ä¹ˆä½ å¯ä»¥æŸ¥çœ‹å¸®åŠ©ã€‚äº‹å®ä¸Šå¯¹ä»»ä½•å‘½ä»¤ä½ éƒ½å¯ä»¥å¯»æ±‚å¸®åŠ©ã€‚è¦åˆ—å‡º ip å‘½ä»¤çš„æ‰€æœ‰å¯é€‰é¡¹ï¼Œæ‰§è¡Œï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ip <span class="built_in">help</span></span></span><br></pre></td></tr></table></figure></p>
<p>è®°ä½ï¼Œip å‘½ä»¤æ˜¯ä¸€ä¸ªå¯¹ Linux ç³»ç»Ÿç®¡ç†æ¥è¯´ç‰¹åˆ«é‡è¦çš„å‘½ä»¤ï¼Œå­¦ä¹ å¹¶æŒæ¡å®ƒèƒ½å¤Ÿè®©é…ç½®ç½‘ç»œå˜å¾—å®¹æ˜“ã€‚</p>
<p>ref <a href="https://zhuanlan.zhihu.com/p/32945498" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/32945498</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸€å¹´åˆä¸€å¹´ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨ä½¿ç”¨ ifconfig å‘½ä»¤æ¥æ‰§è¡Œç½‘ç»œç›¸å…³çš„ä»»åŠ¡ï¼Œæ¯”å¦‚æ£€æŸ¥å’Œé…ç½®ç½‘å¡ä¿¡æ¯ã€‚ä½†æ˜¯ ifconfig å·²ç»ä¸å†è¢«ç»´æŠ¤ï¼Œå¹¶ä¸”åœ¨æœ€è¿‘ç‰ˆæœ¬çš„ Linux ä¸­è¢«åºŸé™¤äº†ï¼ ifconfig å‘½ä»¤å·²ç»è¢« ip å‘½ä»¤æ‰€æ›¿ä»£äº†ã€‚&lt;/p&gt;
&lt;p&gt;ip å‘½ä»¤è·Ÿ ifconfig å‘½ä»¤æœ‰äº›ç±»ä¼¼ï¼Œä½†è¦å¼ºåŠ›çš„å¤šï¼Œå®ƒæœ‰è®¸å¤šæ–°åŠŸèƒ½ã€‚ip å‘½ä»¤å®Œæˆå¾ˆå¤š ifconfig å‘½ä»¤æ— æ³•å®Œæˆçš„ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;h1 id=&quot;æ¡ˆä¾‹-1ï¼šæ£€æŸ¥ç½‘å¡ä¿¡æ¯&quot;&gt;&lt;a href=&quot;#æ¡ˆä¾‹-1ï¼šæ£€æŸ¥ç½‘å¡ä¿¡æ¯&quot; class=&quot;headerlink&quot; title=&quot;æ¡ˆä¾‹ 1ï¼šæ£€æŸ¥ç½‘å¡ä¿¡æ¯&quot;&gt;&lt;/a&gt;æ¡ˆä¾‹ 1ï¼šæ£€æŸ¥ç½‘å¡ä¿¡æ¯&lt;/h1&gt;&lt;p&gt;æ£€æŸ¥ç½‘å¡çš„è¯¸å¦‚ IP åœ°å€ï¼Œå­ç½‘ç­‰ç½‘ç»œä¿¡æ¯ï¼Œä½¿ç”¨ ip addr show å‘½ä»¤ï¼š&lt;br&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; ip addr show&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;æˆ–&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; ip a s&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="linuxå‘½ä»¤" scheme="http://idiotsky.top/categories/linux%E5%91%BD%E4%BB%A4/"/>
    
    
      <category term="linux" scheme="http://idiotsky.top/tags/linux/"/>
    
      <category term="route" scheme="http://idiotsky.top/tags/route/"/>
    
      <category term="ip" scheme="http://idiotsky.top/tags/ip/"/>
    
      <category term="arp" scheme="http://idiotsky.top/tags/arp/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•å®ç°ä¸€ä¸ªmalloc</title>
    <link href="http://idiotsky.top/2018/01/16/c-malloc/"/>
    <id>http://idiotsky.top/2018/01/16/c-malloc/</id>
    <published>2018-01-16T15:46:42.000Z</published>
    <updated>2018-07-17T11:39:16.538Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>è¿™ç¯‡æ–‡ç« å¾ˆå¥½çš„æ€»ç»“äº†å¾ˆå¤šå…³äºå†…å­˜çš„çŸ¥è¯†ï¼Œè™½ç„¶å®ƒè®²çš„åªæ˜¯ä¸€ä¸ªcæ ‡å‡†åº“çš„ä¸€ä¸ªå‡½æ•°ï¼Œmarkä¹‹ğŸ‘¿</p>
</blockquote>
<p>ä»»ä½•ä¸€ä¸ªç”¨è¿‡æˆ–å­¦è¿‡Cçš„äººå¯¹mallocéƒ½ä¸ä¼šé™Œç”Ÿã€‚å¤§å®¶éƒ½çŸ¥é“mallocå¯ä»¥åˆ†é…ä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå¹¶ä¸”åœ¨ä¸å†ä½¿ç”¨æ—¶å¯ä»¥é€šè¿‡freeé‡Šæ”¾æ‰ã€‚ä½†æ˜¯ï¼Œè®¸å¤šç¨‹åºå‘˜å¯¹mallocèƒŒåçš„äº‹æƒ…å¹¶ä¸ç†Ÿæ‚‰ï¼Œè®¸å¤šäººç”šè‡³æŠŠmallocå½“åšæ“ä½œç³»ç»Ÿæ‰€æä¾›çš„ç³»ç»Ÿè°ƒç”¨æˆ–Cçš„å…³é”®å­—ã€‚å®é™…ä¸Šï¼Œmallocåªæ˜¯Cçš„æ ‡å‡†åº“ä¸­æä¾›çš„ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œè€Œä¸”å®ç°mallocçš„<strong>åŸºæœ¬</strong>æ€æƒ³å¹¶ä¸å¤æ‚ï¼Œä»»ä½•ä¸€ä¸ªå¯¹Cå’Œæ“ä½œç³»ç»Ÿæœ‰äº›è®¸äº†è§£çš„ç¨‹åºå‘˜éƒ½å¯ä»¥å¾ˆå®¹æ˜“ç†è§£ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« é€šè¿‡å®ç°ä¸€ä¸ªç®€å•çš„mallocæ¥æè¿°mallocèƒŒåçš„æœºåˆ¶ã€‚å½“ç„¶ä¸ç°æœ‰Cçš„æ ‡å‡†åº“å®ç°ï¼ˆä¾‹å¦‚glibcï¼‰ç›¸æ¯”ï¼Œæˆ‘ä»¬å®ç°çš„mallocå¹¶ä¸æ˜¯ç‰¹åˆ«é«˜æ•ˆï¼Œä½†æ˜¯è¿™ä¸ªå®ç°æ¯”ç›®å‰çœŸå®çš„mallocå®ç°è¦ç®€å•å¾ˆå¤šï¼Œå› æ­¤æ˜“äºç†è§£ã€‚é‡è¦çš„æ˜¯ï¼Œè¿™ä¸ªå®ç°å’ŒçœŸå®å®ç°åœ¨åŸºæœ¬åŸç†ä¸Šæ˜¯ä¸€è‡´çš„ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« å°†é¦–å…ˆä»‹ç»ä¸€äº›æ‰€éœ€çš„åŸºæœ¬çŸ¥è¯†ï¼Œå¦‚æ“ä½œç³»ç»Ÿå¯¹è¿›ç¨‹çš„å†…å­˜ç®¡ç†ä»¥åŠç›¸å…³çš„ç³»ç»Ÿè°ƒç”¨ï¼Œç„¶åé€æ­¥å®ç°ä¸€ä¸ªç®€å•çš„mallocã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œè¿™ç¯‡æ–‡ç« å°†åªè€ƒè™‘x86_64ä½“ç³»ç»“æ„ï¼Œæ“ä½œç³»ç»Ÿä¸ºLinuxã€‚</p>
<a id="more"></a>
<h1 id="ä»€ä¹ˆæ˜¯malloc"><a href="#ä»€ä¹ˆæ˜¯malloc" class="headerlink" title="ä»€ä¹ˆæ˜¯malloc"></a>ä»€ä¹ˆæ˜¯malloc</h1><p>åœ¨å®ç°mallocä¹‹å‰ï¼Œå…ˆè¦ç›¸å¯¹æ­£å¼åœ°å¯¹mallocåšä¸€ä¸ªå®šä¹‰ã€‚</p>
<p>æ ¹æ®æ ‡å‡†Cåº“å‡½æ•°çš„å®šä¹‰ï¼Œmallocå…·æœ‰å¦‚ä¸‹åŸå‹ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span>* <span class="title">malloc</span><span class="params">(<span class="keyword">size_t</span> size)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªå‡½æ•°è¦å®ç°çš„åŠŸèƒ½æ˜¯åœ¨ç³»ç»Ÿä¸­åˆ†é…ä¸€æ®µè¿ç»­çš„å¯ç”¨çš„å†…å­˜ï¼Œå…·ä½“æœ‰å¦‚ä¸‹è¦æ±‚ï¼š</p>
<ul>
<li>mallocåˆ†é…çš„å†…å­˜å¤§å°<strong>è‡³å°‘</strong>ä¸ºsizeå‚æ•°æ‰€æŒ‡å®šçš„å­—èŠ‚æ•°</li>
<li>mallocçš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€æ®µå¯ç”¨å†…å­˜çš„èµ·å§‹åœ°å€</li>
<li>å¤šæ¬¡è°ƒç”¨mallocæ‰€åˆ†é…çš„åœ°å€ä¸èƒ½æœ‰é‡å éƒ¨åˆ†ï¼Œé™¤éæŸæ¬¡mallocæ‰€åˆ†é…çš„åœ°å€è¢«é‡Šæ”¾æ‰</li>
<li>mallocåº”è¯¥å°½å¿«å®Œæˆå†…å­˜åˆ†é…å¹¶è¿”å›ï¼ˆä¸èƒ½ä½¿ç”¨<a href="http://en.wikipedia.org/wiki/NP-hard" target="_blank" rel="noopener">NP-hard</a>çš„å†…å­˜åˆ†é…ç®—æ³•ï¼‰</li>
<li>å®ç°mallocæ—¶åº”åŒæ—¶å®ç°å†…å­˜å¤§å°è°ƒæ•´å’Œå†…å­˜é‡Šæ”¾å‡½æ•°ï¼ˆå³reallocå’Œfreeï¼‰</li>
</ul>
<p>å¯¹äºmallocæ›´å¤šçš„è¯´æ˜å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­é”®å…¥ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">man malloc</span><br></pre></td></tr></table></figure></p>
<h1 id="é¢„å¤‡çŸ¥è¯†"><a href="#é¢„å¤‡çŸ¥è¯†" class="headerlink" title="é¢„å¤‡çŸ¥è¯†"></a>é¢„å¤‡çŸ¥è¯†</h1><p>åœ¨å®ç°mallocä¹‹å‰ï¼Œéœ€è¦å…ˆè§£é‡Šä¸€äº›Linuxç³»ç»Ÿå†…å­˜ç›¸å…³çš„çŸ¥è¯†ã€‚</p>
<h2 id="Linuxå†…å­˜ç®¡ç†"><a href="#Linuxå†…å­˜ç®¡ç†" class="headerlink" title="Linuxå†…å­˜ç®¡ç†"></a>Linuxå†…å­˜ç®¡ç†</h2><h3 id="è™šæ‹Ÿå†…å­˜åœ°å€ä¸ç‰©ç†å†…å­˜åœ°å€"><a href="#è™šæ‹Ÿå†…å­˜åœ°å€ä¸ç‰©ç†å†…å­˜åœ°å€" class="headerlink" title="è™šæ‹Ÿå†…å­˜åœ°å€ä¸ç‰©ç†å†…å­˜åœ°å€"></a>è™šæ‹Ÿå†…å­˜åœ°å€ä¸ç‰©ç†å†…å­˜åœ°å€</h3><p>ä¸ºäº†ç®€å•ï¼Œç°ä»£æ“ä½œç³»ç»Ÿåœ¨å¤„ç†å†…å­˜åœ°å€æ—¶ï¼Œæ™®éé‡‡ç”¨è™šæ‹Ÿå†…å­˜åœ°å€æŠ€æœ¯ã€‚å³åœ¨æ±‡ç¼–ç¨‹åºï¼ˆæˆ–æœºå™¨è¯­è¨€ï¼‰å±‚é¢ï¼Œå½“æ¶‰åŠå†…å­˜åœ°å€æ—¶ï¼Œéƒ½æ˜¯ä½¿ç”¨è™šæ‹Ÿå†…å­˜åœ°å€ã€‚é‡‡ç”¨è¿™ç§æŠ€æœ¯æ—¶ï¼Œæ¯ä¸ªè¿›ç¨‹ä»¿ä½›è‡ªå·±ç‹¬äº«ä¸€ç‰‡2^Nå­—èŠ‚çš„å†…å­˜ï¼Œå…¶ä¸­Næ˜¯æœºå™¨ä½æ•°ã€‚ä¾‹å¦‚åœ¨64ä½CPUå’Œ64ä½æ“ä½œç³»ç»Ÿä¸‹ï¼Œæ¯ä¸ªè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸º2^64Byte.</p>
<p>è¿™ç§è™šæ‹Ÿåœ°å€ç©ºé—´çš„ä½œç”¨ä¸»è¦æ˜¯ç®€åŒ–ç¨‹åºçš„ç¼–å†™åŠæ–¹ä¾¿æ“ä½œç³»ç»Ÿå¯¹è¿›ç¨‹é—´å†…å­˜çš„éš”ç¦»ç®¡ç†ï¼ŒçœŸå®ä¸­çš„è¿›ç¨‹ä¸å¤ªå¯èƒ½ï¼ˆä¹Ÿç”¨ä¸åˆ°ï¼‰å¦‚æ­¤å¤§çš„å†…å­˜ç©ºé—´ï¼Œå®é™…èƒ½ç”¨åˆ°çš„å†…å­˜å–å†³äºç‰©ç†å†…å­˜å¤§å°ã€‚</p>
<p>ç”±äºåœ¨æœºå™¨è¯­è¨€å±‚é¢éƒ½æ˜¯é‡‡ç”¨è™šæ‹Ÿåœ°å€ï¼Œå½“å®é™…çš„æœºå™¨ç ç¨‹åºæ¶‰åŠåˆ°å†…å­˜æ“ä½œæ—¶ï¼Œéœ€è¦æ ¹æ®å½“å‰è¿›ç¨‹è¿è¡Œçš„å®é™…ä¸Šä¸‹æ–‡å°†è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†å†…å­˜åœ°å€ï¼Œæ‰èƒ½å®ç°å¯¹çœŸå®å†…å­˜æ•°æ®çš„æ“ä½œã€‚è¿™ä¸ªè½¬æ¢ä¸€èˆ¬ç”±ä¸€ä¸ªå«<a href="http://en.wikipedia.org/wiki/Memory_management_unit" target="_blank" rel="noopener">MMU</a>ï¼ˆMemory Management Unitï¼‰çš„ç¡¬ä»¶å®Œæˆã€‚</p>
<h3 id="é¡µä¸åœ°å€æ„æˆ"><a href="#é¡µä¸åœ°å€æ„æˆ" class="headerlink" title="é¡µä¸åœ°å€æ„æˆ"></a>é¡µä¸åœ°å€æ„æˆ</h3><p>åœ¨ç°ä»£æ“ä½œç³»ç»Ÿä¸­ï¼Œä¸è®ºæ˜¯è™šæ‹Ÿå†…å­˜è¿˜æ˜¯ç‰©ç†å†…å­˜ï¼Œéƒ½ä¸æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½è¿›è¡Œç®¡ç†çš„ï¼Œè€Œæ˜¯ä»¥é¡µï¼ˆPageï¼‰ä¸ºå•ä½ã€‚ä¸€ä¸ªå†…å­˜é¡µæ˜¯ä¸€æ®µå›ºå®šå¤§å°çš„è¿ç»­å†…å­˜åœ°å€çš„æ€»ç§°ï¼Œå…·ä½“åˆ°Linuxä¸­ï¼Œå…¸å‹çš„å†…å­˜é¡µå¤§å°ä¸º4096Byteï¼ˆ4Kï¼‰ã€‚</p>
<p>æ‰€ä»¥å†…å­˜åœ°å€å¯ä»¥åˆ†ä¸ºé¡µå·å’Œé¡µå†…åç§»é‡ã€‚ä¸‹é¢ä»¥64ä½æœºå™¨ï¼Œ4Gç‰©ç†å†…å­˜ï¼Œ4Ké¡µå¤§å°ä¸ºä¾‹ï¼Œè™šæ‹Ÿå†…å­˜åœ°å€å’Œç‰©ç†å†…å­˜åœ°å€çš„ç»„æˆå¦‚ä¸‹ï¼š<br><a href="http://idiotsky.top/images2/c-malloc-1.png"><img src="http://idiotsky.top/images2/c-malloc-1.png" alt=""></a></p>
<p>ä¸Šé¢æ˜¯è™šæ‹Ÿå†…å­˜åœ°å€ï¼Œä¸‹é¢æ˜¯ç‰©ç†å†…å­˜åœ°å€ã€‚ç”±äºé¡µå¤§å°éƒ½æ˜¯4Kï¼Œæ‰€ä»¥é¡µå†…ä¾¿å®œéƒ½æ˜¯ç”¨ä½12ä½è¡¨ç¤ºï¼Œè€Œå‰©ä¸‹çš„é«˜åœ°å€è¡¨ç¤ºé¡µå·ã€‚</p>
<p>MMUæ˜ å°„å•ä½å¹¶ä¸æ˜¯å­—èŠ‚ï¼Œè€Œæ˜¯é¡µï¼Œè¿™ä¸ªæ˜ å°„é€šè¿‡æŸ¥ä¸€ä¸ªå¸¸é©»å†…å­˜çš„æ•°æ®ç»“æ„<a href="http://en.wikipedia.org/wiki/Page_table" target="_blank" rel="noopener">é¡µè¡¨</a>æ¥å®ç°ã€‚ç°åœ¨è®¡ç®—æœºå…·ä½“çš„å†…å­˜åœ°å€æ˜ å°„æ¯”è¾ƒå¤æ‚ï¼Œä¸ºäº†åŠ å¿«é€Ÿåº¦ä¼šå¼•å…¥ä¸€ç³»åˆ—ç¼“å­˜å’Œä¼˜åŒ–ï¼Œä¾‹å¦‚<a href="http://en.wikipedia.org/wiki/Translation_lookaside_buffer" target="_blank" rel="noopener">TLB</a>ç­‰æœºåˆ¶ã€‚ä¸‹é¢ç»™å‡ºä¸€ä¸ªç»è¿‡ç®€åŒ–çš„å†…å­˜åœ°å€ç¿»è¯‘ç¤ºæ„å›¾ï¼Œè™½ç„¶ç»è¿‡äº†ç®€åŒ–ï¼Œä½†æ˜¯åŸºæœ¬åŸç†ä¸ç°ä»£è®¡ç®—æœºçœŸå®çš„æƒ…å†µçš„ä¸€è‡´çš„ã€‚<br><a href="http://idiotsky.top/images2/c-malloc-2.png"><img src="http://idiotsky.top/images2/c-malloc-2.png" alt=""></a></p>
<h3 id="å†…å­˜é¡µä¸ç£ç›˜é¡µ"><a href="#å†…å­˜é¡µä¸ç£ç›˜é¡µ" class="headerlink" title="å†…å­˜é¡µä¸ç£ç›˜é¡µ"></a>å†…å­˜é¡µä¸ç£ç›˜é¡µ</h3><p>æˆ‘ä»¬çŸ¥é“ä¸€èˆ¬å°†å†…å­˜çœ‹åšç£ç›˜çš„çš„ç¼“å­˜ï¼Œæœ‰æ—¶MMUåœ¨å·¥ä½œæ—¶ï¼Œä¼šå‘ç°é¡µè¡¨è¡¨æ˜æŸä¸ªå†…å­˜é¡µä¸åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œæ­¤æ—¶ä¼šè§¦å‘ä¸€ä¸ªç¼ºé¡µå¼‚å¸¸ï¼ˆPage Faultï¼‰ï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šåˆ°ç£ç›˜ä¸­ç›¸åº”çš„åœ°æ–¹å°†ç£ç›˜é¡µè½½å…¥åˆ°å†…å­˜ä¸­ï¼Œç„¶åé‡æ–°æ‰§è¡Œç”±äºç¼ºé¡µè€Œå¤±è´¥çš„æœºå™¨æŒ‡ä»¤ã€‚å…³äºè¿™éƒ¨åˆ†ï¼Œå› ä¸ºå¯ä»¥çœ‹åšå¯¹mallocå®ç°æ˜¯é€æ˜çš„ï¼Œæ‰€ä»¥ä¸å†è¯¦ç»†è®²è¿°ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å‚è€ƒã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹ç›¸å…³ç« èŠ‚ã€‚<br><a href="http://idiotsky.top/images2/c-malloc-3.png"><img src="http://idiotsky.top/images2/c-malloc-3.png" alt=""></a></p>
<h2 id="Linuxè¿›ç¨‹çº§å†…å­˜ç®¡ç†"><a href="#Linuxè¿›ç¨‹çº§å†…å­˜ç®¡ç†" class="headerlink" title="Linuxè¿›ç¨‹çº§å†…å­˜ç®¡ç†"></a>Linuxè¿›ç¨‹çº§å†…å­˜ç®¡ç†</h2><h3 id="å†…å­˜æ’å¸ƒ"><a href="#å†…å­˜æ’å¸ƒ" class="headerlink" title="å†…å­˜æ’å¸ƒ"></a>å†…å­˜æ’å¸ƒ</h3><p>æ˜ç™½äº†è™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜çš„å…³ç³»åŠç›¸å…³çš„æ˜ å°„æœºåˆ¶ï¼Œä¸‹é¢çœ‹ä¸€ä¸‹å…·ä½“åœ¨ä¸€ä¸ªè¿›ç¨‹å†…æ˜¯å¦‚ä½•æ’å¸ƒå†…å­˜çš„ã€‚</p>
<p>ä»¥Linux 64ä½ç³»ç»Ÿä¸ºä¾‹ã€‚ç†è®ºä¸Šï¼Œ64bitå†…å­˜åœ°å€å¯ç”¨ç©ºé—´ä¸º0x0000000000000000 ~ 0xFFFFFFFFFFFFFFFFï¼Œè¿™æ˜¯ä¸ªç›¸å½“åºå¤§çš„ç©ºé—´ï¼ŒLinuxå®é™…ä¸Šåªç”¨äº†å…¶ä¸­ä¸€å°éƒ¨åˆ†ï¼ˆ256Tï¼‰ã€‚</p>
<p>æ ¹æ®<a href="https://www.kernel.org/doc/Documentation/x86/x86_64/mm.txt" target="_blank" rel="noopener">Linuxå†…æ ¸ç›¸å…³æ–‡æ¡£</a>æè¿°ï¼ŒLinux64ä½æ“ä½œç³»ç»Ÿä»…ä½¿ç”¨ä½47ä½ï¼Œé«˜17ä½åšæ‰©å±•ï¼ˆåªèƒ½æ˜¯å…¨0æˆ–å…¨1ï¼‰ã€‚æ‰€ä»¥ï¼Œå®é™…ç”¨åˆ°çš„åœ°å€ä¸ºç©ºé—´ä¸º0x0000000000000000 ~ 0x00007FFFFFFFFFFFå’Œ0xFFFF800000000000 ~ 0xFFFFFFFFFFFFFFFFï¼Œå…¶ä¸­å‰é¢ä¸ºç”¨æˆ·ç©ºé—´ï¼ˆUser Spaceï¼‰ï¼Œåè€…ä¸ºå†…æ ¸ç©ºé—´ï¼ˆKernel Spaceï¼‰ã€‚å›¾ç¤ºå¦‚ä¸‹ï¼š<br><a href="http://idiotsky.top/images2/c-malloc-4.png"><img src="http://idiotsky.top/images2/c-malloc-4.png" alt=""></a></p>
<p>å¯¹ç”¨æˆ·æ¥è¯´ï¼Œä¸»è¦å…³æ³¨çš„ç©ºé—´æ˜¯User Spaceã€‚å°†User Spaceæ”¾å¤§åï¼Œå¯ä»¥çœ‹åˆ°é‡Œé¢ä¸»è¦åˆ†ä¸ºå¦‚ä¸‹å‡ æ®µï¼š</p>
<ul>
<li>Codeï¼šè¿™æ˜¯æ•´ä¸ªç”¨æˆ·ç©ºé—´çš„æœ€ä½åœ°å€éƒ¨åˆ†ï¼Œå­˜æ”¾çš„æ˜¯æŒ‡ä»¤ï¼ˆä¹Ÿå°±æ˜¯ç¨‹åºæ‰€ç¼–è¯‘æˆçš„å¯æ‰§è¡Œæœºå™¨ç ï¼‰</li>
<li>Dataï¼šè¿™é‡Œå­˜æ”¾çš„æ˜¯åˆå§‹åŒ–è¿‡çš„å…¨å±€å˜é‡</li>
<li>BSSï¼šè¿™é‡Œå­˜æ”¾çš„æ˜¯æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡</li>
<li>Heapï¼šå †ï¼Œè¿™æ˜¯æˆ‘ä»¬æœ¬æ–‡é‡ç‚¹å…³æ³¨çš„åœ°æ–¹ï¼Œå †è‡ªä½åœ°å€å‘é«˜åœ°å€å¢é•¿ï¼Œåé¢è¦è®²åˆ°çš„brkç›¸å…³çš„ç³»ç»Ÿè°ƒç”¨å°±æ˜¯ä»è¿™é‡Œåˆ†é…å†…å­˜</li>
<li>Mapping Areaï¼šè¿™é‡Œæ˜¯ä¸mmapç³»ç»Ÿè°ƒç”¨ç›¸å…³çš„åŒºåŸŸã€‚å¤§å¤šæ•°å®é™…çš„mallocå®ç°ä¼šè€ƒè™‘é€šè¿‡mmapåˆ†é…è¾ƒå¤§å—çš„å†…å­˜åŒºåŸŸï¼Œæœ¬æ–‡ä¸è®¨è®ºè¿™ç§æƒ…å†µã€‚è¿™ä¸ªåŒºåŸŸè‡ªé«˜åœ°å€å‘ä½åœ°å€å¢é•¿</li>
<li>Stackï¼šè¿™æ˜¯æ ˆåŒºåŸŸï¼Œè‡ªé«˜åœ°å€å‘ä½åœ°å€å¢é•¿</li>
</ul>
<p>ä¸‹é¢æˆ‘ä»¬ä¸»è¦å…³æ³¨HeapåŒºåŸŸçš„æ“ä½œã€‚å¯¹æ•´ä¸ªLinuxå†…å­˜æ’å¸ƒæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å‚è€ƒå…¶å®ƒèµ„æ–™ã€‚</p>
<h3 id="Heapå†…å­˜æ¨¡å‹"><a href="#Heapå†…å­˜æ¨¡å‹" class="headerlink" title="Heapå†…å­˜æ¨¡å‹"></a>Heapå†…å­˜æ¨¡å‹</h3><p>ä¸€èˆ¬æ¥è¯´ï¼Œmallocæ‰€ç”³è¯·çš„å†…å­˜ä¸»è¦ä»HeapåŒºåŸŸåˆ†é…ï¼ˆæœ¬æ–‡ä¸è€ƒè™‘é€šè¿‡mmapç”³è¯·å¤§å—å†…å­˜çš„æƒ…å†µï¼‰ã€‚</p>
<p>ç”±ä¸Šæ–‡çŸ¥é“ï¼Œè¿›ç¨‹æ‰€é¢å¯¹çš„è™šæ‹Ÿå†…å­˜åœ°å€ç©ºé—´ï¼Œåªæœ‰æŒ‰é¡µæ˜ å°„åˆ°ç‰©ç†å†…å­˜åœ°å€ï¼Œæ‰èƒ½çœŸæ­£ä½¿ç”¨ã€‚å—ç‰©ç†å­˜å‚¨å®¹é‡é™åˆ¶ï¼Œæ•´ä¸ªå †è™šæ‹Ÿå†…å­˜ç©ºé—´ä¸å¯èƒ½å…¨éƒ¨æ˜ å°„åˆ°å®é™…çš„ç‰©ç†å†…å­˜ã€‚Linuxå¯¹å †çš„ç®¡ç†ç¤ºæ„å¦‚ä¸‹ï¼š<br><a href="http://idiotsky.top/images2/c-malloc-5.png"><img src="http://idiotsky.top/images2/c-malloc-5.png" alt=""></a></p>
<p>Linuxç»´æŠ¤ä¸€ä¸ªbreakæŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å †ç©ºé—´çš„æŸä¸ªåœ°å€ã€‚ä»å †èµ·å§‹åœ°å€åˆ°breakä¹‹é—´çš„åœ°å€ç©ºé—´ä¸ºæ˜ å°„å¥½çš„ï¼Œå¯ä»¥ä¾›è¿›ç¨‹è®¿é—®ï¼›è€Œä»breakå¾€ä¸Šï¼Œæ˜¯æœªæ˜ å°„çš„åœ°å€ç©ºé—´ï¼Œå¦‚æœè®¿é—®è¿™æ®µç©ºé—´åˆ™ç¨‹åºä¼šæŠ¥é”™ã€‚</p>
<h3 id="brkä¸sbrk"><a href="#brkä¸sbrk" class="headerlink" title="brkä¸sbrk"></a>brkä¸sbrk</h3><p>ç”±ä¸Šæ–‡çŸ¥é“ï¼Œè¦å¢åŠ ä¸€ä¸ªè¿›ç¨‹å®é™…çš„å¯ç”¨å †å¤§å°ï¼Œå°±éœ€è¦å°†breakæŒ‡é’ˆå‘é«˜åœ°å€ç§»åŠ¨ã€‚Linuxé€šè¿‡brkå’Œsbrkç³»ç»Ÿè°ƒç”¨æ“ä½œbreakæŒ‡é’ˆã€‚ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨çš„åŸå‹å¦‚ä¸‹ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">brk</span><span class="params">(<span class="keyword">void</span> *addr)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">sbrk</span><span class="params">(<span class="keyword">intptr_t</span> increment)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>brkå°†breakæŒ‡é’ˆç›´æ¥è®¾ç½®ä¸ºæŸä¸ªåœ°å€ï¼Œè€Œsbrkå°†breakä»å½“å‰ä½ç½®ç§»åŠ¨incrementæ‰€æŒ‡å®šçš„å¢é‡ã€‚brkåœ¨æ‰§è¡ŒæˆåŠŸæ—¶è¿”å›0ï¼Œå¦åˆ™è¿”å›-1å¹¶è®¾ç½®errnoä¸ºENOMEMï¼›sbrkæˆåŠŸæ—¶è¿”å›breakç§»åŠ¨ä¹‹å‰æ‰€æŒ‡å‘çš„åœ°å€ï¼Œå¦åˆ™è¿”å›(void *)-1ã€‚</p>
<p>ä¸€ä¸ªå°æŠ€å·§æ˜¯ï¼Œå¦‚æœå°†incrementè®¾ç½®ä¸º0ï¼Œåˆ™å¯ä»¥è·å¾—å½“å‰breakçš„åœ°å€ã€‚</p>
<p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºLinuxæ˜¯æŒ‰é¡µè¿›è¡Œå†…å­˜æ˜ å°„çš„ï¼Œæ‰€ä»¥å¦‚æœbreakè¢«è®¾ç½®ä¸ºæ²¡æœ‰æŒ‰é¡µå¤§å°å¯¹é½ï¼Œåˆ™ç³»ç»Ÿå®é™…ä¸Šä¼šåœ¨æœ€åæ˜ å°„ä¸€ä¸ªå®Œæ•´çš„é¡µï¼Œä»è€Œå®é™…å·²æ˜ å°„çš„å†…å­˜ç©ºé—´æ¯”breakæŒ‡å‘çš„åœ°æ–¹è¦å¤§ä¸€äº›ã€‚ä½†æ˜¯ä½¿ç”¨breakä¹‹åçš„åœ°å€æ˜¯å¾ˆå±é™©çš„ï¼ˆå°½ç®¡ä¹Ÿè®¸breakä¹‹åç¡®å®æœ‰ä¸€å°å—å¯ç”¨å†…å­˜åœ°å€ï¼‰ã€‚</p>
<h3 id="èµ„æºé™åˆ¶ä¸rlimit"><a href="#èµ„æºé™åˆ¶ä¸rlimit" class="headerlink" title="èµ„æºé™åˆ¶ä¸rlimit"></a>èµ„æºé™åˆ¶ä¸rlimit</h3><p>ç³»ç»Ÿå¯¹æ¯ä¸€ä¸ªè¿›ç¨‹æ‰€åˆ†é…çš„èµ„æºä¸æ˜¯æ— é™çš„ï¼ŒåŒ…æ‹¬å¯æ˜ å°„çš„å†…å­˜ç©ºé—´ï¼Œå› æ­¤æ¯ä¸ªè¿›ç¨‹æœ‰ä¸€ä¸ªrlimitè¡¨ç¤ºå½“å‰è¿›ç¨‹å¯ç”¨çš„èµ„æºä¸Šé™ã€‚è¿™ä¸ªé™åˆ¶å¯ä»¥é€šè¿‡getrlimitç³»ç»Ÿè°ƒç”¨å¾—åˆ°ï¼Œä¸‹é¢ä»£ç è·å–å½“å‰è¿›ç¨‹è™šæ‹Ÿå†…å­˜ç©ºé—´çš„rlimitï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rlimit</span> *<span class="title">limit</span> = (<span class="title">struct</span> <span class="title">rlimit</span> *)<span class="title">malloc</span>(<span class="title">sizeof</span>(<span class="title">struct</span> <span class="title">rlimit</span>));</span></span><br><span class="line">    getrlimit(RLIMIT_AS, limit);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"soft limit: %ld, hard limit: %ld\n"</span>, limit-&gt;rlim_cur, limit-&gt;rlim_max);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å…¶ä¸­rlimitæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rlimit</span> &#123;</span></span><br><span class="line">    <span class="keyword">rlim_t</span> rlim_cur;  <span class="comment">/* Soft limit */</span></span><br><span class="line">    <span class="keyword">rlim_t</span> rlim_max;  <span class="comment">/* Hard limit (ceiling for rlim_cur) */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>æ¯ç§èµ„æºæœ‰è½¯é™åˆ¶å’Œç¡¬é™åˆ¶ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡setrlimitå¯¹rlimitè¿›è¡Œæœ‰æ¡ä»¶è®¾ç½®ã€‚å…¶ä¸­ç¡¬é™åˆ¶ä½œä¸ºè½¯é™åˆ¶çš„ä¸Šé™ï¼Œéç‰¹æƒè¿›ç¨‹åªèƒ½è®¾ç½®è½¯é™åˆ¶ï¼Œä¸”ä¸èƒ½è¶…è¿‡ç¡¬é™åˆ¶ã€‚</p>
<h1 id="å®ç°malloc"><a href="#å®ç°malloc" class="headerlink" title="å®ç°malloc"></a>å®ç°malloc</h1><h2 id="ç©å…·å®ç°"><a href="#ç©å…·å®ç°" class="headerlink" title="ç©å…·å®ç°"></a>ç©å…·å®ç°</h2><p>åœ¨æ­£å¼å¼€å§‹è®¨è®ºmallocçš„å®ç°å‰ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸Šè¿°çŸ¥è¯†å®ç°ä¸€ä¸ªç®€å•ä½†å‡ ä¹æ²¡æ³•ç”¨äºçœŸå®çš„ç©å…·mallocï¼Œæƒå½“å¯¹ä¸Šé¢çŸ¥è¯†çš„å¤ä¹ ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ä¸€ä¸ªç©å…·malloc */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">malloc</span><span class="params">(<span class="keyword">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">void</span> *p;</span><br><span class="line">    p = sbrk(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (sbrk(size) == (<span class="keyword">void</span> *)<span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªmallocæ¯æ¬¡éƒ½åœ¨å½“å‰breakçš„åŸºç¡€ä¸Šå¢åŠ sizeæ‰€æŒ‡å®šçš„å­—èŠ‚æ•°ï¼Œå¹¶å°†ä¹‹å‰breakçš„åœ°å€è¿”å›ã€‚è¿™ä¸ªmallocç”±äºå¯¹æ‰€åˆ†é…çš„å†…å­˜ç¼ºä¹è®°å½•ï¼Œä¸ä¾¿äºå†…å­˜é‡Šæ”¾ï¼Œæ‰€ä»¥æ— æ³•ç”¨äºçœŸå®åœºæ™¯ã€‚</p>
<h2 id="æ­£å¼å®ç°"><a href="#æ­£å¼å®ç°" class="headerlink" title="æ­£å¼å®ç°"></a>æ­£å¼å®ç°</h2><p>ä¸‹é¢ä¸¥è‚ƒç‚¹è®¨è®ºmallocçš„å®ç°æ–¹æ¡ˆã€‚</p>
<h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p>é¦–å…ˆæˆ‘ä»¬è¦ç¡®å®šæ‰€é‡‡ç”¨çš„æ•°æ®ç»“æ„ã€‚ä¸€ä¸ªç®€å•å¯è¡Œæ–¹æ¡ˆæ˜¯å°†å †å†…å­˜ç©ºé—´ä»¥å—ï¼ˆBlockï¼‰çš„å½¢å¼ç»„ç»‡èµ·æ¥ï¼Œæ¯ä¸ªå—ç”±metaåŒºå’Œæ•°æ®åŒºç»„æˆï¼ŒmetaåŒºè®°å½•æ•°æ®å—çš„å…ƒä¿¡æ¯ï¼ˆæ•°æ®åŒºå¤§å°ã€ç©ºé—²æ ‡å¿—ä½ã€æŒ‡é’ˆç­‰ç­‰ï¼‰ï¼Œæ•°æ®åŒºæ˜¯çœŸå®åˆ†é…çš„å†…å­˜åŒºåŸŸï¼Œå¹¶ä¸”æ•°æ®åŒºçš„ç¬¬ä¸€ä¸ªå­—èŠ‚åœ°å€å³ä¸ºmallocè¿”å›çš„åœ°å€ã€‚</p>
<p>å¯ä»¥ç”¨å¦‚ä¸‹ç»“æ„ä½“å®šä¹‰ä¸€ä¸ªblockï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">s_block</span> *<span class="title">t_block</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">s_block</span> &#123;</span></span><br><span class="line">    <span class="keyword">size_t</span> size;  <span class="comment">/* æ•°æ®åŒºå¤§å° */</span></span><br><span class="line">    t_block next; <span class="comment">/* æŒ‡å‘ä¸‹ä¸ªå—çš„æŒ‡é’ˆ */</span></span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">free</span>;     <span class="comment">/* æ˜¯å¦æ˜¯ç©ºé—²å— */</span></span><br><span class="line">    <span class="keyword">int</span> padding;  <span class="comment">/* å¡«å……4å­—èŠ‚ï¼Œä¿è¯metaå—é•¿åº¦ä¸º8çš„å€æ•° */</span></span><br><span class="line">    <span class="keyword">char</span> data[<span class="number">1</span>]  <span class="comment">/* è¿™æ˜¯ä¸€ä¸ªè™šæ‹Ÿå­—æ®µï¼Œè¡¨ç¤ºæ•°æ®å—çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œé•¿åº¦ä¸åº”è®¡å…¥meta */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>ç”±äºæˆ‘ä»¬åªè€ƒè™‘64ä½æœºå™¨ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬åœ¨ç»“æ„ä½“æœ€åå¡«å……ä¸€ä¸ªintï¼Œä½¿å¾—ç»“æ„ä½“æœ¬èº«çš„é•¿åº¦ä¸º8çš„å€æ•°ï¼Œä»¥ä¾¿å†…å­˜å¯¹é½ã€‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><a href="http://idiotsky.top/images2/c-malloc-6.png"><img src="http://idiotsky.top/images2/c-malloc-6.png" alt=""></a></p>
<h3 id="å¯»æ‰¾åˆé€‚çš„block"><a href="#å¯»æ‰¾åˆé€‚çš„block" class="headerlink" title="å¯»æ‰¾åˆé€‚çš„block"></a>å¯»æ‰¾åˆé€‚çš„block</h3><p>ç°åœ¨è€ƒè™‘å¦‚ä½•åœ¨blocké“¾ä¸­æŸ¥æ‰¾åˆé€‚çš„blockã€‚ä¸€èˆ¬æ¥è¯´æœ‰ä¸¤ç§æŸ¥æ‰¾ç®—æ³•ï¼š</p>
<ul>
<li><strong>First fit</strong>ï¼šä»å¤´å¼€å§‹ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªæ•°æ®åŒºå¤§å°å¤§äºè¦æ±‚sizeçš„å—æ‰€è°“æ­¤æ¬¡åˆ†é…çš„å—</li>
<li><strong>Best fit</strong>ï¼šä»å¤´å¼€å§‹ï¼Œéå†æ‰€æœ‰å—ï¼Œä½¿ç”¨æ•°æ®åŒºå¤§å°å¤§äºsizeä¸”å·®å€¼æœ€å°çš„å—ä½œä¸ºæ­¤æ¬¡åˆ†é…çš„å—</li>
</ul>
<p>ä¸¤ç§æ–¹æ³•å„æœ‰åƒç§‹ï¼Œbest fitå…·æœ‰è¾ƒé«˜çš„å†…å­˜ä½¿ç”¨ç‡ï¼ˆpayloadè¾ƒé«˜ï¼‰ï¼Œè€Œfirst fitå…·æœ‰æ›´å¥½çš„è¿è¡Œæ•ˆç‡ã€‚è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨first fitç®—æ³•ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* First fit */</span></span><br><span class="line"><span class="function">t_block <span class="title">find_block</span><span class="params">(t_block *last, <span class="keyword">size_t</span> size)</span> </span>&#123;</span><br><span class="line">    t_block b = first_block;</span><br><span class="line">    <span class="keyword">while</span>(b &amp;&amp; !(b-&gt;<span class="built_in">free</span> &amp;&amp; b-&gt;size &gt;= size)) &#123;</span><br><span class="line">        *last = b;</span><br><span class="line">        b = b-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>find_blockä»frist_blockå¼€å§‹ï¼ŒæŸ¥æ‰¾ç¬¬ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„blockå¹¶è¿”å›blockèµ·å§‹åœ°å€ï¼Œå¦‚æœæ‰¾ä¸åˆ°è¿™è¿”å›NULLã€‚è¿™é‡Œåœ¨éå†æ—¶ä¼šæ›´æ–°ä¸€ä¸ªå«lastçš„æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆå§‹ç»ˆæŒ‡å‘å½“å‰éå†çš„blockã€‚è¿™æ˜¯ä¸ºäº†å¦‚æœæ‰¾ä¸åˆ°åˆé€‚çš„blockè€Œå¼€è¾Ÿæ–°blockä½¿ç”¨çš„ï¼Œå…·ä½“ä¼šåœ¨æ¥ä¸‹æ¥çš„ä¸€èŠ‚ç”¨åˆ°ã€‚</p>
<h3 id="å¼€è¾Ÿæ–°çš„block"><a href="#å¼€è¾Ÿæ–°çš„block" class="headerlink" title="å¼€è¾Ÿæ–°çš„block"></a>å¼€è¾Ÿæ–°çš„block</h3><p>å¦‚æœç°æœ‰blockéƒ½ä¸èƒ½æ»¡è¶³sizeçš„è¦æ±‚ï¼Œåˆ™éœ€è¦åœ¨é“¾è¡¨æœ€åå¼€è¾Ÿä¸€ä¸ªæ–°çš„blockã€‚è¿™é‡Œå…³é”®æ˜¯å¦‚ä½•åªä½¿ç”¨sbrkåˆ›å»ºä¸€ä¸ªstructï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BLOCK_SIZE 24 <span class="comment">/* ç”±äºå­˜åœ¨è™šæ‹Ÿçš„dataå­—æ®µï¼Œsizeofä¸èƒ½æ­£ç¡®è®¡ç®—metaé•¿åº¦ï¼Œè¿™é‡Œæ‰‹å·¥è®¾ç½® */</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function">t_block <span class="title">extend_heap</span><span class="params">(t_block last, <span class="keyword">size_t</span> s)</span> </span>&#123;</span><br><span class="line">    t_block b;</span><br><span class="line">    b = sbrk(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span>(sbrk(BLOCK_SIZE + s) == (<span class="keyword">void</span> *)<span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    b-&gt;size = s;</span><br><span class="line">    b-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span>(last)</span><br><span class="line">        last-&gt;next = b;</span><br><span class="line">    b-&gt;<span class="built_in">free</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="åˆ†è£‚block"><a href="#åˆ†è£‚block" class="headerlink" title="åˆ†è£‚block"></a>åˆ†è£‚block</h3><p>First fitæœ‰ä¸€ä¸ªæ¯”è¾ƒè‡´å‘½çš„ç¼ºç‚¹ï¼Œå°±æ˜¯å¯èƒ½ä¼šè®©å¾ˆå°çš„sizeå æ®å¾ˆå¤§çš„ä¸€å—blockï¼Œæ­¤æ—¶ï¼Œä¸ºäº†æé«˜payloadï¼Œåº”è¯¥åœ¨å‰©ä½™æ•°æ®åŒºè¶³å¤Ÿå¤§çš„æƒ…å†µä¸‹ï¼Œå°†å…¶åˆ†è£‚ä¸ºä¸€ä¸ªæ–°çš„blockï¼Œç¤ºæ„å¦‚ä¸‹ï¼š<br><a href="http://idiotsky.top/images2/c-malloc-7.png"><img src="http://idiotsky.top/images2/c-malloc-7.png" alt=""></a></p>
<p>å®ç°ä»£ç ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">split_block</span><span class="params">(t_block b, <span class="keyword">size_t</span> s)</span> </span>&#123;</span><br><span class="line">    t_block <span class="keyword">new</span>;</span><br><span class="line">    <span class="keyword">new</span> = b-&gt;data + s;</span><br><span class="line">    <span class="keyword">new</span>-&gt;size = b-&gt;size - s - BLOCK_SIZE ;</span><br><span class="line">    <span class="keyword">new</span>-&gt;next = b-&gt;next;</span><br><span class="line">    <span class="keyword">new</span>-&gt;<span class="built_in">free</span> = <span class="number">1</span>;</span><br><span class="line">    b-&gt;size = s;</span><br><span class="line">    b-&gt;next = <span class="keyword">new</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="mallocçš„å®ç°"><a href="#mallocçš„å®ç°" class="headerlink" title="mallocçš„å®ç°"></a>mallocçš„å®ç°</h3><p>æœ‰äº†ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒä»¬æ•´åˆæˆä¸€ä¸ªç®€å•ä½†åˆæ­¥å¯ç”¨çš„mallocã€‚æ³¨æ„é¦–å…ˆæˆ‘ä»¬è¦å®šä¹‰ä¸ªblocké“¾è¡¨çš„å¤´first_blockï¼Œåˆå§‹åŒ–ä¸ºNULLï¼›å¦å¤–ï¼Œæˆ‘ä»¬éœ€è¦å‰©ä½™ç©ºé—´è‡³å°‘æœ‰BLOCK_SIZE + 8æ‰æ‰§è¡Œåˆ†è£‚æ“ä½œã€‚</p>
<p>ç”±äºæˆ‘ä»¬å¸Œæœ›mallocåˆ†é…çš„æ•°æ®åŒºæ˜¯æŒ‰8å­—èŠ‚å¯¹é½ï¼Œæ‰€ä»¥åœ¨sizeä¸ä¸º8çš„å€æ•°æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†sizeè°ƒæ•´ä¸ºå¤§äºsizeçš„æœ€å°çš„8çš„å€æ•°ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">size_t</span> align8(<span class="keyword">size_t</span> s) &#123;</span><br><span class="line">    <span class="keyword">if</span>(s &amp; <span class="number">0x7</span> == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    <span class="keyword">return</span> ((s &gt;&gt; <span class="number">3</span>) + <span class="number">1</span>) &lt;&lt; <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BLOCK_SIZE 24</span></span><br><span class="line"><span class="keyword">void</span> *first_block=<span class="literal">NULL</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* other functions... */</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">malloc</span><span class="params">(<span class="keyword">size_t</span> size)</span> </span>&#123;</span><br><span class="line">    t_block b, last;</span><br><span class="line">    <span class="keyword">size_t</span> s;</span><br><span class="line">    <span class="comment">/* å¯¹é½åœ°å€ */</span></span><br><span class="line">    s = align8(size);</span><br><span class="line">    <span class="keyword">if</span>(first_block) &#123;</span><br><span class="line">        <span class="comment">/* æŸ¥æ‰¾åˆé€‚çš„block */</span></span><br><span class="line">        last = first_block;</span><br><span class="line">        b = find_block(&amp;last, s);</span><br><span class="line">        <span class="keyword">if</span>(b) &#123;</span><br><span class="line">            <span class="comment">/* å¦‚æœå¯ä»¥ï¼Œåˆ™åˆ†è£‚ */</span></span><br><span class="line">            <span class="keyword">if</span> ((b-&gt;size - s) &gt;= ( BLOCK_SIZE + <span class="number">8</span>))</span><br><span class="line">                split_block(b, s);</span><br><span class="line">            b-&gt;<span class="built_in">free</span> = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">/* æ²¡æœ‰åˆé€‚çš„blockï¼Œå¼€è¾Ÿä¸€ä¸ªæ–°çš„ */</span></span><br><span class="line">            b = extend_heap(last, s);</span><br><span class="line">            <span class="keyword">if</span>(!b)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        b = extend_heap(<span class="literal">NULL</span>, s);</span><br><span class="line">        <span class="keyword">if</span>(!b)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        first_block = b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b-&gt;data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="callocçš„å®ç°"><a href="#callocçš„å®ç°" class="headerlink" title="callocçš„å®ç°"></a>callocçš„å®ç°</h3><p>æœ‰äº†mallocï¼Œå®ç°callocåªè¦ä¸¤æ­¥ï¼š</p>
<ol>
<li>mallocä¸€æ®µå†…å­˜</li>
<li>å°†æ•°æ®åŒºå†…å®¹ç½®ä¸º0</li>
</ol>
<p>ç”±äºæˆ‘ä»¬çš„æ•°æ®åŒºæ˜¯æŒ‰8å­—èŠ‚å¯¹é½çš„ï¼Œæ‰€ä»¥ä¸ºäº†æé«˜æ•ˆç‡ï¼Œæˆ‘ä»¬å¯ä»¥æ¯8å­—èŠ‚ä¸€ç»„ç½®0ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªä¸€ä¸ªå­—èŠ‚è®¾ç½®ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ–°å»ºä¸€ä¸ªsize_tæŒ‡é’ˆï¼Œå°†å†…å­˜åŒºåŸŸå¼ºåˆ¶çœ‹åšsize_tç±»å‹æ¥å®ç°ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">calloc</span><span class="params">(<span class="keyword">size_t</span> number, <span class="keyword">size_t</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">size_t</span> *<span class="keyword">new</span>;</span><br><span class="line">    <span class="keyword">size_t</span> s8, i;</span><br><span class="line">    <span class="keyword">new</span> = <span class="built_in">malloc</span>(number * size);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">new</span>) &#123;</span><br><span class="line">        s8 = align8(number * size) &gt;&gt; <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; s8; i++)</span><br><span class="line">            <span class="keyword">new</span>[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="freeçš„å®ç°"><a href="#freeçš„å®ç°" class="headerlink" title="freeçš„å®ç°"></a>freeçš„å®ç°</h3><p>freeçš„å®ç°å¹¶ä¸åƒçœ‹ä¸Šå»é‚£ä¹ˆç®€å•ï¼Œè¿™é‡Œæˆ‘ä»¬è¦è§£å†³ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼š</p>
<ol>
<li>å¦‚ä½•éªŒè¯æ‰€ä¼ å…¥çš„åœ°å€æ˜¯æœ‰æ•ˆåœ°å€ï¼Œå³ç¡®å®æ˜¯é€šè¿‡mallocæ–¹å¼åˆ†é…çš„æ•°æ®åŒºé¦–åœ°å€</li>
<li>å¦‚ä½•è§£å†³ç¢ç‰‡é—®é¢˜</li>
</ol>
<p>é¦–å…ˆæˆ‘ä»¬è¦ä¿è¯ä¼ å…¥freeçš„åœ°å€æ˜¯æœ‰æ•ˆçš„ï¼Œè¿™ä¸ªæœ‰æ•ˆåŒ…æ‹¬ä¸¤æ–¹é¢ï¼š</p>
<ol>
<li>åœ°å€åº”è¯¥åœ¨ä¹‹å‰mallocæ‰€åˆ†é…çš„åŒºåŸŸå†…ï¼Œå³åœ¨first_blockå’Œå½“å‰breakæŒ‡é’ˆèŒƒå›´å†…</li>
<li>è¿™ä¸ªåœ°å€ç¡®å®æ˜¯ä¹‹å‰é€šè¿‡æˆ‘ä»¬è‡ªå·±çš„mallocåˆ†é…çš„</li>
</ol>
<p>ç¬¬ä¸€ä¸ªé—®é¢˜æ¯”è¾ƒå¥½è§£å†³ï¼Œåªè¦è¿›è¡Œåœ°å€æ¯”è¾ƒå°±å¯ä»¥äº†ï¼Œå…³é”®æ˜¯ç¬¬äºŒä¸ªé—®é¢˜ã€‚è¿™é‡Œæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼šä¸€æ˜¯åœ¨ç»“æ„ä½“å†…åŸ‹ä¸€ä¸ªmagic numberå­—æ®µï¼Œfreeä¹‹å‰é€šè¿‡ç›¸å¯¹åç§»æ£€æŸ¥ç‰¹å®šä½ç½®çš„å€¼æ˜¯å¦ä¸ºæˆ‘ä»¬è®¾ç½®çš„magic numberï¼Œå¦ä¸€ç§æ–¹æ³•æ˜¯åœ¨ç»“æ„ä½“å†…å¢åŠ ä¸€ä¸ªmagic pointerï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘æ•°æ®åŒºçš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼ˆä¹Ÿå°±æ˜¯åœ¨åˆæ³•æ—¶freeæ—¶ä¼ å…¥çš„åœ°å€ï¼‰ï¼Œæˆ‘ä»¬åœ¨freeå‰æ£€æŸ¥magic pointeræ˜¯å¦æŒ‡å‘å‚æ•°æ‰€æŒ‡åœ°å€ã€‚è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ç¬¬äºŒç§æ–¹æ¡ˆï¼š</p>
<p>é¦–å…ˆæˆ‘ä»¬åœ¨ç»“æ„ä½“ä¸­å¢åŠ magic pointerï¼ˆåŒæ—¶è¦ä¿®æ”¹BLOCK_SIZEï¼‰ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">s_block</span> *<span class="title">t_block</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">s_block</span> &#123;</span></span><br><span class="line">    <span class="keyword">size_t</span> size;  <span class="comment">/* æ•°æ®åŒºå¤§å° */</span></span><br><span class="line">    t_block next; <span class="comment">/* æŒ‡å‘ä¸‹ä¸ªå—çš„æŒ‡é’ˆ */</span></span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">free</span>;     <span class="comment">/* æ˜¯å¦æ˜¯ç©ºé—²å— */</span></span><br><span class="line">    <span class="keyword">int</span> padding;  <span class="comment">/* å¡«å……4å­—èŠ‚ï¼Œä¿è¯metaå—é•¿åº¦ä¸º8çš„å€æ•° */</span></span><br><span class="line">    <span class="keyword">void</span> *ptr;    <span class="comment">/* Magic pointerï¼ŒæŒ‡å‘data */</span></span><br><span class="line">    <span class="keyword">char</span> data[<span class="number">1</span>]  <span class="comment">/* è¿™æ˜¯ä¸€ä¸ªè™šæ‹Ÿå­—æ®µï¼Œè¡¨ç¤ºæ•°æ®å—çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œé•¿åº¦ä¸åº”è®¡å…¥meta */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åæˆ‘ä»¬å®šä¹‰æ£€æŸ¥åœ°å€åˆæ³•æ€§çš„å‡½æ•°ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">t_block <span class="title">get_block</span><span class="params">(<span class="keyword">void</span> *p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *tmp;  </span><br><span class="line">    tmp = p;</span><br><span class="line">    <span class="keyword">return</span> (p = tmp -= BLOCK_SIZE);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">valid_addr</span><span class="params">(<span class="keyword">void</span> *p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(first_block) &#123;</span><br><span class="line">        <span class="keyword">if</span>(p &gt; first_block &amp;&amp; p &lt; sbrk(<span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> p == (get_block(p))-&gt;ptr;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å½“å¤šæ¬¡mallocå’Œfreeåï¼Œæ•´ä¸ªå†…å­˜æ± å¯èƒ½ä¼šäº§ç”Ÿå¾ˆå¤šç¢ç‰‡blockï¼Œè¿™äº›blockå¾ˆå°ï¼Œç»å¸¸æ— æ³•ä½¿ç”¨ï¼Œç”šè‡³å‡ºç°è®¸å¤šç¢ç‰‡è¿åœ¨ä¸€èµ·ï¼Œè™½ç„¶æ€»ä½“èƒ½æ»¡è¶³æŸæ­¤mallocè¦æ±‚ï¼Œä½†æ˜¯ç”±äºåˆ†å‰²æˆäº†å¤šä¸ªå°blockè€Œæ— æ³•fitï¼Œè¿™å°±æ˜¯ç¢ç‰‡é—®é¢˜ã€‚</p>
<p>ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹å¼æ—¶å½“freeæŸä¸ªblockæ—¶ï¼Œå¦‚æœå‘ç°å®ƒç›¸é‚»çš„blockä¹Ÿæ˜¯freeçš„ï¼Œåˆ™å°†blockå’Œç›¸é‚»blockåˆå¹¶ã€‚ä¸ºäº†æ»¡è¶³è¿™ä¸ªå®ç°ï¼Œéœ€è¦å°†s_blockæ”¹ä¸ºåŒå‘é“¾è¡¨ã€‚ä¿®æ”¹åçš„blockç»“æ„å¦‚ä¸‹ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">s_block</span> *<span class="title">t_block</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">s_block</span> &#123;</span></span><br><span class="line">    <span class="keyword">size_t</span> size;  <span class="comment">/* æ•°æ®åŒºå¤§å° */</span></span><br><span class="line">    t_block prev; <span class="comment">/* æŒ‡å‘ä¸Šä¸ªå—çš„æŒ‡é’ˆ */</span></span><br><span class="line">    t_block next; <span class="comment">/* æŒ‡å‘ä¸‹ä¸ªå—çš„æŒ‡é’ˆ */</span></span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">free</span>;     <span class="comment">/* æ˜¯å¦æ˜¯ç©ºé—²å— */</span></span><br><span class="line">    <span class="keyword">int</span> padding;  <span class="comment">/* å¡«å……4å­—èŠ‚ï¼Œä¿è¯metaå—é•¿åº¦ä¸º8çš„å€æ•° */</span></span><br><span class="line">    <span class="keyword">void</span> *ptr;    <span class="comment">/* Magic pointerï¼ŒæŒ‡å‘data */</span></span><br><span class="line">    <span class="keyword">char</span> data[<span class="number">1</span>]  <span class="comment">/* è¿™æ˜¯ä¸€ä¸ªè™šæ‹Ÿå­—æ®µï¼Œè¡¨ç¤ºæ•°æ®å—çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œé•¿åº¦ä¸åº”è®¡å…¥meta */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>åˆå¹¶æ–¹æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">t_block <span class="title">fusion</span><span class="params">(t_block b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b-&gt;next &amp;&amp; b-&gt;next-&gt;<span class="built_in">free</span>) &#123;</span><br><span class="line">        b-&gt;size += BLOCK_SIZE + b-&gt;next-&gt;size;</span><br><span class="line">        b-&gt;next = b-&gt;next-&gt;next;</span><br><span class="line">        <span class="keyword">if</span>(b-&gt;next)</span><br><span class="line">            b-&gt;next-&gt;prev = b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æœ‰äº†ä¸Šè¿°æ–¹æ³•ï¼Œfreeçš„å®ç°æ€è·¯å°±æ¯”è¾ƒæ¸…æ™°äº†ï¼šé¦–å…ˆæ£€æŸ¥å‚æ•°åœ°å€çš„åˆæ³•æ€§ï¼Œå¦‚æœä¸åˆæ³•åˆ™ä¸åšä»»ä½•äº‹ï¼›å¦åˆ™ï¼Œå°†æ­¤blockçš„freeæ ‡ä¸º1ï¼Œå¹¶ä¸”åœ¨å¯ä»¥çš„æƒ…å†µä¸‹ä¸åé¢çš„blockè¿›è¡Œåˆå¹¶ã€‚å¦‚æœå½“å‰æ˜¯æœ€åä¸€ä¸ªblockï¼Œåˆ™å›é€€breakæŒ‡é’ˆé‡Šæ”¾è¿›ç¨‹å†…å­˜ï¼Œå¦‚æœå½“å‰blockæ˜¯æœ€åä¸€ä¸ªblockï¼Œåˆ™å›é€€breakæŒ‡é’ˆå¹¶è®¾ç½®first_blockä¸ºNULLã€‚å®ç°å¦‚ä¸‹ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">free</span><span class="params">(<span class="keyword">void</span> *p)</span> </span>&#123;</span><br><span class="line">    t_block b;</span><br><span class="line">    <span class="keyword">if</span>(valid_addr(p)) &#123;</span><br><span class="line">        b = get_block(p);</span><br><span class="line">        b-&gt;<span class="built_in">free</span> = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(b-&gt;prev &amp;&amp; b-&gt;prev-&gt;<span class="built_in">free</span>)</span><br><span class="line">            b = fusion(b-&gt;prev);</span><br><span class="line">        <span class="keyword">if</span>(b-&gt;next)</span><br><span class="line">            fusion(b);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(b-&gt;prev)</span><br><span class="line">                b-&gt;prev-&gt;prev = <span class="literal">NULL</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                first_block = <span class="literal">NULL</span>;</span><br><span class="line">            brk(b);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="reallocçš„å®ç°"><a href="#reallocçš„å®ç°" class="headerlink" title="reallocçš„å®ç°"></a>reallocçš„å®ç°</h3><p>ä¸ºäº†å®ç°reallocï¼Œæˆ‘ä»¬é¦–å…ˆè¦å®ç°ä¸€ä¸ªå†…å­˜å¤åˆ¶æ–¹æ³•ã€‚å¦‚åŒcallocä¸€æ ·ï¼Œä¸ºäº†æ•ˆç‡ï¼Œæˆ‘ä»¬ä»¥8å­—èŠ‚ä¸ºå•ä½è¿›è¡Œå¤åˆ¶ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">copy_block</span><span class="params">(t_block src, t_block dst)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">size_t</span> *sdata, *ddata;</span><br><span class="line">    <span class="keyword">size_t</span> i;</span><br><span class="line">    sdata = src-&gt;ptr;</span><br><span class="line">    ddata = dst-&gt;ptr;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; (i * <span class="number">8</span>) &lt; src-&gt;size &amp;&amp; (i * <span class="number">8</span>) &lt; dst-&gt;size; i++)</span><br><span class="line">        ddata[i] = sdata[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åæˆ‘ä»¬å¼€å§‹å®ç°reallocã€‚ä¸€ä¸ªç®€å•ï¼ˆä½†æ˜¯ä½æ•ˆï¼‰çš„æ–¹æ³•æ˜¯mallocä¸€æ®µå†…å­˜ï¼Œç„¶åå°†æ•°æ®å¤åˆ¶è¿‡å»ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åšçš„æ›´é«˜æ•ˆï¼Œå…·ä½“å¯ä»¥è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>å¦‚æœå½“å‰blockçš„æ•°æ®åŒºå¤§äºç­‰äºreallocæ‰€è¦æ±‚çš„sizeï¼Œåˆ™ä¸åšä»»ä½•æ“ä½œ</li>
<li>å¦‚æœæ–°çš„sizeå˜å°äº†ï¼Œè€ƒè™‘split</li>
<li>å¦‚æœå½“å‰blockçš„æ•°æ®åŒºä¸èƒ½æ»¡è¶³sizeï¼Œä½†æ˜¯å…¶åç»§blockæ˜¯freeçš„ï¼Œå¹¶ä¸”åˆå¹¶åå¯ä»¥æ»¡è¶³ï¼Œåˆ™è€ƒè™‘åšåˆå¹¶</li>
</ul>
<p>ä¸‹é¢æ˜¯reallocçš„å®ç°ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">realloc</span><span class="params">(<span class="keyword">void</span> *p, <span class="keyword">size_t</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">size_t</span> s;</span><br><span class="line">    t_block b, <span class="keyword">new</span>;</span><br><span class="line">    <span class="keyword">void</span> *newp;</span><br><span class="line">    <span class="keyword">if</span> (!p)</span><br><span class="line">        <span class="comment">/* æ ¹æ®æ ‡å‡†åº“æ–‡æ¡£ï¼Œå½“pä¼ å…¥NULLæ—¶ï¼Œç›¸å½“äºè°ƒç”¨malloc */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">malloc</span>(size);</span><br><span class="line">    <span class="keyword">if</span>(valid_addr(p)) &#123;</span><br><span class="line">        s = align8(size);</span><br><span class="line">        b = get_block(p);</span><br><span class="line">        <span class="keyword">if</span>(b-&gt;size &gt;= s) &#123;</span><br><span class="line">            <span class="keyword">if</span>(b-&gt;size - s &gt;= (BLOCK_SIZE + <span class="number">8</span>))</span><br><span class="line">                split_block(b,s);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">/* çœ‹æ˜¯å¦å¯è¿›è¡Œåˆå¹¶ */</span></span><br><span class="line">            <span class="keyword">if</span>(b-&gt;next &amp;&amp; b-&gt;next-&gt;<span class="built_in">free</span></span><br><span class="line">                    &amp;&amp; (b-&gt;size + BLOCK_SIZE + b-&gt;next-&gt;size) &gt;= s) &#123;</span><br><span class="line">                fusion(b);</span><br><span class="line">                <span class="keyword">if</span>(b-&gt;size - s &gt;= (BLOCK_SIZE + <span class="number">8</span>))</span><br><span class="line">                    split_block(b, s);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">/* æ–°malloc */</span></span><br><span class="line">                newp = <span class="built_in">malloc</span> (s);</span><br><span class="line">                <span class="keyword">if</span> (!newp)</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">                <span class="keyword">new</span> = get_block(newp);</span><br><span class="line">                copy_block(b, <span class="keyword">new</span>);</span><br><span class="line">                <span class="built_in">free</span>(p);</span><br><span class="line">                <span class="keyword">return</span>(newp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (p);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="é—ç•™é—®é¢˜å’Œä¼˜åŒ–"><a href="#é—ç•™é—®é¢˜å’Œä¼˜åŒ–" class="headerlink" title="é—ç•™é—®é¢˜å’Œä¼˜åŒ–"></a>é—ç•™é—®é¢˜å’Œä¼˜åŒ–</h2><p>ä»¥ä¸Šæ˜¯ä¸€ä¸ªè¾ƒä¸ºç®€é™‹ï¼Œä½†æ˜¯åˆæ­¥å¯ç”¨çš„mallocå®ç°ã€‚è¿˜æœ‰å¾ˆå¤šé—ç•™çš„å¯èƒ½ä¼˜åŒ–ç‚¹ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>åŒæ—¶å…¼å®¹32ä½å’Œ64ä½ç³»ç»Ÿ</li>
<li>åœ¨åˆ†é…è¾ƒå¤§å¿«å†…å­˜æ—¶ï¼Œè€ƒè™‘ä½¿ç”¨mmapè€Œésbrkï¼Œè¿™é€šå¸¸æ›´é«˜æ•ˆ</li>
<li>å¯ä»¥è€ƒè™‘ç»´æŠ¤å¤šä¸ªé“¾è¡¨è€Œéå•ä¸ªï¼Œæ¯ä¸ªé“¾è¡¨ä¸­çš„blockå¤§å°å‡ä¸ºä¸€ä¸ªèŒƒå›´å†…ï¼Œä¾‹å¦‚8å­—èŠ‚é“¾è¡¨ã€16å­—èŠ‚é“¾è¡¨ã€24-32å­—èŠ‚é“¾è¡¨ç­‰ç­‰ã€‚æ­¤æ—¶å¯ä»¥æ ¹æ®sizeåˆ°å¯¹åº”é“¾è¡¨ä¸­åšåˆ†é…ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘ç¢ç‰‡ï¼Œå¹¶æé«˜æŸ¥è¯¢blockçš„é€Ÿåº¦</li>
<li>å¯ä»¥è€ƒè™‘é“¾è¡¨ä¸­åªå­˜æ”¾freeçš„blockï¼Œè€Œä¸å­˜æ”¾å·²åˆ†é…çš„blockï¼Œå¯ä»¥å‡å°‘æŸ¥æ‰¾blockçš„æ¬¡æ•°ï¼Œæé«˜æ•ˆç‡</li>
</ul>
<p>è¿˜æœ‰å¾ˆå¤šå¯èƒ½çš„ä¼˜åŒ–ï¼Œè¿™é‡Œä¸ä¸€ä¸€èµ˜è¿°ã€‚</p>
<p>from <a href="http://blog.codinglabs.org/articles/a-malloc-tutorial.html" target="_blank" rel="noopener">http://blog.codinglabs.org/articles/a-malloc-tutorial.html</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« å¾ˆå¥½çš„æ€»ç»“äº†å¾ˆå¤šå…³äºå†…å­˜çš„çŸ¥è¯†ï¼Œè™½ç„¶å®ƒè®²çš„åªæ˜¯ä¸€ä¸ªcæ ‡å‡†åº“çš„ä¸€ä¸ªå‡½æ•°ï¼Œmarkä¹‹ğŸ‘¿&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»»ä½•ä¸€ä¸ªç”¨è¿‡æˆ–å­¦è¿‡Cçš„äººå¯¹mallocéƒ½ä¸ä¼šé™Œç”Ÿã€‚å¤§å®¶éƒ½çŸ¥é“mallocå¯ä»¥åˆ†é…ä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå¹¶ä¸”åœ¨ä¸å†ä½¿ç”¨æ—¶å¯ä»¥é€šè¿‡freeé‡Šæ”¾æ‰ã€‚ä½†æ˜¯ï¼Œè®¸å¤šç¨‹åºå‘˜å¯¹mallocèƒŒåçš„äº‹æƒ…å¹¶ä¸ç†Ÿæ‚‰ï¼Œè®¸å¤šäººç”šè‡³æŠŠmallocå½“åšæ“ä½œç³»ç»Ÿæ‰€æä¾›çš„ç³»ç»Ÿè°ƒç”¨æˆ–Cçš„å…³é”®å­—ã€‚å®é™…ä¸Šï¼Œmallocåªæ˜¯Cçš„æ ‡å‡†åº“ä¸­æä¾›çš„ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œè€Œä¸”å®ç°mallocçš„&lt;strong&gt;åŸºæœ¬&lt;/strong&gt;æ€æƒ³å¹¶ä¸å¤æ‚ï¼Œä»»ä½•ä¸€ä¸ªå¯¹Cå’Œæ“ä½œç³»ç»Ÿæœ‰äº›è®¸äº†è§£çš„ç¨‹åºå‘˜éƒ½å¯ä»¥å¾ˆå®¹æ˜“ç†è§£ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« é€šè¿‡å®ç°ä¸€ä¸ªç®€å•çš„mallocæ¥æè¿°mallocèƒŒåçš„æœºåˆ¶ã€‚å½“ç„¶ä¸ç°æœ‰Cçš„æ ‡å‡†åº“å®ç°ï¼ˆä¾‹å¦‚glibcï¼‰ç›¸æ¯”ï¼Œæˆ‘ä»¬å®ç°çš„mallocå¹¶ä¸æ˜¯ç‰¹åˆ«é«˜æ•ˆï¼Œä½†æ˜¯è¿™ä¸ªå®ç°æ¯”ç›®å‰çœŸå®çš„mallocå®ç°è¦ç®€å•å¾ˆå¤šï¼Œå› æ­¤æ˜“äºç†è§£ã€‚é‡è¦çš„æ˜¯ï¼Œè¿™ä¸ªå®ç°å’ŒçœŸå®å®ç°åœ¨åŸºæœ¬åŸç†ä¸Šæ˜¯ä¸€è‡´çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« å°†é¦–å…ˆä»‹ç»ä¸€äº›æ‰€éœ€çš„åŸºæœ¬çŸ¥è¯†ï¼Œå¦‚æ“ä½œç³»ç»Ÿå¯¹è¿›ç¨‹çš„å†…å­˜ç®¡ç†ä»¥åŠç›¸å…³çš„ç³»ç»Ÿè°ƒç”¨ï¼Œç„¶åé€æ­¥å®ç°ä¸€ä¸ªç®€å•çš„mallocã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œè¿™ç¯‡æ–‡ç« å°†åªè€ƒè™‘x86_64ä½“ç³»ç»“æ„ï¼Œæ“ä½œç³»ç»Ÿä¸ºLinuxã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="c" scheme="http://idiotsky.top/categories/c/"/>
    
    
      <category term="c" scheme="http://idiotsky.top/tags/c/"/>
    
      <category term="malloc" scheme="http://idiotsky.top/tags/malloc/"/>
    
  </entry>
  
  <entry>
    <title>æ·±å…¥goæ¥å£</title>
    <link href="http://idiotsky.top/2018/01/15/go-interface/"/>
    <id>http://idiotsky.top/2018/01/15/go-interface/</id>
    <published>2018-01-15T07:44:21.000Z</published>
    <updated>2018-02-26T11:25:41.824Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ¥å£æ˜¯ä»€ä¹ˆ"><a href="#æ¥å£æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ¥å£æ˜¯ä»€ä¹ˆ"></a>æ¥å£æ˜¯ä»€ä¹ˆ</h1><p>æ¥å£å°±æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»å‹ï¼Œä¸ä¹‹å¯¹åº”çš„å°±æ˜¯å…·ä½“ç±»å‹ï¼ŒåŒæ—¶æ¥å£ä¹Ÿæ˜¯æŠ½è±¡æ–¹æ³•æ¥å£ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> human <span class="keyword">interface</span>&#123;</span><br><span class="line">	walk()</span><br><span class="line">	run()</span><br><span class="line">	eat()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢çš„ä»£ç å®šä¹‰äº†æ¥å£ï¼Œæ¥å£é‡Œå®šä¹‰äº†å‡ ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œä¸€èˆ¬å…¶ä»–è¯­è¨€ä¾‹å¦‚Javaï¼Œéƒ½ä¼šå®šä¹‰ä¸€ä¸ªå…·ä½“çš„ç±»å‹æ¥å®ç°è¿™ä¸ªæ¥å£ï¼Œåƒè¿™æ ·<code>class man implements human</code> å£°æ˜<code>man</code>å®ç°äº†<code>human</code>ã€‚ä½†æ˜¯goä¸Šä½¿ç”¨äº†ä¸€ç§<code>duck typing</code>æ¥å®šä¹‰å…·ä½“ç±»å‹ã€‚<br><a id="more"></a></p>
<blockquote>
<p>When I see a bird that walks like a duck and swins like a duck and quacks like a duck, I call that bird a duck. â€“ James Whitcomb Riley</p>
</blockquote>
<p>ç»“åˆç»´åŸºç™¾ç§‘çš„<a href="https://en.wikipedia.org/wiki/Duck_typing" target="_blank" rel="noopener">å®šä¹‰</a>ï¼Œduck typingæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€çš„ä¸€ç§ç±»å‹å®šä¹‰æ–¹æ³•ã€‚æˆ‘ä»¬åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯ä»€ä¹ˆä¸æ˜¯é€šè¿‡å®ƒçš„ç±»å‹å®šä¹‰æ¥åˆ¤æ–­ï¼Œè€Œæ˜¯åˆ¤æ–­å®ƒæ˜¯å¦æ»¡è¶³æŸäº›ç‰¹å®šçš„æ–¹æ³•å’Œå±æ€§å®šä¹‰ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> man <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *man)</span> <span class="title">walk</span><span class="params">()</span></span>&#123;</span><br><span class="line">	fmt.Println(<span class="string">"man walk"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *man)</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">	fmt.Println(<span class="string">"man run"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *man)</span> <span class="title">eat</span><span class="params">()</span></span>&#123;</span><br><span class="line">	fmt.Println(<span class="string">"man eat"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢å®šä¹‰çš„<code>man</code> å¹¶æ²¡æœ‰å£°æ˜å®ƒå®ç°äº†å“ªäº›æ¥å£ï¼Œä½†æ˜¯ï¼Œå®ƒç¡®åˆ‡æ˜¯<code>human</code>çš„å…·ä½“ç±»å‹<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">var</span> h human=&amp;man&#123;&#125;</span><br><span class="line">	h.eat()</span><br><span class="line">	h.run()</span><br><span class="line">	h.walk()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œç»“æœ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">man eat</span><br><span class="line">man run</span><br><span class="line">man walk</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢ç»“æœè¯´æ˜äº†ï¼Œä¸ç”¨å£°æ˜æŸå…·ä½“ç±»å‹å®ç°å“ªä¸ªæ¥å£ï¼Œåªè¦å®ƒæœ‰æŸæ¥å£çš„æ‰€æœ‰æ–¹æ³•ï¼Œé‚£å®ƒå°±æ˜¯æŸæ¥å£çš„å…·ä½“ç±»å‹ã€‚</p>
<h1 id="æ¥å£å®ç°å¤šæ€"><a href="#æ¥å£å®ç°å¤šæ€" class="headerlink" title="æ¥å£å®ç°å¤šæ€"></a>æ¥å£å®ç°å¤šæ€</h1><p>å¾ˆæ˜æ˜¾ï¼Œå†åŠ ä¸ª<code>woman</code>ç±»å‹ï¼Œå®ç°æ‰€æœ‰æ–¹æ³•å°±å¯ä»¥å®ç°ä¸ªå¤šæ€ï¼ˆæ–¹æ³•é‡è½½ï¼‰<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> woman <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *woman)</span> <span class="title">walk</span><span class="params">()</span></span>&#123;</span><br><span class="line">	fmt.Println(<span class="string">"woman walk"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *woman)</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">	fmt.Println(<span class="string">"woman run"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *woman)</span> <span class="title">eat</span><span class="params">()</span></span>&#123;</span><br><span class="line">	fmt.Println(<span class="string">"woman eat"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">var</span> h human=&amp;man&#123;&#125;</span><br><span class="line">	h.eat()</span><br><span class="line">	h.run()</span><br><span class="line">    h.walk()</span><br><span class="line">    h=&amp;woman&#123;&#125;</span><br><span class="line">    h.eat()</span><br><span class="line">	h.run()</span><br><span class="line">    h.walk()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œç»“æœ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">man eat</span><br><span class="line">man run</span><br><span class="line">man walk</span><br><span class="line">woman eat</span><br><span class="line">woman run</span><br><span class="line">woman walk</span><br></pre></td></tr></table></figure></p>
<h1 id="ç±»å‹æ–­è¨€"><a href="#ç±»å‹æ–­è¨€" class="headerlink" title="ç±»å‹æ–­è¨€"></a>ç±»å‹æ–­è¨€</h1><p>æ‰€è°“ç±»å‹æ–­è¨€ï¼Œå°±æ˜¯ä¸€ä¸ªæ¥å£ç±»å‹ï¼Œè½¬åŒ–æˆå…·ä½“ç±»å‹æ—¶å€™ä½¿ç”¨ã€‚è¿˜æœ‰goé‡Œé¢<code>interface{}</code>æ˜¯ä¸€ä¸ªä¸‡èƒ½çš„ç±»å‹ï¼Œæœ‰ç‚¹åƒjavaçš„<code>Object</code>ç±»å‹<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">do</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">    n := v.(<span class="keyword">int</span>)    <span class="comment">// might panic</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">do</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">    n, ok := v.(<span class="keyword">int</span>)</span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">        <span class="comment">// æ–­è¨€å¤±è´¥å¤„ç†</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢çš„æ–¹æ³•å¯ä»¥ç”¨æ‰€æœ‰çš„ä¸åŒç±»å‹çš„å‚æ•°è°ƒç”¨ï¼Œæ‰€ä»¥å¦‚æœä¸æ˜¯<code>int</code>ç±»å‹å‚æ•°çš„è¯å°±æ˜¯panicäº†ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ª<code>do</code>å¯ä»¥è¿›è¡Œæ–­è¨€å¤±è´¥å¤„ç†ï¼Œé¿å…é”™è¯¯å‘ç”Ÿã€‚</p>
<h1 id="æ·±å…¥æºç "><a href="#æ·±å…¥æºç " class="headerlink" title="æ·±å…¥æºç "></a>æ·±å…¥æºç </h1><h2 id="interface-åº•å±‚ç»“æ„"><a href="#interface-åº•å±‚ç»“æ„" class="headerlink" title="interface åº•å±‚ç»“æ„"></a>interface åº•å±‚ç»“æ„</h2><p>æ ¹æ® interface æ˜¯å¦åŒ…å«æœ‰ methodï¼Œåº•å±‚å®ç°ä¸Šç”¨ä¸¤ç§ struct æ¥è¡¨ç¤ºï¼šiface å’Œ efaceã€‚efaceè¡¨ç¤ºä¸å« method çš„ interface ç»“æ„ï¼Œæˆ–è€…å« empty interfaceã€‚å¯¹äº Golang ä¸­çš„å¤§éƒ¨åˆ†æ•°æ®ç±»å‹éƒ½å¯ä»¥æŠ½è±¡å‡ºæ¥ _type ç»“æ„ï¼ŒåŒæ—¶é’ˆå¯¹ä¸åŒçš„ç±»å‹è¿˜ä¼šæœ‰ä¸€äº›å…¶ä»–ä¿¡æ¯ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> eface <span class="keyword">struct</span> &#123;</span><br><span class="line">    _type *_type</span><br><span class="line">    data  unsafe.Pointer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> _type <span class="keyword">struct</span> &#123;</span><br><span class="line">    size       <span class="keyword">uintptr</span> <span class="comment">// type size</span></span><br><span class="line">    ptrdata    <span class="keyword">uintptr</span> <span class="comment">// size of memory prefix holding all pointers</span></span><br><span class="line">    hash       <span class="keyword">uint32</span>  <span class="comment">// hash of type; avoids computation in hash tables</span></span><br><span class="line">    tflag      tflag   <span class="comment">// extra type information flags</span></span><br><span class="line">    align      <span class="keyword">uint8</span>   <span class="comment">// alignment of variable with this type</span></span><br><span class="line">    fieldalign <span class="keyword">uint8</span>   <span class="comment">// alignment of struct field with this type</span></span><br><span class="line">    kind       <span class="keyword">uint8</span>   <span class="comment">// enumeration for C</span></span><br><span class="line">    alg        *typeAlg  <span class="comment">// algorithm table</span></span><br><span class="line">    gcdata    *<span class="keyword">byte</span>    <span class="comment">// garbage collection data</span></span><br><span class="line">    str       nameOff  <span class="comment">// string form</span></span><br><span class="line">    ptrToThis typeOff  <span class="comment">// type for pointer to this type, may be zero</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>iface è¡¨ç¤º non-empty interface çš„åº•å±‚å®ç°ã€‚ç›¸æ¯”äº empty interfaceï¼Œnon-empty è¦åŒ…å«ä¸€äº› methodã€‚method çš„å…·ä½“å®ç°å­˜æ”¾åœ¨ itab.fun å˜é‡é‡Œã€‚å¦‚æœ interface åŒ…å«å¤šä¸ª methodï¼Œè¿™é‡Œåªæœ‰ä¸€ä¸ª fun å˜é‡æ€ä¹ˆå­˜å‘¢ï¼Ÿè¿™ä¸ªä¸‹é¢å†ç»†è¯´ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> iface <span class="keyword">struct</span> &#123;</span><br><span class="line">    tab  *itab</span><br><span class="line">    data unsafe.Pointer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// layout of Itab known to compilers</span></span><br><span class="line"><span class="comment">// allocated in non-garbage-collected memory</span></span><br><span class="line"><span class="comment">// Needs to be in sync with</span></span><br><span class="line"><span class="comment">// ../cmd/compile/internal/gc/reflect.go:/^func.dumptypestructs.</span></span><br><span class="line"><span class="keyword">type</span> itab <span class="keyword">struct</span> &#123;</span><br><span class="line">    inter  *interfacetype</span><br><span class="line">    _type  *_type</span><br><span class="line">    link   *itab</span><br><span class="line">    bad    <span class="keyword">int32</span></span><br><span class="line">    inhash <span class="keyword">int32</span>      <span class="comment">// has this itab been added to hash?</span></span><br><span class="line">    fun    [<span class="number">1</span>]<span class="keyword">uintptr</span> <span class="comment">// variable sized</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬ä½¿ç”¨å®é™…ç¨‹åºæ¥çœ‹ä¸€ä¸‹ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">    Print()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyStruct <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ms MyStruct)</span> <span class="title">Print</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    x := <span class="number">1</span></span><br><span class="line">    <span class="keyword">var</span> y <span class="keyword">interface</span>&#123;&#125; = x</span><br><span class="line">    <span class="keyword">var</span> s MyStruct</span><br><span class="line">    <span class="keyword">var</span> t MyInterface = s</span><br><span class="line">    fmt.Println(y, z)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æŸ¥çœ‹æ±‡ç¼–ä»£ç ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ go build -gcflags &apos;-l&apos; -o interface11 interface11.go</span><br><span class="line">$ go tool objdump -s &quot;main\.main&quot; interface11</span><br><span class="line">TEXT main.main(SB) /Users/kltao/code/go/examples/interface11.go</span><br><span class="line">    interface11.go:15   0x10870f0   65488b0c25a0080000  GS MOVQ GS:0x8a0, CX</span><br><span class="line">    interface11.go:15   0x10870f9   483b6110        CMPQ 0x10(CX), SP</span><br><span class="line">    interface11.go:15   0x10870fd   0f86de000000        JBE 0x10871e1</span><br><span class="line">    interface11.go:15   0x1087103   4883ec70        SUBQ $0x70, SP</span><br><span class="line">    interface11.go:15   0x1087107   48896c2468      MOVQ BP, 0x68(SP)</span><br><span class="line">    interface11.go:15   0x108710c   488d6c2468      LEAQ 0x68(SP), BP</span><br><span class="line">    interface11.go:17   0x1087111   48c744243001000000  MOVQ $0x1, 0x30(SP)</span><br><span class="line">    interface11.go:17   0x108711a   488d057fde0000      LEAQ 0xde7f(IP), AX</span><br><span class="line">    interface11.go:17   0x1087121   48890424        MOVQ AX, 0(SP)</span><br><span class="line">    interface11.go:17   0x1087125   488d442430      LEAQ 0x30(SP), AX</span><br><span class="line">    interface11.go:17   0x108712a   4889442408      MOVQ AX, 0x8(SP)</span><br><span class="line">    interface11.go:17   0x108712f   e87c45f8ff      CALL runtime.convT2E(SB)</span><br><span class="line">    interface11.go:17   0x1087134   488b442410      MOVQ 0x10(SP), AX</span><br><span class="line">    interface11.go:17   0x1087139   4889442438      MOVQ AX, 0x38(SP)</span><br><span class="line">    interface11.go:17   0x108713e   488b4c2418      MOVQ 0x18(SP), CX</span><br><span class="line">    interface11.go:17   0x1087143   48894c2440      MOVQ CX, 0x40(SP)</span><br><span class="line">    interface11.go:19   0x1087148   488d15b1000800      LEAQ 0x800b1(IP), DX</span><br><span class="line">    interface11.go:19   0x108714f   48891424        MOVQ DX, 0(SP)</span><br><span class="line">    interface11.go:19   0x1087153   488d542430      LEAQ 0x30(SP), DX</span><br><span class="line">    interface11.go:19   0x1087158   4889542408      MOVQ DX, 0x8(SP)</span><br><span class="line">    interface11.go:19   0x108715d   e8fe45f8ff      CALL runtime.convT2I(SB)</span><br></pre></td></tr></table></figure></p>
<p>ä»£ç  17 è¡Œ var y interface{} = x è°ƒç”¨äº†å‡½æ•° runtime.convT2Eï¼Œå°† int ç±»å‹çš„ x è½¬æ¢æˆ empty interfaceã€‚ä»£ç  19 è¡Œ var t MyInterface = s å°† MyStruct ç±»å‹è½¬æ¢æˆ non-empty interface: MyInterfaceã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">convT2E</span><span class="params">(t *_type, elem unsafe.Pointer)</span> <span class="params">(e eface)</span></span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  </span><br><span class="line">    x := newobject(t)</span><br><span class="line">    typedmemmove(t, x, elem)</span><br><span class="line">    e._type = t</span><br><span class="line">    e.data = x</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">convT2I</span><span class="params">(tab *itab, elem unsafe.Pointer)</span> <span class="params">(i iface)</span></span> &#123;</span><br><span class="line">    t := tab._type</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">  </span><br><span class="line">    x := newobject(t)</span><br><span class="line">    typedmemmove(t, x, elem)</span><br><span class="line">    i.tab = tab</span><br><span class="line">    i.data = x</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>çœ‹ä¸Šé¢çš„å‡½æ•°åŸå‹ï¼Œå¯ä»¥çœ‹å‡ºä¸­é—´è¿‡ç¨‹ç¼–è¯‘å™¨å°†æ ¹æ®æˆ‘ä»¬çš„è½¬æ¢ç›®æ ‡ç±»å‹çš„ empty interface è¿˜æ˜¯ non-empty interfaceï¼Œæ¥å¯¹åŸæ•°æ®ç±»å‹è¿›è¡Œè½¬æ¢ï¼ˆè½¬æ¢æˆ &lt;<em>_type, unsafe.Pointer&gt; æˆ–è€… &lt;</em>itab, unsafe.Pointer&gt;ï¼‰ã€‚è¿™é‡Œå¯¹äº struct æ»¡ä¸æ»¡è¶³ interface çš„ç±»å‹è¦æ±‚ï¼ˆä¹Ÿå°±æ˜¯ struct æ˜¯å¦å®ç°äº† interface çš„æ‰€æœ‰ methodï¼‰ï¼Œæ˜¯ç”±ç¼–è¯‘å™¨æ¥æ£€æµ‹çš„ã€‚</p>
<h2 id="itab"><a href="#itab" class="headerlink" title="itab"></a>itab</h2><p>iface ç»“æ„ä¸­æœ€é‡è¦çš„æ˜¯ itab ç»“æ„ã€‚itab å¯ä»¥ç†è§£ä¸º <code>pair&lt;interface type, concrete type&gt;</code> ã€‚å½“ç„¶ itab é‡Œé¢è¿˜åŒ…å«ä¸€äº›å…¶ä»–ä¿¡æ¯ï¼Œæ¯”å¦‚ interface é‡Œé¢åŒ…å«çš„ method çš„å…·ä½“å®ç°ã€‚ä¸‹é¢ç»†è¯´ã€‚itab çš„ç»“æ„å¦‚ä¸‹ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> itab <span class="keyword">struct</span> &#123;</span><br><span class="line">    inter  *interfacetype</span><br><span class="line">    _type  *_type</span><br><span class="line">    link   *itab</span><br><span class="line">    bad    <span class="keyword">int32</span></span><br><span class="line">    inhash <span class="keyword">int32</span>      <span class="comment">// has this itab been added to hash?</span></span><br><span class="line">    fun    [<span class="number">1</span>]<span class="keyword">uintptr</span> <span class="comment">// variable sized</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ interfacetype åŒ…å«äº†ä¸€äº›å…³äº interface æœ¬èº«çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ package pathï¼ŒåŒ…å«çš„ methodã€‚ä¸Šé¢æåˆ°çš„ iface å’Œ eface æ˜¯æ•°æ®ç±»å‹ï¼ˆbuilt-in å’Œ type-defineï¼‰è½¬æ¢æˆ interface ä¹‹åçš„å®ä½“çš„ struct ç»“æ„ï¼Œè€Œè¿™é‡Œçš„ interfacetype æ˜¯æˆ‘ä»¬å®šä¹‰ interface æ—¶å€™çš„ä¸€ç§æŠ½è±¡è¡¨ç¤ºã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> interfacetype <span class="keyword">struct</span> &#123;</span><br><span class="line">    typ     _type</span><br><span class="line">    pkgpath name</span><br><span class="line">    mhdr    []imethod</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> imethod <span class="keyword">struct</span> &#123;   <span class="comment">//è¿™é‡Œçš„ method åªæ˜¯ä¸€ç§å‡½æ•°å£°æ˜çš„æŠ½è±¡ï¼Œæ¯”å¦‚  func Print() error</span></span><br><span class="line">    name nameOff</span><br><span class="line">    ityp typeOff</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>_type è¡¨ç¤º concrete typeã€‚fun è¡¨ç¤ºçš„ interface é‡Œé¢çš„ method çš„å…·ä½“å®ç°ã€‚æ¯”å¦‚ interface type åŒ…å«äº† method A, Bï¼Œåˆ™é€šè¿‡ fun å°±å¯ä»¥æ‰¾åˆ°è¿™ä¸¤ä¸ª method çš„å…·ä½“å®ç°ã€‚è¿™é‡Œæœ‰ä¸ªé—®é¢˜ fun æ˜¯é•¿åº¦ä¸º 1 çš„ uintptr æ•°ç»„ï¼Œé‚£ä¹ˆæ€ä¹ˆè¡¨ç¤ºå¤šä¸ª method å‘¢ï¼Ÿçœ‹ä¸€ä¸‹æµ‹è¯•ç¨‹åºã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyInterface <span class="keyword">interface</span> &#123;</span><br><span class="line">    Print()</span><br><span class="line">    Hello()</span><br><span class="line">    World()</span><br><span class="line">    AWK()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Foo</span><span class="params">(me MyInterface)</span></span> &#123;</span><br><span class="line">    me.Print()</span><br><span class="line">    me.Hello()</span><br><span class="line">    me.World()</span><br><span class="line">    me.AWK()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyStruct <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(me MyStruct)</span> <span class="title">Print</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(me MyStruct)</span> <span class="title">Hello</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(me MyStruct)</span> <span class="title">World</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(me MyStruct)</span> <span class="title">AWK</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> me MyStruct</span><br><span class="line">    Foo(me)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>çœ‹ä¸€ä¸‹å‡½æ•°è°ƒç”¨å¯¹åº”çš„æ±‡ç¼–ä»£ç ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">$ go build -gcflags &apos;-l&apos; -o interface8 interface8.go</span><br><span class="line">$ go tool objdump -s &quot;main\.Foo&quot; interface8</span><br><span class="line">TEXT main.Foo(SB) /Users/kltao/code/go/examples/interface8.go</span><br><span class="line">    interface8.go:10    0x104c060   65488b0c25a0080000  GS MOVQ GS:0x8a0, CX</span><br><span class="line">    interface8.go:10    0x104c069   483b6110        CMPQ 0x10(CX), SP</span><br><span class="line">    interface8.go:10    0x104c06d   7668            JBE 0x104c0d7</span><br><span class="line">    interface8.go:10    0x104c06f   4883ec10        SUBQ $0x10, SP</span><br><span class="line">    interface8.go:10    0x104c073   48896c2408      MOVQ BP, 0x8(SP)</span><br><span class="line">    interface8.go:10    0x104c078   488d6c2408      LEAQ 0x8(SP), BP</span><br><span class="line">    interface8.go:11    0x104c07d   488b442418      MOVQ 0x18(SP), AX</span><br><span class="line">    interface8.go:11    0x104c082   488b4830        MOVQ 0x30(AX), CX //å–å¾— Print å‡½æ•°åœ°å€</span><br><span class="line">    interface8.go:11    0x104c086   488b542420      MOVQ 0x20(SP), DX</span><br><span class="line">    interface8.go:11    0x104c08b   48891424        MOVQ DX, 0(SP)</span><br><span class="line">    interface8.go:11    0x104c08f   ffd1            CALL CX     // è°ƒç”¨ Print()</span><br><span class="line">    interface8.go:12    0x104c091   488b442418      MOVQ 0x18(SP), AX</span><br><span class="line">    interface8.go:12    0x104c096   488b4828        MOVQ 0x28(AX), CX //å–å¾— Hello å‡½æ•°åœ°å€</span><br><span class="line">    interface8.go:12    0x104c09a   488b542420      MOVQ 0x20(SP), DX</span><br><span class="line">    interface8.go:12    0x104c09f   48891424        MOVQ DX, 0(SP)</span><br><span class="line">    interface8.go:12    0x104c0a3   ffd1            CALL CX           //è°ƒç”¨ Hello()</span><br><span class="line">    interface8.go:13    0x104c0a5   488b442418      MOVQ 0x18(SP), AX</span><br><span class="line">    interface8.go:13    0x104c0aa   488b4838        MOVQ 0x38(AX), CX //å–å¾— World å‡½æ•°åœ°å€</span><br><span class="line">    interface8.go:13    0x104c0ae   488b542420      MOVQ 0x20(SP), DX </span><br><span class="line">    interface8.go:13    0x104c0b3   48891424        MOVQ DX, 0(SP)</span><br><span class="line">    interface8.go:13    0x104c0b7   ffd1            CALL CX           //è°ƒç”¨ World()</span><br><span class="line">    interface8.go:14    0x104c0b9   488b442418      MOVQ 0x18(SP), AX</span><br><span class="line">    interface8.go:14    0x104c0be   488b4020        MOVQ 0x20(AX), AX //å–å¾— AWK å‡½æ•°åœ°å€</span><br><span class="line">    interface8.go:14    0x104c0c2   488b4c2420      MOVQ 0x20(SP), CX</span><br><span class="line">    interface8.go:14    0x104c0c7   48890c24        MOVQ CX, 0(SP)</span><br><span class="line">    interface8.go:14    0x104c0cb   ffd0            CALL AX           //è°ƒç”¨ AWK()</span><br><span class="line">    interface8.go:15    0x104c0cd   488b6c2408      MOVQ 0x8(SP), BP</span><br><span class="line">    interface8.go:15    0x104c0d2   4883c410        ADDQ $0x10, SP</span><br><span class="line">    interface8.go:15    0x104c0d6   c3          RET</span><br><span class="line">    interface8.go:10    0x104c0d7   e8f48bffff      CALL runtime.morestack_noctxt(SB)</span><br><span class="line">    interface8.go:10    0x104c0dc   eb82            JMP main.Foo(SB)</span><br></pre></td></tr></table></figure></p>
<p>å…¶ä¸­ 0x18(SP) å¯¹åº”çš„ itab çš„åœ°å€ã€‚fun åœ¨ x86-64 æœºå™¨ä¸Šå¯¹åº” itab å†…çš„åœ°å€åç§»ä¸º 8+8+8+4+4 = 32 = 0x20ï¼Œä¹Ÿå°±æ˜¯ 0x20(AX) å¯¹åº”çš„ fun çš„å€¼ï¼Œæ­¤æ—¶å­˜æ”¾çš„ AWK å‡½æ•°åœ°å€ã€‚ç„¶å 0x28(AX) = &amp;Helloï¼Œ0x30(AX) = &amp;Printï¼Œ0x38(AX) = &amp;Worldã€‚å¯¹çš„ï¼Œæ¯æ¬¡å‡½æ•°æ˜¯æŒ‰å­—å…¸åºæ’åºå­˜æ”¾çš„ã€‚</p>
<p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹å‡½æ•°åœ°å€ç©¶ç«Ÿæ˜¯æ€ä¹ˆå†™å…¥çš„ï¼Ÿé¦–å…ˆ Golang ä¸­çš„ uintptr ä¸€èˆ¬ç”¨æ¥å­˜æ”¾æŒ‡é’ˆçš„å€¼ï¼Œè¿™é‡Œå¯¹åº”çš„å°±æ˜¯å‡½æ•°æŒ‡é’ˆçš„å€¼ï¼ˆä¹Ÿå°±æ˜¯å‡½æ•°çš„è°ƒç”¨åœ°å€ï¼‰ã€‚ä½†æ˜¯è¿™é‡Œçš„ fun æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º 1 çš„ uintptr æ•°ç»„ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹ runtime åŒ…çš„ additab å‡½æ•°ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">additab</span><span class="params">(m *itab, locked, canfail <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    *(*unsafe.Pointer)(add(unsafe.Pointer(&amp;m.fun[<span class="number">0</span>]), <span class="keyword">uintptr</span>(k)*sys.PtrSize)) = ifn</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢çš„ä»£ç çš„æ„æ€æ˜¯åœ¨ fun[0] çš„åœ°å€åé¢ä¾æ¬¡å†™å…¥å…¶ä»– method å¯¹åº”çš„å‡½æ•°æŒ‡é’ˆã€‚ç†Ÿæ‚‰ C++ çš„åŒå­¦å¯ä»¥ç±»æ¯” C++ çš„è™šå‡½æ•°è¡¨æŒ‡é’ˆæ¥çœ‹ã€‚</p>
<p>å‰©ä¸‹çš„è¿˜æœ‰ badï¼Œlinkï¼Œinhashã€‚å…¶ä¸­ bad æ˜¯ä¸€ä¸ªè¡¨å¾ itab çŠ¶æ€çš„å˜é‡ã€‚è€Œè¿™é‡Œçš„ link æ˜¯ *itab ç±»å‹ï¼Œæ˜¯ä¸æ˜¯è¡¨ç¤º interface çš„åµŒå¥—å‘¢ï¼Ÿå¹¶ä¸æ˜¯ï¼Œinterface çš„åµŒå¥—ä¹Ÿæ˜¯æŠŠ method å¹³é“ºè€Œå·²ã€‚link è¦å’Œ inhash ä¸€èµ·æ¥è¯´ã€‚åœ¨ runtime åŒ…é‡Œé¢æœ‰ä¸€ä¸ª hash è¡¨ï¼Œé€šè¿‡ hash[hashitab(interface_type, concrete_type)] å¯ä»¥å–å¾— itabï¼Œè¿™æ˜¯å‡ºäºæ€§èƒ½æ–¹é¢çš„è€ƒè™‘ã€‚ä¸»è¦ä»£ç å¦‚ä¸‹ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    hashSize = <span class="number">1009</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    ifaceLock mutex <span class="comment">// lock for accessing hash</span></span><br><span class="line">    hash      [hashSize]*itab</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">itabhash</span><span class="params">(inter *interfacetype, typ *_type)</span> <span class="title">uint32</span></span> &#123;</span><br><span class="line">    <span class="comment">// compiler has provided some good hash codes for us.</span></span><br><span class="line">    h := inter.typ.hash</span><br><span class="line">    h += <span class="number">17</span> * typ.hash</span><br><span class="line">    <span class="comment">// TODO(rsc): h += 23 * x.mhash ?</span></span><br><span class="line">    <span class="keyword">return</span> h % hashSize</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">additab</span><span class="params">(...)</span></span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    h := itabhash(inter, typ)</span><br><span class="line">    m.link = hash[h]</span><br><span class="line">    m.inhash = <span class="number">1</span></span><br><span class="line">    atomicstorep(unsafe.Pointer(&amp;hash[h]), unsafe.Pointer(m))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="ç±»å‹æ–­è¨€-1"><a href="#ç±»å‹æ–­è¨€-1" class="headerlink" title="ç±»å‹æ–­è¨€"></a>ç±»å‹æ–­è¨€</h2><p>ä¸Šé¢æœ‰è¯´åˆ°çš„æ–­è¨€ï¼Œå®ƒçš„å®ç°æºç å¦‚ä¸‹å‡ ä¸ªå‡½æ•°ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The assertXXX functions may fail (either panicking or returning false,</span></span><br><span class="line"><span class="comment">// depending on whether they are 1-result or 2-result).</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">assertI2I</span><span class="params">(inter *interfacetype, i iface)</span> <span class="params">(r iface)</span></span> &#123;</span><br><span class="line">    tab := i.tab</span><br><span class="line">    <span class="keyword">if</span> tab == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="comment">// explicit conversions require non-nil interface value.</span></span><br><span class="line">        <span class="built_in">panic</span>(&amp;TypeAssertionError&#123;<span class="string">""</span>, <span class="string">""</span>, inter.typ.<span class="keyword">string</span>(), <span class="string">""</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> tab.inter == inter &#123;</span><br><span class="line">        r.tab = tab</span><br><span class="line">        r.data = i.data</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    r.tab = getitab(inter, tab._type, <span class="literal">false</span>)</span><br><span class="line">    r.data = i.data</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">assertI2I2</span><span class="params">(inter *interfacetype, i iface)</span> <span class="params">(r iface, b <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">    tab := i.tab</span><br><span class="line">    <span class="keyword">if</span> tab == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> tab.inter != inter &#123;</span><br><span class="line">        tab = getitab(inter, tab._type, <span class="literal">true</span>)</span><br><span class="line">        <span class="keyword">if</span> tab == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    r.tab = tab</span><br><span class="line">    r.data = i.data</span><br><span class="line">    b = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»ä¼¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">assertE2I</span><span class="params">(inter *interfacetype, e eface)</span> <span class="params">(r iface)</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">assertE2I2</span><span class="params">(inter *interfacetype, e eface)</span> <span class="params">(r iface, b <span class="keyword">bool</span>)</span></span></span><br></pre></td></tr></table></figure></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>goçš„interfaceæ˜¯ä¸€ç§ç±»å‹ï¼Œä»æºç æ¥çœ‹ï¼Œå…¶ä»–ç±»å‹åœ¨èµ‹å€¼ç»™ä¸€ä¸ªæ¥å£çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºç»“æ„ï¼ˆifaceå’Œefaceï¼‰æ¥åŒ…è£…è¿™ä¸ªåŸå§‹æ•°æ®ã€‚è¿˜æœ‰goçš„é¸­å­ç±»å‹è¿™ç§ç‰¹ç‚¹ï¼Œæ–¹ä¾¿å¤šæ€çš„å®ç°ã€‚</p>
<p>å‚è€ƒ <a href="https://zhuanlan.zhihu.com/p/27652856" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/27652856</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;æ¥å£æ˜¯ä»€ä¹ˆ&quot;&gt;&lt;a href=&quot;#æ¥å£æ˜¯ä»€ä¹ˆ&quot; class=&quot;headerlink&quot; title=&quot;æ¥å£æ˜¯ä»€ä¹ˆ&quot;&gt;&lt;/a&gt;æ¥å£æ˜¯ä»€ä¹ˆ&lt;/h1&gt;&lt;p&gt;æ¥å£å°±æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»å‹ï¼Œä¸ä¹‹å¯¹åº”çš„å°±æ˜¯å…·ä½“ç±»å‹ï¼ŒåŒæ—¶æ¥å£ä¹Ÿæ˜¯æŠ½è±¡æ–¹æ³•æ¥å£ã€‚&lt;br&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;type&lt;/span&gt; human &lt;span class=&quot;keyword&quot;&gt;interface&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	walk()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	run()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	eat()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šé¢çš„ä»£ç å®šä¹‰äº†æ¥å£ï¼Œæ¥å£é‡Œå®šä¹‰äº†å‡ ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œä¸€èˆ¬å…¶ä»–è¯­è¨€ä¾‹å¦‚Javaï¼Œéƒ½ä¼šå®šä¹‰ä¸€ä¸ªå…·ä½“çš„ç±»å‹æ¥å®ç°è¿™ä¸ªæ¥å£ï¼Œåƒè¿™æ ·&lt;code&gt;class man implements human&lt;/code&gt; å£°æ˜&lt;code&gt;man&lt;/code&gt;å®ç°äº†&lt;code&gt;human&lt;/code&gt;ã€‚ä½†æ˜¯goä¸Šä½¿ç”¨äº†ä¸€ç§&lt;code&gt;duck typing&lt;/code&gt;æ¥å®šä¹‰å…·ä½“ç±»å‹ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="go" scheme="http://idiotsky.top/categories/go/"/>
    
    
      <category term="go" scheme="http://idiotsky.top/tags/go/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨scrollå®ç°Elasticsearchæ•°æ®éå†å’Œæ·±åº¦åˆ†é¡µ</title>
    <link href="http://idiotsky.top/2018/01/11/elasticsearch-scroll/"/>
    <id>http://idiotsky.top/2018/01/11/elasticsearch-scroll/</id>
    <published>2018-01-11T02:09:18.000Z</published>
    <updated>2018-07-17T11:39:16.528Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>ä¹‹å‰é¢è¯•è¢«é—®åˆ°æ·±åˆ†é¡µçš„é—®é¢˜ï¼Œç°åœ¨markä¸€ä¸‹å§</p>
</blockquote>
<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>Elasticsearch æ˜¯ä¸€ä¸ªå®æ—¶çš„åˆ†å¸ƒå¼æœç´¢ä¸åˆ†æå¼•æ“ï¼Œè¢«å¹¿æ³›ç”¨æ¥åšå…¨æ–‡æœç´¢ã€ç»“æ„åŒ–æœç´¢ã€åˆ†æã€‚åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€äº›å…¸å‹çš„ä½¿ç”¨åœºæ™¯ï¼Œæ¯”å¦‚åˆ†é¡µã€éå†ç­‰ã€‚åœ¨ä½¿ç”¨å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬è¢«å‘ŠçŸ¥è¦æ³¨æ„ç”šè‡³è¢«æ˜ç¡®ç¦æ­¢ä½¿ç”¨æ·±åº¦åˆ†é¡µï¼ŒåŒç†ï¼Œåœ¨ Elasticsearch ä¸­ï¼Œä¹Ÿåº”è¯¥å°½é‡é¿å…ä½¿ç”¨æ·±åº¦åˆ†é¡µã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç» Elasticsearch ä¸­ä½¿ç”¨åˆ†é¡µçš„æ–¹å¼ã€Elasticsearch æœç´¢æ‰§è¡Œè¿‡ç¨‹ä»¥åŠä¸ºä»€ä¹ˆæ·±åº¦åˆ†é¡µåº”è¯¥è¢«ç¦æ­¢ï¼Œæœ€åå†ä»‹ç»ä½¿ç”¨ scroll çš„æ–¹å¼éå†æ•°æ®ã€‚</p>
<h1 id="Elasticsearch-æœç´¢å†…éƒ¨æ‰§è¡ŒåŸç†"><a href="#Elasticsearch-æœç´¢å†…éƒ¨æ‰§è¡ŒåŸç†" class="headerlink" title="Elasticsearch æœç´¢å†…éƒ¨æ‰§è¡ŒåŸç†"></a>Elasticsearch æœç´¢å†…éƒ¨æ‰§è¡ŒåŸç†</h1><p>ä¸€ä¸ªæœ€åŸºæœ¬çš„ Elasticsearch æŸ¥è¯¢è¯­å¥æ˜¯è¿™æ ·çš„ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /my_index/my_type/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123; &quot;match_all&quot;: &#123;&#125;&#125;,</span><br><span class="line">    &quot;from&quot;: 100,</span><br><span class="line">    &quot;size&quot;:  10</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢çš„æŸ¥è¯¢è¡¨ç¤ºä»æœç´¢ç»“æœä¸­å–ç¬¬100æ¡å¼€å§‹çš„10æ¡æ•°æ®ã€‚ä¸‹é¢è®²è§£æœç´¢è¿‡ç¨‹æ—¶ä¹Ÿä»¥è¿™ä¸ªè¯·æ±‚ä¸ºä¾‹ã€‚</p>
<p>é‚£ä¹ˆï¼Œè¿™ä¸ªæŸ¥è¯¢è¯­å¥åœ¨ Elasticsearch é›†ç¾¤å†…éƒ¨æ˜¯æ€ä¹ˆæ‰§è¡Œçš„å‘¢ï¼Ÿä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œæˆ‘ä»¬å‡è®¾è¯¥ index åªæœ‰primary shardsï¼Œæ²¡æœ‰ replica shardsã€‚</p>
<p>åœ¨ Elasticsearch ä¸­ï¼Œæœç´¢ä¸€èˆ¬åŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µï¼Œquery å’Œ fetch é˜¶æ®µï¼Œå¯ä»¥ç®€å•çš„ç†è§£ï¼Œquery é˜¶æ®µç¡®å®šè¦å–å“ªäº›docï¼Œfetch é˜¶æ®µå–å‡ºå…·ä½“çš„ docã€‚<br><a id="more"></a></p>
<h2 id="Query-é˜¶æ®µ"><a href="#Query-é˜¶æ®µ" class="headerlink" title="Query é˜¶æ®µ"></a>Query é˜¶æ®µ</h2><p><a href="http://idiotsky.top/images2/es-scroll-1.jpg"><img src="http://idiotsky.top/images2/es-scroll-1.jpg" alt=""></a></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæè¿°äº†ä¸€æ¬¡æœç´¢è¯·æ±‚çš„ query é˜¶æ®µã€‚</p>
<ol>
<li>Client å‘é€ä¸€æ¬¡æœç´¢è¯·æ±‚ï¼Œnode1 æ¥æ”¶åˆ°è¯·æ±‚ï¼Œç„¶åï¼Œnode1 åˆ›å»ºä¸€ä¸ªå¤§å°ä¸º from + size çš„ä¼˜å…ˆçº§é˜Ÿåˆ—ç”¨æ¥å­˜ç»“æœï¼Œæˆ‘ä»¬ç®¡ node1 å« coordinating nodeã€‚</li>
<li>coordinating nodeå°†è¯·æ±‚å¹¿æ’­åˆ°æ¶‰åŠåˆ°çš„ shardsï¼Œæ¯ä¸ª shard åœ¨å†…éƒ¨æ‰§è¡Œæœç´¢è¯·æ±‚ï¼Œç„¶åï¼Œå°†ç»“æœå­˜åˆ°å†…éƒ¨çš„å¤§å°åŒæ ·ä¸º from + size çš„ä¼˜å…ˆçº§é˜Ÿåˆ—é‡Œï¼Œå¯ä»¥æŠŠä¼˜å…ˆçº§é˜Ÿåˆ—ç†è§£ä¸ºä¸€ä¸ªåŒ…å« top N ç»“æœçš„åˆ—è¡¨ã€‚</li>
<li>æ¯ä¸ª shard æŠŠæš‚å­˜åœ¨è‡ªèº«ä¼˜å…ˆçº§é˜Ÿåˆ—é‡Œçš„æ•°æ®è¿”å›ç»™ coordinating nodeï¼Œcoordinating node æ‹¿åˆ°å„ä¸ª shards è¿”å›çš„ç»“æœåå¯¹ç»“æœè¿›è¡Œä¸€æ¬¡åˆå¹¶ï¼Œäº§ç”Ÿä¸€ä¸ªå…¨å±€çš„ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå­˜åˆ°è‡ªèº«çš„ä¼˜å…ˆçº§é˜Ÿåˆ—é‡Œã€‚</li>
</ol>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œcoordinating node æ‹¿åˆ° (from + size) * 6 æ¡æ•°æ®ï¼Œç„¶ååˆå¹¶å¹¶æ’åºåé€‰æ‹©å‰é¢çš„ from + size æ¡æ•°æ®å­˜åˆ°ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œä»¥ä¾¿ fetch é˜¶æ®µä½¿ç”¨ã€‚å¦å¤–ï¼Œå„ä¸ªåˆ†ç‰‡è¿”å›ç»™ coordinating node çš„æ•°æ®ç”¨äºé€‰å‡ºå‰ from + size æ¡æ•°æ®ï¼Œæ‰€ä»¥ï¼Œåªéœ€è¦è¿”å›å”¯ä¸€æ ‡è®° doc çš„ _id ä»¥åŠç”¨äºæ’åºçš„ _score å³å¯ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥ä¿è¯è¿”å›çš„æ•°æ®é‡è¶³å¤Ÿå°ã€‚</p>
<p>coordinating node è®¡ç®—å¥½è‡ªå·±çš„ä¼˜å…ˆçº§é˜Ÿåˆ—åï¼Œquery é˜¶æ®µç»“æŸï¼Œè¿›å…¥ fetch é˜¶æ®µã€‚</p>
<h2 id="Fetch-é˜¶æ®µ"><a href="#Fetch-é˜¶æ®µ" class="headerlink" title="Fetch é˜¶æ®µ"></a>Fetch é˜¶æ®µ</h2><p>query é˜¶æ®µçŸ¥é“äº†è¦å–å“ªäº›æ•°æ®ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å–å…·ä½“çš„æ•°æ®ï¼Œè¿™å°±æ˜¯ fetch é˜¶æ®µè¦åšçš„ã€‚<br><a href="http://idiotsky.top/images2/es-scroll-2.jpg"><img src="http://idiotsky.top/images2/es-scroll-2.jpg" alt=""></a></p>
<p>ä¸Šå›¾å±•ç¤ºäº† fetch è¿‡ç¨‹ï¼š</p>
<ol>
<li>coordinating node å‘é€ GET è¯·æ±‚åˆ°ç›¸å…³shardsã€‚</li>
<li>shard æ ¹æ® doc çš„ _id å–åˆ°æ•°æ®è¯¦æƒ…ï¼Œç„¶åè¿”å›ç»™ coordinating nodeã€‚</li>
<li>coordinating node è¿”å›æ•°æ®ç»™ Clientã€‚</li>
</ol>
<p>coordinating node çš„ä¼˜å…ˆçº§é˜Ÿåˆ—é‡Œæœ‰ from + size ä¸ª _doc _idï¼Œä½†æ˜¯ï¼Œåœ¨ fetch é˜¶æ®µï¼Œå¹¶ä¸éœ€è¦å–å›æ‰€æœ‰æ•°æ®ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå‰100æ¡æ•°æ®æ˜¯ä¸éœ€è¦å–çš„ï¼Œåªéœ€è¦å–ä¼˜å…ˆçº§é˜Ÿåˆ—é‡Œçš„ç¬¬101åˆ°110æ¡æ•°æ®å³å¯ã€‚</p>
<p>éœ€è¦å–çš„æ•°æ®å¯èƒ½åœ¨ä¸åŒåˆ†ç‰‡ï¼Œä¹Ÿå¯èƒ½åœ¨åŒä¸€åˆ†ç‰‡ï¼Œcoordinating node ä½¿ç”¨ multi-get æ¥é¿å…å¤šæ¬¡å»åŒä¸€åˆ†ç‰‡å–æ•°æ®ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</p>
<h1 id="æ·±åº¦åˆ†é¡µçš„é—®é¢˜"><a href="#æ·±åº¦åˆ†é¡µçš„é—®é¢˜" class="headerlink" title="æ·±åº¦åˆ†é¡µçš„é—®é¢˜"></a>æ·±åº¦åˆ†é¡µçš„é—®é¢˜</h1><p>Elasticsearch çš„è¿™ç§æ–¹å¼æä¾›äº†åˆ†é¡µçš„åŠŸèƒ½ï¼ŒåŒæ—¶ï¼Œä¹Ÿæœ‰ç›¸åº”çš„é™åˆ¶ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªç´¢å¼•ï¼Œæœ‰10äº¿æ•°æ®ï¼Œåˆ†10ä¸ª shardsï¼Œç„¶åï¼Œä¸€ä¸ªæœç´¢è¯·æ±‚ï¼Œfrom=1,000,000ï¼Œsize=100ï¼Œè¿™æ—¶å€™ï¼Œä¼šå¸¦æ¥ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ï¼š</p>
<ul>
<li>CPU</li>
<li>å†…å­˜</li>
<li>IO</li>
<li>ç½‘ç»œå¸¦å®½</li>
</ul>
<p>CPUã€å†…å­˜å’ŒIOæ¶ˆè€—å®¹æ˜“ç†è§£ï¼Œç½‘ç»œå¸¦å®½é—®é¢˜ç¨éš¾ç†è§£ä¸€ç‚¹ã€‚åœ¨ query é˜¶æ®µï¼Œæ¯ä¸ªshardséœ€è¦è¿”å› 1,000,100 æ¡æ•°æ®ç»™ coordinating nodeï¼Œè€Œ coordinating node éœ€è¦æ¥æ”¶ 10 * 1,000,100 æ¡æ•°æ®ï¼Œå³ä½¿æ¯æ¡æ•°æ®åªæœ‰ _doc _id å’Œ _scoreï¼Œè¿™æ•°æ®é‡ä¹Ÿå¾ˆå¤§äº†ï¼Œè€Œä¸”ï¼Œè¿™æ‰ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚ï¼Œé‚£å¦‚æœå†ä¹˜ä»¥100å‘¢ï¼Ÿ</p>
<p>åœ¨å¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬æ„è¯†åˆ°ï¼Œè¿™ç§æ·±åº¦åˆ†é¡µçš„è¯·æ±‚å¹¶ä¸åˆç†ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯å¾ˆå°‘äººä¸ºçš„çœ‹å¾ˆåé¢çš„è¯·æ±‚çš„ï¼Œåœ¨å¾ˆå¤šçš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œéƒ½ç›´æ¥é™åˆ¶åˆ†é¡µï¼Œæ¯”å¦‚åªèƒ½çœ‹å‰100é¡µã€‚</p>
<p>ä¸è¿‡ï¼Œè¿™ç§æ·±åº¦åˆ†é¡µç¡®å®å­˜åœ¨ï¼Œæ¯”å¦‚ï¼Œè¢«çˆ¬è™«äº†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œç›´æ¥å¹²æ‰æ·±åº¦åˆ†é¡µå°±å¥½ï¼›åˆæˆ–è€…ï¼Œä¸šåŠ¡ä¸Šæœ‰éå†æ•°æ®çš„éœ€è¦ï¼Œæ¯”å¦‚ï¼Œæœ‰1åƒä¸‡ç²‰ä¸çš„å¾®ä¿¡å¤§Vï¼Œè¦ç»™æ‰€æœ‰ç²‰ä¸ç¾¤å‘æ¶ˆæ¯ï¼Œæˆ–è€…ç»™æŸçœç²‰ä¸ç¾¤å‘ï¼Œè¿™æ—¶å€™å°±éœ€è¦å–å¾—æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„ç²‰ä¸ï¼Œè€Œæœ€å®¹æ˜“æƒ³åˆ°çš„å°±æ˜¯åˆ©ç”¨ from + size æ¥å®ç°ï¼Œä¸è¿‡ï¼Œè¿™ä¸ªæ˜¯ä¸ç°å®çš„ï¼Œè¿™æ—¶ï¼Œå¯ä»¥é‡‡ç”¨ Elasticsearch æä¾›çš„ scroll æ–¹å¼æ¥å®ç°éå†ã€‚</p>
<h1 id="åˆ©ç”¨-scroll-éå†æ•°æ®"><a href="#åˆ©ç”¨-scroll-éå†æ•°æ®" class="headerlink" title="åˆ©ç”¨ scroll éå†æ•°æ®"></a>åˆ©ç”¨ scroll éå†æ•°æ®</h1><p>å¯ä»¥æŠŠ scroll ç†è§£ä¸ºå…³ç³»å‹æ•°æ®åº“é‡Œçš„ cursorï¼Œå› æ­¤ï¼Œscroll å¹¶ä¸é€‚åˆç”¨æ¥åšå®æ—¶æœç´¢ï¼Œè€Œæ›´é€‚ç”¨äºåå°æ‰¹å¤„ç†ä»»åŠ¡ï¼Œæ¯”å¦‚ç¾¤å‘ã€‚</p>
<p>å¯ä»¥æŠŠ scroll åˆ†ä¸ºåˆå§‹åŒ–å’Œéå†ä¸¤æ­¥ï¼Œåˆå§‹åŒ–æ—¶å°†æ‰€æœ‰ç¬¦åˆæœç´¢æ¡ä»¶çš„æœç´¢ç»“æœç¼“å­˜èµ·æ¥ï¼Œå¯ä»¥æƒ³è±¡æˆå¿«ç…§ï¼Œåœ¨éå†æ—¶ï¼Œä»è¿™ä¸ªå¿«ç…§é‡Œå–æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨åˆå§‹åŒ–åå¯¹ç´¢å¼•æ’å…¥ã€åˆ é™¤ã€æ›´æ–°æ•°æ®éƒ½ä¸ä¼šå½±å“éå†ç»“æœã€‚</p>
<h2 id="ä½¿ç”¨ä»‹ç»"><a href="#ä½¿ç”¨ä»‹ç»" class="headerlink" title="ä½¿ç”¨ä»‹ç»"></a>ä½¿ç”¨ä»‹ç»</h2><p>ä¸‹é¢ä»‹ç»ä¸‹scrollçš„ä½¿ç”¨ï¼Œå¯ä»¥é€šè¿‡ Elasticsearch çš„ HTTP æ¥å£åšè¯•éªŒä¸‹ï¼ŒåŒ…æ‹¬åˆå§‹åŒ–å’Œéå†ä¸¤ä¸ªéƒ¨åˆ†ã€‚</p>
<h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST ip:port/my_index/my_type/_search?scroll=1m</span><br><span class="line">&#123;</span><br><span class="line">	&quot;query&quot;: &#123; &quot;match_all&quot;: &#123;&#125;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆå§‹åŒ–æ—¶éœ€è¦åƒæ™®é€š search ä¸€æ ·ï¼ŒæŒ‡æ˜ index å’Œ type (å½“ç„¶ï¼Œsearch æ˜¯å¯ä»¥ä¸æŒ‡æ˜ index å’Œ type çš„)ï¼Œç„¶åï¼ŒåŠ ä¸Šå‚æ•° scrollï¼Œè¡¨ç¤ºæš‚å­˜æœç´¢ç»“æœçš„æ—¶é—´ï¼Œå…¶å®ƒå°±åƒä¸€ä¸ªæ™®é€šçš„searchè¯·æ±‚ä¸€æ ·ã€‚</p>
<p>åˆå§‹åŒ–è¿”å›ä¸€ä¸ª _scroll_idï¼Œ_scroll_id ç”¨æ¥ä¸‹æ¬¡å–æ•°æ®ç”¨ã€‚</p>
<h3 id="éå†"><a href="#éå†" class="headerlink" title="éå†"></a>éå†</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /_search?scroll=1m</span><br><span class="line">&#123;</span><br><span class="line">    &quot;scroll_id&quot;:&quot;XXXXXXXXXXXXXXXXXXXXXXX I am scroll id XXXXXXXXXXXXXXX&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„ scroll_id å³ ä¸Šä¸€æ¬¡éå†å–å›çš„ _scroll_id æˆ–è€…æ˜¯åˆå§‹åŒ–è¿”å›çš„ _scroll_idï¼ŒåŒæ ·çš„ï¼Œéœ€è¦å¸¦ scroll å‚æ•°ã€‚ é‡å¤è¿™ä¸€æ­¥éª¤ï¼Œç›´åˆ°è¿”å›çš„æ•°æ®ä¸ºç©ºï¼Œå³éå†å®Œæˆã€‚æ³¨æ„ï¼Œæ¯æ¬¡éƒ½è¦ä¼ å‚æ•° scrollï¼Œåˆ·æ–°æœç´¢ç»“æœçš„ç¼“å­˜æ—¶é—´ã€‚å¦å¤–ï¼Œä¸éœ€è¦æŒ‡å®š index å’Œ typeã€‚</p>
<p>è®¾ç½®scrollçš„æ—¶å€™ï¼Œéœ€è¦ä½¿æœç´¢ç»“æœç¼“å­˜åˆ°ä¸‹ä¸€æ¬¡éå†å®Œæˆï¼ŒåŒæ—¶ï¼Œä¹Ÿä¸èƒ½å¤ªé•¿ï¼Œæ¯•ç«Ÿç©ºé—´æœ‰é™ã€‚</p>
<h2 id="Scroll-Scan"><a href="#Scroll-Scan" class="headerlink" title="Scroll-Scan"></a>Scroll-Scan</h2><p>Elasticsearch æä¾›äº† Scroll-Scan æ–¹å¼è¿›ä¸€æ­¥æé«˜éå†æ€§èƒ½ã€‚è¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼Œå¾®ä¿¡å¤§Vè¦ç»™ç²‰ä¸ç¾¤å‘è¿™ç§åå°ä»»åŠ¡ï¼Œæ˜¯ä¸éœ€è¦å…³æ³¨é¡ºåºçš„ï¼Œåªè¦èƒ½éå†æ‰€æœ‰æ•°æ®å³å¯ï¼Œè¿™æ—¶å€™ï¼Œå°±å¯ä»¥ç”¨Scroll-Scanã€‚</p>
<p>Scroll-Scan çš„éå†ä¸æ™®é€š Scroll ä¸€æ ·ï¼Œåˆå§‹åŒ–å­˜åœ¨ä¸€ç‚¹å·®åˆ«ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST ip:port/my_index/my_type/_search?search_type=scan&amp;scroll=1m&amp;size=50</span><br><span class="line">&#123;</span><br><span class="line">	&quot;query&quot;: &#123; &quot;match_all&quot;: &#123;&#125;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>éœ€è¦æŒ‡æ˜å‚æ•°ï¼š</p>
<ul>
<li>search_typeã€‚èµ‹å€¼ä¸ºscanï¼Œè¡¨ç¤ºé‡‡ç”¨ Scroll-Scan çš„æ–¹å¼éå†ï¼ŒåŒæ—¶å‘Šè¯‰ Elasticsearch æœç´¢ç»“æœä¸éœ€è¦æ’åºã€‚</li>
<li>scrollã€‚åŒä¸Šï¼Œä¼ æ—¶é—´ã€‚</li>
<li>sizeã€‚ä¸æ™®é€šçš„ size ä¸åŒï¼Œè¿™ä¸ª size è¡¨ç¤ºçš„æ˜¯æ¯ä¸ª shard è¿”å›çš„ size æ•°ï¼Œæœ€ç»ˆç»“æœæœ€å¤§ä¸º number_of_shards * sizeã€‚</li>
</ul>
<p>Scroll-Scan æ–¹å¼ä¸æ™®é€š scroll æœ‰å‡ ç‚¹ä¸åŒï¼š</p>
<ol>
<li>Scroll-Scan ç»“æœæ²¡æœ‰æ’åºï¼ŒæŒ‰ index é¡ºåºè¿”å›ï¼Œæ²¡æœ‰æ’åºï¼Œå¯ä»¥æé«˜å–æ•°æ®æ€§èƒ½ã€‚</li>
<li>åˆå§‹åŒ–æ—¶åªè¿”å› _scroll_idï¼Œæ²¡æœ‰å…·ä½“çš„ hits ç»“æœã€‚</li>
<li>size æ§åˆ¶çš„æ˜¯æ¯ä¸ªåˆ†ç‰‡çš„è¿”å›çš„æ•°æ®é‡è€Œä¸æ˜¯æ•´ä¸ªè¯·æ±‚è¿”å›çš„æ•°æ®é‡ã€‚</li>
</ol>
<h2 id="Java-å®ç°"><a href="#Java-å®ç°" class="headerlink" title="Java å®ç°"></a>Java å®ç°</h2><p>ç”¨ Java ä¸¾ä¸ªä¾‹å­ã€‚</p>
<h3 id="åˆå§‹åŒ–-1"><a href="#åˆå§‹åŒ–-1" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    response = esClient.prepareSearch(index)</span><br><span class="line">            .setTypes(type)</span><br><span class="line">            .setSearchType(SearchType.SCAN)</span><br><span class="line">            .setQuery(query)</span><br><span class="line">            .setScroll(<span class="keyword">new</span> TimeValue(timeout))</span><br><span class="line">            .setSize(size)</span><br><span class="line">            .execute()</span><br><span class="line">            .actionGet();</span><br><span class="line">&#125; <span class="keyword">catch</span> (ElasticsearchException e) &#123;</span><br><span class="line">    <span class="comment">// handle Exception</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆå§‹åŒ–è¿”å› _scroll_idï¼Œç„¶åï¼Œç”¨ _scroll_id å»éå†ï¼Œæ³¨æ„ï¼Œä¸Šé¢çš„queryæ˜¯ä¸€ä¸ªJSONObjectï¼Œä¸è¿‡è¿™é‡Œå¾ˆå¤šç§å®ç°æ–¹å¼ï¼Œæˆ‘è¿™å„¿åªæ˜¯ä¸ªä¾‹å­ã€‚</p>
<h3 id="éå†-1"><a href="#éå†-1" class="headerlink" title="éå†"></a>éå†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    response = esClient.prepareSearchScroll(scrollId)</span><br><span class="line">            .setScroll(<span class="keyword">new</span> TimeValue(timeout))</span><br><span class="line">            .execute()</span><br><span class="line">            .actionGet();</span><br><span class="line">&#125; <span class="keyword">catch</span> (ElasticsearchException e) &#123;</span><br><span class="line">    <span class="comment">// handle Exception</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ol>
<li>æ·±åº¦åˆ†é¡µä¸ç®¡æ˜¯å…³ç³»å‹æ•°æ®åº“è¿˜æ˜¯Elasticsearchè¿˜æ˜¯å…¶ä»–æœç´¢å¼•æ“ï¼Œéƒ½ä¼šå¸¦æ¥å·¨å¤§æ€§èƒ½å¼€é”€ï¼Œç‰¹åˆ«æ˜¯åœ¨åˆ†å¸ƒå¼æƒ…å†µä¸‹ã€‚</li>
<li>æœ‰äº›é—®é¢˜å¯ä»¥è€ƒä¸šåŠ¡è§£å†³è€Œä¸æ˜¯é æŠ€æœ¯è§£å†³ï¼Œæ¯”å¦‚å¾ˆå¤šä¸šåŠ¡éƒ½å¯¹é¡µç æœ‰é™åˆ¶ï¼Œgoogle æœç´¢ï¼Œå¾€åç¿»åˆ°ä¸€å®šé¡µç å°±ä¸è¡Œäº†ã€‚</li>
<li>Elasticsearch æä¾›çš„ Scroll æ¥å£ä¸“é—¨ç”¨æ¥è·å–å¤§é‡æ•°æ®ç”šè‡³å…¨éƒ¨æ•°æ®ï¼Œåœ¨é¡ºåºæ— å…³æƒ…å†µä¸‹ï¼Œé¦–æ¨Scroll-Scanã€‚</li>
<li>æè¿°æœç´¢è¿‡ç¨‹æ—¶ï¼Œä¸ºäº†ç®€åŒ–æè¿°ï¼Œå‡è®¾ index æ²¡æœ‰å¤‡ä»½ï¼Œå®é™…ä¸Šï¼Œindex è‚¯å®šä¼šæœ‰å¤‡ä»½ï¼Œè¿™æ—¶å€™ï¼Œå°±æ¶‰åŠåˆ°é€‰æ‹© shardã€‚</li>
</ol>
<p>from <a href="http://lxwei.github.io/posts/%E4%BD%BF%E7%94%A8scroll%E5%AE%9E%E7%8E%B0Elasticsearch%E6%95%B0%E6%8D%AE%E9%81%8D%E5%8E%86%E5%92%8C%E6%B7%B1%E5%BA%A6%E5%88%86%E9%A1%B5.html" target="_blank" rel="noopener">http://lxwei.github.io/posts/%E4%BD%BF%E7%94%A8scroll%E5%AE%9E%E7%8E%B0Elasticsearch%E6%95%B0%E6%8D%AE%E9%81%8D%E5%8E%86%E5%92%8C%E6%B7%B1%E5%BA%A6%E5%88%86%E9%A1%B5.html</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä¹‹å‰é¢è¯•è¢«é—®åˆ°æ·±åˆ†é¡µçš„é—®é¢˜ï¼Œç°åœ¨markä¸€ä¸‹å§&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;Elasticsearch æ˜¯ä¸€ä¸ªå®æ—¶çš„åˆ†å¸ƒå¼æœç´¢ä¸åˆ†æå¼•æ“ï¼Œè¢«å¹¿æ³›ç”¨æ¥åšå…¨æ–‡æœç´¢ã€ç»“æ„åŒ–æœç´¢ã€åˆ†æã€‚åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€äº›å…¸å‹çš„ä½¿ç”¨åœºæ™¯ï¼Œæ¯”å¦‚åˆ†é¡µã€éå†ç­‰ã€‚åœ¨ä½¿ç”¨å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬è¢«å‘ŠçŸ¥è¦æ³¨æ„ç”šè‡³è¢«æ˜ç¡®ç¦æ­¢ä½¿ç”¨æ·±åº¦åˆ†é¡µï¼ŒåŒç†ï¼Œåœ¨ Elasticsearch ä¸­ï¼Œä¹Ÿåº”è¯¥å°½é‡é¿å…ä½¿ç”¨æ·±åº¦åˆ†é¡µã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç» Elasticsearch ä¸­ä½¿ç”¨åˆ†é¡µçš„æ–¹å¼ã€Elasticsearch æœç´¢æ‰§è¡Œè¿‡ç¨‹ä»¥åŠä¸ºä»€ä¹ˆæ·±åº¦åˆ†é¡µåº”è¯¥è¢«ç¦æ­¢ï¼Œæœ€åå†ä»‹ç»ä½¿ç”¨ scroll çš„æ–¹å¼éå†æ•°æ®ã€‚&lt;/p&gt;
&lt;h1 id=&quot;Elasticsearch-æœç´¢å†…éƒ¨æ‰§è¡ŒåŸç†&quot;&gt;&lt;a href=&quot;#Elasticsearch-æœç´¢å†…éƒ¨æ‰§è¡ŒåŸç†&quot; class=&quot;headerlink&quot; title=&quot;Elasticsearch æœç´¢å†…éƒ¨æ‰§è¡ŒåŸç†&quot;&gt;&lt;/a&gt;Elasticsearch æœç´¢å†…éƒ¨æ‰§è¡ŒåŸç†&lt;/h1&gt;&lt;p&gt;ä¸€ä¸ªæœ€åŸºæœ¬çš„ Elasticsearch æŸ¥è¯¢è¯­å¥æ˜¯è¿™æ ·çš„ï¼š&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;POST /my_index/my_type/_search&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;query&amp;quot;: &amp;#123; &amp;quot;match_all&amp;quot;: &amp;#123;&amp;#125;&amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;from&amp;quot;: 100,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;size&amp;quot;:  10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šé¢çš„æŸ¥è¯¢è¡¨ç¤ºä»æœç´¢ç»“æœä¸­å–ç¬¬100æ¡å¼€å§‹çš„10æ¡æ•°æ®ã€‚ä¸‹é¢è®²è§£æœç´¢è¿‡ç¨‹æ—¶ä¹Ÿä»¥è¿™ä¸ªè¯·æ±‚ä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆï¼Œè¿™ä¸ªæŸ¥è¯¢è¯­å¥åœ¨ Elasticsearch é›†ç¾¤å†…éƒ¨æ˜¯æ€ä¹ˆæ‰§è¡Œçš„å‘¢ï¼Ÿä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œæˆ‘ä»¬å‡è®¾è¯¥ index åªæœ‰primary shardsï¼Œæ²¡æœ‰ replica shardsã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Elasticsearch ä¸­ï¼Œæœç´¢ä¸€èˆ¬åŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µï¼Œquery å’Œ fetch é˜¶æ®µï¼Œå¯ä»¥ç®€å•çš„ç†è§£ï¼Œquery é˜¶æ®µç¡®å®šè¦å–å“ªäº›docï¼Œfetch é˜¶æ®µå–å‡ºå…·ä½“çš„ docã€‚&lt;br&gt;
    
    </summary>
    
      <category term="elasticsearch" scheme="http://idiotsky.top/categories/elasticsearch/"/>
    
    
      <category term="elasticsearch" scheme="http://idiotsky.top/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>ç”¨goå°è¯•websocket</title>
    <link href="http://idiotsky.top/2018/01/10/go-websocket/"/>
    <id>http://idiotsky.top/2018/01/10/go-websocket/</id>
    <published>2018-01-10T07:44:21.000Z</published>
    <updated>2018-07-17T11:39:16.527Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯websocket"><a href="#ä»€ä¹ˆæ˜¯websocket" class="headerlink" title="ä»€ä¹ˆæ˜¯websocket"></a>ä»€ä¹ˆæ˜¯websocket</h1><p>åˆæ¬¡æ¥è§¦ WebSocket çš„äººï¼Œéƒ½ä¼šé—®åŒæ ·çš„é—®é¢˜ï¼šæˆ‘ä»¬å·²ç»æœ‰äº† HTTP åè®®ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦å¦ä¸€ä¸ªåè®®ï¼Ÿå®ƒèƒ½å¸¦æ¥ä»€ä¹ˆå¥½å¤„ï¼Ÿ<br>ç­”æ¡ˆå¾ˆç®€å•ï¼Œå› ä¸º HTTP åè®®æœ‰ä¸€ä¸ªç¼ºé™·ï¼šé€šä¿¡åªèƒ½ç”±å®¢æˆ·ç«¯å‘èµ·ã€‚</p>
<p>ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä»¬æƒ³äº†è§£ä»Šå¤©çš„å¤©æ°”ï¼Œåªèƒ½æ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›æŸ¥è¯¢ç»“æœã€‚HTTP åè®®åšä¸åˆ°æœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€ä¿¡æ¯ã€‚<br>è¿™ç§å•å‘è¯·æ±‚çš„ç‰¹ç‚¹ï¼Œæ³¨å®šäº†å¦‚æœæœåŠ¡å™¨æœ‰è¿ç»­çš„çŠ¶æ€å˜åŒ–ï¼Œå®¢æˆ·ç«¯è¦è·çŸ¥å°±éå¸¸éº»çƒ¦ã€‚æˆ‘ä»¬åªèƒ½ä½¿ç”¨â€è½®è¯¢â€ï¼šæ¯éš”ä¸€æ®µæ—¶å€™ï¼Œå°±å‘å‡ºä¸€ä¸ªè¯¢é—®ï¼Œäº†è§£æœåŠ¡å™¨æœ‰æ²¡æœ‰æ–°çš„ä¿¡æ¯ã€‚æœ€å…¸å‹çš„åœºæ™¯å°±æ˜¯èŠå¤©å®¤ã€‚</p>
<p>è½®è¯¢çš„æ•ˆç‡ä½ï¼Œéå¸¸æµªè´¹èµ„æºï¼ˆå› ä¸ºå¿…é¡»ä¸åœè¿æ¥ï¼Œæˆ–è€… HTTP è¿æ¥å§‹ç»ˆæ‰“å¼€ï¼‰ã€‚å› æ­¤ï¼Œå·¥ç¨‹å¸ˆä»¬ä¸€ç›´åœ¨æ€è€ƒï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•ã€‚WebSocket å°±æ˜¯è¿™æ ·å‘æ˜çš„ã€‚</p>
<p>WebSocket åè®®åœ¨2008å¹´è¯ç”Ÿï¼Œ2011å¹´æˆä¸ºå›½é™…æ ‡å‡†ã€‚æ‰€æœ‰æµè§ˆå™¨éƒ½å·²ç»æ”¯æŒäº†ã€‚</p>
<p>å®ƒçš„æœ€å¤§ç‰¹ç‚¹å°±æ˜¯ï¼ŒæœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥ä¸»åŠ¨å‘æœåŠ¡å™¨å‘é€ä¿¡æ¯ï¼Œæ˜¯çœŸæ­£çš„åŒå‘å¹³ç­‰å¯¹è¯ï¼Œå±äº<a href="https://en.wikipedia.org/wiki/Push_technology" target="_blank" rel="noopener">æœåŠ¡å™¨æ¨é€</a>æŠ€æœ¯çš„ä¸€ç§ã€‚<br><a href="http://idiotsky.top/images2/go-websocket-1.png"><img src="http://idiotsky.top/images2/go-websocket-1.png" alt=""></a></p>
<a id="more"></a>
<p>å…¶ä»–ç‰¹ç‚¹åŒ…æ‹¬ï¼š</p>
<ol>
<li>å»ºç«‹åœ¨ TCP åè®®ä¹‹ä¸Šï¼ŒæœåŠ¡å™¨ç«¯çš„å®ç°æ¯”è¾ƒå®¹æ˜“ã€‚</li>
<li>ä¸ HTTP åè®®æœ‰ç€è‰¯å¥½çš„å…¼å®¹æ€§ã€‚é»˜è®¤ç«¯å£ä¹Ÿæ˜¯80å’Œ443ï¼Œå¹¶ä¸”æ¡æ‰‹é˜¶æ®µé‡‡ç”¨ HTTP åè®®ï¼Œå› æ­¤æ¡æ‰‹æ—¶ä¸å®¹æ˜“å±è”½ï¼Œèƒ½é€šè¿‡å„ç§ HTTP ä»£ç†æœåŠ¡å™¨ã€‚</li>
<li>æ•°æ®æ ¼å¼æ¯”è¾ƒè½»é‡ï¼Œæ€§èƒ½å¼€é”€å°ï¼Œé€šä¿¡é«˜æ•ˆã€‚</li>
<li>å¯ä»¥å‘é€æ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥å‘é€äºŒè¿›åˆ¶æ•°æ®ã€‚</li>
<li>æ²¡æœ‰åŒæºé™åˆ¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä¸ä»»æ„æœåŠ¡å™¨é€šä¿¡ã€‚</li>
<li>åè®®æ ‡è¯†ç¬¦æ˜¯wsï¼ˆå¦‚æœåŠ å¯†ï¼Œåˆ™ä¸ºwssï¼‰ï¼ŒæœåŠ¡å™¨ç½‘å€å°±æ˜¯ URLã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ws://example.com:80/some/path</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><a href="http://idiotsky.top/images2/go-websocket-2.jpg"><img src="http://idiotsky.top/images2/go-websocket-2.jpg" alt=""></a></p>
<h1 id="å°è¯•"><a href="#å°è¯•" class="headerlink" title="å°è¯•"></a>å°è¯•</h1><p>ç”¨ä¸€ä¸ªechoçš„ä¾‹å­æ¥è¯•ä¸€ä¸‹websocket</p>
<h2 id="å®¢æˆ·ç«¯å®ç°"><a href="#å®¢æˆ·ç«¯å®ç°" class="headerlink" title="å®¢æˆ·ç«¯å®ç°"></a>å®¢æˆ·ç«¯å®ç°</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE HTML&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">        var ws;</span></span><br><span class="line"><span class="undefined">        function connect() &#123;</span></span><br><span class="line"><span class="undefined">            ws= new WebSocket("ws://localhost:8080/echo");</span></span><br><span class="line"><span class="undefined">            ws.onopen = function()</span></span><br><span class="line"><span class="undefined">            &#123;</span></span><br><span class="line"><span class="undefined">                alert("connection is successful");</span></span><br><span class="line"><span class="undefined">            &#125;;</span></span><br><span class="line"><span class="undefined">            ws.onmessage = function (e)</span></span><br><span class="line"><span class="undefined">            &#123;</span></span><br><span class="line"><span class="undefined">                var msg = e.data;</span></span><br><span class="line"><span class="undefined">                var li=document.createElement("li");</span></span><br><span class="line"><span class="undefined">                li.innerText=msg;</span></span><br><span class="line"><span class="undefined">                document.getElementsByTagName("ul")[0].appendChild(li);</span></span><br><span class="line"><span class="undefined">            &#125;;</span></span><br><span class="line"><span class="undefined">            ws.onclose = function()</span></span><br><span class="line"><span class="undefined">            &#123;</span></span><br><span class="line"><span class="undefined">                // websocket is closed.</span></span><br><span class="line"><span class="undefined">                alert("Connection is closed...");</span></span><br><span class="line"><span class="undefined">            &#125;;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        function send() &#123;</span></span><br><span class="line"><span class="undefined">            if(ws)&#123;</span></span><br><span class="line"><span class="undefined">                var msg=document.getElementById("txt").value;</span></span><br><span class="line"><span class="undefined">                ws.send(msg);</span></span><br><span class="line"><span class="undefined">                return;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">            alert("connect first!!!");</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:connect()"</span>&gt;</span>connect<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">"txt"</span> <span class="attr">style</span>=<span class="string">"width: 100%"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"sendBtn"</span> <span class="attr">onclick</span>=<span class="string">"send()"</span>&gt;</span>send<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯ç”¨<code>new WebSocket(&quot;ws://localhost:8080/echo&quot;)</code>åˆå§‹åŒ–websocketï¼Œç„¶åæ³¨å†Œç›¸å…³äº‹ä»¶ï¼Œå°±å¯ä»¥å®Œæˆä¸€ä¸ªç®€å•websocketå®¢æˆ·ç«¯äº†ã€‚</p>
<h2 id="æœåŠ¡ç«¯å®ç°"><a href="#æœåŠ¡ç«¯å®ç°" class="headerlink" title="æœåŠ¡ç«¯å®ç°"></a>æœåŠ¡ç«¯å®ç°</h2><p>goçš„æ ‡å‡†åº“æ²¡æœ‰å®ç°websocketçš„åŠŸèƒ½ï¼Œæ‰€ä»¥è¦ç”¨<code>github.com/gorilla/websocket</code>è¿™ä¸ªåº“æ¥å®ç°æœåŠ¡ç«¯<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/gorilla/websocket"</span></span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> upgrader = websocket.Upgrader&#123;</span><br><span class="line">	ReadBufferSize:  <span class="number">1024</span>,</span><br><span class="line">	WriteBufferSize: <span class="number">1024</span>,</span><br><span class="line">	CheckOrigin: <span class="function"><span class="keyword">func</span><span class="params">(r *http.Request)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	static := http.FileServer(http.Dir(<span class="string">"./static"</span>))</span><br><span class="line">	http.Handle(<span class="string">"/"</span>, static)</span><br><span class="line"></span><br><span class="line">	http.HandleFunc(<span class="string">"/echo"</span>, echo)</span><br><span class="line"></span><br><span class="line">	log.Printf(<span class="string">"Service started on %d \n"</span>, <span class="number">8080</span>)</span><br><span class="line">	log.Fatal(http.ListenAndServe(<span class="string">":8080"</span>, <span class="literal">nil</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">echo</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	conn, err := upgrader.Upgrade(w, r, <span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">"upgrade error:"</span>, err.Error())</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	log.Println(<span class="string">"Connected..."</span>)</span><br><span class="line">	<span class="keyword">defer</span> conn.Close()</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		messageType, p, err := conn.ReadMessage()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Println(<span class="string">"read message error:"</span>, err.Error())</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> err := conn.WriteMessage(messageType, p); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Println(<span class="string">"write message error:"</span>, err.Error())</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	log.Println(<span class="string">"Disconnect."</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªhttpæœåŠ¡ï¼Œç„¶åæŠŠä¸Šé¢çš„htmlä½œä¸ºé™æ€èµ„æºï¼ŒåŒæ—¶å®šä¹‰ä¸€ä¸ª<code>echo</code>çš„å¤„ç†å‡½æ•°ã€‚å‡½æ•°é‡Œé¢å¯¹è¯·æ±‚è¿›è¡Œ<code>upgrade</code>ï¼Œè¡¨ç¤ºä»æ™®é€šçš„è¯·æ±‚å˜æˆwebsocketï¼ˆå‰ææ˜¯è¯·æ±‚å¤´é‡Œé¢è¦åŒ…å«<code>upgrade</code>æ ‡è®°ï¼‰ï¼Œä¹‹åå°±è·å–äº†connectionï¼Œæ¥ä¸‹æ¥å°±è·Ÿå¹³å¸¸tcpçš„è¿æ¥é‚£æ ·è¯»å†™æ•°æ®äº†ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ç”¨goå®ç°çš„websocketç®€ç›´æ˜¯ç®€å•åˆ°çˆ†äº†ï¼ŒåŸºæœ¬ç¬¬ä¸‰æ–¹åº“å·²ç»å°è£…å¥½äº†ğŸ‘¿</p>
<p>æ‰€æœ‰ä»£ç åœ¨ <a href="https://github.com/ejunjsh/go-code/tree/master/websocket" target="_blank" rel="noopener">https://github.com/ejunjsh/go-code/tree/master/websocket</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;ä»€ä¹ˆæ˜¯websocket&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯websocket&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯websocket&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯websocket&lt;/h1&gt;&lt;p&gt;åˆæ¬¡æ¥è§¦ WebSocket çš„äººï¼Œéƒ½ä¼šé—®åŒæ ·çš„é—®é¢˜ï¼šæˆ‘ä»¬å·²ç»æœ‰äº† HTTP åè®®ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦å¦ä¸€ä¸ªåè®®ï¼Ÿå®ƒèƒ½å¸¦æ¥ä»€ä¹ˆå¥½å¤„ï¼Ÿ&lt;br&gt;ç­”æ¡ˆå¾ˆç®€å•ï¼Œå› ä¸º HTTP åè®®æœ‰ä¸€ä¸ªç¼ºé™·ï¼šé€šä¿¡åªèƒ½ç”±å®¢æˆ·ç«¯å‘èµ·ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä»¬æƒ³äº†è§£ä»Šå¤©çš„å¤©æ°”ï¼Œåªèƒ½æ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›æŸ¥è¯¢ç»“æœã€‚HTTP åè®®åšä¸åˆ°æœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€ä¿¡æ¯ã€‚&lt;br&gt;è¿™ç§å•å‘è¯·æ±‚çš„ç‰¹ç‚¹ï¼Œæ³¨å®šäº†å¦‚æœæœåŠ¡å™¨æœ‰è¿ç»­çš„çŠ¶æ€å˜åŒ–ï¼Œå®¢æˆ·ç«¯è¦è·çŸ¥å°±éå¸¸éº»çƒ¦ã€‚æˆ‘ä»¬åªèƒ½ä½¿ç”¨â€è½®è¯¢â€ï¼šæ¯éš”ä¸€æ®µæ—¶å€™ï¼Œå°±å‘å‡ºä¸€ä¸ªè¯¢é—®ï¼Œäº†è§£æœåŠ¡å™¨æœ‰æ²¡æœ‰æ–°çš„ä¿¡æ¯ã€‚æœ€å…¸å‹çš„åœºæ™¯å°±æ˜¯èŠå¤©å®¤ã€‚&lt;/p&gt;
&lt;p&gt;è½®è¯¢çš„æ•ˆç‡ä½ï¼Œéå¸¸æµªè´¹èµ„æºï¼ˆå› ä¸ºå¿…é¡»ä¸åœè¿æ¥ï¼Œæˆ–è€… HTTP è¿æ¥å§‹ç»ˆæ‰“å¼€ï¼‰ã€‚å› æ­¤ï¼Œå·¥ç¨‹å¸ˆä»¬ä¸€ç›´åœ¨æ€è€ƒï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•ã€‚WebSocket å°±æ˜¯è¿™æ ·å‘æ˜çš„ã€‚&lt;/p&gt;
&lt;p&gt;WebSocket åè®®åœ¨2008å¹´è¯ç”Ÿï¼Œ2011å¹´æˆä¸ºå›½é™…æ ‡å‡†ã€‚æ‰€æœ‰æµè§ˆå™¨éƒ½å·²ç»æ”¯æŒäº†ã€‚&lt;/p&gt;
&lt;p&gt;å®ƒçš„æœ€å¤§ç‰¹ç‚¹å°±æ˜¯ï¼ŒæœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥ä¸»åŠ¨å‘æœåŠ¡å™¨å‘é€ä¿¡æ¯ï¼Œæ˜¯çœŸæ­£çš„åŒå‘å¹³ç­‰å¯¹è¯ï¼Œå±äº&lt;a href=&quot;https://en.wikipedia.org/wiki/Push_technology&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æœåŠ¡å™¨æ¨é€&lt;/a&gt;æŠ€æœ¯çš„ä¸€ç§ã€‚&lt;br&gt;&lt;a href=&quot;http://idiotsky.top/images2/go-websocket-1.png&quot;&gt;&lt;img src=&quot;http://idiotsky.top/images2/go-websocket-1.png&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="go" scheme="http://idiotsky.top/categories/go/"/>
    
    
      <category term="go" scheme="http://idiotsky.top/tags/go/"/>
    
      <category term="websocket" scheme="http://idiotsky.top/tags/websocket/"/>
    
  </entry>
  
  <entry>
    <title>goåŸºç¡€-nil</title>
    <link href="http://idiotsky.top/2018/01/03/go-nil/"/>
    <id>http://idiotsky.top/2018/01/03/go-nil/</id>
    <published>2018-01-03T15:48:13.000Z</published>
    <updated>2018-07-17T11:39:16.534Z</updated>
    
    <content type="html"><![CDATA[<h1 id="nilæ˜¯ä»€ä¹ˆ"><a href="#nilæ˜¯ä»€ä¹ˆ" class="headerlink" title="nilæ˜¯ä»€ä¹ˆ"></a>nilæ˜¯ä»€ä¹ˆ</h1><blockquote>
<p>The â€œnilâ€ identifier can be used as the â€œzero valueâ€ for interfaces, functions, pointers, maps, slices, and channels</p>
</blockquote>
<p>è¿™æ˜¯å¯¹nilçš„å®˜æ–¹è§£é‡Šï¼Œæ„æ€å°±æ˜¯è¯´nilæ˜¯æ¥å£ï¼Œå‡½æ•°ï¼ŒæŒ‡é’ˆï¼Œmapï¼Œsliceå’Œç®¡é“çš„é›¶å€¼ã€‚é›¶å€¼ï¼Œzero valueï¼Œåœ¨Goè¯­è¨€ä¸­ï¼Œå¦‚æœä½ å£°æ˜äº†ä¸€ä¸ªå˜é‡ä½†æ˜¯æ²¡æœ‰å¯¹å®ƒè¿›è¡Œèµ‹å€¼æ“ä½œï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡å°±ä¼šæœ‰ä¸€ä¸ªç±»å‹çš„é»˜è®¤é›¶å€¼ã€‚è¿™æ˜¯æ¯ç§ç±»å‹å¯¹åº”çš„é›¶å€¼ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span>      -&gt; <span class="literal">false</span>                              </span><br><span class="line">numbers -&gt; <span class="number">0</span>                                 </span><br><span class="line"><span class="keyword">string</span>    -&gt; <span class="string">""</span>      </span><br><span class="line"></span><br><span class="line">pointers -&gt; <span class="literal">nil</span></span><br><span class="line">slices -&gt; <span class="literal">nil</span></span><br><span class="line">maps -&gt; <span class="literal">nil</span></span><br><span class="line">channels -&gt; <span class="literal">nil</span></span><br><span class="line">functions -&gt; <span class="literal">nil</span></span><br><span class="line">interfaces -&gt; <span class="literal">nil</span></span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå½“ä½ å®šä¹‰äº†ä¸€ä¸ªstructï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">  AgeYears <span class="keyword">int</span></span><br><span class="line">  Name <span class="keyword">string</span></span><br><span class="line">  Friends []Person</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p Person <span class="comment">// Person&#123;0, "", nil&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢å®˜æ–¹è§£é‡Šè¿˜æœ‰ä¸€å¥<code>The &quot;nil&quot; identifier</code>,æ„æ€å°±æ˜¯è¯´nilæ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼ˆå˜é‡ï¼‰ï¼Œè¿goçš„å…³é”®å­—éƒ½ä¸ç®—ï¼Œæ˜¯ä¸€ä¸ªé¢„å®šä¹‰çš„å˜é‡è€Œå·²ï¼Œä½ ç”šè‡³å¯ä»¥æ”¹å˜å®ƒ<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="literal">nil</span> = errors.New(<span class="string">"hi"</span>)</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·æ˜¯å®Œå…¨å¯ä»¥ç¼–è¯‘å¾—è¿‡çš„ï¼Œä½†æ˜¯æœ€å¥½ä¸è¦è¿™æ ·å­å»åšã€‚</p>
<h1 id="nilæœ‰ä»€ä¹ˆç”¨"><a href="#nilæœ‰ä»€ä¹ˆç”¨" class="headerlink" title="nilæœ‰ä»€ä¹ˆç”¨"></a>nilæœ‰ä»€ä¹ˆç”¨</h1><p>åœ¨äº†è§£äº†ä»€ä¹ˆæ˜¯nilä¹‹åï¼Œå†æ¥è¯´è¯´nilæœ‰ä»€ä¹ˆç”¨ã€‚</p>
<h2 id="pointers"><a href="#pointers" class="headerlink" title="pointers"></a>pointers</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p *<span class="keyword">int</span></span><br><span class="line">p == <span class="literal">nil</span>    <span class="comment">// true</span></span><br><span class="line">*p          <span class="comment">// panic: invalid memory address or nil pointer dereference</span></span><br></pre></td></tr></table></figure>
<p>æŒ‡é’ˆè¡¨ç¤ºæŒ‡å‘å†…å­˜çš„åœ°å€ï¼Œå¦‚æœå¯¹ä¸ºnilçš„æŒ‡é’ˆè¿›è¡Œè§£å¼•ç”¨çš„è¯å°±ä¼šå¯¼è‡´panicã€‚é‚£ä¹ˆä¸ºnilçš„æŒ‡é’ˆæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿå…ˆæ¥çœ‹ä¸€ä¸ªè®¡ç®—äºŒå‰æ ‘å’Œçš„ä¾‹å­ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> tree <span class="keyword">struct</span> &#123;</span><br><span class="line">  v <span class="keyword">int</span></span><br><span class="line">  l *tree</span><br><span class="line">  r *tree</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// first solution</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *tree)</span> <span class="title">Sum</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">  sum := t.v</span><br><span class="line">  <span class="keyword">if</span> t.l != <span class="literal">nil</span> &#123;</span><br><span class="line">    sum += t.l.Sum()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> t.r != <span class="literal">nil</span> &#123;</span><br><span class="line">    sum += t.r.Sum()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢çš„ä»£ç æœ‰ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªæ˜¯ä»£ç é‡å¤ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> t.l != <span class="literal">nil</span> &#123;</span><br><span class="line">  <span class="comment">//....</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> t.r != <span class="literal">nil</span> &#123;</span><br><span class="line">  <span class="comment">//....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¦ä¸€ä¸ªæ˜¯å½“tæ˜¯nilçš„æ—¶å€™ä¼španicï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> t *tree</span><br><span class="line">sum := t.Sum()   <span class="comment">// panic: invalid memory address or nil pointer dereference</span></span><br></pre></td></tr></table></figure></p>
<p>æ€ä¹ˆè§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Ÿæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¸€ä¸ªæŒ‡é’ˆæ¥æ”¶å™¨çš„ä¾‹å­ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sayHi</span><span class="params">(p *person)</span></span> &#123; fmt.Println(<span class="string">"hi"</span>) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *person)</span> <span class="title">sayHi</span><span class="params">()</span></span> &#123; fmt.Println(<span class="string">"hi"</span>) &#125;</span><br><span class="line"><span class="keyword">var</span> p *person</span><br><span class="line">p.sayHi() <span class="comment">// hi</span></span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œå°±æœ‰ç‚¹ç–‘é—®ï¼Œä¸ºä»€ä¹ˆ<code>t.sum()</code>ä¼šæŠ¥é”™ï¼Œè€Œ<code>p.sayHi()</code>ä¸æŠ¥é”™ï¼Œå…¶å®æ˜¯å› ä¸º<code>t.sum()</code>å‡½æ•°é‡Œé¢<code>sum := t.v</code>è¿™å¥ï¼Œå…¶å®å®ƒç›¸å½“äº<code>sum := (*t).v</code>,æ‰€ä»¥ï¼Œå¯¹äºæŒ‡é’ˆå¯¹è±¡çš„æ–¹æ³•æ¥è¯´ï¼Œå°±ç®—æŒ‡é’ˆçš„å€¼ä¸ºnilä¹Ÿæ˜¯å¯ä»¥è°ƒç”¨å®ƒä»¬çš„æ–¹æ³•,è‡³äºæ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¼šä¸ä¼šæŠ¥é”™å°±è¦åšå¤„ç†äº†ï¼ŒåŸºäºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹åˆšåˆšè®¡ç®—äºŒå‰æ ‘å’Œçš„ä¾‹å­è¿›è¡Œä¸€ä¸‹æ”¹é€ ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span><span class="params">(t *tree)</span> <span class="title">Sum</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> t == <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> t.v + t.l.Sum() + t.r.Sum()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è·Ÿåˆšæ‰çš„ä»£ç ä¸€å¯¹æ¯”æ˜¯ä¸æ˜¯ç®€æ´äº†å¾ˆå¤šï¼Ÿå¯¹äºnilæŒ‡é’ˆï¼Œåªéœ€è¦åœ¨æ–¹æ³•å‰é¢åˆ¤æ–­ä¸€ä¸‹å°±okäº†ï¼Œæ— éœ€é‡å¤åˆ¤æ–­ã€‚æ¢æˆæ‰“å°äºŒå‰æ ‘çš„å€¼æˆ–è€…æŸ¥æ‰¾äºŒå‰æ ‘çš„æŸä¸ªå€¼éƒ½æ˜¯ä¸€æ ·çš„ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span><span class="params">(t *tree)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> t == <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> fmt.Sprint(t.l, t.v, t.r)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// nil receivers are useful: Find</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *tree)</span> <span class="title">Find</span><span class="params">(v <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> t == <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> t.v == v || t.l.Find(v) || t.r.Find(v)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰€ä»¥å¦‚æœä¸æ˜¯å¾ˆéœ€è¦çš„è¯ï¼Œä¸è¦ç”¨NewX()å»åˆå§‹åŒ–å€¼ï¼Œè€Œæ˜¯ä½¿ç”¨å®ƒä»¬çš„é»˜è®¤å€¼ã€‚</p>
<h2 id="slices"><a href="#slices" class="headerlink" title="slices"></a>slices</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nil slices</span></span><br><span class="line"><span class="keyword">var</span> s []slice</span><br><span class="line"><span class="built_in">len</span>(s)  <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">cap</span>(s)  <span class="comment">// 0</span></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">range</span> s  <span class="comment">// iterates zero times</span></span><br><span class="line">s[i]  <span class="comment">// panic: index out of range</span></span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ªä¸ºnilçš„sliceï¼Œé™¤äº†ä¸èƒ½ç´¢å¼•å¤–ï¼Œå…¶ä»–çš„æ“ä½œéƒ½æ˜¯å¯ä»¥çš„ï¼Œå½“ä½ éœ€è¦å¡«å……å€¼çš„æ—¶å€™å¯ä»¥ä½¿ç”¨appendå‡½æ•°ï¼Œsliceä¼šè‡ªåŠ¨è¿›è¡Œæ‰©å……ã€‚é‚£ä¹ˆä¸ºnilçš„sliceçš„åº•å±‚ç»“æ„æ˜¯æ€æ ·çš„å‘¢ï¼Ÿæ ¹æ®å®˜æ–¹çš„æ–‡æ¡£ï¼Œsliceæœ‰ä¸‰ä¸ªå…ƒç´ ï¼Œåˆ†åˆ«æ˜¯é•¿åº¦ã€å®¹é‡ã€æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼š<br><a href="http://idiotsky.top/images2/go-nil.png"><img src="http://idiotsky.top/images2/go-nil.png" alt=""></a></p>
<p>å½“æœ‰å…ƒç´ çš„æ—¶å€™ï¼š<br><a href="http://idiotsky.top/images2/go-nil-1.png"><img src="http://idiotsky.top/images2/go-nil-1.png" alt=""></a></p>
<p>æ‰€ä»¥æˆ‘ä»¬å¹¶ä¸éœ€è¦æ‹…å¿ƒsliceçš„å¤§å°ï¼Œä½¿ç”¨appendçš„è¯sliceä¼šè‡ªåŠ¨æ‰©å®¹ã€‚</p>
<h2 id="map"><a href="#map" class="headerlink" title="map"></a>map</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nil maps</span></span><br><span class="line"><span class="keyword">var</span> m <span class="keyword">map</span>[t]u</span><br><span class="line"><span class="built_in">len</span>(m)  <span class="comment">// 0</span></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">range</span> m <span class="comment">// iterates zero times</span></span><br><span class="line">v, ok := m[i] <span class="comment">// zero(u), false</span></span><br><span class="line">m[i] = x <span class="comment">// panic: assignment to entry in nil map</span></span><br></pre></td></tr></table></figure>
<p>å¯¹äºnilçš„mapï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•æŠŠå®ƒçœ‹æˆæ˜¯ä¸€ä¸ªåªè¯»çš„mapï¼Œä¸èƒ½è¿›è¡Œå†™æ“ä½œï¼Œå¦åˆ™å°±ä¼španicã€‚é‚£ä¹ˆnilçš„mapæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿçœ‹ä¸€ä¸‹è¿™ä¸ªä¾‹å­ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewGet</span><span class="params">(url <span class="keyword">string</span>, headers <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span> <span class="params">(*http.Request, error)</span></span> &#123;</span><br><span class="line">  req, err := http.NewRequest(http.MethodGet, url, <span class="literal">nil</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> k, v := <span class="keyword">range</span> headers &#123;</span><br><span class="line">    req.Header.Set(k, v)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> req, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯¹äºNewGetæ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦ä¼ å…¥ä¸€ä¸ªç±»å‹ä¸ºmapçš„å‚æ•°ï¼Œå¹¶ä¸”è¿™ä¸ªå‡½æ•°åªæ˜¯å¯¹è¿™ä¸ªå‚æ•°è¿›è¡Œè¯»å–ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ªéç©ºçš„å€¼ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NewGet(<span class="string">"http://google.com"</span>, <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;</span><br><span class="line">  <span class="string">"USER_AGENT"</span>: <span class="string">"golang/gopher"</span>,</span><br><span class="line">&#125;,)</span><br></pre></td></tr></table></figure></p>
<p>æˆ–è€…è¿™æ ·ä¼ ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NewGet(<span class="string">"http://google.com"</span>, <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;&#125;)</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯å‰é¢ä¹Ÿè¯´äº†ï¼Œmapçš„é›¶å€¼æ˜¯nilï¼Œæ‰€ä»¥å½“headerä¸ºç©ºçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä¼ å…¥ä¸€ä¸ªnilï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NewGet(<span class="string">"http://google.com"</span>, <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure></p>
<p>æ˜¯ä¸æ˜¯ç®€æ´å¾ˆå¤šï¼Ÿæ‰€ä»¥ï¼ŒæŠŠnil mapä½œä¸ºä¸€ä¸ªåªè¯»çš„ç©ºçš„mapè¿›è¡Œè¯»å–å§ã€‚</p>
<h2 id="channel"><a href="#channel" class="headerlink" title="channel"></a>channel</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nil channels</span></span><br><span class="line"><span class="keyword">var</span> c <span class="keyword">chan</span> t</span><br><span class="line">&lt;- c      <span class="comment">// blocks forever</span></span><br><span class="line">c &lt;- x    <span class="comment">// blocks forever</span></span><br><span class="line"><span class="built_in">close</span>(c)  <span class="comment">// panic: close of nil channel</span></span><br></pre></td></tr></table></figure>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚ç°åœ¨æœ‰ä¸¤ä¸ªchannelè´Ÿè´£è¾“å…¥ï¼Œä¸€ä¸ªchannelè´Ÿè´£æ±‡æ€»ï¼Œç®€å•çš„å®ç°ä»£ç ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">merge</span><span class="params">(out <span class="keyword">chan</span>&lt;- <span class="keyword">int</span>, a, b &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> &#123;</span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> v := &lt;-a:</span><br><span class="line">        out &lt;- v</span><br><span class="line">      <span class="keyword">case</span> v := &lt;- b:</span><br><span class="line">        out &lt;- v</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœåœ¨å¤–éƒ¨è°ƒç”¨ä¸­å…³é—­äº†aæˆ–è€…bï¼Œé‚£ä¹ˆå°±ä¼šä¸æ–­åœ°ä»aæˆ–è€…bä¸­è¯»å‡º0ï¼Œè¿™å’Œæˆ‘ä»¬æƒ³è¦çš„ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬æƒ³å…³é—­aå’Œbåå°±åœæ­¢æ±‡æ€»äº†ï¼Œä¿®æ”¹ä¸€ä¸‹ä»£ç ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">merge</span><span class="params">(out <span class="keyword">chan</span>&lt;- <span class="keyword">int</span>, a, b &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  <span class="keyword">for</span> a != <span class="literal">nil</span> || b != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> v, ok := &lt;-a:</span><br><span class="line">          <span class="keyword">if</span> !ok &#123;</span><br><span class="line">            a = <span class="literal">nil</span></span><br><span class="line">            fmt.Println(<span class="string">"a is nil"</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">          &#125;</span><br><span class="line">          out &lt;- v</span><br><span class="line">      <span class="keyword">case</span> v, ok := &lt;-b:</span><br><span class="line">          <span class="keyword">if</span> !ok &#123;</span><br><span class="line">            b = <span class="literal">nil</span></span><br><span class="line">            fmt.Println(<span class="string">"b is nil"</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">          &#125;</span><br><span class="line">          out &lt;- v</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  fmt.Println(<span class="string">"close out"</span>)</span><br><span class="line">  <span class="built_in">close</span>(out)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨çŸ¥é“channelå…³é—­åï¼Œå°†channelçš„å€¼è®¾ä¸ºnilï¼Œè¿™æ ·å­å°±ç›¸å½“äºå°†è¿™ä¸ªselect caseå­å¥åœç”¨äº†ï¼Œå› ä¸ºnilçš„channelæ˜¯æ°¸è¿œé˜»å¡çš„ã€‚</p>
<h2 id="interface"><a href="#interface" class="headerlink" title="interface"></a>interface</h2><p>interfaceå¹¶ä¸æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒçš„åº•å±‚å®ç°ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œä¸€ä¸ªæ˜¯ç±»å‹ï¼Œä¸€ä¸ªå€¼ï¼Œä¹Ÿå°±æ˜¯ç±»ä¼¼äºï¼š(Type, Value)ã€‚åªæœ‰å½“ç±»å‹å’Œå€¼éƒ½æ˜¯nilçš„æ—¶å€™ï¼Œæ‰ç­‰äºnilã€‚çœ‹çœ‹ä¸‹é¢çš„ä»£ç ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> doError <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *doError)</span> <span class="title">Error</span><span class="params">()</span> <span class="title">string</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">do</span><span class="params">()</span> <span class="title">error</span></span> &#123;   <span class="comment">// error(*doError, nil)</span></span><br><span class="line">	<span class="keyword">var</span> err *doError</span><br><span class="line">	<span class="keyword">return</span> err  <span class="comment">// nil of type *doError</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	err := do()</span><br><span class="line">	fmt.Println(err == <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¾“å‡ºç»“æœæ˜¯falseã€‚doå‡½æ•°å£°æ˜äº†ä¸€ä¸ª*doErroçš„å˜é‡errï¼Œç„¶åè¿”å›ï¼Œè¿”å›å€¼æ˜¯erroræ¥å£ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™çš„Typeå·²ç»å˜æˆäº†ï¼šï¼ˆ*doErrorï¼Œnilï¼‰ï¼Œæ‰€ä»¥å’Œnilè‚¯å®šæ˜¯ä¸ä¼šç›¸ç­‰çš„ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨å†™å‡½æ•°çš„æ—¶å€™ï¼Œä¸è¦å£°æ˜å…·ä½“çš„errorå˜é‡ï¼Œè€Œæ˜¯åº”è¯¥ç›´æ¥è¿”å›nilï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">do</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å†æ¥çœ‹çœ‹è¿™ä¸ªä¾‹å­ï¼š<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">do</span><span class="params">()</span> *<span class="title">doError</span></span> &#123;  <span class="comment">// nil of type *doError</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">wrapDo</span><span class="params">()</span> <span class="title">error</span></span> &#123; <span class="comment">// error (*doError, nil)</span></span><br><span class="line">  <span class="keyword">return</span> do()       <span class="comment">// nil of type *doError</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  err := wrapDo()   <span class="comment">// error  (*doError, nil)</span></span><br><span class="line">  fmt.Println(err == <span class="literal">nil</span>) <span class="comment">// false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæœ€ç»ˆçš„è¾“å‡ºç»“æœä¹Ÿæ˜¯falseã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå°½ç®¡wrapDoå‡½æ•°è¿”å›çš„æ˜¯errorç±»å‹ï¼Œä½†æ˜¯doè¿”å›çš„å´æ˜¯*doErrorç±»å‹ï¼Œä¹Ÿå°±æ˜¯å˜æˆäº†ï¼ˆ*doErrorï¼Œnilï¼‰ï¼Œè‡ªç„¶ä¹Ÿå°±å’Œnilä¸ç›¸ç­‰äº†ã€‚å› æ­¤ï¼Œä¸è¦è¿”å›å…·ä½“çš„é”™è¯¯ç±»å‹ã€‚éµä»è¿™ä¸¤æ¡å»ºè®®ï¼Œæ‰å¯ä»¥æ”¾å¿ƒåœ°ä½¿ç”¨<code>if x != nil</code>ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>nilæŒ‡é’ˆå¯ä»¥æ‰§è¡Œæ–¹æ³•ï¼Œnilçš„mapå’Œsliceåªæ˜¯å¯è¯»ï¼Œnilçš„chanå¯ä»¥ç”¨æ¥åšä¸ºselectçš„åœæ­¢æ ‡è®°ï¼Œè€Œnilçš„interfaceå¯èƒ½å°±æ˜¯ä¸ªå‘ğŸ‘¿</p>
<p>å‚è€ƒ <a href="https://www.jianshu.com/p/dd80f6be7969" target="_blank" rel="noopener">https://www.jianshu.com/p/dd80f6be7969</a><br>éƒ¨åˆ†ä»£ç  <a href="https://github.com/ejunjsh/go-code/tree/master/nil" target="_blank" rel="noopener">https://github.com/ejunjsh/go-code/tree/master/nil</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;nilæ˜¯ä»€ä¹ˆ&quot;&gt;&lt;a href=&quot;#nilæ˜¯ä»€ä¹ˆ&quot; class=&quot;headerlink&quot; title=&quot;nilæ˜¯ä»€ä¹ˆ&quot;&gt;&lt;/a&gt;nilæ˜¯ä»€ä¹ˆ&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;The â€œnilâ€ identifier can be used as the â€œzero valueâ€ for interfaces, functions, pointers, maps, slices, and channels&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™æ˜¯å¯¹nilçš„å®˜æ–¹è§£é‡Šï¼Œæ„æ€å°±æ˜¯è¯´nilæ˜¯æ¥å£ï¼Œå‡½æ•°ï¼ŒæŒ‡é’ˆï¼Œmapï¼Œsliceå’Œç®¡é“çš„é›¶å€¼ã€‚é›¶å€¼ï¼Œzero valueï¼Œåœ¨Goè¯­è¨€ä¸­ï¼Œå¦‚æœä½ å£°æ˜äº†ä¸€ä¸ªå˜é‡ä½†æ˜¯æ²¡æœ‰å¯¹å®ƒè¿›è¡Œèµ‹å€¼æ“ä½œï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡å°±ä¼šæœ‰ä¸€ä¸ªç±»å‹çš„é»˜è®¤é›¶å€¼ã€‚è¿™æ˜¯æ¯ç§ç±»å‹å¯¹åº”çš„é›¶å€¼ï¼š&lt;br&gt;&lt;figure class=&quot;highlight go&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;bool&lt;/span&gt;      -&amp;gt; &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;                              &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;numbers -&amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;                                 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;string&lt;/span&gt;    -&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;      &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pointers -&amp;gt; &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;slices -&amp;gt; &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;maps -&amp;gt; &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;channels -&amp;gt; &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;functions -&amp;gt; &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;interfaces -&amp;gt; &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="go" scheme="http://idiotsky.top/categories/go/"/>
    
    
      <category term="go" scheme="http://idiotsky.top/tags/go/"/>
    
  </entry>
  
  <entry>
    <title>mysql explainè¯¦è§£</title>
    <link href="http://idiotsky.top/2017/11/30/mysql-explain/"/>
    <id>http://idiotsky.top/2017/11/30/mysql-explain/</id>
    <published>2017-11-30T15:00:28.000Z</published>
    <updated>2018-03-22T15:18:37.311Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>ğŸ‘¿ mark</p>
</blockquote>
<h1 id="Explainç®€ä»‹"><a href="#Explainç®€ä»‹" class="headerlink" title="Explainç®€ä»‹"></a>Explainç®€ä»‹</h1><p>æœ¬æ–‡ä¸»è¦è®²è¿°å¦‚ä½•é€šè¿‡ explain å‘½ä»¤è·å– select è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œé€šè¿‡ explain æˆ‘ä»¬å¯ä»¥çŸ¥é“ä»¥ä¸‹ä¿¡æ¯ï¼šè¡¨çš„è¯»å–é¡ºåºï¼Œæ•°æ®è¯»å–æ“ä½œçš„ç±»å‹ï¼Œå“ªäº›ç´¢å¼•å¯ä»¥ä½¿ç”¨ï¼Œå“ªäº›ç´¢å¼•å®é™…ä½¿ç”¨äº†ï¼Œè¡¨ä¹‹é—´çš„å¼•ç”¨ï¼Œæ¯å¼ è¡¨æœ‰å¤šå°‘è¡Œè¢«ä¼˜åŒ–å™¨æŸ¥è¯¢ç­‰ä¿¡æ¯ã€‚</p>
<p>ä¸‹é¢æ˜¯ä½¿ç”¨ explain çš„ä¾‹å­ï¼š </p>
<p>åœ¨ select è¯­å¥ä¹‹å‰å¢åŠ  explain å…³é”®å­—ï¼ŒMySQL ä¼šåœ¨æŸ¥è¯¢ä¸Šè®¾ç½®ä¸€ä¸ªæ ‡è®°ï¼Œæ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œä¼šè¿”å›æ‰§è¡Œè®¡åˆ’çš„ä¿¡æ¯ï¼Œè€Œä¸æ˜¯æ‰§è¡Œè¿™æ¡SQLï¼ˆå¦‚æœ from ä¸­åŒ…å«å­æŸ¥è¯¢ï¼Œä»ä¼šæ‰§è¡Œè¯¥å­æŸ¥è¯¢ï¼Œå°†ç»“æœæ”¾å…¥ä¸´æ—¶è¡¨ä¸­ï¼‰ã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from actor;</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+------+------+-------+</span></span><br><span class="line">| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra |</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+------+------+-------+</span></span><br><span class="line">|  1 | SIMPLE      | actor | ALL  | NULL          | NULL | NULL    | NULL |    2 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+------+------+-------+</span></span><br></pre></td></tr></table></figure></p>
<p>åœ¨æŸ¥è¯¢ä¸­çš„æ¯ä¸ªè¡¨ä¼šè¾“å‡ºä¸€è¡Œï¼Œå¦‚æœæœ‰ä¸¤ä¸ªè¡¨é€šè¿‡ join è¿æ¥æŸ¥è¯¢ï¼Œé‚£ä¹ˆä¼šè¾“å‡ºä¸¤è¡Œã€‚è¡¨çš„æ„ä¹‰ç›¸å½“å¹¿æ³›ï¼šå¯ä»¥æ˜¯å­æŸ¥è¯¢ã€ä¸€ä¸ª union ç»“æœç­‰ã€‚<br><a id="more"></a></p>
<h1 id="explain-ä¸­çš„åˆ—"><a href="#explain-ä¸­çš„åˆ—" class="headerlink" title="explain ä¸­çš„åˆ—"></a>explain ä¸­çš„åˆ—</h1><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†å±•ç¤º explain ä¸­æ¯ä¸ªåˆ—çš„ä¿¡æ¯ã€‚</p>
<h2 id="idåˆ—"><a href="#idåˆ—" class="headerlink" title="idåˆ—"></a>idåˆ—</h2><p>idåˆ—çš„ç¼–å·æ˜¯ select çš„åºåˆ—å·ï¼Œæœ‰å‡ ä¸ª select å°±æœ‰å‡ ä¸ªidï¼Œå¹¶ä¸”idçš„é¡ºåºæ˜¯æŒ‰ select å‡ºç°çš„é¡ºåºå¢é•¿çš„ã€‚MySQLå°† select æŸ¥è¯¢åˆ†ä¸ºç®€å•æŸ¥è¯¢å’Œå¤æ‚æŸ¥è¯¢ã€‚å¤æ‚æŸ¥è¯¢åˆ†ä¸ºä¸‰ç±»ï¼šç®€å•å­æŸ¥è¯¢ã€æ´¾ç”Ÿè¡¨ï¼ˆfromè¯­å¥ä¸­çš„å­æŸ¥è¯¢ï¼‰ã€union æŸ¥è¯¢ã€‚</p>
<h3 id="ç®€å•å­æŸ¥è¯¢"><a href="#ç®€å•å­æŸ¥è¯¢" class="headerlink" title="ç®€å•å­æŸ¥è¯¢"></a>ç®€å•å­æŸ¥è¯¢</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select (select 1 from actor limit 1) from film;</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+</span></span><br><span class="line">| id | select_type | table | type  | possible_keys | key      | key_len | ref  | rows | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+</span></span><br><span class="line">|  1 | PRIMARY     | film  | index | NULL          | idx_name | 32      | NULL |    1 | Using index |</span><br><span class="line">|  2 | SUBQUERY    | actor | index | NULL          | PRIMARY  | 4       | NULL |    2 | Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+</span></span><br></pre></td></tr></table></figure>
<h3 id="fromå­å¥ä¸­çš„å­æŸ¥è¯¢"><a href="#fromå­å¥ä¸­çš„å­æŸ¥è¯¢" class="headerlink" title="fromå­å¥ä¸­çš„å­æŸ¥è¯¢"></a>fromå­å¥ä¸­çš„å­æŸ¥è¯¢</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select id from (select id from film) as der;</span><br><span class="line">+<span class="comment">----+-------------+------------+-------+---------------+----------+---------+------+------+-------------+</span></span><br><span class="line">| id | select_type | table      | type  | possible_keys | key      | key_len | ref  | rows | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+------------+-------+---------------+----------+---------+------+------+-------------+</span></span><br><span class="line">|  1 | PRIMARY     | &lt;derived2&gt; | ALL   | NULL          | NULL     | NULL    | NULL |    2 | NULL        |</span><br><span class="line">|  2 | DERIVED     | film       | index | NULL          | idx_name | 32      | NULL |    1 | Using index |</span><br><span class="line">+<span class="comment">----+-------------+------------+-------+---------------+----------+---------+------+------+-------------+</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæŸ¥è¯¢æ‰§è¡Œæ—¶æœ‰ä¸ªä¸´æ—¶è¡¨åˆ«åä¸º<code>&lt;derived2&gt;</code>ï¼Œå¤–éƒ¨ select æŸ¥è¯¢å¼•ç”¨äº†è¿™ä¸ªä¸´æ—¶è¡¨</p>
<h3 id="unionæŸ¥è¯¢"><a href="#unionæŸ¥è¯¢" class="headerlink" title="unionæŸ¥è¯¢"></a>unionæŸ¥è¯¢</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select 1 union all select 1;</span><br><span class="line">+<span class="comment">------+--------------+------------+------+---------------+------+---------+------+------+-----------------+</span></span><br><span class="line">| id   | select_type  | table      | type | possible_keys | key  | key_len | ref  | rows | Extra           |</span><br><span class="line">+<span class="comment">------+--------------+------------+------+---------------+------+---------+------+------+-----------------+</span></span><br><span class="line">|  1   | PRIMARY      | NULL       | NULL | NULL          | NULL | NULL    | NULL | NULL | No tables used  |</span><br><span class="line">|  2   | UNION        | NULL       | NULL | NULL          | NULL | NULL    | NULL | NULL | No tables used  |</span><br><span class="line">| NULL | UNION RESULT | &lt;union1,2&gt; | ALL  | NULL          | NULL | NULL    | NULL | NULL | Using temporary |</span><br><span class="line">+<span class="comment">----+--------------+------------+------+---------------+------+---------+------+------+-------------------+</span></span><br></pre></td></tr></table></figure>
<p>unionç»“æœæ€»æ˜¯æ”¾åœ¨ä¸€ä¸ªåŒ¿åä¸´æ—¶è¡¨ä¸­ï¼Œä¸´æ—¶è¡¨ä¸åœ¨SQLæ€»å‡ºç°ï¼Œå› æ­¤å®ƒçš„idæ˜¯NULLã€‚</p>
<h2 id="select-typeåˆ—"><a href="#select-typeåˆ—" class="headerlink" title="select_typeåˆ—"></a>select_typeåˆ—</h2><p>select_type è¡¨ç¤ºå¯¹åº”è¡Œæ˜¯æ˜¯ç®€å•è¿˜æ˜¯å¤æ‚çš„æŸ¥è¯¢ï¼Œå¦‚æœæ˜¯å¤æ‚çš„æŸ¥è¯¢ï¼Œåˆæ˜¯ä¸Šè¿°ä¸‰ç§å¤æ‚æŸ¥è¯¢ä¸­çš„å“ªä¸€ç§ã€‚</p>
<ul>
<li><p>simpleï¼šç®€å•æŸ¥è¯¢ã€‚æŸ¥è¯¢ä¸åŒ…å«å­æŸ¥è¯¢å’Œunion</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from film where id = 2;</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+---------+---------+-------+------+-------+</span></span><br><span class="line">| id | select_type | table | type  | possible_keys | key     | key_len | ref   | rows | Extra |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+---------+---------+-------+------+-------+</span></span><br><span class="line">|  1 | SIMPLE      | film  | const | PRIMARY       | PRIMARY | 4       | const |    1 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+---------+---------+-------+------+-------+</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>primaryï¼šå¤æ‚æŸ¥è¯¢ä¸­æœ€å¤–å±‚çš„ select</p>
</li>
<li>subqueryï¼šåŒ…å«åœ¨ select ä¸­çš„å­æŸ¥è¯¢ï¼ˆä¸åœ¨ from å­å¥ä¸­ï¼‰</li>
<li><p>derivedï¼šåŒ…å«åœ¨ from å­å¥ä¸­çš„å­æŸ¥è¯¢ã€‚MySQLä¼šå°†ç»“æœå­˜æ”¾åœ¨ä¸€ä¸ªä¸´æ—¶è¡¨ä¸­ï¼Œä¹Ÿç§°ä¸ºæ´¾ç”Ÿè¡¨ï¼ˆderivedçš„è‹±æ–‡å«ä¹‰ï¼‰</p>
<p>  ç”¨è¿™ä¸ªä¾‹å­æ¥äº†è§£ primaryã€subquery å’Œ derived ç±»å‹</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select (select 1 from actor where id = 1) from (select * from film where id = 1) der;</span><br><span class="line">+<span class="comment">----+-------------+------------+--------+---------------+---------+---------+-------+------+-------------+</span></span><br><span class="line">| id | select_type | table      | type   | possible_keys | key     | key_len | ref   | rows | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+------------+--------+---------------+---------+---------+-------+------+-------------+</span></span><br><span class="line">|  1 | PRIMARY     | &lt;derived3&gt; | system | NULL          | NULL    | NULL    | NULL  |    1 | NULL        |</span><br><span class="line">|  3 | DERIVED     | film       | const  | PRIMARY       | PRIMARY | 4       | const |    1 | NULL        |</span><br><span class="line">|  2 | SUBQUERY    | actor      | const  | PRIMARY       | PRIMARY | 4       | const |    1 | Using index |</span><br><span class="line">+<span class="comment">----+-------------+------------+--------+---------------+---------+---------+-------+------+-------------+</span></span><br></pre></td></tr></table></figure>
<ul>
<li>unionï¼šåœ¨ union ä¸­çš„ç¬¬äºŒä¸ªå’Œéšåçš„ select</li>
<li><p>union resultï¼šä» union ä¸´æ—¶è¡¨æ£€ç´¢ç»“æœçš„ select</p>
<p>  ç”¨è¿™ä¸ªä¾‹å­æ¥äº†è§£ union å’Œ union result ç±»å‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select 1 union all select 1;</span><br><span class="line">+<span class="comment">------+--------------+------------+------+---------------+------+---------+------+------+-----------------+</span></span><br><span class="line">| id   | select_type  | table      | type | possible_keys | key  | key_len | ref  | rows | Extra           |</span><br><span class="line">+<span class="comment">------+--------------+------------+------+---------------+------+---------+------+------+-----------------+</span></span><br><span class="line">|  1   | PRIMARY      | NULL       | NULL | NULL          | NULL | NULL    | NULL | NULL | No tables used  |</span><br><span class="line">|  2   | UNION        | NULL       | NULL | NULL          | NULL | NULL    | NULL | NULL | No tables used  |</span><br><span class="line">| NULL | UNION RESULT | &lt;union1,2&gt; | ALL  | NULL          | NULL | NULL    | NULL | NULL | Using temporary |</span><br><span class="line">+<span class="comment">----+--------------+------------+------+---------------+------+---------+------+------+-------------------+</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="tableåˆ—"><a href="#tableåˆ—" class="headerlink" title="tableåˆ—"></a>tableåˆ—</h2><p>è¿™ä¸€åˆ—è¡¨ç¤º explain çš„ä¸€è¡Œæ­£åœ¨è®¿é—®å“ªä¸ªè¡¨ã€‚</p>
<p>å½“ from å­å¥ä¸­æœ‰å­æŸ¥è¯¢æ—¶ï¼Œtableåˆ—æ˜¯ <code>&lt;derivenN&gt;</code> æ ¼å¼ï¼Œè¡¨ç¤ºå½“å‰æŸ¥è¯¢ä¾èµ– id=N çš„æŸ¥è¯¢ï¼Œäºæ˜¯å…ˆæ‰§è¡Œ id=N çš„æŸ¥è¯¢ã€‚å½“æœ‰ union æ—¶ï¼ŒUNION RESULT çš„ table åˆ—çš„å€¼ä¸º <code>&lt;union1,2&gt;</code>ï¼Œ1å’Œ2è¡¨ç¤ºå‚ä¸ union çš„ select è¡Œidã€‚</p>
<h2 id="typeåˆ—"><a href="#typeåˆ—" class="headerlink" title="typeåˆ—"></a>typeåˆ—</h2><p>è¿™ä¸€åˆ—è¡¨ç¤ºå…³è”ç±»å‹æˆ–è®¿é—®ç±»å‹ï¼Œå³MySQLå†³å®šå¦‚ä½•æŸ¥æ‰¾è¡¨ä¸­çš„è¡Œã€‚</p>
<p>ä¾æ¬¡ä»æœ€ä¼˜åˆ°æœ€å·®åˆ†åˆ«ä¸ºï¼šsystem &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL</p>
<p><strong>NULL</strong>ï¼šmysqlèƒ½å¤Ÿåœ¨ä¼˜åŒ–é˜¶æ®µåˆ†è§£æŸ¥è¯¢è¯­å¥ï¼Œåœ¨æ‰§è¡Œé˜¶æ®µç”¨ä¸ç€å†è®¿é—®è¡¨æˆ–ç´¢å¼•ã€‚ä¾‹å¦‚ï¼šåœ¨ç´¢å¼•åˆ—ä¸­é€‰å–æœ€å°å€¼ï¼Œå¯ä»¥å•ç‹¬æŸ¥æ‰¾ç´¢å¼•æ¥å®Œæˆï¼Œä¸éœ€è¦åœ¨æ‰§è¡Œæ—¶è®¿é—®è¡¨<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select min(id) from film;</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+------+------+------------------------------+</span></span><br><span class="line">| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra                        |</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+------+------+------------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | NULL  | NULL | NULL          | NULL | NULL    | NULL | NULL | <span class="keyword">Select</span> <span class="keyword">tables</span> optimized away |</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+------+------+------------------------------+</span></span><br></pre></td></tr></table></figure></p>
<p><strong>const, system</strong>ï¼šmysqlèƒ½å¯¹æŸ¥è¯¢çš„æŸéƒ¨åˆ†è¿›è¡Œä¼˜åŒ–å¹¶å°†å…¶è½¬åŒ–æˆä¸€ä¸ªå¸¸é‡ï¼ˆå¯ä»¥çœ‹show warnings çš„ç»“æœï¼‰ã€‚ç”¨äº primary key æˆ– unique key çš„æ‰€æœ‰åˆ—ä¸å¸¸æ•°æ¯”è¾ƒæ—¶ï¼Œæ‰€ä»¥è¡¨æœ€å¤šæœ‰ä¸€ä¸ªåŒ¹é…è¡Œï¼Œè¯»å–1æ¬¡ï¼Œé€Ÿåº¦æ¯”è¾ƒå¿«ã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain extended select * from (select * from film where id = 1) tmp;</span><br><span class="line">+<span class="comment">----+-------------+------------+--------+---------------+---------+---------+-------+------+----------+-------+</span></span><br><span class="line">| id | select_type | table      | type   | possible_keys | key     | key_len | ref   | rows | filtered | Extra |</span><br><span class="line">+<span class="comment">----+-------------+------------+--------+---------------+---------+---------+-------+------+----------+-------+</span></span><br><span class="line">|  1 | PRIMARY     | &lt;derived2&gt; | system | NULL          | NULL    | NULL    | NULL  |    1 |   100.00 | NULL  |</span><br><span class="line">|  2 | DERIVED     | film       | const  | PRIMARY       | PRIMARY | 4       | const |    1 |   100.00 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+------------+--------+---------------+---------+---------+-------+------+----------+-------+</span></span><br><span class="line"></span><br><span class="line">mysql&gt; show warnings;</span><br><span class="line">+<span class="comment">-------+------+---------------------------------------------------------------+</span></span><br><span class="line">| Level | Code | Message                                                       |</span><br><span class="line">+<span class="comment">-------+------+---------------------------------------------------------------+</span></span><br><span class="line">| Note  | 1003 | <span class="comment">/* select#1 */</span> <span class="keyword">select</span> <span class="string">'1'</span> <span class="keyword">AS</span> <span class="string">`id`</span>,<span class="string">'film1'</span> <span class="keyword">AS</span> <span class="string">`name`</span> <span class="keyword">from</span> dual |</span><br><span class="line">+<span class="comment">-------+------+---------------------------------------------------------------+</span></span><br></pre></td></tr></table></figure></p>
<p><strong>eq_ref</strong>ï¼šprimary key æˆ– unique key ç´¢å¼•çš„æ‰€æœ‰éƒ¨åˆ†è¢«è¿æ¥ä½¿ç”¨ ï¼Œæœ€å¤šåªä¼šè¿”å›ä¸€æ¡ç¬¦åˆæ¡ä»¶çš„è®°å½•ã€‚è¿™å¯èƒ½æ˜¯åœ¨ const ä¹‹å¤–æœ€å¥½çš„è”æ¥ç±»å‹äº†ï¼Œç®€å•çš„ select æŸ¥è¯¢ä¸ä¼šå‡ºç°è¿™ç§ typeã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from film_actor left join film on film_actor.film_id = film.id;</span><br><span class="line">+<span class="comment">----+-------------+------------+--------+---------------+-------------------+---------+-------------------------+------+-------------+</span></span><br><span class="line">| id | select_type | table      | type   | possible_keys | key               | key_len | ref                     | rows | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+------------+--------+---------------+-------------------+---------+-------------------------+------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | film_actor | index  | NULL          | idx_film_actor_id | 8       | NULL                    |    3 | Using index |</span><br><span class="line">|  1 | SIMPLE      | film       | eq_ref | PRIMARY       | PRIMARY           | 4       | test.film_actor.film_id |    1 | NULL        |</span><br><span class="line">+<span class="comment">----+-------------+------------+--------+---------------+-------------------+---------+-------------------------+------+-------------+</span></span><br></pre></td></tr></table></figure></p>
<p><strong>ref</strong>ï¼šç›¸æ¯” eq_refï¼Œä¸ä½¿ç”¨å”¯ä¸€ç´¢å¼•ï¼Œè€Œæ˜¯ä½¿ç”¨æ™®é€šç´¢å¼•æˆ–è€…å”¯ä¸€æ€§ç´¢å¼•çš„éƒ¨åˆ†å‰ç¼€ï¼Œç´¢å¼•è¦å’ŒæŸä¸ªå€¼ç›¸æ¯”è¾ƒï¼Œå¯èƒ½ä¼šæ‰¾åˆ°å¤šä¸ªç¬¦åˆæ¡ä»¶çš„è¡Œã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1. ç®€å• <span class="keyword">select</span> æŸ¥è¯¢ï¼Œ<span class="keyword">name</span>æ˜¯æ™®é€šç´¢å¼•ï¼ˆéå”¯ä¸€ç´¢å¼•ï¼‰</span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> film <span class="keyword">where</span> <span class="keyword">name</span> = <span class="string">"film1"</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+----------+---------+-------+------+--------------------------+</span></span><br><span class="line">| id | select_type | table | type | possible_keys | key      | key_len | ref   | rows | Extra                    |</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+----------+---------+-------+------+--------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | film  | ref  | idx_name      | idx_name | 33      | const |    1 | Using where; Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+----------+---------+-------+------+--------------------------+</span></span><br><span class="line"></span><br><span class="line">2.å…³è”è¡¨æŸ¥è¯¢ï¼Œidx_film_actor_idæ˜¯film_idå’Œactor_idçš„è”åˆç´¢å¼•ï¼Œè¿™é‡Œä½¿ç”¨åˆ°äº†film_actorçš„å·¦è¾¹å‰ç¼€film_idéƒ¨åˆ†ã€‚</span><br><span class="line">mysql&gt; explain select * from film left join film_actor on film.id = film_actor.film_id;</span><br><span class="line">+<span class="comment">----+-------------+------------+-------+-------------------+-------------------+---------+--------------+------+-------------+</span></span><br><span class="line">| id | select_type | table      | type  | possible_keys     | key               | key_len | ref          | rows | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+------------+-------+-------------------+-------------------+---------+--------------+------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | film       | index | NULL              | idx_name          | 33      | NULL         |    3 | Using index |</span><br><span class="line">|  1 | SIMPLE      | film_actor | ref   | idx_film_actor_id | idx_film_actor_id | 4       | test.film.id |    1 | Using index |</span><br><span class="line">+<span class="comment">----+-------------+------------+-------+-------------------+-------------------+---------+--------------+------+-------------+</span></span><br></pre></td></tr></table></figure></p>
<p><strong>ref_or_null</strong>ï¼šç±»ä¼¼refï¼Œä½†æ˜¯å¯ä»¥æœç´¢å€¼ä¸ºNULLçš„è¡Œã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from film where name = "film1" or name is null;</span><br><span class="line">+<span class="comment">----+-------------+-------+-------------+---------------+----------+---------+-------+------+--------------------------+</span></span><br><span class="line">| id | select_type | table | type        | possible_keys | key      | key_len | ref   | rows | Extra                    |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------------+---------------+----------+---------+-------+------+--------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | film  | ref_or_null | idx_name      | idx_name | 33      | const |    2 | Using where; Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------------+---------------+----------+---------+-------+------+--------------------------+</span></span><br></pre></td></tr></table></figure></p>
<p><strong>index_merge</strong>ï¼šè¡¨ç¤ºä½¿ç”¨äº†ç´¢å¼•åˆå¹¶çš„ä¼˜åŒ–æ–¹æ³•ã€‚ ä¾‹å¦‚ä¸‹è¡¨ï¼šidæ˜¯ä¸»é”®ï¼Œtenant_idæ˜¯æ™®é€šç´¢å¼•ã€‚or çš„æ—¶å€™æ²¡æœ‰ç”¨ primary keyï¼Œè€Œæ˜¯ä½¿ç”¨äº† primary key(id) å’Œ tenant_id ç´¢å¼•</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from role where id = 11011 or tenant_id = 8888;</span><br><span class="line">+<span class="comment">----+-------------+-------+-------------+-----------------------+-----------------------+---------+------+------+-------------------------------------------------+</span></span><br><span class="line">| id | select_type | table | type        | possible_keys         | key                   | key_len | ref  | rows | Extra                                           |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------------+-----------------------+-----------------------+---------+------+------+-------------------------------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | role  | index_merge | PRIMARY,idx_tenant_id | PRIMARY,idx_tenant_id | 4,4     | NULL |  134 | Using union(PRIMARY,idx_tenant_id); Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------------+-----------------------+-----------------------+---------+------+------+-------------------------------------------------+</span></span><br></pre></td></tr></table></figure>
<p><strong>range</strong>ï¼šèŒƒå›´æ‰«æé€šå¸¸å‡ºç°åœ¨ in(), between ,&gt; ,&lt;, &gt;= ç­‰æ“ä½œä¸­ã€‚ä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ¥æ£€ç´¢ç»™å®šèŒƒå›´çš„è¡Œã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from actor where id &gt; 1;</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+</span></span><br><span class="line">| id | select_type | table | type  | possible_keys | key     | key_len | ref  | rows | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | actor | range | PRIMARY       | PRIMARY | 4       | NULL |    2 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+</span></span><br></pre></td></tr></table></figure></p>
<p><strong>index</strong>ï¼šå’ŒALLä¸€æ ·ï¼Œä¸åŒå°±æ˜¯mysqlåªéœ€æ‰«æç´¢å¼•æ ‘ï¼Œè¿™é€šå¸¸æ¯”ALLå¿«ä¸€äº›ã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select count(*) from film;</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+</span></span><br><span class="line">| id | select_type | table | type  | possible_keys | key      | key_len | ref  | rows | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | film  | index | NULL          | idx_name | 33      | NULL |    3 | Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+</span></span><br></pre></td></tr></table></figure></p>
<p><strong>ALL</strong>ï¼šå³å…¨è¡¨æ‰«æï¼Œæ„å‘³ç€mysqléœ€è¦ä»å¤´åˆ°å°¾å»æŸ¥æ‰¾æ‰€éœ€è¦çš„è¡Œã€‚é€šå¸¸æƒ…å†µä¸‹è¿™éœ€è¦å¢åŠ ç´¢å¼•æ¥è¿›è¡Œä¼˜åŒ–äº†<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from actor;</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+------+------+-------+</span></span><br><span class="line">| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra |</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+------+------+-------+</span></span><br><span class="line">|  1 | SIMPLE      | actor | ALL  | NULL          | NULL | NULL    | NULL |    2 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+------+------+-------+</span></span><br></pre></td></tr></table></figure></p>
<h2 id="possible-keysåˆ—"><a href="#possible-keysåˆ—" class="headerlink" title="possible_keysåˆ—"></a>possible_keysåˆ—</h2><p>è¿™ä¸€åˆ—æ˜¾ç¤ºæŸ¥è¯¢å¯èƒ½ä½¿ç”¨å“ªäº›ç´¢å¼•æ¥æŸ¥æ‰¾ã€‚<br>explain æ—¶å¯èƒ½å‡ºç° possible_keys æœ‰åˆ—ï¼Œè€Œ key æ˜¾ç¤º NULL çš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µæ˜¯å› ä¸ºè¡¨ä¸­æ•°æ®ä¸å¤šï¼Œmysqlè®¤ä¸ºç´¢å¼•å¯¹æ­¤æŸ¥è¯¢å¸®åŠ©ä¸å¤§ï¼Œé€‰æ‹©äº†å…¨è¡¨æŸ¥è¯¢ã€‚<br>å¦‚æœè¯¥åˆ—æ˜¯NULLï¼Œåˆ™æ²¡æœ‰ç›¸å…³çš„ç´¢å¼•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥ where å­å¥çœ‹æ˜¯å¦å¯ä»¥åˆ›é€ ä¸€ä¸ªé€‚å½“çš„ç´¢å¼•æ¥æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œç„¶åç”¨ explain æŸ¥çœ‹æ•ˆæœã€‚</p>
<h2 id="keyåˆ—"><a href="#keyåˆ—" class="headerlink" title="keyåˆ—"></a>keyåˆ—</h2><p>è¿™ä¸€åˆ—æ˜¾ç¤ºmysqlå®é™…é‡‡ç”¨å“ªä¸ªç´¢å¼•æ¥ä¼˜åŒ–å¯¹è¯¥è¡¨çš„è®¿é—®ã€‚<br>å¦‚æœæ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œåˆ™è¯¥åˆ—æ˜¯ NULLã€‚å¦‚æœæƒ³å¼ºåˆ¶mysqlä½¿ç”¨æˆ–å¿½è§†possible_keysåˆ—ä¸­çš„ç´¢å¼•ï¼Œåœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨ force indexã€ignore indexã€‚</p>
<h2 id="key-lenåˆ—"><a href="#key-lenåˆ—" class="headerlink" title="key_lenåˆ—"></a>key_lenåˆ—</h2><p>è¿™ä¸€åˆ—æ˜¾ç¤ºäº†mysqlåœ¨ç´¢å¼•é‡Œä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œé€šè¿‡è¿™ä¸ªå€¼å¯ä»¥ç®—å‡ºå…·ä½“ä½¿ç”¨äº†ç´¢å¼•ä¸­çš„å“ªäº›åˆ—ã€‚<br>ä¸¾ä¾‹æ¥è¯´ï¼Œfilm_actorçš„è”åˆç´¢å¼• idx_film_actor_id ç”± film_id å’Œ actor_id ä¸¤ä¸ªintåˆ—ç»„æˆï¼Œå¹¶ä¸”æ¯ä¸ªintæ˜¯4å­—èŠ‚ã€‚é€šè¿‡ç»“æœä¸­çš„key_len=4å¯æ¨æ–­å‡ºæŸ¥è¯¢ä½¿ç”¨äº†ç¬¬ä¸€ä¸ªåˆ—ï¼šfilm_idåˆ—æ¥æ‰§è¡Œç´¢å¼•æŸ¥æ‰¾ã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from film_actor where film_id = 2;</span><br><span class="line">+<span class="comment">----+-------------+------------+------+-------------------+-------------------+---------+-------+------+-------------+</span></span><br><span class="line">| id | select_type | table      | type | possible_keys     | key               | key_len | ref   | rows | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+------------+------+-------------------+-------------------+---------+-------+------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | film_actor | ref  | idx_film_actor_id | idx_film_actor_id | 4       | const |    1 | Using index |</span><br><span class="line">+<span class="comment">----+-------------+------------+------+-------------------+-------------------+---------+-------+------+-------------+</span></span><br></pre></td></tr></table></figure></p>
<p>key_lenè®¡ç®—è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li>ç¬¦ä¸²<ul>
<li>char(n)ï¼šnå­—èŠ‚é•¿åº¦</li>
<li>varchar(n)ï¼š2å­—èŠ‚å­˜å‚¨å­—ç¬¦ä¸²é•¿åº¦ï¼Œå¦‚æœæ˜¯utf-8ï¼Œåˆ™é•¿åº¦ 3n + 2</li>
</ul>
</li>
<li>æ•°å€¼ç±»å‹<ul>
<li>tinyintï¼š1å­—èŠ‚</li>
<li>smallintï¼š2å­—èŠ‚</li>
<li>intï¼š4å­—èŠ‚</li>
<li>bigintï¼š8å­—èŠ‚ã€€ã€€</li>
</ul>
</li>
<li>æ—¶é—´ç±»å‹ã€€<ul>
<li>dateï¼š3å­—èŠ‚</li>
<li>timestampï¼š4å­—èŠ‚</li>
<li>datetimeï¼š8å­—èŠ‚</li>
</ul>
</li>
<li>å¦‚æœå­—æ®µå…è®¸ä¸º NULLï¼Œéœ€è¦1å­—èŠ‚è®°å½•æ˜¯å¦ä¸º NULL</li>
</ul>
<p>ç´¢å¼•æœ€å¤§é•¿åº¦æ˜¯768å­—èŠ‚ï¼Œå½“å­—ç¬¦ä¸²è¿‡é•¿æ—¶ï¼Œmysqlä¼šåšä¸€ä¸ªç±»ä¼¼å·¦å‰ç¼€ç´¢å¼•çš„å¤„ç†ï¼Œå°†å‰åŠéƒ¨åˆ†çš„å­—ç¬¦æå–å‡ºæ¥åšç´¢å¼•ã€‚</p>
<h2 id="refåˆ—"><a href="#refåˆ—" class="headerlink" title="refåˆ—"></a>refåˆ—</h2><p>è¿™ä¸€åˆ—æ˜¾ç¤ºäº†åœ¨keyåˆ—è®°å½•çš„ç´¢å¼•ä¸­ï¼Œè¡¨æŸ¥æ‰¾å€¼æ‰€ç”¨åˆ°çš„åˆ—æˆ–å¸¸é‡ï¼Œå¸¸è§çš„æœ‰ï¼šconstï¼ˆå¸¸é‡ï¼‰ï¼Œfuncï¼ŒNULLï¼Œå­—æ®µåï¼ˆä¾‹ï¼šfilm.idï¼‰</p>
<h2 id="rowsåˆ—"><a href="#rowsåˆ—" class="headerlink" title="rowsåˆ—"></a>rowsåˆ—</h2><p>è¿™ä¸€åˆ—æ˜¯mysqlä¼°è®¡è¦è¯»å–å¹¶æ£€æµ‹çš„è¡Œæ•°ï¼Œæ³¨æ„è¿™ä¸ªä¸æ˜¯ç»“æœé›†é‡Œçš„è¡Œæ•°ã€‚</p>
<h2 id="Extraåˆ—"><a href="#Extraåˆ—" class="headerlink" title="Extraåˆ—"></a>Extraåˆ—</h2><p>è¿™ä¸€åˆ—å±•ç¤ºçš„æ˜¯é¢å¤–ä¿¡æ¯ã€‚å¸¸è§çš„é‡è¦å€¼å¦‚ä¸‹ï¼š<br><strong>distinct</strong>: ä¸€æ—¦mysqlæ‰¾åˆ°äº†ä¸è¡Œç›¸è”åˆåŒ¹é…çš„è¡Œï¼Œå°±ä¸å†æœç´¢äº†<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select distinct name from film left join film_actor on film.id = film_actor.film_id;</span><br><span class="line">+<span class="comment">----+-------------+------------+-------+-------------------+-------------------+---------+--------------+------+------------------------------+</span></span><br><span class="line">| id | select_type | table      | type  | possible_keys     | key               | key_len | ref          | rows | Extra                        |</span><br><span class="line">+<span class="comment">----+-------------+------------+-------+-------------------+-------------------+---------+--------------+------+------------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | film       | index | idx_name          | idx_name          | 33      | NULL         |    3 | Using index; Using temporary |</span><br><span class="line">|  1 | SIMPLE      | film_actor | ref   | idx_film_actor_id | idx_film_actor_id | 4       | test.film.id |    1 | Using index; Distinct        |</span><br><span class="line">+<span class="comment">----+-------------+------------+-------+-------------------+-------------------+---------+--------------+------+------------------------------+</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Using index</strong>ï¼šè¿™å‘ç”Ÿåœ¨å¯¹è¡¨çš„è¯·æ±‚åˆ—éƒ½æ˜¯åŒä¸€ç´¢å¼•çš„éƒ¨åˆ†çš„æ—¶å€™ï¼Œè¿”å›çš„åˆ—æ•°æ®åªä½¿ç”¨äº†ç´¢å¼•ä¸­çš„ä¿¡æ¯ï¼Œè€Œæ²¡æœ‰å†å»è®¿é—®è¡¨ä¸­çš„è¡Œè®°å½•ã€‚æ˜¯æ€§èƒ½é«˜çš„è¡¨ç°ã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select id from film order by id;</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+</span></span><br><span class="line">| id | select_type | table | type  | possible_keys | key     | key_len | ref  | rows | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | film  | index | NULL          | PRIMARY | 4       | NULL |    3 | Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+---------+---------+------+------+-------------+</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Using where</strong>ï¼šmysqlæœåŠ¡å™¨å°†åœ¨å­˜å‚¨å¼•æ“æ£€ç´¢è¡Œåå†è¿›è¡Œè¿‡æ»¤ã€‚å°±æ˜¯å…ˆè¯»å–æ•´è¡Œæ•°æ®ï¼Œå†æŒ‰ where æ¡ä»¶è¿›è¡Œæ£€æŸ¥ï¼Œç¬¦åˆå°±ç•™ä¸‹ï¼Œä¸ç¬¦åˆå°±ä¸¢å¼ƒã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from film where id &gt; 1;</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+----------+---------+------+------+--------------------------+</span></span><br><span class="line">| id | select_type | table | type  | possible_keys | key      | key_len | ref  | rows | Extra                    |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+----------+---------+------+------+--------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | film  | index | PRIMARY       | idx_name | 33      | NULL |    3 | Using where; Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+----------+---------+------+------+--------------------------+</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Using temporary</strong>ï¼šmysqléœ€è¦åˆ›å»ºä¸€å¼ ä¸´æ—¶è¡¨æ¥å¤„ç†æŸ¥è¯¢ã€‚å‡ºç°è¿™ç§æƒ…å†µä¸€èˆ¬æ˜¯è¦è¿›è¡Œä¼˜åŒ–çš„ï¼Œé¦–å…ˆæ˜¯æƒ³åˆ°ç”¨ç´¢å¼•æ¥ä¼˜åŒ–ã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1. actor.nameæ²¡æœ‰ç´¢å¼•ï¼Œæ­¤æ—¶åˆ›å»ºäº†å¼ ä¸´æ—¶è¡¨æ¥distinct</span><br><span class="line">mysql&gt; explain select distinct name from actor;</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+------+------+-----------------+</span></span><br><span class="line">| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra           |</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+------+------+-----------------+</span></span><br><span class="line">|  1 | SIMPLE      | actor | ALL  | NULL          | NULL | NULL    | NULL |    2 | Using temporary |</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+------+------+-----------------+</span></span><br><span class="line"></span><br><span class="line">2. film.nameå»ºç«‹äº†idx_nameç´¢å¼•ï¼Œæ­¤æ—¶æŸ¥è¯¢æ—¶extraæ˜¯using index,æ²¡æœ‰ç”¨ä¸´æ—¶è¡¨</span><br><span class="line">mysql&gt; explain select distinct name from film;</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+</span></span><br><span class="line">| id | select_type | table | type  | possible_keys | key      | key_len | ref  | rows | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | film  | index | idx_name      | idx_name | 33      | NULL |    3 | Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Using filesort</strong>ï¼šå¦‚æœæ’åºå­—æ®µä¸æ˜¯ç´¢å¼•çš„è¯ï¼Œå°±ä¼šå‡ºç°è¿™ä¸ªï¼Œè¿™ç§æƒ…å†µä¸‹ä¸€èˆ¬ä¹Ÿæ˜¯è¦è€ƒè™‘ä½¿ç”¨ç´¢å¼•æ¥ä¼˜åŒ–çš„ã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1. actor.nameæœªåˆ›å»ºç´¢å¼•ï¼Œä¼šæµè§ˆactoræ•´ä¸ªè¡¨ï¼Œä¿å­˜æ’åºå…³é”®å­—nameå’Œå¯¹åº”çš„idï¼Œç„¶åæ’åºnameå¹¶æ£€ç´¢è¡Œè®°å½•</span><br><span class="line">mysql&gt; explain select * from actor order by name;</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+------+------+----------------+</span></span><br><span class="line">| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra          |</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+------+------+----------------+</span></span><br><span class="line">|  1 | SIMPLE      | actor | ALL  | NULL          | NULL | NULL    | NULL |    2 | Using filesort |</span><br><span class="line">+<span class="comment">----+-------------+-------+------+---------------+------+---------+------+------+----------------+</span></span><br><span class="line"></span><br><span class="line">2. film.nameå»ºç«‹äº†idx_nameç´¢å¼•,æ­¤æ—¶æŸ¥è¯¢æ—¶extraæ˜¯using index</span><br><span class="line">mysql&gt; explain select * from film order by name;</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+</span></span><br><span class="line">| id | select_type | table | type  | possible_keys | key      | key_len | ref  | rows | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | film  | index | NULL          | idx_name | 33      | NULL |    3 | Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------+-------+---------------+----------+---------+------+------+-------------+</span></span><br></pre></td></tr></table></figure></p>
<h1 id="ä½¿ç”¨çš„è¡¨"><a href="#ä½¿ç”¨çš„è¡¨" class="headerlink" title="ä½¿ç”¨çš„è¡¨"></a>ä½¿ç”¨çš„è¡¨</h1><p>ä»¥ä¸Šæ‰€æœ‰sqlä½¿ç”¨çš„è¡¨å’Œæ•°æ®ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`actor`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`actor`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">45</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`update_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`actor`</span> (<span class="string">`id`</span>, <span class="string">`name`</span>, <span class="string">`update_time`</span>) <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">'a'</span>,<span class="string">'2017-12-22 15:27:18'</span>), (<span class="number">2</span>,<span class="string">'b'</span>,<span class="string">'2017-12-22 15:27:18'</span>), (<span class="number">3</span>,<span class="string">'c'</span>,<span class="string">'2017-12-22 15:27:18'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`film`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`film`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`idx_name`</span> (<span class="string">`name`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`film`</span> (<span class="string">`id`</span>, <span class="string">`name`</span>) <span class="keyword">VALUES</span> (<span class="number">3</span>,<span class="string">'film0'</span>),(<span class="number">1</span>,<span class="string">'film1'</span>),(<span class="number">2</span>,<span class="string">'film2'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`film_actor`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`film_actor`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`film_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`actor_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`idx_film_actor_id`</span> (<span class="string">`film_id`</span>,<span class="string">`actor_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`film_actor`</span> (<span class="string">`id`</span>, <span class="string">`film_id`</span>, <span class="string">`actor_id`</span>) <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>),(<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>),(<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>);</span><br></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ğŸ‘¿ mark&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;Explainç®€ä»‹&quot;&gt;&lt;a href=&quot;#Explainç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;Explainç®€ä»‹&quot;&gt;&lt;/a&gt;Explainç®€ä»‹&lt;/h1&gt;&lt;p&gt;æœ¬æ–‡ä¸»è¦è®²è¿°å¦‚ä½•é€šè¿‡ explain å‘½ä»¤è·å– select è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œé€šè¿‡ explain æˆ‘ä»¬å¯ä»¥çŸ¥é“ä»¥ä¸‹ä¿¡æ¯ï¼šè¡¨çš„è¯»å–é¡ºåºï¼Œæ•°æ®è¯»å–æ“ä½œçš„ç±»å‹ï¼Œå“ªäº›ç´¢å¼•å¯ä»¥ä½¿ç”¨ï¼Œå“ªäº›ç´¢å¼•å®é™…ä½¿ç”¨äº†ï¼Œè¡¨ä¹‹é—´çš„å¼•ç”¨ï¼Œæ¯å¼ è¡¨æœ‰å¤šå°‘è¡Œè¢«ä¼˜åŒ–å™¨æŸ¥è¯¢ç­‰ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä½¿ç”¨ explain çš„ä¾‹å­ï¼š &lt;/p&gt;
&lt;p&gt;åœ¨ select è¯­å¥ä¹‹å‰å¢åŠ  explain å…³é”®å­—ï¼ŒMySQL ä¼šåœ¨æŸ¥è¯¢ä¸Šè®¾ç½®ä¸€ä¸ªæ ‡è®°ï¼Œæ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œä¼šè¿”å›æ‰§è¡Œè®¡åˆ’çš„ä¿¡æ¯ï¼Œè€Œä¸æ˜¯æ‰§è¡Œè¿™æ¡SQLï¼ˆå¦‚æœ from ä¸­åŒ…å«å­æŸ¥è¯¢ï¼Œä»ä¼šæ‰§è¡Œè¯¥å­æŸ¥è¯¢ï¼Œå°†ç»“æœæ”¾å…¥ä¸´æ—¶è¡¨ä¸­ï¼‰ã€‚&lt;br&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mysql&amp;gt; explain select * from actor;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+&lt;span class=&quot;comment&quot;&gt;----+-------------+-------+------+---------------+------+---------+------+------+-------+&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+&lt;span class=&quot;comment&quot;&gt;----+-------------+-------+------+---------------+------+---------+------+------+-------+&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;|  1 | SIMPLE      | actor | ALL  | NULL          | NULL | NULL    | NULL |    2 | NULL  |&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;+&lt;span class=&quot;comment&quot;&gt;----+-------------+-------+------+---------------+------+---------+------+------+-------+&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;åœ¨æŸ¥è¯¢ä¸­çš„æ¯ä¸ªè¡¨ä¼šè¾“å‡ºä¸€è¡Œï¼Œå¦‚æœæœ‰ä¸¤ä¸ªè¡¨é€šè¿‡ join è¿æ¥æŸ¥è¯¢ï¼Œé‚£ä¹ˆä¼šè¾“å‡ºä¸¤è¡Œã€‚è¡¨çš„æ„ä¹‰ç›¸å½“å¹¿æ³›ï¼šå¯ä»¥æ˜¯å­æŸ¥è¯¢ã€ä¸€ä¸ª union ç»“æœç­‰ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="mysql" scheme="http://idiotsky.top/categories/mysql/"/>
    
    
      <category term="mysql" scheme="http://idiotsky.top/tags/mysql/"/>
    
  </entry>
  
</feed>
