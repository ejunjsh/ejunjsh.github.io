<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="docker," />





  <link rel="alternate" href="/atom.xml" title="IdiotSky" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="ä¸æƒ³åˆ†å‡ ç« äº†ï¼Œæ‰€ä»¥å¾ˆé•¿å¾ˆé•¿ğŸ‘¿  docker å®¹å™¨çš„çŠ¶æ€æœº ä¸€ä¸ªå®¹å™¨åœ¨æŸä¸ªæ—¶åˆ»å¯èƒ½å¤„äºä»¥ä¸‹å‡ ç§çŠ¶æ€ä¹‹ä¸€ï¼š  createdï¼šå·²ç»è¢«åˆ›å»º ï¼ˆä½¿ç”¨ docker ps -a å‘½ä»¤å¯ä»¥åˆ—å‡ºï¼‰ä½†æ˜¯è¿˜æ²¡æœ‰è¢«å¯åŠ¨ ï¼ˆä½¿ç”¨ docker ps å‘½ä»¤è¿˜æ— æ³•åˆ—å‡ºï¼‰ runningï¼šè¿è¡Œä¸­ pausedï¼šå®¹å™¨çš„è¿›ç¨‹è¢«æš‚åœäº† restartingï¼šå®¹å™¨çš„è¿›ç¨‹æ­£åœ¨é‡å¯è¿‡ç¨‹ä¸­ exitedï¼šä¸Šå›¾ä¸­çš„ stopped çŠ¶">
<meta name="keywords" content="docker">
<meta property="og:type" content="article">
<meta property="og:title" content="dockeræ€»ç»“">
<meta property="og:url" content="http://idiotsky.top/2018/10/24/docker-summary/index.html">
<meta property="og:site_name" content="IdiotSky">
<meta property="og:description" content="ä¸æƒ³åˆ†å‡ ç« äº†ï¼Œæ‰€ä»¥å¾ˆé•¿å¾ˆé•¿ğŸ‘¿  docker å®¹å™¨çš„çŠ¶æ€æœº ä¸€ä¸ªå®¹å™¨åœ¨æŸä¸ªæ—¶åˆ»å¯èƒ½å¤„äºä»¥ä¸‹å‡ ç§çŠ¶æ€ä¹‹ä¸€ï¼š  createdï¼šå·²ç»è¢«åˆ›å»º ï¼ˆä½¿ç”¨ docker ps -a å‘½ä»¤å¯ä»¥åˆ—å‡ºï¼‰ä½†æ˜¯è¿˜æ²¡æœ‰è¢«å¯åŠ¨ ï¼ˆä½¿ç”¨ docker ps å‘½ä»¤è¿˜æ— æ³•åˆ—å‡ºï¼‰ runningï¼šè¿è¡Œä¸­ pausedï¼šå®¹å™¨çš„è¿›ç¨‹è¢«æš‚åœäº† restartingï¼šå®¹å™¨çš„è¿›ç¨‹æ­£åœ¨é‡å¯è¿‡ç¨‹ä¸­ exitedï¼šä¸Šå›¾ä¸­çš„ stopped çŠ¶">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://idiotsky.top/images3/docker-summary-1.jpg">
<meta property="og:image" content="http://idiotsky.top/images3/docker-summary-2.jpg">
<meta property="og:image" content="http://idiotsky.top/images3/docker-summary-9.png">
<meta property="og:image" content="http://idiotsky.top/images3/docker-summary-10.png">
<meta property="og:image" content="http://idiotsky.top/images3/docker-summary-3.jpg">
<meta property="og:image" content="http://idiotsky.top/images3/docker-summary-3.jpg">
<meta property="og:image" content="http://idiotsky.top/images3/docker-summary-5.jpg">
<meta property="og:image" content="http://idiotsky.top/images3/docker-summary-6.jpg">
<meta property="og:image" content="http://idiotsky.top/images3/docker-summary-7.jpg">
<meta property="og:image" content="http://idiotsky.top/images3/docker-summary-8.jpg">
<meta property="og:updated_time" content="2018-11-10T04:34:41.277Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="dockeræ€»ç»“">
<meta name="twitter:description" content="ä¸æƒ³åˆ†å‡ ç« äº†ï¼Œæ‰€ä»¥å¾ˆé•¿å¾ˆé•¿ğŸ‘¿  docker å®¹å™¨çš„çŠ¶æ€æœº ä¸€ä¸ªå®¹å™¨åœ¨æŸä¸ªæ—¶åˆ»å¯èƒ½å¤„äºä»¥ä¸‹å‡ ç§çŠ¶æ€ä¹‹ä¸€ï¼š  createdï¼šå·²ç»è¢«åˆ›å»º ï¼ˆä½¿ç”¨ docker ps -a å‘½ä»¤å¯ä»¥åˆ—å‡ºï¼‰ä½†æ˜¯è¿˜æ²¡æœ‰è¢«å¯åŠ¨ ï¼ˆä½¿ç”¨ docker ps å‘½ä»¤è¿˜æ— æ³•åˆ—å‡ºï¼‰ runningï¼šè¿è¡Œä¸­ pausedï¼šå®¹å™¨çš„è¿›ç¨‹è¢«æš‚åœäº† restartingï¼šå®¹å™¨çš„è¿›ç¨‹æ­£åœ¨é‡å¯è¿‡ç¨‹ä¸­ exitedï¼šä¸Šå›¾ä¸­çš„ stopped çŠ¶">
<meta name="twitter:image" content="http://idiotsky.top/images3/docker-summary-1.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '4C652JRMON',
      apiKey: 'ef468e206fb85903f33c4fc8b4bb2cd6',
      indexName: 'myblog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://idiotsky.top/2018/10/24/docker-summary/"/>





  <title>dockeræ€»ç»“ | IdiotSky</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?c2da852ee703ae71196b173fd6edef51";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">IdiotSky</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-books">
          <a href="/books/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />
            
            Books
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://idiotsky.top/2018/10/24/docker-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ejunjsh">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars7.githubusercontent.com/u/22493186?v=4&s=460">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IdiotSky">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">dockeræ€»ç»“</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-24T22:50:22+08:00">
                24 Oct 18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/docker/" itemprop="url" rel="index">
                    <span itemprop="name">docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>ä¸æƒ³åˆ†å‡ ç« äº†ï¼Œæ‰€ä»¥å¾ˆé•¿å¾ˆé•¿ğŸ‘¿</p>
</blockquote>
<h1 id="docker-å®¹å™¨çš„çŠ¶æ€æœº"><a href="#docker-å®¹å™¨çš„çŠ¶æ€æœº" class="headerlink" title="docker å®¹å™¨çš„çŠ¶æ€æœº"></a>docker å®¹å™¨çš„çŠ¶æ€æœº</h1><p><a href="http://idiotsky.top/images3/docker-summary-1.jpg"><img src="http://idiotsky.top/images3/docker-summary-1.jpg" alt=""></a></p>
<p>ä¸€ä¸ªå®¹å™¨åœ¨æŸä¸ªæ—¶åˆ»å¯èƒ½å¤„äºä»¥ä¸‹å‡ ç§çŠ¶æ€ä¹‹ä¸€ï¼š</p>
<ul>
<li>createdï¼šå·²ç»è¢«åˆ›å»º ï¼ˆä½¿ç”¨ docker ps -a å‘½ä»¤å¯ä»¥åˆ—å‡ºï¼‰ä½†æ˜¯è¿˜æ²¡æœ‰è¢«å¯åŠ¨ ï¼ˆä½¿ç”¨ docker ps å‘½ä»¤è¿˜æ— æ³•åˆ—å‡ºï¼‰</li>
<li>runningï¼šè¿è¡Œä¸­</li>
<li>pausedï¼šå®¹å™¨çš„è¿›ç¨‹è¢«æš‚åœäº†</li>
<li>restartingï¼šå®¹å™¨çš„è¿›ç¨‹æ­£åœ¨é‡å¯è¿‡ç¨‹ä¸­</li>
<li>exitedï¼šä¸Šå›¾ä¸­çš„ stopped çŠ¶æ€ï¼Œè¡¨ç¤ºå®¹å™¨ä¹‹å‰è¿è¡Œè¿‡ä½†æ˜¯ç°åœ¨å¤„äºåœæ­¢çŠ¶æ€ï¼ˆè¦åŒºåˆ«äº created çŠ¶æ€ï¼Œå®ƒæ˜¯æŒ‡ä¸€ä¸ªæ–°åˆ›å‡ºçš„å°šæœªè¿è¡Œè¿‡çš„å®¹å™¨ï¼‰ã€‚å¯ä»¥é€šè¿‡ start å‘½ä»¤ä½¿å…¶é‡æ–°è¿›å…¥ running çŠ¶æ€</li>
<li>destroyedï¼šå®¹å™¨è¢«åˆ é™¤äº†ï¼Œå†ä¹Ÿä¸å­˜åœ¨äº†</li>
</ul>
<a id="more"></a>
<h1 id="Docker-å‘½ä»¤æ¦‚è¿°"><a href="#Docker-å‘½ä»¤æ¦‚è¿°" class="headerlink" title="Docker å‘½ä»¤æ¦‚è¿°"></a>Docker å‘½ä»¤æ¦‚è¿°</h1><p>æˆ‘ä»¬å¯ä»¥æŠŠDocker çš„å‘½ä»¤å¤§æ¦‚åœ°åˆ†ç±»å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">é•œåƒæ“ä½œï¼š</span><br><span class="line">    build     Build an image from a Dockerfile</span><br><span class="line">    commit    Create a new image from a container&apos;s changes</span><br><span class="line">    images    List images</span><br><span class="line">    load      Load an image from a tar archive or STDIN</span><br><span class="line">    pull      Pull an image or a repository from a registry</span><br><span class="line">    push      Push an image or a repository to a registry</span><br><span class="line">    rmi       Remove one or more images</span><br><span class="line">    search    Search the Docker Hub for images</span><br><span class="line">    tag       Tag an image into a repository</span><br><span class="line">    save      Save one or more images to a tar archive (streamed to STDOUT by default)</span><br><span class="line">    history   æ˜¾ç¤ºæŸé•œåƒçš„å†å²</span><br><span class="line">    inspect   è·å–é•œåƒçš„è¯¦ç»†ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">    å®¹å™¨åŠå…¶ä¸­åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸæ“ä½œï¼š</span><br><span class="line">    create    Create a new container ï¼ˆåˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼‰        </span><br><span class="line">    kill      Kill one or more running containers</span><br><span class="line">    inspect   Return low-level information on a container, image or task</span><br><span class="line">    pause     Pause all processes within one or more containers</span><br><span class="line">    ps        List containers</span><br><span class="line">    rm        Remove one or more containers ï¼ˆåˆ é™¤ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ï¼‰</span><br><span class="line">    rename    Rename a container</span><br><span class="line">    restart   Restart a container</span><br><span class="line">    run       Run a command in a new container ï¼ˆåˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼‰</span><br><span class="line">    start     Start one or more stopped containers ï¼ˆå¯åŠ¨ä¸€ä¸ªå¤„äºåœæ­¢çŠ¶æ€çš„å®¹å™¨ï¼‰</span><br><span class="line">    stats     Display a live stream of container(s) resource usage statistics ï¼ˆæ˜¾ç¤ºå®¹å™¨å®æ—¶çš„èµ„æºæ¶ˆè€—ä¿¡æ¯ï¼‰</span><br><span class="line">    stop      Stop one or more running containers ï¼ˆåœæ­¢ä¸€ä¸ªå¤„äºè¿è¡ŒçŠ¶æ€çš„å®¹å™¨ï¼‰</span><br><span class="line">    top       Display the running processes of a container</span><br><span class="line">    unpause   Unpause all processes within one or more containers</span><br><span class="line">    update    Update configuration of one or more containers</span><br><span class="line">    wait      Block until a container stops, then print its exit code</span><br><span class="line">    attach    Attach to a running container</span><br><span class="line">    exec      Run a command in a running container</span><br><span class="line">    port      List port mappings or a specific mapping for the container</span><br><span class="line">    logs      è·å–å®¹å™¨çš„æ—¥å¿—    </span><br><span class="line">    </span><br><span class="line">    å®¹å™¨æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼š</span><br><span class="line">    cp        Copy files/folders between a container and the local filesystem</span><br><span class="line">    diff      Inspect changes on a container&apos;s filesystem</span><br><span class="line">    export    Export a container&apos;s filesystem as a tar archive</span><br><span class="line">    import    Import the contents from a tarball to create a filesystem image</span><br><span class="line">    </span><br><span class="line">    Docker registry æ“ä½œï¼š</span><br><span class="line">    login     Log in to a Docker registry.</span><br><span class="line">    logout    Log out from a Docker registry.</span><br><span class="line">    </span><br><span class="line">    Volume æ“ä½œ</span><br><span class="line">    volume    Manage Docker volumes</span><br><span class="line">    </span><br><span class="line">    ç½‘ç»œæ“ä½œ</span><br><span class="line">    network   Manage Docker networks</span><br><span class="line">    </span><br><span class="line">    Swarm ç›¸å…³æ“ä½œ</span><br><span class="line">    swarm     Manage Docker Swarm</span><br><span class="line">    service   Manage Docker services</span><br><span class="line">    node      Manage Docker Swarm nodes       </span><br><span class="line">    </span><br><span class="line">    ç³»ç»Ÿæ“ä½œï¼š    </span><br><span class="line">    version   Show the Docker version information</span><br><span class="line">    events    Get real time events from the server  (æŒç»­è¿”å›docker äº‹ä»¶)</span><br><span class="line">    info      Display system-wide information ï¼ˆæ˜¾ç¤ºDocker ä¸»æœºç³»ç»ŸèŒƒå›´å†…çš„ä¿¡æ¯ï¼‰</span><br></pre></td></tr></table></figure>
<h1 id="Doker-å¹³å°çš„åŸºæœ¬æ„æˆ"><a href="#Doker-å¹³å°çš„åŸºæœ¬æ„æˆ" class="headerlink" title="Doker å¹³å°çš„åŸºæœ¬æ„æˆ"></a>Doker å¹³å°çš„åŸºæœ¬æ„æˆ</h1><p><a href="http://idiotsky.top/images3/docker-summary-2.jpg"><img src="http://idiotsky.top/images3/docker-summary-2.jpg" alt=""></a></p>
<p>Docker å¹³å°åŸºæœ¬ä¸Šç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯ï¼šç”¨æˆ·ä½¿ç”¨ Docker æä¾›çš„å·¥å…·ï¼ˆCLI ä»¥åŠ API ç­‰ï¼‰æ¥æ„å»ºï¼Œä¸Šä¼ é•œåƒå¹¶å‘å¸ƒå‘½ä»¤æ¥åˆ›å»ºå’Œå¯åŠ¨å®¹å™¨</li>
<li>Docker ä¸»æœºï¼šä» Docker registry ä¸Šä¸‹è½½é•œåƒå¹¶å¯åŠ¨å®¹å™¨</li>
<li>Docker registryï¼šDocker é•œåƒä»“åº“ï¼Œç”¨äºä¿å­˜é•œåƒï¼Œå¹¶æä¾›é•œåƒä¸Šä¼ å’Œä¸‹è½½</li>
</ul>
<h1 id="Host-OS-VS-Guest-OS-VS-Base-image"><a href="#Host-OS-VS-Guest-OS-VS-Base-image" class="headerlink" title="Host OS VS Guest OS VS Base image"></a>Host OS VS Guest OS VS Base image</h1><p>æ¯”å¦‚ï¼Œä¸€å°ä¸»æœºå®‰è£…çš„æ˜¯ Centos æ“ä½œç³»ç»Ÿï¼Œç°åœ¨åœ¨ä¸Šé¢è·‘ä¸€ä¸ª Ubuntu å®¹å™¨ã€‚æ­¤æ—¶ï¼ŒHost OS æ˜¯ Centosï¼ŒGuest OS æ˜¯ Ubuntuã€‚Guest OS ä¹Ÿè¢«æˆä¸ºå®¹å™¨çš„ Base Imageã€‚</p>
<p><a href="http://idiotsky.top/images3/docker-summary-9.png"><img src="http://idiotsky.top/images3/docker-summary-9.png" alt=""></a></p>
<p>ä¸€äº›è¯´æ˜ï¼š</p>
<ul>
<li>å…³äº linux å†…æ ¸å’Œç‰ˆæœ¬ï¼šæ‰€æœ‰ Linux å‘è¡Œç‰ˆéƒ½é‡‡ç”¨ç›¸åŒçš„ Linux å†…æ ¸ï¼ˆkernelï¼‰ï¼Œç„¶åæ‰€æœ‰å‘è¡Œç‰ˆå¯¹å†…æ ¸éƒ½æœ‰è½»å¾®æ”¹åŠ¨ã€‚è¿™äº›æ”¹åŠ¨éƒ½ä¼šä¸Šä¼ å› linux ç¤¾åŒºï¼Œå¹¶è¢«åˆå¹¶ã€‚</li>
<li>å…³äºLinux å®¹å™¨ç¯å¢ƒï¼šå› ä¸ºæ‰€æœ‰Linuxå‘è¡Œç‰ˆéƒ½åŒ…å«åŒä¸€ä¸ªlinux å†…æ ¸ï¼ˆæœ‰è½»å¾®ä¿®æ”¹ï¼‰ï¼Œä»¥åŠä¸åŒçš„è‡ªå·±çš„è½¯ä»¶ï¼Œå› æ­¤ï¼Œä¼šå¾ˆå®¹æ˜“åœ°å°†æŸä¸ª userland è½¯ä»¶å®‰è£…åœ¨linux å†…æ ¸ä¸Šï¼Œæ¥æ¨¡æ‹Ÿä¸åŒçš„å‘è¡Œç‰ˆç¯å¢ƒã€‚æ¯”å¦‚è¯´ï¼Œåœ¨ Ubuntu ä¸Šè¿è¡Œ Centos å®¹å™¨ï¼Œè¿™æ„å‘³ç€ä» Centos è·å– userland è½¯ä»¶ï¼Œè¿è¡Œåœ¨ Ubuntu å†…æ ¸ä¸Šã€‚å› æ­¤ï¼Œè¿™å°±åƒåœ¨åŒä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼ˆlinux å†…æ ¸ï¼‰ä¸Šè¿è¡Œä¸åŒçš„ userland è½¯ä»¶ï¼ˆå‘è¡Œç‰ˆçš„ï¼‰ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆDocker ä¸æ”¯æŒåœ¨ Linux ä¸»æœºä¸Šè¿è¡Œ FreeBSD æˆ–è€…windows å®¹å™¨ã€‚</li>
</ul>
<p>å¯è§ï¼Œå®¹å™¨çš„ base image å¹¶ä¸çœŸçš„æ˜¯ base OSã€‚Base image ä¼šè¿œè¿œæ¯” base OS æ›´è½»é‡ã€‚å®ƒåªå®‰è£…å‘è¡Œç‰ˆç‰¹æ®Šçš„éƒ¨åˆ†ï¼ˆuserland è½¯ä»¶ï¼‰ã€‚</p>
<p><a href="http://idiotsky.top/images3/docker-summary-10.png"><img src="http://idiotsky.top/images3/docker-summary-10.png" alt=""></a></p>
<p>é‚£ä¸ºä»€ä¹ˆè¿˜éœ€è¦ base image å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºï¼Œdocker å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸ host OS æ˜¯éš”ç¦»çš„ã€‚å®¹å™¨é•œåƒä¸­çš„åº”ç”¨è½¯ä»¶æ— æ³•çœ‹åˆ°ä¸»æœºæ–‡ä»¶ç³»ç»Ÿï¼Œé™¤éå°†ä¸»æœºæ–‡ä»¶ç³»ç»ŸæŒ‚è½½ä¸ºå®¹å™¨çš„å·ã€‚å› æ­¤ï¼Œå¯ä»¥æƒ³åƒä¸€ä¸‹ï¼Œä½ å®¹å™¨ä¸­çš„åº”ç”¨ä¾èµ–äºå„ç§æ“ä½œç³»ç»Ÿåº“ï¼Œå› æ­¤æˆ‘ä»¬ä¸å¾—ä¸å°†è¿™äº›åº“æ‰“åŒ…åˆ°é•œåƒä¹‹ä¸­ã€‚å¦å¤–ï¼Œbase image ä¼šè®©æˆ‘ä»¬ä½¿ç”¨åˆ°å„ä¸ªå‘è¡Œç‰ˆçš„åŒ…ç®¡ç†ç³»ç»Ÿï¼Œæ¯”å¦‚ yum å’Œ apt-getã€‚è€Œä¸”ï¼Œå„ä¸ªlinux å‘è¡Œç‰ˆçš„ base image ä¹Ÿä¸æ˜¯æ™®é€šçš„å‘è¡Œç‰ˆï¼Œè€Œæ˜¯ä¸€ä¸ªç®€åŒ–äº†çš„ç‰ˆæœ¬ã€‚è€Œä¸”ï¼Œbase image å¹¶ä¸å¸¦æœ‰ linux å†…æ ¸ï¼Œå› ä¸ºå®¹å™¨ä¼šä½¿ç”¨ä¸»æœºçš„å†…æ ¸ã€‚</p>
<p>å› æ­¤ï¼Œéœ€è¦æ³¨é‡ç†è§£ image å’Œ OS è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚ä¹‹æ‰€ä»¥æˆä¸º base imageï¼Œè€Œä¸æ˜¯ base OSï¼Œæ˜¯å› ä¸º base image ä¸­å¹¶ä¸åŒ…æ‹¬å®Œæ•´çš„ OSã€‚è€Œè¿™ä¸€ç‚¹ï¼Œæ˜¯å®¹å™¨ä¸è™šæ‹Ÿæœºä¹‹å‰çš„æœ¬è´¨åŒºåˆ«ä¹‹ä¸€ã€‚é‚£å°±æ˜¯ï¼Œå®¹å™¨å¹¶æ²¡æœ‰è™šæ‹ŸåŒ–ï¼Œè€Œæ˜¯å…±äº«ä¸»æœºä¸Šçš„linux å†…æ ¸ã€‚</p>
<h1 id="Docker-é•œåƒåˆ†å±‚-COW-å’Œ-é•œåƒå¤§å°ï¼ˆsizeï¼‰"><a href="#Docker-é•œåƒåˆ†å±‚-COW-å’Œ-é•œåƒå¤§å°ï¼ˆsizeï¼‰" class="headerlink" title="Docker é•œåƒåˆ†å±‚,COW å’Œ é•œåƒå¤§å°ï¼ˆsizeï¼‰"></a>Docker é•œåƒåˆ†å±‚,COW å’Œ é•œåƒå¤§å°ï¼ˆsizeï¼‰</h1><h2 id="é•œåƒåˆ†å±‚å’Œå®¹å™¨å±‚"><a href="#é•œåƒåˆ†å±‚å’Œå®¹å™¨å±‚" class="headerlink" title="é•œåƒåˆ†å±‚å’Œå®¹å™¨å±‚"></a>é•œåƒåˆ†å±‚å’Œå®¹å™¨å±‚</h2><p>ä¸€ä¸ª Docker é•œåƒæ˜¯åŸºäºåŸºç¡€é•œåƒçš„å¤šå±‚å åŠ ï¼Œæœ€ç»ˆæ„æˆå’Œå®¹å™¨çš„ rootfs ï¼ˆæ ¹æ–‡ä»¶ç³»ç»Ÿï¼‰ã€‚å½“ Docker åˆ›å»ºä¸€ä¸ªå®¹å™¨æ—¶ï¼Œå®ƒä¼šåœ¨åŸºç¡€é•œåƒçš„å®¹å™¨å±‚ä¹‹ä¸Šæ·»åŠ ä¸€å±‚æ–°çš„è–„è–„çš„å¯å†™å®¹å™¨å±‚ã€‚æ¥ä¸‹æ¥ï¼Œæ‰€æœ‰å¯¹å®¹å™¨çš„å˜åŒ–ï¼Œæ¯”å¦‚å†™æ–°çš„æ–‡ä»¶ï¼Œä¿®æ”¹å·²æœ‰æ–‡ä»¶å’Œåˆ é™¤æ–‡ä»¶ï¼Œéƒ½åªä¼šä½œç”¨åœ¨è¿™ä¸ªå®¹å™¨å±‚ä¹‹ä¸­ã€‚å› æ­¤ï¼Œé€šè¿‡ä¸æ‹·è´å®Œæ•´çš„ rootfsï¼ŒDocker å‡å°‘äº†å®¹å™¨æ‰€å ç”¨çš„ç©ºé—´ï¼Œä»¥åŠå‡å°‘äº†å®¹å™¨å¯åŠ¨æ‰€éœ€æ—¶é—´ã€‚</p>
<p><a href="http://idiotsky.top/images3/docker-summary-3.jpg"><img src="http://idiotsky.top/images3/docker-summary-3.jpg" alt=""></a></p>
<h2 id="COW-å’Œé•œåƒå¤§å°"><a href="#COW-å’Œé•œåƒå¤§å°" class="headerlink" title="COW å’Œé•œåƒå¤§å°"></a>COW å’Œé•œåƒå¤§å°</h2><p>COWï¼Œcopy-on-write æŠ€æœ¯ï¼Œä¸€æ–¹é¢å¸¦æ¥äº†å®¹å™¨å¯åŠ¨çš„å¿«æ·ï¼Œå¦ä¸€æ–¹ä¹Ÿé€ æˆäº†å®¹å™¨é•œåƒå¤§å°çš„å¢åŠ ã€‚æ¯ä¸€æ¬¡ RUN å‘½ä»¤éƒ½ä¼šåœ¨é•œåƒä¸Šå¢åŠ ä¸€å±‚ï¼Œæ¯ä¸€å±‚éƒ½ä¼šå ç”¨ç£ç›˜ç©ºé—´ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ Ubuntu 14.04 åŸºç¡€é•œåƒä¸­è¿è¡Œ RUN apt-get upgrade ä¼šåœ¨ä¿ç•™åŸºç¡€å±‚çš„åŒæ—¶å†åˆ›å»ºä¸€ä¸ªæ–°å±‚æ¥æ”¾æ‰€æœ‰æ–°çš„æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä¿®æ”¹è€çš„æ–‡ä»¶ï¼Œå› æ­¤ï¼Œæ–°çš„é•œåƒå¤§å°ä¼šè¶…è¿‡ç›´æ¥åœ¨è€çš„æ–‡ä»¶ç³»ç»Ÿä¸Šåšæ›´æ–°æ—¶çš„æ–‡ä»¶å¤§å°ã€‚å› æ­¤ï¼Œä¸ºäº†å‡å°‘é•œåƒå¤§å°èµ·è§ï¼Œæ‰€æœ‰æ–‡ä»¶ç›¸å…³çš„æ“ä½œï¼Œæ¯”å¦‚åˆ é™¤ï¼Œé‡Šæ”¾å’Œç§»åŠ¨ç­‰ï¼Œéƒ½éœ€è¦å°½å¯èƒ½åœ°æ”¾åœ¨ä¸€ä¸ª RUN æŒ‡ä»¤ä¸­è¿›è¡Œã€‚</p>
<h2 id="ä½¿ç”¨å®¹å™¨éœ€è¦é¿å…çš„ä¸€äº›åšæ³•"><a href="#ä½¿ç”¨å®¹å™¨éœ€è¦é¿å…çš„ä¸€äº›åšæ³•" class="headerlink" title="ä½¿ç”¨å®¹å™¨éœ€è¦é¿å…çš„ä¸€äº›åšæ³•"></a>ä½¿ç”¨å®¹å™¨éœ€è¦é¿å…çš„ä¸€äº›åšæ³•</h2><p>è¿™ç¯‡æ–‡ç«  <a href="http://developers.redhat.com/blog/2016/02/24/10-things-to-avoid-in-docker-containers/" target="_blank" rel="noopener">10 things to avoid in docker containers</a> åˆ—ä¸¾äº†ä¸€äº›åœ¨ä½¿ç”¨å®¹å™¨æ—¶éœ€è¦é¿å…çš„åšæ³•ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>ä¸è¦åœ¨å®¹å™¨ä¸­ä¿å­˜æ•°æ®ï¼ˆDonâ€™t store data in containersï¼‰</li>
<li>å°†åº”ç”¨æ‰“åŒ…åˆ°é•œåƒå†éƒ¨ç½²è€Œä¸æ˜¯æ›´æ–°åˆ°å·²æœ‰å®¹å™¨ï¼ˆDonâ€™t ship your application in two piecesï¼‰</li>
<li>ä¸è¦äº§ç”Ÿè¿‡å¤§çš„é•œåƒ ï¼ˆDonâ€™t create large imagesï¼‰</li>
<li>ä¸è¦ä½¿ç”¨å•å±‚é•œåƒ ï¼ˆDonâ€™t use a single layer imageï¼‰</li>
<li>ä¸è¦ä»è¿è¡Œç€çš„å®¹å™¨ä¸Šäº§ç”Ÿé•œåƒ ï¼ˆDonâ€™t create images from running containers ï¼‰</li>
<li>ä¸è¦åªæ˜¯ä½¿ç”¨ â€œlatestâ€æ ‡ç­¾ ï¼ˆDonâ€™t use only the â€œlatestâ€ tagï¼‰</li>
<li>ä¸è¦åœ¨å®¹å™¨å†…è¿è¡Œè¶…è¿‡ä¸€ä¸ªçš„è¿›ç¨‹ ï¼ˆDonâ€™t run more than one process in a single container ï¼‰</li>
<li>ä¸è¦åœ¨å®¹å™¨å†…ä¿å­˜ credentialsï¼Œè€Œæ˜¯è¦ä»å¤–é¢é€šè¿‡ç¯å¢ƒå˜é‡ä¼ å…¥ ï¼ˆ Donâ€™t store credentials in the image. Use environment variablesï¼‰</li>
<li>ä¸è¦ä½¿ç”¨ root ç”¨æˆ·è·‘å®¹å™¨è¿›ç¨‹ï¼ˆDonâ€™t run processes as a root user ï¼‰</li>
<li>ä¸è¦ä¾èµ–äºIPåœ°å€ï¼Œè€Œæ˜¯è¦ä»å¤–é¢é€šè¿‡ç¯å¢ƒå˜é‡ä¼ å…¥ ï¼ˆDonâ€™t rely on IP addresses ï¼‰</li>
</ul>
<h1 id="Linux-namespace-çš„æ¦‚å¿µ"><a href="#Linux-namespace-çš„æ¦‚å¿µ" class="headerlink" title="Linux namespace çš„æ¦‚å¿µ"></a>Linux namespace çš„æ¦‚å¿µ</h1><p>Linux å†…æ ¸ä»ç‰ˆæœ¬ 2.4.19 å¼€å§‹é™†ç»­å¼•å…¥äº† namespace çš„æ¦‚å¿µã€‚å…¶ç›®çš„æ˜¯å°†æŸä¸ªç‰¹å®šçš„å…¨å±€ç³»ç»Ÿèµ„æºï¼ˆglobal system resourceï¼‰é€šè¿‡æŠ½è±¡æ–¹æ³•ä½¿å¾—namespace ä¸­çš„è¿›ç¨‹çœ‹èµ·æ¥æ‹¥æœ‰å®ƒä»¬è‡ªå·±çš„éš”ç¦»çš„å…¨å±€ç³»ç»Ÿèµ„æºå®ä¾‹ï¼ˆThe purpose of each namespace is to wrap a particular global system resource in an abstraction that makes it appear to the processes within the namespace that they have their own isolated instance of the global resource. ï¼‰ã€‚Linux å†…æ ¸ä¸­å®ç°äº†å…­ç§ namespaceï¼ŒæŒ‰ç…§å¼•å…¥çš„å…ˆåé¡ºåºï¼Œåˆ—è¡¨å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>namespace</th>
<th>å¼•å…¥çš„ç›¸å…³å†…æ ¸ç‰ˆæœ¬</th>
<th>è¢«éš”ç¦»çš„å…¨å±€ç³»ç»Ÿèµ„æº</th>
<th>åœ¨å®¹å™¨è¯­å¢ƒä¸‹çš„éš”ç¦»æ•ˆæœ</th>
</tr>
</thead>
<tbody>
<tr>
<td>Mount namespaces</td>
<td>Linux 2.4.19</td>
<td>æ–‡ä»¶ç³»ç»ŸæŒ‚æ¥ç‚¹</td>
<td>æ¯ä¸ªå®¹å™¨èƒ½çœ‹åˆ°ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡ç»“æ„</td>
</tr>
<tr>
<td>ÂšUTS namespaces</td>
<td>Linux 2.6.19</td>
<td>nodename å’Œ domainname</td>
<td>æ¯ä¸ªå®¹å™¨å¯ä»¥æœ‰è‡ªå·±çš„ hostname å’Œ domainame</td>
</tr>
<tr>
<td>IPC namespaces</td>
<td>Linux 2.6.19</td>
<td>ç‰¹å®šçš„è¿›ç¨‹é—´é€šä¿¡èµ„æºï¼ŒåŒ…æ‹¬System V IPC å’Œ  POSIX message queues</td>
<td>æ¯ä¸ªå®¹å™¨æœ‰å…¶è‡ªå·±çš„ System V IPC å’Œ POSIX æ¶ˆæ¯é˜Ÿåˆ—æ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤ï¼Œåªæœ‰åœ¨åŒä¸€ä¸ª IPC namespace çš„è¿›ç¨‹ä¹‹é—´æ‰èƒ½äº’ç›¸é€šä¿¡</td>
</tr>
<tr>
<td>PID namespaces</td>
<td>Linux 2.6.24</td>
<td>è¿›ç¨‹ ID æ•°å­—ç©ºé—´ ï¼ˆprocess ID number spaceï¼‰</td>
<td>æ¯ä¸ª PID namespace ä¸­çš„è¿›ç¨‹å¯ä»¥æœ‰å…¶ç‹¬ç«‹çš„ PIDï¼› æ¯ä¸ªå®¹å™¨å¯ä»¥æœ‰å…¶ PID ä¸º 1 çš„root è¿›ç¨‹ï¼›ä¹Ÿä½¿å¾—å®¹å™¨å¯ä»¥åœ¨ä¸åŒçš„ host ä¹‹é—´è¿ç§»ï¼Œå› ä¸º namespace ä¸­çš„è¿›ç¨‹ ID å’Œ host æ— å…³äº†ã€‚è¿™ä¹Ÿä½¿å¾—å®¹å™¨ä¸­çš„æ¯ä¸ªè¿›ç¨‹æœ‰ä¸¤ä¸ªPIDï¼šå®¹å™¨ä¸­çš„ PID å’Œ host ä¸Šçš„ PIDã€‚</td>
</tr>
<tr>
<td>Network namespaces</td>
<td>å§‹äºLinux 2.6.24 å®Œæˆäº Linux 2.6.29</td>
<td>ç½‘ç»œç›¸å…³çš„ç³»ç»Ÿèµ„æº</td>
<td>æ¯ä¸ªå®¹å™¨ç”¨æœ‰å…¶ç‹¬ç«‹çš„ç½‘ç»œè®¾å¤‡ï¼ŒIP åœ°å€ï¼ŒIP è·¯ç”±è¡¨ï¼Œ/proc/net ç›®å½•ï¼Œç«¯å£å·ç­‰ç­‰ã€‚è¿™ä¹Ÿä½¿å¾—ä¸€ä¸ª host ä¸Šå¤šä¸ªå®¹å™¨å†…çš„åŒä¸€ä¸ªåº”ç”¨éƒ½ç»‘å®šåˆ°å„è‡ªå®¹å™¨çš„ 80 ç«¯å£ä¸Šã€‚</td>
</tr>
<tr>
<td>User namespaces</td>
<td>å§‹äº Linux 2.6.23 å®Œæˆäº Linux 3.8)</td>
<td>ç”¨æˆ·å’Œç»„ ID ç©ºé—´</td>
<td>åœ¨ user namespace ä¸­çš„è¿›ç¨‹çš„ç”¨æˆ·å’Œç»„ ID å¯ä»¥å’Œåœ¨ host ä¸Šä¸åŒï¼› æ¯ä¸ª container å¯ä»¥æœ‰ä¸åŒçš„ user å’Œ group idï¼›ä¸€ä¸ª host ä¸Šçš„éç‰¹æƒç”¨æˆ·å¯ä»¥æˆä¸º user namespace ä¸­çš„ç‰¹æƒç”¨æˆ·ï¼›</td>
</tr>
</tbody>
</table>
<p>Linux namespace çš„æ¦‚å¿µè¯´ç®€å•ä¹Ÿç®€å•è¯´å¤æ‚ä¹Ÿå¤æ‚ã€‚ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬åªè¦çŸ¥é“ï¼Œå¤„äºæŸä¸ª namespace ä¸­çš„è¿›ç¨‹ï¼Œèƒ½çœ‹åˆ°ç‹¬ç«‹çš„å®ƒè‡ªå·±çš„éš”ç¦»çš„æŸäº›ç‰¹å®šç³»ç»Ÿèµ„æºï¼›å¤æ‚æ¥è¯´ï¼Œå¯ä»¥å»çœ‹çœ‹ Linux å†…æ ¸ä¸­å®ç° namespace çš„åŸç†ï¼Œç½‘ç»œä¸Šä¹Ÿæœ‰å¤§é‡çš„æ–‡æ¡£ä¾›å‚è€ƒï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p>
<h1 id="Docker-å®¹å™¨ä½¿ç”¨-linux-namespace-åšè¿è¡Œç¯å¢ƒéš”ç¦»"><a href="#Docker-å®¹å™¨ä½¿ç”¨-linux-namespace-åšè¿è¡Œç¯å¢ƒéš”ç¦»" class="headerlink" title="Docker å®¹å™¨ä½¿ç”¨ linux namespace åšè¿è¡Œç¯å¢ƒéš”ç¦»"></a>Docker å®¹å™¨ä½¿ç”¨ linux namespace åšè¿è¡Œç¯å¢ƒéš”ç¦»</h1><p>å½“ Docker åˆ›å»ºä¸€ä¸ªå®¹å™¨æ—¶ï¼Œå®ƒä¼šåˆ›å»ºæ–°çš„ä»¥ä¸Šå…­ç§ namespace çš„å®ä¾‹ï¼Œç„¶åæŠŠå®¹å™¨ä¸­çš„æ‰€æœ‰è¿›ç¨‹æ”¾åˆ°è¿™äº› namespace ä¹‹ä¸­ï¼Œä½¿å¾—Docker å®¹å™¨ä¸­çš„è¿›ç¨‹åªèƒ½çœ‹åˆ°éš”ç¦»çš„ç³»ç»Ÿèµ„æºã€‚ </p>
<h2 id="Mount-Namespace"><a href="#Mount-Namespace" class="headerlink" title="Mount Namespace"></a>Mount Namespace</h2><p>Mount namespaceç”¨æ¥éš”ç¦»æ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½ç‚¹, ä½¿å¾—ä¸åŒçš„mount namespaceæ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æŒ‚è½½ç‚¹ä¿¡æ¯ï¼Œä¸åŒçš„namespaceä¹‹é—´ä¸ä¼šç›¸äº’å½±å“ï¼Œè¿™å¯¹äºæ„å»ºç”¨æˆ·æˆ–è€…å®¹å™¨è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿç›®å½•éå¸¸æœ‰ç”¨ã€‚</p>
<p>å½“å‰è¿›ç¨‹æ‰€åœ¨mount namespaceé‡Œçš„æ‰€æœ‰æŒ‚è½½ä¿¡æ¯å¯ä»¥åœ¨/proc/[pid]/mountsã€/proc/[pid]/mountinfoå’Œ/proc/[pid]/mountstatsé‡Œé¢æ‰¾åˆ°ã€‚</p>
<p>Mount namespacesæ˜¯ç¬¬ä¸€ä¸ªè¢«åŠ å…¥Linuxçš„namespaceï¼Œç”±äºå½“æ—¶æ²¡æƒ³åˆ°è¿˜ä¼šå¼•å…¥å…¶å®ƒçš„namespaceï¼Œæ‰€ä»¥å–åä¸ºCLONE_NEWNSï¼Œè€Œæ²¡æœ‰å«CLONE_NEWMOUNTã€‚</p>
<p>æ¯ä¸ªmount namespaceéƒ½æ‹¥æœ‰ä¸€ä»½è‡ªå·±çš„æŒ‚è½½ç‚¹åˆ—è¡¨ï¼Œå½“ç”¨cloneæˆ–è€…unshareå‡½æ•°åˆ›å»ºæ–°çš„mount namespaceæ—¶ï¼Œæ–°åˆ›å»ºçš„namespaceå°†æ‹·è´ä¸€ä»½è€namespaceé‡Œçš„æŒ‚è½½ç‚¹åˆ—è¡¨ï¼Œä½†ä»è¿™ä¹‹åï¼Œä»–ä»¬å°±æ²¡æœ‰å…³ç³»äº†ï¼Œé€šè¿‡mountå’Œumountå¢åŠ å’Œåˆ é™¤å„è‡ªnamespaceé‡Œé¢çš„æŒ‚è½½ç‚¹éƒ½ä¸ä¼šç›¸äº’å½±å“ã€‚</p>
<h2 id="PID-namespace"><a href="#PID-namespace" class="headerlink" title="PID namespace"></a>PID namespace</h2><p>æˆ‘ä»¬èƒ½çœ‹åˆ°åŒä¸€ä¸ªè¿›ç¨‹ï¼Œåœ¨å®¹å™¨å†…å¤–çš„ PID æ˜¯ä¸åŒçš„ï¼š</p>
<ul>
<li>åœ¨å®¹å™¨å†… PID æ˜¯ 1ï¼ŒPPID æ˜¯ 0ã€‚</li>
<li>åœ¨å®¹å™¨å¤– PID æ˜¯ 2198ï¼Œ PPID æ˜¯ 2179 å³ docker-containerd-shim è¿›ç¨‹.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@devstack:/home/sammy# ps -ef | grep python</span><br><span class="line">root 2198 2179 0 00:06 ? 00:00:00 python app.py</span><br><span class="line"></span><br><span class="line">root@devstack:/home/sammy# ps -ef | grep 2179</span><br><span class="line">root 2179 765 0 00:06 ? 00:00:00 docker-containerd-shim 8b7dd09fbcae00373207f01e2acde45740871c9e3b98286b5458b4ea09f41b3e /var/run/docker/libcontainerd/8b7dd09fbcae00373207f01e2acde45740871c9e3b98286b5458b4ea09f41b3e docker-runc</span><br><span class="line">root 2198 2179 0 00:06 ? 00:00:00 python app.py</span><br><span class="line">root 2249 1692 0 00:06 pts/0 00:00:00 grep --color=auto 2179</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@devstack:/home/sammy# docker exec -it web31 ps -ef</span><br><span class="line">UID PID PPID C STIME TTY TIME CMD</span><br><span class="line">root 1 0 0 16:06 ? 00:00:00 python app.py</span><br></pre></td></tr></table></figure>
<p>å…³äº containerdï¼Œcontainerd-shim å’Œ container çš„å…³ç³»ï¼Œ<a href="https://github.com/crosbymichael/dockercon-2016/blob/master/Creating%20Containerd.pdf" target="_blank" rel="noopener">æ–‡ç« </a> ä¸­çš„ä¸‹å›¾å¯ä»¥è¯´æ˜ï¼š</p>
<p><a href="http://idiotsky.top/images3/docker-summary-3.jpg"><img src="http://idiotsky.top/images3/docker-summary-3.jpg" alt=""></a></p>
<ul>
<li>Docker å¼•æ“ç®¡ç†ç€é•œåƒï¼Œç„¶åç§»äº¤ç»™ containerd è¿è¡Œï¼Œcontainerd å†ä½¿ç”¨ runC è¿è¡Œå®¹å™¨ã€‚</li>
<li>Containerd æ˜¯ä¸€ä¸ªç®€å•çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ runC ç®¡ç†å®¹å™¨ï¼Œä½¿ç”¨ gRPC æš´éœ²å®¹å™¨çš„å…¶ä»–åŠŸèƒ½ã€‚å®ƒç®¡ç†å®¹å™¨çš„å¼€å§‹ï¼Œåœæ­¢ï¼Œæš‚åœå’Œé”€æ¯ã€‚ç”±äºå®¹å™¨è¿è¡Œæ—¶æ˜¯å­¤ç«‹çš„å¼•æ“ï¼Œå¼•æ“æœ€ç»ˆèƒ½å¤Ÿå¯åŠ¨å’Œå‡çº§è€Œæ— éœ€é‡æ–°å¯åŠ¨å®¹å™¨ã€‚</li>
<li>runCæ˜¯ä¸€ä¸ªè½»é‡çº§çš„å·¥å…·ï¼Œå®ƒæ˜¯ç”¨æ¥è¿è¡Œå®¹å™¨çš„ï¼Œåªç”¨æ¥åšè¿™ä¸€ä»¶äº‹ï¼Œå¹¶ä¸”è¿™ä¸€ä»¶äº‹è¦åšå¥½ã€‚runCåŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªå°å‘½ä»¤è¡Œå·¥å…·ä¸”å®ƒå¯ä»¥ä¸ç”¨é€šè¿‡Dockerå¼•æ“ï¼Œç›´æ¥å°±å¯ä»¥ä½¿ç”¨å®¹å™¨ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œå®¹å™¨ä¸­çš„ä¸»åº”ç”¨åœ¨ host ä¸Šçš„çˆ¶è¿›ç¨‹æ˜¯ containerd-shimï¼Œæ˜¯å®ƒé€šè¿‡å·¥å…· runC æ¥å¯åŠ¨è¿™äº›è¿›ç¨‹çš„ã€‚</p>
<p>è¿™ä¹Ÿèƒ½çœ‹å‡ºæ¥ï¼Œpid namespace é€šè¿‡å°† host ä¸Š PID æ˜ å°„ä¸ºå®¹å™¨å†…çš„ PIDï¼Œ ä½¿å¾—å®¹å™¨å†…çš„è¿›ç¨‹çœ‹èµ·æ¥æœ‰ä¸ªç‹¬ç«‹çš„ PID ç©ºé—´ã€‚</p>
<h2 id="UTS-namespace"><a href="#UTS-namespace" class="headerlink" title="UTS namespace"></a>UTS namespace</h2><p>ç±»ä¼¼åœ°ï¼Œå®¹å™¨å¯ä»¥æœ‰è‡ªå·±çš„ hostname å’Œ domainnameï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@devstack:/home/sammy# hostname</span><br><span class="line">devstack</span><br><span class="line">root@devstack:/home/sammy# docker exec -it web31 hostname</span><br><span class="line">8b7dd09fbcae</span><br></pre></td></tr></table></figure>
<h2 id="IPC-Namespace"><a href="#IPC-Namespace" class="headerlink" title="IPC Namespace"></a>IPC Namespace</h2><p>IPCå…¨ç§° Inter-Process Communicationï¼Œæ˜¯Unix/Linuxä¸‹è¿›ç¨‹é—´é€šä¿¡çš„ä¸€ç§æ–¹å¼ï¼ŒIPCæœ‰å…±äº«å†…å­˜ã€ä¿¡å·é‡ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰æ–¹æ³•ã€‚æ‰€ä»¥ï¼Œä¸ºäº†éš”ç¦»ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦æŠŠIPCç»™éš”ç¦»å¼€æ¥ï¼Œè¿™æ ·ï¼Œåªæœ‰åœ¨åŒä¸€ä¸ªNamespaceä¸‹çš„è¿›ç¨‹æ‰èƒ½ç›¸äº’é€šä¿¡ã€‚å¦‚æœä½ ç†Ÿæ‚‰IPCçš„åŸç†çš„è¯ï¼Œä½ ä¼šçŸ¥é“ï¼ŒIPCéœ€è¦æœ‰ä¸€ä¸ªå…¨å±€çš„IDï¼Œå³ç„¶æ˜¯å…¨å±€çš„ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€æˆ‘ä»¬çš„Namespaceéœ€è¦å¯¹è¿™ä¸ªIDéš”ç¦»ï¼Œä¸èƒ½è®©åˆ«çš„Namespaceçš„è¿›ç¨‹çœ‹åˆ°ã€‚</p>
<h2 id="user-namespace"><a href="#user-namespace" class="headerlink" title="user namespace"></a>user namespace</h2><p>åœ¨ Docker 1.10 ç‰ˆæœ¬ä¹‹å‰ï¼ŒDocker æ˜¯ä¸æ”¯æŒ user namespaceã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤åœ°ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹çš„è¿è¡Œç”¨æˆ·å°±æ˜¯ host ä¸Šçš„ root ç”¨æˆ·ï¼Œè¿™æ ·çš„è¯ï¼Œå½“ host ä¸Šçš„æ–‡ä»¶æˆ–è€…ç›®å½•ä½œä¸º volume è¢«æ˜ å°„åˆ°å®¹å™¨ä»¥åï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å…¶å®æ˜¯æœ‰ root çš„å‡ ä¹æ‰€æœ‰æƒé™å»ä¿®æ”¹è¿™äº› host ä¸Šçš„ç›®å½•çš„ï¼Œè¿™ä¼šæœ‰å¾ˆå¤§çš„å®‰å…¨é—®é¢˜ã€‚</p>
<p>ä¸¾ä¾‹ï¼š</p>
<ul>
<li>å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼š docker run -d -v /bin:/host/bin â€“name web34 training/webapp python app.py</li>
<li>æ­¤æ—¶è¿›ç¨‹çš„ç”¨æˆ·åœ¨å®¹å™¨å†…å’Œå¤–éƒ½æ˜¯rootï¼Œå®ƒåœ¨å®¹å™¨å†…å¯ä»¥å¯¹ host ä¸Šçš„ /bin ç›®å½•åšä»»æ„ä¿®æ”¹</li>
</ul>
<p>è€Œ Docker 1.10 ä¸­å¼•å…¥çš„ user namespace å°±å¯ä»¥è®©å®¹å™¨æœ‰ä¸€ä¸ª â€œå‡â€çš„  root ç”¨æˆ·ï¼Œå®ƒåœ¨å®¹å™¨å†…æ˜¯ rootï¼Œåœ¨å®¹å™¨å¤–æ˜¯ä¸€ä¸ªé root ç”¨æˆ·ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œuser namespace å®ç°äº† host users å’Œ container users ä¹‹é—´çš„æ˜ å°„ã€‚</p>
<p>å¯ç”¨æ­¥éª¤ï¼š</p>
<ol>
<li>ä¿®æ”¹ /etc/default/docker æ–‡ä»¶ï¼Œæ·»åŠ è¡Œ  DOCKER_OPTS=â€â€“userns-remap=defaultâ€</li>
<li>é‡å¯ docker æœåŠ¡ï¼Œæ­¤æ—¶ dockerd è¿›ç¨‹ä¸º /usr/bin/dockerd â€“userns-remap=default â€“raw-logs</li>
<li>ç„¶ååˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼šdocker run -d -v /bin:/host/bin â€“name web35 training/webapp python app.py</li>
<li>æŸ¥çœ‹è¿›ç¨‹åœ¨å®¹å™¨å†…å¤–çš„ç”¨æˆ·ï¼š</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@devstack:/home/sammy# ps -ef | grep python</span><br><span class="line">231072    1726  1686  0 01:44 ?        00:00:00 python app.py</span><br><span class="line"></span><br><span class="line">root@devstack:/home/sammy# docker exec web35 ps -ef</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root         1     0  0 17:44 ?        00:00:00 python app.py</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æ–‡ä»¶/etc/subuid å’Œ /etc/subgidï¼Œå¯ä»¥çœ‹åˆ° dockermap ç”¨æˆ·åœ¨host ä¸Šçš„ uid å’Œ gid éƒ½æ˜¯ 231072ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@devstack:/home/sammy# cat /etc/subuid</span><br><span class="line">sammy:100000:65536</span><br><span class="line">stack:165536:65536</span><br><span class="line">dockremap:231072:65536</span><br><span class="line">root@devstack:/home/sammy# cat /etc/subgid</span><br><span class="line">sammy:100000:65536</span><br><span class="line">stack:165536:65536</span><br><span class="line">dockremap:231072:65536</span><br></pre></td></tr></table></figure>
<p>å†çœ‹æ–‡ä»¶/proc/1726/uid_mapï¼Œå®ƒè¡¨ç¤ºäº†å®¹å™¨å†…å¤–ç”¨æˆ·çš„æ˜ å°„å…³ç³»ï¼Œå³å°†host ä¸Šçš„ 231072 ç”¨æˆ·æ˜ å°„ä¸ºå®¹å™¨å†…çš„ 0 ï¼ˆå³rootï¼‰ç”¨æˆ·ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@devstack:/home/sammy# cat /proc/1726/uid_map</span><br><span class="line">         0     231072      65536</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬è¯•å›¾åœ¨å®¹å™¨å†…ä¿®æ”¹ host ä¸Šçš„ /bin æ–‡ä»¶å¤¹ï¼Œå°±ä¼šæç¤ºæƒé™ä¸è¶³äº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@80993d821f7b:/host/bin# touch test2</span><br><span class="line">touch: cannot touch &apos;test2&apos;: Permission denied</span><br></pre></td></tr></table></figure>
<p>è¿™è¯´æ˜é€šè¿‡ä½¿ç”¨ user namespaceï¼Œæˆ‘ä»¬å°±æˆåŠŸåœ°é™åˆ¶äº†å®¹å™¨å†…è¿›ç¨‹çš„æƒé™ã€‚</p>
<h2 id="network-namespace"><a href="#network-namespace" class="headerlink" title="network namespace"></a>network namespace</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ docker å®ä¾‹è¢«åˆ›å»ºå‡ºæ¥åï¼Œä½¿ç”¨ ip netns  å‘½ä»¤æ— æ³•çœ‹åˆ°å®¹å™¨å®ä¾‹å¯¹åº”çš„ network namespaceã€‚è¿™æ˜¯å› ä¸º ip netns å‘½ä»¤æ˜¯ä» /var/run/netns æ–‡ä»¶å¤¹ä¸­è¯»å–å†…å®¹çš„ã€‚</p>
<p>æ­¥éª¤ï¼š</p>
<ol>
<li><p>æ‰¾åˆ°å®¹å™¨çš„ä¸»è¿›ç¨‹ ID</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@devstack:/home/sammy# docker inspect --format &apos;&#123;&#123;.State.Pid&#125;&#125;&apos; web5</span><br><span class="line">2704</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ›å»º  /var/run/netns ç›®å½•ä»¥åŠç¬¦å·è¿æ¥</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@devstack:/home/sammy# mkdir /var/run/netns</span><br><span class="line">root@devstack:/home/sammy# ln -s /proc/2704/ns/net /var/run/netns/web5</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ­¤æ—¶å¯ä»¥ä½¿ç”¨ ip netns å‘½ä»¤äº†</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@devstack:/home/sammy# ip netns</span><br><span class="line">web5</span><br><span class="line">root@devstack:/home/sammy# ip netns exec web5 ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default</span><br><span class="line">link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">inet 127.0.0.1/8 scope host lo</span><br><span class="line">valid_lft forever preferred_lft forever</span><br><span class="line">inet6 ::1/128 scope host</span><br><span class="line">valid_lft forever preferred_lft forever</span><br><span class="line">15: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line">link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">inet 172.17.0.3/16 scope global eth0</span><br><span class="line">valid_lft forever preferred_lft forever</span><br><span class="line">inet6 fe80::42:acff:fe11:3/64 scope link</span><br><span class="line">valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="Linux-control-groups"><a href="#Linux-control-groups" class="headerlink" title="Linux control groups"></a>Linux control groups</h1><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>Linux Cgroup å¯â€‹â€‹â€‹è®©â€‹â€‹â€‹æ‚¨â€‹â€‹â€‹ä¸ºâ€‹â€‹â€‹ç³»â€‹â€‹â€‹ç»Ÿâ€‹â€‹â€‹ä¸­â€‹â€‹â€‹æ‰€â€‹â€‹â€‹è¿â€‹â€‹â€‹è¡Œâ€‹â€‹â€‹ä»»â€‹â€‹â€‹åŠ¡â€‹â€‹â€‹ï¼ˆè¿›â€‹â€‹â€‹ç¨‹â€‹â€‹â€‹ï¼‰çš„â€‹â€‹â€‹ç”¨â€‹â€‹â€‹æˆ·â€‹â€‹â€‹å®šâ€‹â€‹â€‹ä¹‰â€‹â€‹â€‹ç»„â€‹â€‹â€‹ç¾¤â€‹â€‹â€‹åˆ†â€‹â€‹â€‹é…â€‹â€‹â€‹èµ„â€‹â€‹â€‹æºâ€‹â€‹â€‹ â€” æ¯”â€‹â€‹â€‹å¦‚â€‹â€‹â€‹ CPU æ—¶â€‹â€‹â€‹é—´â€‹â€‹â€‹ã€â€‹â€‹â€‹ç³»â€‹â€‹â€‹ç»Ÿâ€‹â€‹â€‹å†…â€‹â€‹â€‹å­˜â€‹â€‹â€‹ã€â€‹â€‹â€‹ç½‘â€‹â€‹â€‹ç»œâ€‹â€‹â€‹å¸¦â€‹â€‹â€‹å®½â€‹â€‹â€‹æˆ–â€‹â€‹â€‹è€…â€‹â€‹â€‹è¿™â€‹â€‹â€‹äº›â€‹â€‹â€‹èµ„â€‹â€‹â€‹æºâ€‹â€‹â€‹çš„â€‹â€‹â€‹ç»„â€‹â€‹â€‹åˆâ€‹â€‹â€‹ã€‚â€‹â€‹â€‹æ‚¨â€‹â€‹â€‹å¯â€‹â€‹â€‹ä»¥â€‹â€‹â€‹ç›‘â€‹â€‹â€‹æ§â€‹â€‹â€‹æ‚¨â€‹â€‹â€‹é…â€‹â€‹â€‹ç½®â€‹â€‹â€‹çš„â€‹â€‹â€‹ cgroupï¼Œæ‹’â€‹â€‹â€‹ç»cgroup è®¿â€‹â€‹â€‹é—®â€‹â€‹â€‹æŸâ€‹â€‹â€‹äº›â€‹â€‹â€‹èµ„â€‹â€‹â€‹æºâ€‹â€‹â€‹ï¼Œç”šâ€‹â€‹â€‹è‡³â€‹â€‹â€‹åœ¨â€‹â€‹â€‹è¿â€‹â€‹â€‹è¡Œâ€‹â€‹â€‹çš„â€‹â€‹â€‹ç³»â€‹â€‹â€‹ç»Ÿâ€‹â€‹â€‹ä¸­â€‹â€‹â€‹åŠ¨â€‹â€‹â€‹æ€â€‹â€‹â€‹é…â€‹â€‹â€‹ç½®â€‹â€‹â€‹æ‚¨â€‹â€‹â€‹çš„â€‹â€‹â€‹ cgroupã€‚æ‰€ä»¥ï¼Œå¯ä»¥å°† controll groups ç†è§£ä¸º controller ï¼ˆsystem resourceï¼‰ ï¼ˆforï¼‰ ï¼ˆprocessï¼‰groupsï¼Œä¹Ÿå°±æ˜¯æ˜¯è¯´å®ƒä»¥ä¸€ç»„è¿›ç¨‹ä¸ºç›®æ ‡è¿›è¡Œç³»ç»Ÿèµ„æºåˆ†é…å’Œæ§åˆ¶ã€‚</p>
<p>å®ƒä¸»è¦æä¾›äº†å¦‚ä¸‹åŠŸèƒ½ï¼š </p>
<ul>
<li>Resource limitation: é™åˆ¶èµ„æºä½¿ç”¨ï¼Œæ¯”å¦‚å†…å­˜ä½¿ç”¨ä¸Šé™ä»¥åŠæ–‡ä»¶ç³»ç»Ÿçš„ç¼“å­˜é™åˆ¶ã€‚</li>
<li>Prioritization: ä¼˜å…ˆçº§æ§åˆ¶ï¼Œæ¯”å¦‚ï¼šCPUåˆ©ç”¨å’Œç£ç›˜IOååã€‚</li>
<li>Accounting: ä¸€äº›å®¡è®¡æˆ–ä¸€äº›ç»Ÿè®¡ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è®¡è´¹ã€‚</li>
<li>Control: æŒ‚èµ·è¿›ç¨‹ï¼Œæ¢å¤æ‰§è¡Œè¿›ç¨‹ã€‚</li>
</ul>
<p>ä½¿â€‹â€‹â€‹ç”¨â€‹â€‹â€‹ cgroupï¼Œç³»â€‹â€‹â€‹ç»Ÿâ€‹â€‹â€‹ç®¡â€‹â€‹â€‹ç†â€‹â€‹â€‹å‘˜â€‹â€‹â€‹å¯â€‹â€‹â€‹æ›´â€‹â€‹â€‹å…·â€‹â€‹â€‹ä½“â€‹â€‹â€‹åœ°â€‹â€‹â€‹æ§â€‹â€‹â€‹åˆ¶â€‹â€‹â€‹å¯¹â€‹â€‹â€‹ç³»â€‹â€‹â€‹ç»Ÿâ€‹â€‹â€‹èµ„â€‹â€‹â€‹æºâ€‹â€‹â€‹çš„â€‹â€‹â€‹åˆ†â€‹â€‹â€‹é…â€‹â€‹â€‹ã€â€‹â€‹â€‹ä¼˜â€‹â€‹â€‹å…ˆâ€‹â€‹â€‹é¡ºâ€‹â€‹â€‹åºâ€‹â€‹â€‹ã€â€‹â€‹â€‹æ‹’â€‹â€‹â€‹ç»â€‹â€‹â€‹ã€â€‹â€‹â€‹ç®¡â€‹â€‹â€‹ç†â€‹â€‹â€‹å’Œâ€‹â€‹â€‹ç›‘â€‹â€‹â€‹æ§â€‹â€‹â€‹ã€‚â€‹â€‹â€‹å¯â€‹â€‹â€‹æ›´â€‹â€‹â€‹å¥½â€‹â€‹â€‹åœ°â€‹â€‹â€‹æ ¹â€‹â€‹â€‹æ®â€‹â€‹â€‹ä»»â€‹â€‹â€‹åŠ¡â€‹â€‹â€‹å’Œâ€‹â€‹â€‹ç”¨â€‹â€‹â€‹æˆ·â€‹â€‹â€‹åˆ†â€‹â€‹â€‹é…â€‹â€‹â€‹ç¡¬â€‹â€‹â€‹ä»¶â€‹â€‹â€‹èµ„â€‹â€‹â€‹æºâ€‹â€‹â€‹ï¼Œæâ€‹â€‹â€‹é«˜â€‹â€‹â€‹æ€»â€‹â€‹â€‹ä½“â€‹â€‹â€‹æ•ˆâ€‹â€‹â€‹ç‡â€‹â€‹â€‹ã€‚</p>
<p>åœ¨å®è·µä¸­ï¼Œç³»ç»Ÿç®¡ç†å‘˜ä¸€èˆ¬ä¼šåˆ©ç”¨CGroupåšä¸‹é¢è¿™äº›äº‹ï¼ˆæœ‰ç‚¹åƒä¸ºæŸä¸ªè™šæ‹Ÿæœºåˆ†é…èµ„æºä¼¼çš„ï¼‰ï¼š</p>
<ul>
<li>éš”ç¦»ä¸€ä¸ªè¿›ç¨‹é›†åˆï¼ˆæ¯”å¦‚ï¼šnginxçš„æ‰€æœ‰è¿›ç¨‹ï¼‰ï¼Œå¹¶é™åˆ¶ä»–ä»¬æ‰€æ¶ˆè´¹çš„èµ„æºï¼Œæ¯”å¦‚ç»‘å®šCPUçš„æ ¸ã€‚</li>
<li>ä¸ºè¿™ç»„è¿›ç¨‹åˆ†é…å…¶è¶³å¤Ÿä½¿ç”¨çš„å†…å­˜</li>
<li>ä¸ºè¿™ç»„è¿›ç¨‹åˆ†é…ç›¸åº”çš„ç½‘ç»œå¸¦å®½å’Œç£ç›˜å­˜å‚¨é™åˆ¶</li>
<li>é™åˆ¶è®¿é—®æŸäº›è®¾å¤‡ï¼ˆé€šè¿‡è®¾ç½®è®¾å¤‡çš„ç™½åå•ï¼‰</li>
</ul>
<p>Linux ç³»ç»Ÿä¸­ï¼Œä¸€åˆ‡çš†æ–‡ä»¶ã€‚Linux ä¹Ÿå°† cgroups å®ç°æˆäº†æ–‡ä»¶ç³»ç»Ÿï¼Œæ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">root@devstack:/home/sammy# mount -t cgroup</span><br><span class="line">cgroup on /sys/fs/cgroup/cpuset type cgroup (rw,relatime,cpuset)</span><br><span class="line">cgroup on /sys/fs/cgroup/cpu type cgroup (rw,relatime,cpu)</span><br><span class="line">systemd on /sys/fs/cgroup/systemd type cgroup (rw,noexec,nosuid,nodev,none,name=systemd)</span><br><span class="line"></span><br><span class="line">root@devstack:/home/sammy# lssubsys -m</span><br><span class="line">cpuset /sys/fs/cgroup/cpuset</span><br><span class="line">cpu /sys/fs/cgroup/cpu</span><br><span class="line">cpuacct /sys/fs/cgroup/cpuacct</span><br><span class="line">memory /sys/fs/cgroup/memory</span><br><span class="line">devices /sys/fs/cgroup/devices</span><br><span class="line">freezer /sys/fs/cgroup/freezer</span><br><span class="line">blkio /sys/fs/cgroup/blkio</span><br><span class="line">perf_event /sys/fs/cgroup/perf_event</span><br><span class="line">hugetlb /sys/fs/cgroup/hugetlb</span><br><span class="line"></span><br><span class="line">root@devstack:/home/sammy# ls /sys/fs/cgroup/ -l</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x 3 root root 0 Sep 18 21:46 blkio</span><br><span class="line">drwxr-xr-x 3 root root 0 Sep 18 21:46 cpu</span><br><span class="line">drwxr-xr-x 3 root root 0 Sep 18 21:46 cpuacct</span><br><span class="line">drwxr-xr-x 3 root root 0 Sep 18 21:46 cpuset</span><br><span class="line">drwxr-xr-x 3 root root 0 Sep 18 21:46 devices</span><br><span class="line">drwxr-xr-x 3 root root 0 Sep 18 21:46 freezer</span><br><span class="line">drwxr-xr-x 3 root root 0 Sep 18 21:46 hugetlb</span><br><span class="line">drwxr-xr-x 3 root root 0 Sep 18 21:46 memory</span><br><span class="line">drwxr-xr-x 3 root root 0 Sep 18 21:46 perf_event</span><br><span class="line">drwxr-xr-x 3 root root 0 Sep 18 21:46 systemd</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çœ‹åˆ° /sys/fs/cgroup ç›®å½•ä¸­æœ‰è‹¥å¹²ä¸ªå­ç›®å½•ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºè¿™äº›éƒ½æ˜¯å— cgroups æ§åˆ¶çš„èµ„æºä»¥åŠè¿™äº›èµ„æºçš„ä¿¡æ¯ã€‚</p>
<ul>
<li>blkio â€” è¿™â€‹â€‹â€‹ä¸ªâ€‹â€‹â€‹å­â€‹â€‹â€‹ç³»â€‹â€‹â€‹ç»Ÿâ€‹â€‹â€‹ä¸ºâ€‹â€‹â€‹å—â€‹â€‹â€‹è®¾â€‹â€‹â€‹å¤‡â€‹â€‹â€‹è®¾â€‹â€‹â€‹å®šâ€‹â€‹â€‹è¾“â€‹â€‹â€‹å…¥â€‹â€‹â€‹/è¾“â€‹â€‹â€‹å‡ºâ€‹â€‹â€‹é™â€‹â€‹â€‹åˆ¶â€‹â€‹â€‹ï¼Œæ¯”â€‹â€‹â€‹å¦‚â€‹â€‹â€‹ç‰©â€‹â€‹â€‹ç†â€‹â€‹â€‹è®¾â€‹â€‹â€‹å¤‡â€‹â€‹â€‹ï¼ˆç£â€‹â€‹â€‹ç›˜â€‹â€‹â€‹ï¼Œå›ºâ€‹â€‹â€‹æ€â€‹â€‹â€‹ç¡¬â€‹â€‹â€‹ç›˜â€‹â€‹â€‹ï¼ŒUSB ç­‰â€‹â€‹â€‹ç­‰â€‹â€‹â€‹ï¼‰ã€‚</li>
<li>cpu â€” è¿™â€‹â€‹â€‹ä¸ªâ€‹â€‹â€‹å­â€‹â€‹â€‹ç³»â€‹â€‹â€‹ç»Ÿâ€‹â€‹â€‹ä½¿â€‹â€‹â€‹ç”¨â€‹â€‹â€‹è°ƒâ€‹â€‹â€‹åº¦â€‹â€‹â€‹ç¨‹â€‹â€‹â€‹åºâ€‹â€‹â€‹æâ€‹â€‹â€‹ä¾›â€‹â€‹â€‹å¯¹â€‹â€‹â€‹ CPU çš„â€‹â€‹â€‹ cgroup ä»»â€‹â€‹â€‹åŠ¡â€‹â€‹â€‹è®¿â€‹â€‹â€‹é—®â€‹â€‹â€‹ã€‚â€‹â€‹â€‹</li>
<li>cpuacct â€” è¿™â€‹â€‹â€‹ä¸ªâ€‹â€‹â€‹å­â€‹â€‹â€‹ç³»â€‹â€‹â€‹ç»Ÿâ€‹â€‹â€‹è‡ªâ€‹â€‹â€‹åŠ¨â€‹â€‹â€‹ç”Ÿâ€‹â€‹â€‹æˆâ€‹â€‹â€‹ cgroup ä¸­â€‹â€‹â€‹ä»»â€‹â€‹â€‹åŠ¡â€‹â€‹â€‹æ‰€â€‹â€‹â€‹ä½¿â€‹â€‹â€‹ç”¨â€‹â€‹â€‹çš„â€‹â€‹â€‹ CPU æŠ¥â€‹â€‹â€‹å‘Šâ€‹â€‹â€‹ã€‚â€‹â€‹â€‹</li>
<li>cpuset â€” è¿™â€‹â€‹â€‹ä¸ªâ€‹â€‹â€‹å­â€‹â€‹â€‹ç³»â€‹â€‹â€‹ç»Ÿâ€‹â€‹â€‹ä¸ºâ€‹â€‹â€‹ cgroup ä¸­â€‹â€‹â€‹çš„â€‹â€‹â€‹ä»»â€‹â€‹â€‹åŠ¡â€‹â€‹â€‹åˆ†â€‹â€‹â€‹é…â€‹â€‹â€‹ç‹¬â€‹â€‹â€‹ç«‹â€‹â€‹â€‹ CPUï¼ˆåœ¨â€‹â€‹â€‹å¤šâ€‹â€‹â€‹æ ¸â€‹â€‹â€‹ç³»â€‹â€‹â€‹ç»Ÿâ€‹â€‹â€‹ï¼‰å’Œâ€‹â€‹â€‹å†…â€‹â€‹â€‹å­˜â€‹â€‹â€‹èŠ‚â€‹â€‹â€‹ç‚¹ã€‚</li>
<li>devices â€” è¿™â€‹â€‹â€‹ä¸ªâ€‹â€‹â€‹å­â€‹â€‹â€‹ç³»â€‹â€‹â€‹ç»Ÿâ€‹â€‹â€‹å¯â€‹â€‹â€‹å…â€‹â€‹â€‹è®¸â€‹â€‹â€‹æˆ–â€‹â€‹â€‹è€…â€‹â€‹â€‹æ‹’â€‹â€‹â€‹ç»â€‹â€‹â€‹ cgroup ä¸­â€‹â€‹â€‹çš„â€‹â€‹â€‹ä»»â€‹â€‹â€‹åŠ¡â€‹â€‹â€‹è®¿â€‹â€‹â€‹é—®â€‹â€‹â€‹è®¾â€‹â€‹â€‹å¤‡â€‹â€‹â€‹ã€‚â€‹â€‹â€‹</li>
<li>freezer â€” è¿™â€‹â€‹â€‹ä¸ªâ€‹â€‹â€‹å­â€‹â€‹â€‹ç³»â€‹â€‹â€‹ç»Ÿâ€‹â€‹â€‹æŒ‚â€‹â€‹â€‹èµ·â€‹â€‹â€‹æˆ–â€‹â€‹â€‹è€…â€‹â€‹â€‹æ¢â€‹â€‹â€‹å¤â€‹â€‹â€‹ cgroup ä¸­â€‹â€‹â€‹çš„â€‹â€‹â€‹ä»»â€‹â€‹â€‹åŠ¡â€‹â€‹â€‹ã€‚â€‹â€‹â€‹</li>
<li>memory â€” è¿™â€‹â€‹â€‹ä¸ªâ€‹â€‹â€‹å­â€‹â€‹â€‹ç³»â€‹â€‹â€‹ç»Ÿâ€‹â€‹â€‹è®¾â€‹â€‹â€‹å®šâ€‹â€‹â€‹ cgroup ä¸­â€‹â€‹â€‹ä»»â€‹â€‹â€‹åŠ¡â€‹â€‹â€‹ä½¿â€‹â€‹â€‹ç”¨â€‹â€‹â€‹çš„â€‹â€‹â€‹å†…â€‹â€‹â€‹å­˜â€‹â€‹â€‹é™â€‹â€‹â€‹åˆ¶â€‹â€‹â€‹ï¼Œå¹¶â€‹â€‹â€‹è‡ªâ€‹â€‹â€‹åŠ¨â€‹â€‹â€‹ç”Ÿâ€‹â€‹â€‹æˆâ€‹â€‹â€‹â€‹â€‹å†…â€‹â€‹â€‹å­˜â€‹â€‹â€‹èµ„â€‹æºä½¿ç”¨â€‹â€‹â€‹æŠ¥â€‹â€‹â€‹å‘Šâ€‹â€‹â€‹ã€‚â€‹â€‹â€‹</li>
<li>net_cls â€” è¿™â€‹â€‹â€‹ä¸ªâ€‹â€‹â€‹å­â€‹â€‹â€‹ç³»â€‹â€‹â€‹ç»Ÿâ€‹â€‹â€‹ä½¿â€‹â€‹â€‹ç”¨â€‹â€‹â€‹ç­‰â€‹â€‹â€‹çº§â€‹â€‹â€‹è¯†â€‹â€‹â€‹åˆ«â€‹â€‹â€‹ç¬¦â€‹â€‹â€‹ï¼ˆclassidï¼‰æ ‡â€‹â€‹â€‹è®°â€‹â€‹â€‹ç½‘â€‹â€‹â€‹ç»œâ€‹â€‹â€‹æ•°â€‹â€‹â€‹æ®â€‹â€‹â€‹åŒ…â€‹â€‹â€‹ï¼Œå¯â€‹â€‹â€‹å…â€‹â€‹â€‹è®¸â€‹â€‹â€‹ Linux æµé‡â€‹â€‹â€‹æ§â€‹â€‹â€‹åˆ¶â€‹â€‹â€‹ç¨‹â€‹â€‹â€‹åºâ€‹â€‹â€‹ï¼ˆtcï¼‰è¯†â€‹â€‹â€‹åˆ«â€‹â€‹â€‹ä»â€‹â€‹â€‹å…·â€‹â€‹â€‹ä½“â€‹â€‹â€‹ cgroup ä¸­â€‹â€‹â€‹ç”Ÿâ€‹â€‹â€‹æˆâ€‹â€‹â€‹çš„â€‹â€‹â€‹æ•°â€‹â€‹â€‹æ®â€‹â€‹â€‹åŒ…â€‹â€‹â€‹ã€‚â€‹â€‹â€‹</li>
<li>net_prio â€” è¿™ä¸ªå­ç³»ç»Ÿç”¨æ¥è®¾è®¡ç½‘ç»œæµé‡çš„ä¼˜å…ˆçº§</li>
<li>hugetlb â€” è¿™ä¸ªå­ç³»ç»Ÿä¸»è¦é’ˆå¯¹äºHugeTLBç³»ç»Ÿè¿›è¡Œé™åˆ¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤§é¡µæ–‡ä»¶ç³»ç»Ÿã€‚</li>
</ul>
<p>é»˜è®¤çš„è¯ï¼Œåœ¨ Ubuntu ç³»ç»Ÿä¸­ï¼Œä½ å¯èƒ½çœ‹ä¸åˆ° net_cls å’Œ net_prio ç›®å½•ï¼Œå®ƒä»¬éœ€è¦ä½ æ‰‹å·¥åš mountï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@devstack:/sys/fs/cgroup# modprobe cls_cgroup</span><br><span class="line">root@devstack:/sys/fs/cgroup# mkdir net_cls</span><br><span class="line">root@devstack:/sys/fs/cgroup# mount -t cgroup -o net_cls none net_cls</span><br><span class="line"></span><br><span class="line">root@devstack:/sys/fs/cgroup# modprobe netprio_cgroup</span><br><span class="line">root@devstack:/sys/fs/cgroup# mkdir net_prio</span><br><span class="line">root@devstack:/sys/fs/cgroup# mount -t cgroup -o net_prio none net_prio</span><br><span class="line"></span><br><span class="line">root@devstack:/sys/fs/cgroup# ls net_prio/cgroup.clone_children  cgroup.procs          net_prio.ifpriomap  notify_on_release  tasks</span><br><span class="line">cgroup.event_control   cgroup.sane_behavior  net_prio.prioidx    release_agent</span><br><span class="line">root@devstack:/sys/fs/cgroup# ls net_cls/</span><br><span class="line">cgroup.clone_children  cgroup.event_control  cgroup.procs  cgroup.sane_behavior  net_cls.classid  notify_on_release  release_agent  tasks</span><br></pre></td></tr></table></figure>
<h2 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h2><h3 id="é€šè¿‡-cgroups-é™åˆ¶è¿›ç¨‹çš„-CPU"><a href="#é€šè¿‡-cgroups-é™åˆ¶è¿›ç¨‹çš„-CPU" class="headerlink" title="é€šè¿‡ cgroups é™åˆ¶è¿›ç¨‹çš„ CPU"></a>é€šè¿‡ cgroups é™åˆ¶è¿›ç¨‹çš„ CPU</h3><p>å†™ä¸€æ®µæœ€ç®€å•çš„ C ç¨‹åºï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(;;) i++;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘ï¼Œè¿è¡Œï¼Œå‘ç°å®ƒå ç”¨çš„ CPU å‡ ä¹åˆ°äº† 100%ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND</span><br><span class="line">2204 root      20   0    4188    356    276 R 99.6  0.0   0:46.03 hello</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬åšå¦‚ä¸‹æ“ä½œï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@devstack:/home/sammy/c# mkdir /sys/fs/cgroup/cpu/hello</span><br><span class="line">root@devstack:/home/sammy/c# cd /sys/fs/cgroup/cpu/hello</span><br><span class="line">root@devstack:/sys/fs/cgroup/cpu/hello# ls</span><br><span class="line">cgroup.clone_children  cgroup.procs       cpu.cfs_quota_us  cpu.stat           tasks</span><br><span class="line">cgroup.event_control   cpu.cfs_period_us  cpu.shares        notify_on_release</span><br><span class="line">root@devstack:/sys/fs/cgroup/cpu/hello# cat cpu.cfs_quota_us</span><br><span class="line">-1</span><br><span class="line">root@devstack:/sys/fs/cgroup/cpu/hello# echo 20000 &gt; cpu.cfs_quota_us</span><br><span class="line">root@devstack:/sys/fs/cgroup/cpu/hello# cat cpu.cfs_quota_us</span><br><span class="line">20000</span><br><span class="line">root@devstack:/sys/fs/cgroup/cpu/hello# echo 2428 &gt; tasks</span><br></pre></td></tr></table></figure>
<p>ç„¶åå†æ¥çœ‹çœ‹è¿™ä¸ªè¿›ç¨‹çš„ CPU å ç”¨æƒ…å†µï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND</span><br><span class="line">2428 root      20   0    4188    356    276 R 19.9  0.0   0:46.03 hello</span><br></pre></td></tr></table></figure>
<p>å®ƒå ç”¨çš„ CPU å‡ ä¹å°±æ˜¯ 20%ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬é¢„è®¾çš„é˜ˆå€¼ã€‚è¿™è¯´æ˜æˆ‘ä»¬é€šè¿‡ä¸Šé¢çš„æ­¥éª¤ï¼ŒæˆåŠŸåœ°å°†è¿™ä¸ªè¿›ç¨‹è¿è¡Œæ‰€å ç”¨çš„ CPU èµ„æºé™åˆ¶åœ¨æŸä¸ªé˜ˆå€¼ä¹‹å†…äº†ã€‚</p>
<p>å¦‚æœæ­¤æ—¶å†å¯åŠ¨å¦ä¸€ä¸ª hello è¿›ç¨‹å¹¶å°†å…¶ id åŠ å…¥ tasks æ–‡ä»¶ï¼Œåˆ™ä¸¤ä¸ªè¿›ç¨‹ä¼šå…±äº«è®¾å®šçš„ CPU é™åˆ¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND</span><br><span class="line"> 2428 root      20   0    4188    356    276 R 10.0  0.0 285:39.54 hello</span><br><span class="line">12526 root      20   0    4188    356    276 R 10.0  0.0   0:25.09 hello</span><br></pre></td></tr></table></figure>
<h3 id="é€šè¿‡-cgroups-é™åˆ¶è¿›ç¨‹çš„-Memory"><a href="#é€šè¿‡-cgroups-é™åˆ¶è¿›ç¨‹çš„-Memory" class="headerlink" title="é€šè¿‡ cgroups é™åˆ¶è¿›ç¨‹çš„ Memory"></a>é€šè¿‡ cgroups é™åˆ¶è¿›ç¨‹çš„ Memory</h3><p>åŒæ ·åœ°ï¼Œæˆ‘ä»¬é’ˆå¯¹å®ƒå ç”¨çš„å†…å­˜åšå¦‚ä¸‹æ“ä½œï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@devstack:/sys/fs/cgroup/memory# mkdir hello</span><br><span class="line">root@devstack:/sys/fs/cgroup/memory# cd hello/</span><br><span class="line">root@devstack:/sys/fs/cgroup/memory/hello# cat memory.limit_in_bytes</span><br><span class="line">18446744073709551615</span><br><span class="line">root@devstack:/sys/fs/cgroup/memory/hello# echo 64k &gt; memory.limit_in_bytes</span><br><span class="line">root@devstack:/sys/fs/cgroup/memory/hello# echo 2428 &gt; tasks</span><br><span class="line">root@devstack:/sys/fs/cgroup/memory/hello#</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„æ­¥éª¤ä¼šæŠŠè¿›ç¨‹ 2428 è¯´å ç”¨çš„å†…å­˜é˜ˆå€¼è®¾ç½®ä¸º 64Kã€‚è¶…è¿‡çš„è¯ï¼Œå®ƒä¼šè¢«æ€æ‰ã€‚</p>
<h3 id="é™åˆ¶è¿›ç¨‹çš„-I-O"><a href="#é™åˆ¶è¿›ç¨‹çš„-I-O" class="headerlink" title="é™åˆ¶è¿›ç¨‹çš„ I/O"></a>é™åˆ¶è¿›ç¨‹çš„ I/O</h3><p>è¿è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dd if=/dev/sda1 of=/dev/null</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ iotop å‘½ä»¤çœ‹ IO ï¼ˆæ­¤æ—¶ç£ç›˜åœ¨å¿«é€Ÿè½¬åŠ¨ï¼‰ï¼Œæ­¤æ—¶å…¶å†™é€Ÿåº¦ä¸º 242M/sï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO&gt;    COMMAND</span><br><span class="line">2555 be/4 root      242.60 M/s    0.00 B/s  0.00 % 61.66 % dd if=/dev/sda1 of=/dev/null</span><br></pre></td></tr></table></figure>
<p>æ¥ç€åšä¸‹é¢çš„æ“ä½œï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@devstack:/home/sammy# mkdir /sys/fs/cgroup/blkio/io</span><br><span class="line">root@devstack:/home/sammy# cd /sys/fs/cgroup/blkio/io</span><br><span class="line">root@devstack:/sys/fs/cgroup/blkio/io# ls -l /dev/sda1</span><br><span class="line">brw-rw---- 1 root disk 8, 1 Sep 18 21:46 /dev/sda1</span><br><span class="line">root@devstack:/sys/fs/cgroup/blkio/io# echo &apos;8:0 1048576&apos;  &gt; /sys/fs/cgroup/blkio/io/blkio.throttle.read_bps_device</span><br><span class="line">root@devstack:/sys/fs/cgroup/blkio/io# echo 2725 &gt; /sys/fs/cgroup/blkio/io/tasks</span><br></pre></td></tr></table></figure>
<p>ç»“æœï¼Œè¿™ä¸ªè¿›ç¨‹çš„IO é€Ÿåº¦å°±è¢«é™åˆ¶åœ¨ 1Mb/s ä¹‹å†…äº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO&gt;    COMMAND</span><br><span class="line">2555 be/4 root      990.44 K/s    0.00 B/s  0.00 % 96.29 % dd if=/dev/sda1 of=/dev/null</span><br></pre></td></tr></table></figure>
<h2 id="æœ¯è¯­"><a href="#æœ¯è¯­" class="headerlink" title="æœ¯è¯­"></a>æœ¯è¯­</h2><p>cgroups çš„æœ¯è¯­åŒ…æ‹¬ï¼š</p>
<ul>
<li>ä»»åŠ¡ï¼ˆTasksï¼‰ï¼šå°±æ˜¯ç³»ç»Ÿçš„ä¸€ä¸ªè¿›ç¨‹ã€‚</li>
<li>æ§åˆ¶ç»„ï¼ˆControl Groupï¼‰ï¼šä¸€ç»„æŒ‰ç…§æŸç§æ ‡å‡†åˆ’åˆ†çš„è¿›ç¨‹ï¼Œæ¯”å¦‚å®˜æ–¹æ–‡æ¡£ä¸­çš„Professorå’ŒStudentï¼Œæˆ–æ˜¯WWWå’ŒSystemä¹‹ç±»çš„ï¼Œå…¶è¡¨ç¤ºäº†æŸè¿›ç¨‹ç»„ã€‚Cgroupsä¸­çš„èµ„æºæ§åˆ¶éƒ½æ˜¯ä»¥æ§åˆ¶ç»„ä¸ºå•ä½å®ç°ã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŠ å…¥åˆ°æŸä¸ªæ§åˆ¶ç»„ã€‚è€Œèµ„æºçš„é™åˆ¶æ˜¯å®šä¹‰åœ¨è¿™ä¸ªç»„ä¸Šï¼Œå°±åƒä¸Šé¢ç¤ºä¾‹ä¸­æˆ‘ç”¨çš„ hello ä¸€æ ·ã€‚ç®€å•ç‚¹è¯´ï¼Œcgroupçš„å‘ˆç°å°±æ˜¯ä¸€ä¸ªç›®å½•å¸¦ä¸€ç³»åˆ—çš„å¯é…ç½®æ–‡ä»¶ã€‚</li>
<li>å±‚çº§ï¼ˆHierarchyï¼‰ï¼šæ§åˆ¶ç»„å¯ä»¥ç»„ç»‡æˆhierarchicalçš„å½¢å¼ï¼Œæ—¢ä¸€é¢—æ§åˆ¶ç»„çš„æ ‘ï¼ˆç›®å½•ç»“æ„ï¼‰ã€‚æ§åˆ¶ç»„æ ‘ä¸Šçš„å­èŠ‚ç‚¹ç»§æ‰¿çˆ¶ç»“ç‚¹çš„å±æ€§ã€‚ç®€å•ç‚¹è¯´ï¼Œhierarchyå°±æ˜¯åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªå­ç³»ç»Ÿä¸Šçš„cgroupsç›®å½•æ ‘ã€‚</li>
<li>å­ç³»ç»Ÿï¼ˆSubsystemï¼‰ï¼šä¸€ä¸ªå­ç³»ç»Ÿå°±æ˜¯ä¸€ä¸ªèµ„æºæ§åˆ¶å™¨ï¼Œæ¯”å¦‚CPUå­ç³»ç»Ÿå°±æ˜¯æ§åˆ¶CPUæ—¶é—´åˆ†é…çš„ä¸€ä¸ªæ§åˆ¶å™¨ã€‚å­ç³»ç»Ÿå¿…é¡»é™„åŠ åˆ°ä¸€ä¸ªå±‚çº§ä¸Šæ‰èƒ½èµ·ä½œç”¨ï¼Œä¸€ä¸ªå­ç³»ç»Ÿé™„åŠ åˆ°æŸä¸ªå±‚çº§ä»¥åï¼Œè¿™ä¸ªå±‚çº§ä¸Šçš„æ‰€æœ‰æ§åˆ¶æ—ç¾¤éƒ½å—åˆ°è¿™ä¸ªå­ç³»ç»Ÿçš„æ§åˆ¶ã€‚Cgroupçš„å­ç³»ç»Ÿå¯ä»¥æœ‰å¾ˆå¤šï¼Œä¹Ÿåœ¨ä¸æ–­å¢åŠ ä¸­ã€‚</li>
</ul>
<h1 id="Docker-å¯¹-cgroups-çš„ä½¿ç”¨"><a href="#Docker-å¯¹-cgroups-çš„ä½¿ç”¨" class="headerlink" title="Docker å¯¹ cgroups çš„ä½¿ç”¨"></a>Docker å¯¹ cgroups çš„ä½¿ç”¨</h1><h2 id="é»˜è®¤æƒ…å†µ"><a href="#é»˜è®¤æƒ…å†µ" class="headerlink" title="é»˜è®¤æƒ…å†µ"></a>é»˜è®¤æƒ…å†µ</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒDocker å¯åŠ¨ä¸€ä¸ªå®¹å™¨åï¼Œä¼šåœ¨ /sys/fs/cgroup ç›®å½•ä¸‹çš„å„ä¸ªèµ„æºç›®å½•ä¸‹ç”Ÿæˆä»¥å®¹å™¨ ID ä¸ºåå­—çš„ç›®å½•ï¼ˆgroupï¼‰ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/sys/fs/cgroup/cpu/docker/03dd196f415276375f754d51ce29b418b170bd92d88c5e420d6901c32f93dc14</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶ cpu.cfs_quota_us çš„å†…å®¹ä¸º -1ï¼Œè¡¨ç¤ºé»˜è®¤æƒ…å†µä¸‹å¹¶æ²¡æœ‰é™åˆ¶å®¹å™¨çš„ CPU ä½¿ç”¨ã€‚åœ¨å®¹å™¨è¢« stopped åï¼Œè¯¥ç›®å½•è¢«åˆ é™¤ã€‚</p>
<p>è¿è¡Œå‘½ä»¤ docker run -d â€“name web41 â€“cpu-quota 25000 â€“cpu-period 100 â€“cpu-shares 30 training/webapp python app.py å¯åŠ¨ä¸€ä¸ªæ–°çš„å®¹å™¨ï¼Œç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@devstack:/sys/fs/cgroup/cpu/docker/06bd180cd340f8288c18e8f0e01ade66d066058dd053ef46161eb682ab69ec24# cat cpu.cfs_quota_us</span><br><span class="line">25000</span><br><span class="line">root@devstack:/sys/fs/cgroup/cpu/docker/06bd180cd340f8288c18e8f0e01ade66d066058dd053ef46161eb682ab69ec24# cat tasks</span><br><span class="line">3704</span><br><span class="line">root@devstack:/sys/fs/cgroup/cpu/docker/06bd180cd340f8288c18e8f0e01ade66d066058dd053ef46161eb682ab69ec24# cat cpu.cfs_period_us</span><br><span class="line">2000</span><br></pre></td></tr></table></figure>
<p>Docker ä¼šå°†å®¹å™¨ä¸­çš„è¿›ç¨‹çš„ ID åŠ å…¥åˆ°å„ä¸ªèµ„æºå¯¹åº”çš„ tasks æ–‡ä»¶ä¸­ã€‚è¡¨ç¤º Docker ä¹Ÿæ˜¯ä»¥ä¸Šé¢çš„æœºåˆ¶æ¥ä½¿ç”¨ cgroups å¯¹å®¹å™¨çš„ CPU ä½¿ç”¨è¿›è¡Œé™åˆ¶ã€‚</p>
<p>ç›¸ä¼¼åœ°ï¼Œå¯ä»¥é€šè¿‡ docker run ä¸­ mem ç›¸å…³çš„å‚æ•°å¯¹å®¹å™¨çš„å†…å­˜ä½¿ç”¨è¿›è¡Œé™åˆ¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    --cpuset-mems string          MEMs in which to allow execution (0-3, 0,1)</span><br><span class="line">    --kernel-memory string        Kernel memory limit</span><br><span class="line">-m, --memory string               Memory limit</span><br><span class="line">    --memory-reservation string   Memory soft limit</span><br><span class="line">    --memory-swap string          Swap limit equal to memory plus swap: &apos;-1&apos; to enable unlimited swap</span><br><span class="line">    --memory-swappiness int       Tune container memory swappiness (0 to 100) (default -1)</span><br></pre></td></tr></table></figure>
<p>æ¯”å¦‚  docker run -d â€“name web42 â€“blkio-weight 100 â€“memory 10M â€“cpu-quota 25000 â€“cpu-period 2000 â€“cpu-shares 30 training/webapp python app.pyï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@devstack:/sys/fs/cgroup/memory/docker/ec8d850ebbabaf24df572cb5acd89a6e7a953fe5aa5d3c6a69c4532f92b57410# cat memory.limit_in_bytes</span><br><span class="line">10485760</span><br><span class="line">  root@devstack:/sys/fs/cgroup/blkio/docker/ec8d850ebbabaf24df572cb5acd89a6e7a953fe5aa5d3c6a69c4532f92b57410# cat blkio.weight</span><br><span class="line">  100</span><br></pre></td></tr></table></figure>
<p>ç›®å‰ docker å·²ç»å‡ ä¹æ”¯æŒäº†æ‰€æœ‰çš„ cgroups èµ„æºï¼Œå¯ä»¥é™åˆ¶å®¹å™¨å¯¹åŒ…æ‹¬ networkï¼Œdeviceï¼Œcpu å’Œ memory åœ¨å†…çš„èµ„æºçš„ä½¿ç”¨ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@devstack:/sys/fs/cgroup# find -iname ec8d850ebbabaf24df572cb5acd89a6e7a953fe5aa5d3c6a69c4532f92b57410</span><br><span class="line">./net_prio/docker/ec8d850ebbabaf24df572cb5acd89a6e7a953fe5aa5d3c6a69c4532f92b57410</span><br><span class="line">./net_cls/docker/ec8d850ebbabaf24df572cb5acd89a6e7a953fe5aa5d3c6a69c4532f92b57410</span><br><span class="line">./systemd/docker/ec8d850ebbabaf24df572cb5acd89a6e7a953fe5aa5d3c6a69c4532f92b57410</span><br><span class="line">./hugetlb/docker/ec8d850ebbabaf24df572cb5acd89a6e7a953fe5aa5d3c6a69c4532f92b57410</span><br><span class="line">./perf_event/docker/ec8d850ebbabaf24df572cb5acd89a6e7a953fe5aa5d3c6a69c4532f92b57410</span><br><span class="line">./blkio/docker/ec8d850ebbabaf24df572cb5acd89a6e7a953fe5aa5d3c6a69c4532f92b57410</span><br><span class="line">./freezer/docker/ec8d850ebbabaf24df572cb5acd89a6e7a953fe5aa5d3c6a69c4532f92b57410</span><br><span class="line">./devices/docker/ec8d850ebbabaf24df572cb5acd89a6e7a953fe5aa5d3c6a69c4532f92b57410</span><br><span class="line">./memory/docker/ec8d850ebbabaf24df572cb5acd89a6e7a953fe5aa5d3c6a69c4532f92b57410</span><br><span class="line">./cpuacct/docker/ec8d850ebbabaf24df572cb5acd89a6e7a953fe5aa5d3c6a69c4532f92b57410</span><br><span class="line">./cpu/docker/ec8d850ebbabaf24df572cb5acd89a6e7a953fe5aa5d3c6a69c4532f92b57410</span><br><span class="line">./cpuset/docker/ec8d850ebbabaf24df572cb5acd89a6e7a953fe5aa5d3c6a69c4532f92b57410</span><br></pre></td></tr></table></figure>
<h1 id="Docker-run-å‘½ä»¤ä¸­-cgroups-ç›¸å…³å‘½ä»¤"><a href="#Docker-run-å‘½ä»¤ä¸­-cgroups-ç›¸å…³å‘½ä»¤" class="headerlink" title="Docker run å‘½ä»¤ä¸­ cgroups ç›¸å…³å‘½ä»¤"></a>Docker run å‘½ä»¤ä¸­ cgroups ç›¸å…³å‘½ä»¤</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">block IO:</span><br><span class="line">      --blkio-weight value          Block IO (relative weight), between 10 and 1000</span><br><span class="line">      --blkio-weight-device value   Block IO weight (relative device weight) (default [])</span><br><span class="line">      --cgroup-parent string        Optional parent cgroup for the container</span><br><span class="line">CPU:</span><br><span class="line">      --cpu-percent int             CPU percent (Windows only)</span><br><span class="line">      --cpu-period int              Limit CPU CFS (Completely Fair Scheduler) period</span><br><span class="line">      --cpu-quota int               Limit CPU CFS (Completely Fair Scheduler) quota</span><br><span class="line">  -c, --cpu-shares int              CPU shares (relative weight)</span><br><span class="line">      --cpuset-cpus string          CPUs in which to allow execution (0-3, 0,1)</span><br><span class="line">      --cpuset-mems string          MEMs in which to allow execution (0-3, 0,1)</span><br><span class="line">Device:    </span><br><span class="line">      --device value                Add a host device to the container (default [])</span><br><span class="line">      --device-read-bps value       Limit read rate (bytes per second) from a device (default [])</span><br><span class="line">      --device-read-iops value      Limit read rate (IO per second) from a device (default [])</span><br><span class="line">      --device-write-bps value      Limit write rate (bytes per second) to a device (default [])</span><br><span class="line">      --device-write-iops value     Limit write rate (IO per second) to a device (default [])</span><br><span class="line">Memory:      </span><br><span class="line">      --kernel-memory string        Kernel memory limit</span><br><span class="line">  -m, --memory string               Memory limit</span><br><span class="line">      --memory-reservation string   Memory soft limit</span><br><span class="line">      --memory-swap string          Swap limit equal to memory plus swap: &apos;-1&apos; to enable unlimited swap</span><br><span class="line">      --memory-swappiness int       Tune container memory swappiness (0 to 100) (default -1)</span><br></pre></td></tr></table></figure>
<p>ä¸€äº›è¯´æ˜ï¼š</p>
<ol>
<li>cgroup åªèƒ½é™åˆ¶ CPU çš„ä½¿ç”¨ï¼Œè€Œä¸èƒ½ä¿è¯CPUçš„ä½¿ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ ä½¿ç”¨ cpuset-cpusï¼Œå¯ä»¥è®©å®¹å™¨åœ¨æŒ‡å®šçš„CPUæˆ–è€…æ ¸ä¸Šè¿è¡Œï¼Œä½†æ˜¯ä¸èƒ½ç¡®ä¿å®ƒç‹¬å è¿™äº›CPUï¼›cpu-shares æ˜¯ä¸ªç›¸å¯¹å€¼ï¼Œåªæœ‰åœ¨CPUä¸å¤Ÿç”¨çš„æ—¶å€™æ‰å…¶ä½œç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“CPUå¤Ÿç”¨çš„æ—¶å€™ï¼Œæ¯ä¸ªå®¹å™¨ä¼šåˆ†åˆ°è¶³å¤Ÿçš„CPUï¼›ä¸å¤Ÿç”¨çš„æ—¶å€™ï¼Œä¼šæŒ‰ç…§æŒ‡å®šçš„æ¯”é‡åœ¨å¤šä¸ªå®¹å™¨ä¹‹é—´åˆ†é…CPUã€‚</li>
<li>å¯¹å†…å­˜æ¥è¯´ï¼Œcgroups å¯ä»¥é™åˆ¶å®¹å™¨æœ€å¤šä½¿ç”¨çš„å†…å­˜ã€‚ä½¿ç”¨ -m å‚æ•°å¯ä»¥è®¾ç½®æœ€å¤šå¯ä»¥ä½¿ç”¨çš„å†…å­˜ã€‚</li>
</ol>
<h1 id="Docker-ç½‘ç»œæ¦‚å†µ"><a href="#Docker-ç½‘ç»œæ¦‚å†µ" class="headerlink" title="Docker ç½‘ç»œæ¦‚å†µ"></a>Docker ç½‘ç»œæ¦‚å†µ</h1><p>ç”¨ä¸€å¼ å›¾æ¥è¯´æ˜ Docker ç½‘ç»œçš„åŸºæœ¬æ¦‚å†µï¼š</p>
<p><a href="http://idiotsky.top/images3/docker-summary-5.jpg"><img src="http://idiotsky.top/images3/docker-summary-5.jpg" alt=""></a></p>
<h1 id="å››ç§å•èŠ‚ç‚¹ç½‘ç»œæ¨¡å¼"><a href="#å››ç§å•èŠ‚ç‚¹ç½‘ç»œæ¨¡å¼" class="headerlink" title="å››ç§å•èŠ‚ç‚¹ç½‘ç»œæ¨¡å¼"></a>å››ç§å•èŠ‚ç‚¹ç½‘ç»œæ¨¡å¼</h1><h2 id="bridge-æ¨¡å¼"><a href="#bridge-æ¨¡å¼" class="headerlink" title="bridge æ¨¡å¼"></a>bridge æ¨¡å¼</h2><p>Docker å®¹å™¨é»˜è®¤ä½¿ç”¨ bridge æ¨¡å¼çš„ç½‘ç»œã€‚å…¶ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä½¿ç”¨ä¸€ä¸ª linux bridgeï¼Œé»˜è®¤ä¸º docker0</li>
<li>ä½¿ç”¨ veth å¯¹ï¼Œä¸€å¤´åœ¨å®¹å™¨çš„ç½‘ç»œ namespace ä¸­ï¼Œä¸€å¤´åœ¨ docker0 ä¸Š</li>
<li>è¯¥æ¨¡å¼ä¸‹Docker Containerä¸å…·æœ‰ä¸€ä¸ªå…¬æœ‰IPï¼Œå› ä¸ºå®¿ä¸»æœºçš„IPåœ°å€ä¸veth pairçš„ IPåœ°å€ä¸åœ¨åŒä¸€ä¸ªç½‘æ®µå†…</li>
<li>Dockeré‡‡ç”¨ NAT æ–¹å¼ï¼Œå°†å®¹å™¨å†…éƒ¨çš„æœåŠ¡ç›‘å¬çš„ç«¯å£ä¸å®¿ä¸»æœºçš„æŸä¸€ä¸ªç«¯å£port è¿›è¡Œâ€œç»‘å®šâ€ï¼Œä½¿å¾—å®¿ä¸»æœºä»¥å¤–çš„ä¸–ç•Œå¯ä»¥ä¸»åŠ¨å°†ç½‘ç»œæŠ¥æ–‡å‘é€è‡³å®¹å™¨å†…éƒ¨</li>
<li>å¤–ç•Œè®¿é—®å®¹å™¨å†…çš„æœåŠ¡æ—¶ï¼Œéœ€è¦è®¿é—®å®¿ä¸»æœºçš„ IP ä»¥åŠå®¿ä¸»æœºçš„ç«¯å£ port</li>
<li>NAT æ¨¡å¼ç”±äºæ˜¯åœ¨ä¸‰å±‚ç½‘ç»œä¸Šçš„å®ç°æ‰‹æ®µï¼Œæ•…è‚¯å®šä¼šå½±å“ç½‘ç»œçš„ä¼ è¾“æ•ˆç‡ã€‚</li>
<li>å®¹å™¨æ‹¥æœ‰ç‹¬ç«‹ã€éš”ç¦»çš„ç½‘ç»œæ ˆï¼›è®©å®¹å™¨å’Œå®¿ä¸»æœºä»¥å¤–çš„ä¸–ç•Œé€šè¿‡NATå»ºç«‹é€šä¿¡</li>
</ul>
<p>iptables çš„ SNTA è§„åˆ™ï¼Œä½¿å¾—ä»å®¹å™¨ç¦»å¼€å»å¤–ç•Œçš„ç½‘ç»œåŒ…çš„æº IP åœ°å€è¢«è½¬æ¢ä¸º Docker ä¸»æœºçš„IPåœ°å€ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Chain POSTROUTING (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination</span><br><span class="line">MASQUERADE  all  --  172.17.0.0/16        0.0.0.0/0</span><br><span class="line">MASQUERADE  all  --  172.18.0.0/16        0.0.0.0/0</span><br></pre></td></tr></table></figure>
<p>ç¤ºæ„å›¾ï¼š</p>
<p><a href="http://idiotsky.top/images3/docker-summary-6.jpg"><img src="http://idiotsky.top/images3/docker-summary-6.jpg" alt=""></a></p>
<h2 id="Host-æ¨¡å¼"><a href="#Host-æ¨¡å¼" class="headerlink" title="Host æ¨¡å¼"></a>Host æ¨¡å¼</h2><p>å®šä¹‰ï¼š</p>
<p>Host æ¨¡å¼å¹¶æ²¡æœ‰ä¸ºå®¹å™¨åˆ›å»ºä¸€ä¸ªéš”ç¦»çš„ç½‘ç»œç¯å¢ƒã€‚è€Œä¹‹æ‰€ä»¥ç§°ä¹‹ä¸ºhostæ¨¡å¼ï¼Œæ˜¯å› ä¸ºè¯¥æ¨¡å¼ä¸‹çš„ Docker å®¹å™¨ä¼šå’Œ host å®¿ä¸»æœºå…±äº«åŒä¸€ä¸ªç½‘ç»œ namespaceï¼Œæ•… Docker Containerå¯ä»¥å’Œå®¿ä¸»æœºä¸€æ ·ï¼Œä½¿ç”¨å®¿ä¸»æœºçš„eth0ï¼Œå®ç°å’Œå¤–ç•Œçš„é€šä¿¡ã€‚æ¢è¨€ä¹‹ï¼ŒDocker Containerçš„ IP åœ°å€å³ä¸ºå®¿ä¸»æœº eth0 çš„ IP åœ°å€ã€‚å…¶ç‰¹ç‚¹åŒ…æ‹¬ï¼š</p>
<ul>
<li>è¿™ç§æ¨¡å¼ä¸‹çš„å®¹å™¨æ²¡æœ‰éš”ç¦»çš„ network namespace</li>
<li>å®¹å™¨çš„ IP åœ°å€åŒ Docker host çš„ IP åœ°å€</li>
<li>éœ€è¦æ³¨æ„å®¹å™¨ä¸­æœåŠ¡çš„ç«¯å£å·ä¸èƒ½ä¸ Docker host ä¸Šå·²ç»ä½¿ç”¨çš„ç«¯å£å·ç›¸å†²çª</li>
<li>host æ¨¡å¼èƒ½å¤Ÿå’Œå…¶å®ƒæ¨¡å¼å…±å­˜</li>
</ul>
<p>ç¤ºæ„å›¾ï¼š</p>
<p><a href="http://idiotsky.top/images3/docker-summary-7.jpg"><img src="http://idiotsky.top/images3/docker-summary-7.jpg" alt=""></a></p>
<h2 id="container-æ¨¡å¼"><a href="#container-æ¨¡å¼" class="headerlink" title="container æ¨¡å¼"></a>container æ¨¡å¼</h2><p>å®šä¹‰ï¼š</p>
<p>Container ç½‘ç»œæ¨¡å¼æ˜¯ Docker ä¸­ä¸€ç§è¾ƒä¸ºç‰¹åˆ«çš„ç½‘ç»œçš„æ¨¡å¼ã€‚å¤„äºè¿™ä¸ªæ¨¡å¼ä¸‹çš„ Docker å®¹å™¨ä¼šå…±äº«å…¶ä»–å®¹å™¨çš„ç½‘ç»œç¯å¢ƒï¼Œå› æ­¤ï¼Œè‡³å°‘è¿™ä¸¤ä¸ªå®¹å™¨ä¹‹é—´ä¸å­˜åœ¨ç½‘ç»œéš”ç¦»ï¼Œè€Œè¿™ä¸¤ä¸ªå®¹å™¨åˆä¸å®¿ä¸»æœºä»¥åŠé™¤æ­¤ä¹‹å¤–å…¶ä»–çš„å®¹å™¨å­˜åœ¨ç½‘ç»œéš”ç¦»ã€‚  </p>
<p>ç¤ºæ„å›¾ï¼š</p>
<p><a href="http://idiotsky.top/images3/docker-summary-8.jpg"><img src="http://idiotsky.top/images3/docker-summary-8.jpg" alt=""></a></p>
<h2 id="none-æ¨¡å¼"><a href="#none-æ¨¡å¼" class="headerlink" title="none æ¨¡å¼"></a>none æ¨¡å¼</h2><p>å®šä¹‰ï¼š</p>
<p>ç½‘ç»œæ¨¡å¼ä¸º noneï¼Œå³ä¸ä¸º Docker å®¹å™¨æ„é€ ä»»ä½•ç½‘ç»œç¯å¢ƒã€‚ä¸€æ—¦Docker å®¹å™¨é‡‡ç”¨äº†none ç½‘ç»œæ¨¡å¼ï¼Œé‚£ä¹ˆå®¹å™¨å†…éƒ¨å°±åªèƒ½ä½¿ç”¨loopbackç½‘ç»œè®¾å¤‡ï¼Œä¸ä¼šå†æœ‰å…¶ä»–çš„ç½‘ç»œèµ„æºã€‚Docker Containerçš„noneç½‘ç»œæ¨¡å¼æ„å‘³ç€ä¸ç»™è¯¥å®¹å™¨åˆ›å»ºä»»ä½•ç½‘ç»œç¯å¢ƒï¼Œå®¹å™¨åªèƒ½ä½¿ç”¨127.0.0.1çš„æœ¬æœºç½‘ç»œã€‚</p>
<blockquote>
<p>to be continue â€¦</p>
</blockquote>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="http://www.cnblogs.com/sammyliu/p/5875470.html" target="_blank" rel="noopener">http://www.cnblogs.com/sammyliu/p/5875470.html</a></p>
<p><a href="http://www.cnblogs.com/sammyliu/p/5878973.html" target="_blank" rel="noopener">http://www.cnblogs.com/sammyliu/p/5878973.html</a></p>
<p><a href="http://www.cnblogs.com/sammyliu/p/5886833.html" target="_blank" rel="noopener">http://www.cnblogs.com/sammyliu/p/5886833.html</a></p>
<p><a href="https://segmentfault.com/a/1190000006912742" target="_blank" rel="noopener">https://segmentfault.com/a/1190000006912742</a></p>
<p><a href="https://coolshell.cn/articles/17010.html" target="_blank" rel="noopener">https://coolshell.cn/articles/17010.html</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/docker/" rel="tag"># docker</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/09/17/tcmalloc/" rel="next" title="TCMallocï¼šThread-Caching(çº¿ç¨‹ç¼“å­˜)Malloc">
                <i class="fa fa-chevron-left"></i> TCMallocï¼šThread-Caching(çº¿ç¨‹ç¼“å­˜)Malloc
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/11/06/CircuitBreaker/" rel="prev" title="ç†”æ–­å™¨æ¦‚å¿µ">
                ç†”æ–­å™¨æ¦‚å¿µ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://avatars7.githubusercontent.com/u/22493186?v=4&s=460"
               alt="ejunjsh" />
          <p class="site-author-name" itemprop="name">ejunjsh</p>
           
              <p class="site-description motion-element" itemprop="description">code freak</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">155</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">150</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ejunjsh" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/339238080" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                    
                      Weibo
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="mailto:sjj050121014@163.com" target="_blank" title="Email">
                  
                    <i class="fa fa-fw fa-envelope"></i>
                  
                    
                      Email
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.facebook.com/junjie.shao.9" target="_blank" title="FB Page">
                  
                    <i class="fa fa-fw fa-facebook"></i>
                  
                    
                      FB Page
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#docker-å®¹å™¨çš„çŠ¶æ€æœº"><span class="nav-number">1.</span> <span class="nav-text">docker å®¹å™¨çš„çŠ¶æ€æœº</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-å‘½ä»¤æ¦‚è¿°"><span class="nav-number">2.</span> <span class="nav-text">Docker å‘½ä»¤æ¦‚è¿°</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Doker-å¹³å°çš„åŸºæœ¬æ„æˆ"><span class="nav-number">3.</span> <span class="nav-text">Doker å¹³å°çš„åŸºæœ¬æ„æˆ</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Host-OS-VS-Guest-OS-VS-Base-image"><span class="nav-number">4.</span> <span class="nav-text">Host OS VS Guest OS VS Base image</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-é•œåƒåˆ†å±‚-COW-å’Œ-é•œåƒå¤§å°ï¼ˆsizeï¼‰"><span class="nav-number">5.</span> <span class="nav-text">Docker é•œåƒåˆ†å±‚,COW å’Œ é•œåƒå¤§å°ï¼ˆsizeï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#é•œåƒåˆ†å±‚å’Œå®¹å™¨å±‚"><span class="nav-number">5.1.</span> <span class="nav-text">é•œåƒåˆ†å±‚å’Œå®¹å™¨å±‚</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#COW-å’Œé•œåƒå¤§å°"><span class="nav-number">5.2.</span> <span class="nav-text">COW å’Œé•œåƒå¤§å°</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä½¿ç”¨å®¹å™¨éœ€è¦é¿å…çš„ä¸€äº›åšæ³•"><span class="nav-number">5.3.</span> <span class="nav-text">ä½¿ç”¨å®¹å™¨éœ€è¦é¿å…çš„ä¸€äº›åšæ³•</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Linux-namespace-çš„æ¦‚å¿µ"><span class="nav-number">6.</span> <span class="nav-text">Linux namespace çš„æ¦‚å¿µ</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-å®¹å™¨ä½¿ç”¨-linux-namespace-åšè¿è¡Œç¯å¢ƒéš”ç¦»"><span class="nav-number">7.</span> <span class="nav-text">Docker å®¹å™¨ä½¿ç”¨ linux namespace åšè¿è¡Œç¯å¢ƒéš”ç¦»</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Mount-Namespace"><span class="nav-number">7.1.</span> <span class="nav-text">Mount Namespace</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PID-namespace"><span class="nav-number">7.2.</span> <span class="nav-text">PID namespace</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UTS-namespace"><span class="nav-number">7.3.</span> <span class="nav-text">UTS namespace</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IPC-Namespace"><span class="nav-number">7.4.</span> <span class="nav-text">IPC Namespace</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#user-namespace"><span class="nav-number">7.5.</span> <span class="nav-text">user namespace</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#network-namespace"><span class="nav-number">7.6.</span> <span class="nav-text">network namespace</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Linux-control-groups"><span class="nav-number">8.</span> <span class="nav-text">Linux control groups</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#æ¦‚å¿µ"><span class="nav-number">8.1.</span> <span class="nav-text">æ¦‚å¿µ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®éªŒ"><span class="nav-number">8.2.</span> <span class="nav-text">å®éªŒ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#é€šè¿‡-cgroups-é™åˆ¶è¿›ç¨‹çš„-CPU"><span class="nav-number">8.2.1.</span> <span class="nav-text">é€šè¿‡ cgroups é™åˆ¶è¿›ç¨‹çš„ CPU</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#é€šè¿‡-cgroups-é™åˆ¶è¿›ç¨‹çš„-Memory"><span class="nav-number">8.2.2.</span> <span class="nav-text">é€šè¿‡ cgroups é™åˆ¶è¿›ç¨‹çš„ Memory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#é™åˆ¶è¿›ç¨‹çš„-I-O"><span class="nav-number">8.2.3.</span> <span class="nav-text">é™åˆ¶è¿›ç¨‹çš„ I/O</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æœ¯è¯­"><span class="nav-number">8.3.</span> <span class="nav-text">æœ¯è¯­</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-å¯¹-cgroups-çš„ä½¿ç”¨"><span class="nav-number">9.</span> <span class="nav-text">Docker å¯¹ cgroups çš„ä½¿ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#é»˜è®¤æƒ…å†µ"><span class="nav-number">9.1.</span> <span class="nav-text">é»˜è®¤æƒ…å†µ</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-run-å‘½ä»¤ä¸­-cgroups-ç›¸å…³å‘½ä»¤"><span class="nav-number">10.</span> <span class="nav-text">Docker run å‘½ä»¤ä¸­ cgroups ç›¸å…³å‘½ä»¤</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Docker-ç½‘ç»œæ¦‚å†µ"><span class="nav-number">11.</span> <span class="nav-text">Docker ç½‘ç»œæ¦‚å†µ</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#å››ç§å•èŠ‚ç‚¹ç½‘ç»œæ¨¡å¼"><span class="nav-number">12.</span> <span class="nav-text">å››ç§å•èŠ‚ç‚¹ç½‘ç»œæ¨¡å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#bridge-æ¨¡å¼"><span class="nav-number">12.1.</span> <span class="nav-text">bridge æ¨¡å¼</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Host-æ¨¡å¼"><span class="nav-number">12.2.</span> <span class="nav-text">Host æ¨¡å¼</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#container-æ¨¡å¼"><span class="nav-number">12.3.</span> <span class="nav-text">container æ¨¡å¼</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#none-æ¨¡å¼"><span class="nav-number">12.4.</span> <span class="nav-text">none æ¨¡å¼</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#å‚è€ƒ"><span class="nav-number">13.</span> <span class="nav-text">å‚è€ƒ</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2014 &mdash; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <a href="/mylove" style="border-bottom:none">
    <i class="fa fa-heart"></i>
    </a>
  </span>
  <span class="author" itemprop="copyrightHolder">ejunjsh</span>

  
</div>


  <div class="powered-by">
    Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
  </div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">
    Theme &mdash;
    <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
      NexT.Gemini
    </a>
  </div>


        







        
      </div>
    </footer>

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.2"></script>



  

  

  

  

  

  

</body>
</html>
